function N0(n,e){for(var r=0;r<e.length;r++){const o=e[r];if(typeof o!="string"&&!Array.isArray(o)){for(const c in o)if(c!=="default"&&!(c in n)){const h=Object.getOwnPropertyDescriptor(o,c);h&&Object.defineProperty(n,c,h.get?h:{enumerable:!0,get:()=>o[c]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const h of c)if(h.type==="childList")for(const p of h.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&o(p)}).observe(document,{childList:!0,subtree:!0});function r(c){const h={};return c.integrity&&(h.integrity=c.integrity),c.referrerpolicy&&(h.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?h.credentials="include":c.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function o(c){if(c.ep)return;c.ep=!0;const h=r(c);fetch(c.href,h)}})();function gr(){}function rh(n){return n()}function kc(){return Object.create(null)}function ni(n){n.forEach(rh)}function ih(n){return typeof n=="function"}function sh(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function R0(n){return Object.keys(n).length===0}function Xe(n,e){n.appendChild(e)}function ri(n,e,r){n.insertBefore(e,r||null)}function br(n){n.parentNode&&n.parentNode.removeChild(n)}function vt(n){return document.createElement(n)}function Ci(n){return document.createTextNode(n)}function wn(){return Ci(" ")}function bi(n,e,r,o){return n.addEventListener(e,r,o),()=>n.removeEventListener(e,r,o)}function Ni(n,e,r){r==null?n.removeAttribute(e):n.getAttribute(e)!==r&&n.setAttribute(e,r)}function O0(n){return Array.from(n.childNodes)}function Pc(n,e){e=""+e,n.wholeText!==e&&(n.data=e)}function Lc(n,e){n.value=e==null?"":e}function oh(n,e,r,o){r===null?n.style.removeProperty(e):n.style.setProperty(e,r,o?"important":"")}let Ui;function Ri(n){Ui=n}function D0(){if(!Ui)throw new Error("Function called outside component initialization");return Ui}function M0(n){D0().$$.on_mount.push(n)}const Fr=[],Ua=[];let Gr=[];const Va=[],k0=Promise.resolve();let Ha=!1;function P0(){Ha||(Ha=!0,k0.then(ah))}function Ga(n){Gr.push(n)}function L0(n){Va.push(n)}const Aa=new Set;let Br=0;function ah(){if(Br!==0)return;const n=Ui;do{try{for(;Br<Fr.length;){const e=Fr[Br];Br++,Ri(e),B0(e.$$)}}catch(e){throw Fr.length=0,Br=0,e}for(Ri(null),Fr.length=0,Br=0;Ua.length;)Ua.pop()();for(let e=0;e<Gr.length;e+=1){const r=Gr[e];Aa.has(r)||(Aa.add(r),r())}Gr.length=0}while(Fr.length);for(;Va.length;)Va.pop()();Ha=!1,Aa.clear(),Ri(n)}function B0(n){if(n.fragment!==null){n.update(),ni(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(Ga)}}function F0(n){const e=[],r=[];Gr.forEach(o=>n.indexOf(o)===-1?e.push(o):r.push(o)),r.forEach(o=>o()),Gr=e}const Xs=new Set;let ur;function U0(){ur={r:0,c:[],p:ur}}function V0(){ur.r||ni(ur.c),ur=ur.p}function Oi(n,e){n&&n.i&&(Xs.delete(n),n.i(e))}function Wa(n,e,r,o){if(n&&n.o){if(Xs.has(n))return;Xs.add(n),ur.c.push(()=>{Xs.delete(n),o&&(r&&n.d(1),o())}),n.o(e)}else o&&o()}function H0(n,e,r){const o=n.$$.props[e];o!==void 0&&(n.$$.bound[o]=r,r(n.$$.ctx[o]))}function G0(n){n&&n.c()}function lh(n,e,r,o){const{fragment:c,after_update:h}=n.$$;c&&c.m(e,r),o||Ga(()=>{const p=n.$$.on_mount.map(rh).filter(ih);n.$$.on_destroy?n.$$.on_destroy.push(...p):ni(p),n.$$.on_mount=[]}),h.forEach(Ga)}function ch(n,e){const r=n.$$;r.fragment!==null&&(F0(r.after_update),ni(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function W0(n,e){n.$$.dirty[0]===-1&&(Fr.push(n),P0(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function uh(n,e,r,o,c,h,p,w=[-1]){const A=Ui;Ri(n);const m=n.$$={fragment:null,ctx:[],props:h,update:gr,not_equal:c,bound:kc(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(A?A.$$.context:[])),callbacks:kc(),dirty:w,skip_bound:!1,root:e.target||A.$$.root};p&&p(m.root);let C=!1;if(m.ctx=r?r(n,e.props||{},(_,k,...H)=>{const q=H.length?H[0]:k;return m.ctx&&c(m.ctx[_],m.ctx[_]=q)&&(!m.skip_bound&&m.bound[_]&&m.bound[_](q),C&&W0(n,_)),k}):[],m.update(),C=!0,ni(m.before_update),m.fragment=o?o(m.ctx):!1,e.target){if(e.hydrate){const _=O0(e.target);m.fragment&&m.fragment.l(_),_.forEach(br)}else m.fragment&&m.fragment.c();e.intro&&Oi(n.$$.fragment),lh(n,e.target,e.anchor,e.customElement),ah()}Ri(A)}class hh{$destroy(){ch(this,1),this.$destroy=gr}$on(e,r){if(!ih(r))return gr;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(r),()=>{const c=o.indexOf(r);c!==-1&&o.splice(c,1)}}$set(e){this.$$set&&!R0(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var K;(function(n){n[n.QR_CODE=0]="QR_CODE",n[n.AZTEC=1]="AZTEC",n[n.CODABAR=2]="CODABAR",n[n.CODE_39=3]="CODE_39",n[n.CODE_93=4]="CODE_93",n[n.CODE_128=5]="CODE_128",n[n.DATA_MATRIX=6]="DATA_MATRIX",n[n.MAXICODE=7]="MAXICODE",n[n.ITF=8]="ITF",n[n.EAN_13=9]="EAN_13",n[n.EAN_8=10]="EAN_8",n[n.PDF_417=11]="PDF_417",n[n.RSS_14=12]="RSS_14",n[n.RSS_EXPANDED=13]="RSS_EXPANDED",n[n.UPC_A=14]="UPC_A",n[n.UPC_E=15]="UPC_E",n[n.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(K||(K={}));var Bc=new Map([[K.QR_CODE,"QR_CODE"],[K.AZTEC,"AZTEC"],[K.CODABAR,"CODABAR"],[K.CODE_39,"CODE_39"],[K.CODE_93,"CODE_93"],[K.CODE_128,"CODE_128"],[K.DATA_MATRIX,"DATA_MATRIX"],[K.MAXICODE,"MAXICODE"],[K.ITF,"ITF"],[K.EAN_13,"EAN_13"],[K.EAN_8,"EAN_8"],[K.PDF_417,"PDF_417"],[K.RSS_14,"RSS_14"],[K.RSS_EXPANDED,"RSS_EXPANDED"],[K.UPC_A,"UPC_A"],[K.UPC_E,"UPC_E"],[K.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),Fc;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.URL=1]="URL"})(Fc||(Fc={}));function X0(n){return Object.values(K).includes(n)}var $s;(function(n){n[n.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",n[n.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})($s||($s={}));var j0=function(){function n(){}return n.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",n.SCAN_DEFAULT_FPS=2,n.DEFAULT_DISABLE_FLIP=!1,n.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,n.DEFAULT_SUPPORTED_SCAN_TYPE=[$s.SCAN_TYPE_CAMERA,$s.SCAN_TYPE_FILE],n}(),fh=function(){function n(e,r){this.format=e,this.formatName=r}return n.prototype.toString=function(){return this.formatName},n.create=function(e){if(!Bc.has(e))throw e+" not in html5QrcodeSupportedFormatsTextMap";return new n(e,Bc.get(e))},n}(),Uc=function(){function n(){}return n.createFromText=function(e){var r={text:e};return{decodedText:e,result:r}},n.createFromQrcodeResult=function(e){return{decodedText:e.text,result:e}},n}(),Xa;(function(n){n[n.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",n[n.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",n[n.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(Xa||(Xa={}));var z0=function(){function n(){}return n.createFrom=function(e){return{errorMessage:e,type:Xa.UNKWOWN_ERROR}},n}(),K0=function(){function n(e){this.verbose=e}return n.prototype.log=function(e){this.verbose&&console.log(e)},n.prototype.warn=function(e){this.verbose&&console.warn(e)},n.prototype.logError=function(e,r){(this.verbose||r===!0)&&console.error(e)},n.prototype.logErrors=function(e){if(e.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(e)},n}();function bn(n){return typeof n>"u"||n===null}var Di=function(){function n(){}return n.codeParseError=function(e){return"QR code parse error, error = "+e},n.errorGettingUserMedia=function(e){return"Error getting userMedia, error = "+e},n.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},n.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},n.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},n.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},n}(),dh=function(){function n(){}return n.isMediaStreamConstraintsValid=function(e,r){if(typeof e!="object"){var o=typeof e;return r.logError("videoConstraints should be of type object, the "+("object passed is of type "+o+"."),!0),!1}for(var c=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],h=new Set(c),p=Object.keys(e),w=0,A=p;w<A.length;w++){var m=A[w];if(h.has(m))return r.logError(m+" is not supported videoConstaints.",!0),!1}return!0},n}(),Ai=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Y0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Be={exports:{}};(function(n,e){(function(r,o){o(e)})(Ai,function(r){function o(E){return E==null}var c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,t){E.__proto__=t}||function(E,t){for(var i in t)t.hasOwnProperty(i)&&(E[i]=t[i])};function h(E,t){c(E,t);function i(){this.constructor=E}E.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}function p(E,t){var i=Object.setPrototypeOf;i?i(E,t):E.__proto__=t}function w(E,t){t===void 0&&(t=E.constructor);var i=Error.captureStackTrace;i&&i(E,t)}var A=function(E){h(t,E);function t(i){var s=this.constructor,a=E.call(this,i)||this;return Object.defineProperty(a,"name",{value:s.name,enumerable:!1}),p(a,s.prototype),w(a),a}return t}(Error);class m extends A{constructor(t=void 0){super(t),this.message=t}getKind(){return this.constructor.kind}}m.kind="Exception";class C extends m{}C.kind="ArgumentException";class _ extends m{}_.kind="IllegalArgumentException";class k{constructor(t){if(this.binarizer=t,t===null)throw new _("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(t,i){return this.binarizer.getBlackRow(t,i)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(t,i,s,a){const l=this.binarizer.getLuminanceSource().crop(t,i,s,a);return new k(this.binarizer.createBinarizer(l))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const t=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new k(this.binarizer.createBinarizer(t))}rotateCounterClockwise45(){const t=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new k(this.binarizer.createBinarizer(t))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class H extends m{static getChecksumInstance(){return new H}}H.kind="ChecksumException";class q{constructor(t){this.source=t}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class j{static arraycopy(t,i,s,a,l){for(;l--;)s[a++]=t[i++]}static currentTimeMillis(){return Date.now()}}class Ce extends m{}Ce.kind="IndexOutOfBoundsException";class De extends Ce{constructor(t=void 0,i=void 0){super(i),this.index=t,this.message=i}}De.kind="ArrayIndexOutOfBoundsException";class he{static fill(t,i){for(let s=0,a=t.length;s<a;s++)t[s]=i}static fillWithin(t,i,s,a){he.rangeCheck(t.length,i,s);for(let l=i;l<s;l++)t[l]=a}static rangeCheck(t,i,s){if(i>s)throw new _("fromIndex("+i+") > toIndex("+s+")");if(i<0)throw new De(i);if(s>t)throw new De(s)}static asList(...t){return t}static create(t,i,s){return Array.from({length:t}).map(l=>Array.from({length:i}).fill(s))}static createInt32Array(t,i,s){return Array.from({length:t}).map(l=>Int32Array.from({length:i}).fill(s))}static equals(t,i){if(!t||!i||!t.length||!i.length||t.length!==i.length)return!1;for(let s=0,a=t.length;s<a;s++)if(t[s]!==i[s])return!1;return!0}static hashCode(t){if(t===null)return 0;let i=1;for(const s of t)i=31*i+s;return i}static fillUint8Array(t,i){for(let s=0;s!==t.length;s++)t[s]=i}static copyOf(t,i){return t.slice(0,i)}static copyOfUint8Array(t,i){if(t.length<=i){const s=new Uint8Array(i);return s.set(t),s}return t.slice(0,i)}static copyOfRange(t,i,s){const a=s-i,l=new Int32Array(a);return j.arraycopy(t,i,l,0,a),l}static binarySearch(t,i,s){s===void 0&&(s=he.numberComparator);let a=0,l=t.length-1;for(;a<=l;){const u=l+a>>1,f=s(i,t[u]);if(f>0)a=u+1;else if(f<0)l=u-1;else return u}return-a-1}static numberComparator(t,i){return t-i}}class Y{static numberOfTrailingZeros(t){let i;if(t===0)return 32;let s=31;return i=t<<16,i!==0&&(s-=16,t=i),i=t<<8,i!==0&&(s-=8,t=i),i=t<<4,i!==0&&(s-=4,t=i),i=t<<2,i!==0&&(s-=2,t=i),s-(t<<1>>>31)}static numberOfLeadingZeros(t){if(t===0)return 32;let i=1;return t>>>16===0&&(i+=16,t<<=16),t>>>24===0&&(i+=8,t<<=8),t>>>28===0&&(i+=4,t<<=4),t>>>30===0&&(i+=2,t<<=2),i-=t>>>31,i}static toHexString(t){return t.toString(16)}static toBinaryString(t){return String(parseInt(String(t),2))}static bitCount(t){return t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),t=t+(t>>>4)&252645135,t=t+(t>>>8),t=t+(t>>>16),t&63}static truncDivision(t,i){return Math.trunc(t/i)}static parseInt(t,i=void 0){return parseInt(t,i)}}Y.MIN_VALUE_32_BITS=-2147483648,Y.MAX_VALUE=Number.MAX_SAFE_INTEGER;class fe{constructor(t,i){t===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=t,i==null?this.bits=fe.makeArray(t):this.bits=i)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(t){if(t>this.bits.length*32){const i=fe.makeArray(t);j.arraycopy(this.bits,0,i,0,this.bits.length),this.bits=i}}get(t){return(this.bits[Math.floor(t/32)]&1<<(t&31))!==0}set(t){this.bits[Math.floor(t/32)]|=1<<(t&31)}flip(t){this.bits[Math.floor(t/32)]^=1<<(t&31)}getNextSet(t){const i=this.size;if(t>=i)return i;const s=this.bits;let a=Math.floor(t/32),l=s[a];l&=~((1<<(t&31))-1);const u=s.length;for(;l===0;){if(++a===u)return i;l=s[a]}const f=a*32+Y.numberOfTrailingZeros(l);return f>i?i:f}getNextUnset(t){const i=this.size;if(t>=i)return i;const s=this.bits;let a=Math.floor(t/32),l=~s[a];l&=~((1<<(t&31))-1);const u=s.length;for(;l===0;){if(++a===u)return i;l=~s[a]}const f=a*32+Y.numberOfTrailingZeros(l);return f>i?i:f}setBulk(t,i){this.bits[Math.floor(t/32)]=i}setRange(t,i){if(i<t||t<0||i>this.size)throw new _;if(i===t)return;i--;const s=Math.floor(t/32),a=Math.floor(i/32),l=this.bits;for(let u=s;u<=a;u++){const f=u>s?0:t&31,g=(2<<(u<a?31:i&31))-(1<<f);l[u]|=g}}clear(){const t=this.bits.length,i=this.bits;for(let s=0;s<t;s++)i[s]=0}isRange(t,i,s){if(i<t||t<0||i>this.size)throw new _;if(i===t)return!0;i--;const a=Math.floor(t/32),l=Math.floor(i/32),u=this.bits;for(let f=a;f<=l;f++){const d=f>a?0:t&31,x=(2<<(f<l?31:i&31))-(1<<d)&4294967295;if((u[f]&x)!==(s?x:0))return!1}return!0}appendBit(t){this.ensureCapacity(this.size+1),t&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(t,i){if(i<0||i>32)throw new _("Num bits must be between 0 and 32");this.ensureCapacity(this.size+i);for(let s=i;s>0;s--)this.appendBit((t>>s-1&1)===1)}appendBitArray(t){const i=t.size;this.ensureCapacity(this.size+i);for(let s=0;s<i;s++)this.appendBit(t.get(s))}xor(t){if(this.size!==t.size)throw new _("Sizes don't match");const i=this.bits;for(let s=0,a=i.length;s<a;s++)i[s]^=t.bits[s]}toBytes(t,i,s,a){for(let l=0;l<a;l++){let u=0;for(let f=0;f<8;f++)this.get(t)&&(u|=1<<7-f),t++;i[s+l]=u}}getBitArray(){return this.bits}reverse(){const t=new Int32Array(this.bits.length),i=Math.floor((this.size-1)/32),s=i+1,a=this.bits;for(let l=0;l<s;l++){let u=a[l];u=u>>1&1431655765|(u&1431655765)<<1,u=u>>2&858993459|(u&858993459)<<2,u=u>>4&252645135|(u&252645135)<<4,u=u>>8&16711935|(u&16711935)<<8,u=u>>16&65535|(u&65535)<<16,t[i-l]=u}if(this.size!==s*32){const l=s*32-this.size;let u=t[0]>>>l;for(let f=1;f<s;f++){const d=t[f];u|=d<<32-l,t[f-1]=u,u=d>>>l}t[s-1]=u}this.bits=t}static makeArray(t){return new Int32Array(Math.floor((t+31)/32))}equals(t){if(!(t instanceof fe))return!1;const i=t;return this.size===i.size&&he.equals(this.bits,i.bits)}hashCode(){return 31*this.size+he.hashCode(this.bits)}toString(){let t="";for(let i=0,s=this.size;i<s;i++)(i&7)===0&&(t+=" "),t+=this.get(i)?"X":".";return t}clone(){return new fe(this.size,this.bits.slice())}}var rt;(function(E){E[E.OTHER=0]="OTHER",E[E.PURE_BARCODE=1]="PURE_BARCODE",E[E.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",E[E.TRY_HARDER=3]="TRY_HARDER",E[E.CHARACTER_SET=4]="CHARACTER_SET",E[E.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",E[E.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",E[E.ASSUME_GS1=7]="ASSUME_GS1",E[E.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",E[E.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",E[E.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(rt||(rt={}));var de=rt;class V extends m{static getFormatInstance(){return new V}}V.kind="FormatException";var xe;(function(E){E[E.Cp437=0]="Cp437",E[E.ISO8859_1=1]="ISO8859_1",E[E.ISO8859_2=2]="ISO8859_2",E[E.ISO8859_3=3]="ISO8859_3",E[E.ISO8859_4=4]="ISO8859_4",E[E.ISO8859_5=5]="ISO8859_5",E[E.ISO8859_6=6]="ISO8859_6",E[E.ISO8859_7=7]="ISO8859_7",E[E.ISO8859_8=8]="ISO8859_8",E[E.ISO8859_9=9]="ISO8859_9",E[E.ISO8859_10=10]="ISO8859_10",E[E.ISO8859_11=11]="ISO8859_11",E[E.ISO8859_13=12]="ISO8859_13",E[E.ISO8859_14=13]="ISO8859_14",E[E.ISO8859_15=14]="ISO8859_15",E[E.ISO8859_16=15]="ISO8859_16",E[E.SJIS=16]="SJIS",E[E.Cp1250=17]="Cp1250",E[E.Cp1251=18]="Cp1251",E[E.Cp1252=19]="Cp1252",E[E.Cp1256=20]="Cp1256",E[E.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",E[E.UTF8=22]="UTF8",E[E.ASCII=23]="ASCII",E[E.Big5=24]="Big5",E[E.GB18030=25]="GB18030",E[E.EUC_KR=26]="EUC_KR"})(xe||(xe={}));class B{constructor(t,i,s,...a){this.valueIdentifier=t,this.name=s,typeof i=="number"?this.values=Int32Array.from([i]):this.values=i,this.otherEncodingNames=a,B.VALUE_IDENTIFIER_TO_ECI.set(t,this),B.NAME_TO_ECI.set(s,this);const l=this.values;for(let u=0,f=l.length;u!==f;u++){const d=l[u];B.VALUES_TO_ECI.set(d,this)}for(const u of a)B.NAME_TO_ECI.set(u,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(t){if(t<0||t>=900)throw new V("incorect value");const i=B.VALUES_TO_ECI.get(t);if(i===void 0)throw new V("incorect value");return i}static getCharacterSetECIByName(t){const i=B.NAME_TO_ECI.get(t);if(i===void 0)throw new V("incorect value");return i}equals(t){if(!(t instanceof B))return!1;const i=t;return this.getName()===i.getName()}}B.VALUE_IDENTIFIER_TO_ECI=new Map,B.VALUES_TO_ECI=new Map,B.NAME_TO_ECI=new Map,B.Cp437=new B(xe.Cp437,Int32Array.from([0,2]),"Cp437"),B.ISO8859_1=new B(xe.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),B.ISO8859_2=new B(xe.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),B.ISO8859_3=new B(xe.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),B.ISO8859_4=new B(xe.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),B.ISO8859_5=new B(xe.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),B.ISO8859_6=new B(xe.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),B.ISO8859_7=new B(xe.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),B.ISO8859_8=new B(xe.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),B.ISO8859_9=new B(xe.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),B.ISO8859_10=new B(xe.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),B.ISO8859_11=new B(xe.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),B.ISO8859_13=new B(xe.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),B.ISO8859_14=new B(xe.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),B.ISO8859_15=new B(xe.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),B.ISO8859_16=new B(xe.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),B.SJIS=new B(xe.SJIS,20,"SJIS","Shift_JIS"),B.Cp1250=new B(xe.Cp1250,21,"Cp1250","windows-1250"),B.Cp1251=new B(xe.Cp1251,22,"Cp1251","windows-1251"),B.Cp1252=new B(xe.Cp1252,23,"Cp1252","windows-1252"),B.Cp1256=new B(xe.Cp1256,24,"Cp1256","windows-1256"),B.UnicodeBigUnmarked=new B(xe.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),B.UTF8=new B(xe.UTF8,26,"UTF8","UTF-8"),B.ASCII=new B(xe.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),B.Big5=new B(xe.Big5,28,"Big5"),B.GB18030=new B(xe.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),B.EUC_KR=new B(xe.EUC_KR,30,"EUC_KR","EUC-KR");class kt extends m{}kt.kind="UnsupportedOperationException";class lt{static decode(t,i){const s=this.encodingName(i);return this.customDecoder?this.customDecoder(t,s):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(s)?this.decodeFallback(t,s):new TextDecoder(s).decode(t)}static shouldDecodeOnFallback(t){return!lt.isBrowser()&&t==="ISO-8859-1"}static encode(t,i){const s=this.encodingName(i);return this.customEncoder?this.customEncoder(t,s):typeof TextEncoder>"u"?this.encodeFallback(t):new TextEncoder().encode(t)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(t){return typeof t=="string"?t:t.getName()}static encodingCharacterSet(t){return t instanceof B?t:B.getCharacterSetECIByName(t)}static decodeFallback(t,i){const s=this.encodingCharacterSet(i);if(lt.isDecodeFallbackSupported(s)){let a="";for(let l=0,u=t.length;l<u;l++){let f=t[l].toString(16);f.length<2&&(f="0"+f),a+="%"+f}return decodeURIComponent(a)}if(s.equals(B.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(t.buffer));throw new kt(`Encoding ${this.encodingName(i)} not supported by fallback.`)}static isDecodeFallbackSupported(t){return t.equals(B.UTF8)||t.equals(B.ISO8859_1)||t.equals(B.ASCII)}static encodeFallback(t){const s=btoa(unescape(encodeURIComponent(t))).split(""),a=[];for(let l=0;l<s.length;l++)a.push(s[l].charCodeAt(0));return new Uint8Array(a)}}class ie{static castAsNonUtf8Char(t,i=null){const s=i?i.getName():this.ISO88591;return lt.decode(new Uint8Array([t]),s)}static guessEncoding(t,i){if(i!=null&&i.get(de.CHARACTER_SET)!==void 0)return i.get(de.CHARACTER_SET).toString();const s=t.length;let a=!0,l=!0,u=!0,f=0,d=0,g=0,x=0,y=0,I=0,T=0,v=0,S=0,N=0,D=0;const F=t.length>3&&t[0]===239&&t[1]===187&&t[2]===191;for(let U=0;U<s&&(a||l||u);U++){const L=t[U]&255;u&&(f>0?(L&128)===0?u=!1:f--:(L&128)!==0&&((L&64)===0?u=!1:(f++,(L&32)===0?d++:(f++,(L&16)===0?g++:(f++,(L&8)===0?x++:u=!1))))),a&&(L>127&&L<160?a=!1:L>159&&(L<192||L===215||L===247)&&D++),l&&(y>0?L<64||L===127||L>252?l=!1:y--:L===128||L===160||L>239?l=!1:L>160&&L<224?(I++,v=0,T++,T>S&&(S=T)):L>127?(y++,T=0,v++,v>N&&(N=v)):(T=0,v=0))}return u&&f>0&&(u=!1),l&&y>0&&(l=!1),u&&(F||d+g+x>0)?ie.UTF8:l&&(ie.ASSUME_SHIFT_JIS||S>=3||N>=3)?ie.SHIFT_JIS:a&&l?S===2&&I===2||D*10>=s?ie.SHIFT_JIS:ie.ISO88591:a?ie.ISO88591:l?ie.SHIFT_JIS:u?ie.UTF8:ie.PLATFORM_DEFAULT_ENCODING}static format(t,...i){let s=-1;function a(u,f,d,g,x,y){if(u==="%%")return"%";if(i[++s]===void 0)return;u=g?parseInt(g.substr(1)):void 0;let I=x?parseInt(x.substr(1)):void 0,T;switch(y){case"s":T=i[s];break;case"c":T=i[s][0];break;case"f":T=parseFloat(i[s]).toFixed(u);break;case"p":T=parseFloat(i[s]).toPrecision(u);break;case"e":T=parseFloat(i[s]).toExponential(u);break;case"x":T=parseInt(i[s]).toString(I||16);break;case"d":T=parseFloat(parseInt(i[s],I||10).toPrecision(u)).toFixed(0);break}T=typeof T=="object"?JSON.stringify(T):(+T).toString(I);let v=parseInt(d),S=d&&d[0]+""=="0"?"0":" ";for(;T.length<v;)T=f!==void 0?T+S:S+T;return T}let l=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return t.replace(l,a)}static getBytes(t,i){return lt.encode(t,i)}static getCharCode(t,i=0){return t.charCodeAt(i)}static getCharAt(t){return String.fromCharCode(t)}}ie.SHIFT_JIS=B.SJIS.getName(),ie.GB2312="GB2312",ie.ISO88591=B.ISO8859_1.getName(),ie.EUC_JP="EUC_JP",ie.UTF8=B.UTF8.getName(),ie.PLATFORM_DEFAULT_ENCODING=ie.UTF8,ie.ASSUME_SHIFT_JIS=!1;class le{constructor(t=""){this.value=t}enableDecoding(t){return this.encoding=t,this}append(t){return typeof t=="string"?this.value+=t.toString():this.encoding?this.value+=ie.castAsNonUtf8Char(t,this.encoding):this.value+=String.fromCharCode(t),this}appendChars(t,i,s){for(let a=i;i<i+s;a++)this.append(t[a]);return this}length(){return this.value.length}charAt(t){return this.value.charAt(t)}deleteCharAt(t){this.value=this.value.substr(0,t)+this.value.substring(t+1)}setCharAt(t,i){this.value=this.value.substr(0,t)+i+this.value.substr(t+1)}substring(t,i){return this.value.substring(t,i)}setLengthToZero(){this.value=""}toString(){return this.value}insert(t,i){this.value=this.value.substr(0,t)+i+this.value.substr(t+i.length)}}class _e{constructor(t,i,s,a){if(this.width=t,this.height=i,this.rowSize=s,this.bits=a,i==null&&(i=t),this.height=i,t<1||i<1)throw new _("Both dimensions must be greater than 0");s==null&&(s=Math.floor((t+31)/32)),this.rowSize=s,a==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(t){const i=t.length,s=t[0].length,a=new _e(s,i);for(let l=0;l<i;l++){const u=t[l];for(let f=0;f<s;f++)u[f]&&a.set(f,l)}return a}static parseFromString(t,i,s){if(t===null)throw new _("stringRepresentation cannot be null");const a=new Array(t.length);let l=0,u=0,f=-1,d=0,g=0;for(;g<t.length;)if(t.charAt(g)===`
`||t.charAt(g)==="\r"){if(l>u){if(f===-1)f=l-u;else if(l-u!==f)throw new _("row lengths do not match");u=l,d++}g++}else if(t.substring(g,g+i.length)===i)g+=i.length,a[l]=!0,l++;else if(t.substring(g,g+s.length)===s)g+=s.length,a[l]=!1,l++;else throw new _("illegal character encountered: "+t.substring(g));if(l>u){if(f===-1)f=l-u;else if(l-u!==f)throw new _("row lengths do not match");d++}const x=new _e(f,d);for(let y=0;y<l;y++)a[y]&&x.set(Math.floor(y%f),Math.floor(y/f));return x}get(t,i){const s=i*this.rowSize+Math.floor(t/32);return(this.bits[s]>>>(t&31)&1)!==0}set(t,i){const s=i*this.rowSize+Math.floor(t/32);this.bits[s]|=1<<(t&31)&4294967295}unset(t,i){const s=i*this.rowSize+Math.floor(t/32);this.bits[s]&=~(1<<(t&31)&4294967295)}flip(t,i){const s=i*this.rowSize+Math.floor(t/32);this.bits[s]^=1<<(t&31)&4294967295}xor(t){if(this.width!==t.getWidth()||this.height!==t.getHeight()||this.rowSize!==t.getRowSize())throw new _("input matrix dimensions do not match");const i=new fe(Math.floor(this.width/32)+1),s=this.rowSize,a=this.bits;for(let l=0,u=this.height;l<u;l++){const f=l*s,d=t.getRow(l,i).getBitArray();for(let g=0;g<s;g++)a[f+g]^=d[g]}}clear(){const t=this.bits,i=t.length;for(let s=0;s<i;s++)t[s]=0}setRegion(t,i,s,a){if(i<0||t<0)throw new _("Left and top must be nonnegative");if(a<1||s<1)throw new _("Height and width must be at least 1");const l=t+s,u=i+a;if(u>this.height||l>this.width)throw new _("The region must fit inside the matrix");const f=this.rowSize,d=this.bits;for(let g=i;g<u;g++){const x=g*f;for(let y=t;y<l;y++)d[x+Math.floor(y/32)]|=1<<(y&31)&4294967295}}getRow(t,i){i==null||i.getSize()<this.width?i=new fe(this.width):i.clear();const s=this.rowSize,a=this.bits,l=t*s;for(let u=0;u<s;u++)i.setBulk(u*32,a[l+u]);return i}setRow(t,i){j.arraycopy(i.getBitArray(),0,this.bits,t*this.rowSize,this.rowSize)}rotate180(){const t=this.getWidth(),i=this.getHeight();let s=new fe(t),a=new fe(t);for(let l=0,u=Math.floor((i+1)/2);l<u;l++)s=this.getRow(l,s),a=this.getRow(i-1-l,a),s.reverse(),a.reverse(),this.setRow(l,a),this.setRow(i-1-l,s)}getEnclosingRectangle(){const t=this.width,i=this.height,s=this.rowSize,a=this.bits;let l=t,u=i,f=-1,d=-1;for(let g=0;g<i;g++)for(let x=0;x<s;x++){const y=a[g*s+x];if(y!==0){if(g<u&&(u=g),g>d&&(d=g),x*32<l){let I=0;for(;(y<<31-I&4294967295)===0;)I++;x*32+I<l&&(l=x*32+I)}if(x*32+31>f){let I=31;for(;y>>>I===0;)I--;x*32+I>f&&(f=x*32+I)}}}return f<l||d<u?null:Int32Array.from([l,u,f-l+1,d-u+1])}getTopLeftOnBit(){const t=this.rowSize,i=this.bits;let s=0;for(;s<i.length&&i[s]===0;)s++;if(s===i.length)return null;const a=s/t;let l=s%t*32;const u=i[s];let f=0;for(;(u<<31-f&4294967295)===0;)f++;return l+=f,Int32Array.from([l,a])}getBottomRightOnBit(){const t=this.rowSize,i=this.bits;let s=i.length-1;for(;s>=0&&i[s]===0;)s--;if(s<0)return null;const a=Math.floor(s/t);let l=Math.floor(s%t)*32;const u=i[s];let f=31;for(;u>>>f===0;)f--;return l+=f,Int32Array.from([l,a])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(t){if(!(t instanceof _e))return!1;const i=t;return this.width===i.width&&this.height===i.height&&this.rowSize===i.rowSize&&he.equals(this.bits,i.bits)}hashCode(){let t=this.width;return t=31*t+this.width,t=31*t+this.height,t=31*t+this.rowSize,t=31*t+he.hashCode(this.bits),t}toString(t="X ",i="  ",s=`
`){return this.buildToString(t,i,s)}buildToString(t,i,s){let a=new le;for(let l=0,u=this.height;l<u;l++){for(let f=0,d=this.width;f<d;f++)a.append(this.get(f,l)?t:i);a.append(s)}return a.toString()}clone(){return new _e(this.width,this.height,this.rowSize,this.bits.slice())}}class M extends m{static getNotFoundInstance(){return new M}}M.kind="NotFoundException";class we extends q{constructor(t){super(t),this.luminances=we.EMPTY,this.buckets=new Int32Array(we.LUMINANCE_BUCKETS)}getBlackRow(t,i){const s=this.getLuminanceSource(),a=s.getWidth();i==null||i.getSize()<a?i=new fe(a):i.clear(),this.initArrays(a);const l=s.getRow(t,this.luminances),u=this.buckets;for(let d=0;d<a;d++)u[(l[d]&255)>>we.LUMINANCE_SHIFT]++;const f=we.estimateBlackPoint(u);if(a<3)for(let d=0;d<a;d++)(l[d]&255)<f&&i.set(d);else{let d=l[0]&255,g=l[1]&255;for(let x=1;x<a-1;x++){const y=l[x+1]&255;(g*4-d-y)/2<f&&i.set(x),d=g,g=y}}return i}getBlackMatrix(){const t=this.getLuminanceSource(),i=t.getWidth(),s=t.getHeight(),a=new _e(i,s);this.initArrays(i);const l=this.buckets;for(let d=1;d<5;d++){const g=Math.floor(s*d/5),x=t.getRow(g,this.luminances),y=Math.floor(i*4/5);for(let I=Math.floor(i/5);I<y;I++){const T=x[I]&255;l[T>>we.LUMINANCE_SHIFT]++}}const u=we.estimateBlackPoint(l),f=t.getMatrix();for(let d=0;d<s;d++){const g=d*i;for(let x=0;x<i;x++)(f[g+x]&255)<u&&a.set(x,d)}return a}createBinarizer(t){return new we(t)}initArrays(t){this.luminances.length<t&&(this.luminances=new Uint8ClampedArray(t));const i=this.buckets;for(let s=0;s<we.LUMINANCE_BUCKETS;s++)i[s]=0}static estimateBlackPoint(t){const i=t.length;let s=0,a=0,l=0;for(let x=0;x<i;x++)t[x]>l&&(a=x,l=t[x]),t[x]>s&&(s=t[x]);let u=0,f=0;for(let x=0;x<i;x++){const y=x-a,I=t[x]*y*y;I>f&&(u=x,f=I)}if(a>u){const x=a;a=u,u=x}if(u-a<=i/16)throw new M;let d=u-1,g=-1;for(let x=u-1;x>a;x--){const y=x-a,I=y*y*(u-x)*(s-t[x]);I>g&&(d=x,g=I)}return d<<we.LUMINANCE_SHIFT}}we.LUMINANCE_BITS=5,we.LUMINANCE_SHIFT=8-we.LUMINANCE_BITS,we.LUMINANCE_BUCKETS=1<<we.LUMINANCE_BITS,we.EMPTY=Uint8ClampedArray.from([0]);class Q extends we{constructor(t){super(t),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const t=this.getLuminanceSource(),i=t.getWidth(),s=t.getHeight();if(i>=Q.MINIMUM_DIMENSION&&s>=Q.MINIMUM_DIMENSION){const a=t.getMatrix();let l=i>>Q.BLOCK_SIZE_POWER;(i&Q.BLOCK_SIZE_MASK)!==0&&l++;let u=s>>Q.BLOCK_SIZE_POWER;(s&Q.BLOCK_SIZE_MASK)!==0&&u++;const f=Q.calculateBlackPoints(a,l,u,i,s),d=new _e(i,s);Q.calculateThresholdForBlock(a,l,u,i,s,f,d),this.matrix=d}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(t){return new Q(t)}static calculateThresholdForBlock(t,i,s,a,l,u,f){const d=l-Q.BLOCK_SIZE,g=a-Q.BLOCK_SIZE;for(let x=0;x<s;x++){let y=x<<Q.BLOCK_SIZE_POWER;y>d&&(y=d);const I=Q.cap(x,2,s-3);for(let T=0;T<i;T++){let v=T<<Q.BLOCK_SIZE_POWER;v>g&&(v=g);const S=Q.cap(T,2,i-3);let N=0;for(let F=-2;F<=2;F++){const U=u[I+F];N+=U[S-2]+U[S-1]+U[S]+U[S+1]+U[S+2]}const D=N/25;Q.thresholdBlock(t,v,y,D,a,f)}}}static cap(t,i,s){return t<i?i:t>s?s:t}static thresholdBlock(t,i,s,a,l,u){for(let f=0,d=s*l+i;f<Q.BLOCK_SIZE;f++,d+=l)for(let g=0;g<Q.BLOCK_SIZE;g++)(t[d+g]&255)<=a&&u.set(i+g,s+f)}static calculateBlackPoints(t,i,s,a,l){const u=l-Q.BLOCK_SIZE,f=a-Q.BLOCK_SIZE,d=new Array(s);for(let g=0;g<s;g++){d[g]=new Int32Array(i);let x=g<<Q.BLOCK_SIZE_POWER;x>u&&(x=u);for(let y=0;y<i;y++){let I=y<<Q.BLOCK_SIZE_POWER;I>f&&(I=f);let T=0,v=255,S=0;for(let D=0,F=x*a+I;D<Q.BLOCK_SIZE;D++,F+=a){for(let U=0;U<Q.BLOCK_SIZE;U++){const L=t[F+U]&255;T+=L,L<v&&(v=L),L>S&&(S=L)}if(S-v>Q.MIN_DYNAMIC_RANGE)for(D++,F+=a;D<Q.BLOCK_SIZE;D++,F+=a)for(let U=0;U<Q.BLOCK_SIZE;U++)T+=t[F+U]&255}let N=T>>Q.BLOCK_SIZE_POWER*2;if(S-v<=Q.MIN_DYNAMIC_RANGE&&(N=v/2,g>0&&y>0)){const D=(d[g-1][y]+2*d[g][y-1]+d[g-1][y-1])/4;v<D&&(N=D)}d[g][y]=N}}return d}}Q.BLOCK_SIZE_POWER=3,Q.BLOCK_SIZE=1<<Q.BLOCK_SIZE_POWER,Q.BLOCK_SIZE_MASK=Q.BLOCK_SIZE-1,Q.MINIMUM_DIMENSION=Q.BLOCK_SIZE*5,Q.MIN_DYNAMIC_RANGE=24;class Ht{constructor(t,i){this.width=t,this.height=i}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(t,i,s,a){throw new kt("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new kt("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new kt("This luminance source does not support rotation by 45 degrees.")}toString(){const t=new Uint8ClampedArray(this.width);let i=new le;for(let s=0;s<this.height;s++){const a=this.getRow(s,t);for(let l=0;l<this.width;l++){const u=a[l]&255;let f;u<64?f="#":u<128?f="+":u<192?f=".":f=" ",i.append(f)}i.append(`
`)}return i.toString()}}class kn extends Ht{constructor(t){super(t.getWidth(),t.getHeight()),this.delegate=t}getRow(t,i){const s=this.delegate.getRow(t,i),a=this.getWidth();for(let l=0;l<a;l++)s[l]=255-(s[l]&255);return s}getMatrix(){const t=this.delegate.getMatrix(),i=this.getWidth()*this.getHeight(),s=new Uint8ClampedArray(i);for(let a=0;a<i;a++)s[a]=255-(t[a]&255);return s}isCropSupported(){return this.delegate.isCropSupported()}crop(t,i,s,a){return new kn(this.delegate.crop(t,i,s,a))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new kn(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new kn(this.delegate.rotateCounterClockwise45())}}class Pn extends Ht{constructor(t){super(t.width,t.height),this.canvas=t,this.tempCanvasElement=null,this.buffer=Pn.makeBufferFromCanvasImageData(t)}static makeBufferFromCanvasImageData(t){const i=t.getContext("2d").getImageData(0,0,t.width,t.height);return Pn.toGrayscaleBuffer(i.data,t.width,t.height)}static toGrayscaleBuffer(t,i,s){const a=new Uint8ClampedArray(i*s);for(let l=0,u=0,f=t.length;l<f;l+=4,u++){let d;if(t[l+3]===0)d=255;else{const x=t[l],y=t[l+1],I=t[l+2];d=306*x+601*y+117*I+512>>10}a[u]=d}return a}getRow(t,i){if(t<0||t>=this.getHeight())throw new _("Requested row is outside the image: "+t);const s=this.getWidth(),a=t*s;return i===null?i=this.buffer.slice(a,a+s):(i.length<s&&(i=new Uint8ClampedArray(s)),i.set(this.buffer.slice(a,a+s))),i}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(t,i,s,a){return super.crop(t,i,s,a),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const t=this.canvas.ownerDocument.createElement("canvas");t.width=this.canvas.width,t.height=this.canvas.height,this.tempCanvasElement=t}return this.tempCanvasElement}rotate(t){const i=this.getTempCanvasElement(),s=i.getContext("2d"),a=t*Pn.DEGREE_TO_RADIANS,l=this.canvas.width,u=this.canvas.height,f=Math.ceil(Math.abs(Math.cos(a))*l+Math.abs(Math.sin(a))*u),d=Math.ceil(Math.abs(Math.sin(a))*l+Math.abs(Math.cos(a))*u);return i.width=f,i.height=d,s.translate(f/2,d/2),s.rotate(a),s.drawImage(this.canvas,l/-2,u/-2),this.buffer=Pn.makeBufferFromCanvasImageData(i),this}invert(){return new kn(this)}}Pn.DEGREE_TO_RADIANS=Math.PI/180;class dc{constructor(t,i,s){this.deviceId=t,this.label=i,this.kind="videoinput",this.groupId=s||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var Pt=(globalThis||Ai||self||window||void 0)&&(globalThis||Ai||self||window||void 0).__awaiter||function(E,t,i,s){function a(l){return l instanceof i?l:new i(function(u){u(l)})}return new(i||(i=Promise))(function(l,u){function f(x){try{g(s.next(x))}catch(y){u(y)}}function d(x){try{g(s.throw(x))}catch(y){u(y)}}function g(x){x.done?l(x.value):a(x.value).then(f,d)}g((s=s.apply(E,t||[])).next())})};class nr{constructor(t,i=500,s){this.reader=t,this.timeBetweenScansMillis=i,this._hints=s,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(t){this._timeBetweenDecodingAttempts=t<0?0:t}set hints(t){this._hints=t||null}get hints(){return this._hints}listVideoInputDevices(){return Pt(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const t=yield navigator.mediaDevices.enumerateDevices(),i=[];for(const s of t){const a=s.kind==="video"?"videoinput":s.kind;if(a!=="videoinput")continue;const l=s.deviceId||s.id,u=s.label||`Video device ${i.length+1}`,f=s.groupId,d={deviceId:l,label:u,kind:a,groupId:f};i.push(d)}return i})}getVideoInputDevices(){return Pt(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(i=>new dc(i.deviceId,i.label))})}findDeviceById(t){return Pt(this,void 0,void 0,function*(){const i=yield this.listVideoInputDevices();return i?i.find(s=>s.deviceId===t):null})}decodeFromInputVideoDevice(t,i){return Pt(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(t,i)})}decodeOnceFromVideoDevice(t,i){return Pt(this,void 0,void 0,function*(){this.reset();let s;t?s={deviceId:{exact:t}}:s={facingMode:"environment"};const a={video:s};return yield this.decodeOnceFromConstraints(a,i)})}decodeOnceFromConstraints(t,i){return Pt(this,void 0,void 0,function*(){const s=yield navigator.mediaDevices.getUserMedia(t);return yield this.decodeOnceFromStream(s,i)})}decodeOnceFromStream(t,i){return Pt(this,void 0,void 0,function*(){this.reset();const s=yield this.attachStreamToVideo(t,i);return yield this.decodeOnce(s)})}decodeFromInputVideoDeviceContinuously(t,i,s){return Pt(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(t,i,s)})}decodeFromVideoDevice(t,i,s){return Pt(this,void 0,void 0,function*(){let a;t?a={deviceId:{exact:t}}:a={facingMode:"environment"};const l={video:a};return yield this.decodeFromConstraints(l,i,s)})}decodeFromConstraints(t,i,s){return Pt(this,void 0,void 0,function*(){const a=yield navigator.mediaDevices.getUserMedia(t);return yield this.decodeFromStream(a,i,s)})}decodeFromStream(t,i,s){return Pt(this,void 0,void 0,function*(){this.reset();const a=yield this.attachStreamToVideo(t,i);return yield this.decodeContinuously(a,s)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(t,i){return Pt(this,void 0,void 0,function*(){const s=this.prepareVideoElement(i);return this.addVideoSource(s,t),this.videoElement=s,this.stream=t,yield this.playVideoOnLoadAsync(s),s})}playVideoOnLoadAsync(t){return new Promise((i,s)=>this.playVideoOnLoad(t,()=>i()))}playVideoOnLoad(t,i){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(t),t.addEventListener("ended",this.videoEndedListener),t.addEventListener("canplay",this.videoCanPlayListener),t.addEventListener("playing",i),this.tryPlayVideo(t)}isVideoPlaying(t){return t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2}tryPlayVideo(t){return Pt(this,void 0,void 0,function*(){if(this.isVideoPlaying(t)){console.warn("Trying to play video that is already playing.");return}try{yield t.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(t,i){const s=document.getElementById(t);if(!s)throw new C(`element with id '${t}' not found`);if(s.nodeName.toLowerCase()!==i.toLowerCase())throw new C(`element with id '${t}' must be an ${i} element`);return s}decodeFromImage(t,i){if(!t&&!i)throw new C("either imageElement with a src set or an url must be provided");return i&&!t?this.decodeFromImageUrl(i):this.decodeFromImageElement(t)}decodeFromVideo(t,i){if(!t&&!i)throw new C("Either an element with a src set or an URL must be provided");return i&&!t?this.decodeFromVideoUrl(i):this.decodeFromVideoElement(t)}decodeFromVideoContinuously(t,i,s){if(t===void 0&&i===void 0)throw new C("Either an element with a src set or an URL must be provided");return i&&!t?this.decodeFromVideoUrlContinuously(i,s):this.decodeFromVideoElementContinuously(t,s)}decodeFromImageElement(t){if(!t)throw new C("An image element must be provided.");this.reset();const i=this.prepareImageElement(t);this.imageElement=i;let s;return this.isImageLoaded(i)?s=this.decodeOnce(i,!1,!0):s=this._decodeOnLoadImage(i),s}decodeFromVideoElement(t){const i=this._decodeFromVideoElementSetup(t);return this._decodeOnLoadVideo(i)}decodeFromVideoElementContinuously(t,i){const s=this._decodeFromVideoElementSetup(t);return this._decodeOnLoadVideoContinuously(s,i)}_decodeFromVideoElementSetup(t){if(!t)throw new C("A video element must be provided.");this.reset();const i=this.prepareVideoElement(t);return this.videoElement=i,i}decodeFromImageUrl(t){if(!t)throw new C("An URL must be provided.");this.reset();const i=this.prepareImageElement();this.imageElement=i;const s=this._decodeOnLoadImage(i);return i.src=t,s}decodeFromVideoUrl(t){if(!t)throw new C("An URL must be provided.");this.reset();const i=this.prepareVideoElement(),s=this.decodeFromVideoElement(i);return i.src=t,s}decodeFromVideoUrlContinuously(t,i){if(!t)throw new C("An URL must be provided.");this.reset();const s=this.prepareVideoElement(),a=this.decodeFromVideoElementContinuously(s,i);return s.src=t,a}_decodeOnLoadImage(t){return new Promise((i,s)=>{this.imageLoadedListener=()=>this.decodeOnce(t,!1,!0).then(i,s),t.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(t){return Pt(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(t),yield this.decodeOnce(t)})}_decodeOnLoadVideoContinuously(t,i){return Pt(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(t),this.decodeContinuously(t,i)})}isImageLoaded(t){return!(!t.complete||t.naturalWidth===0)}prepareImageElement(t){let i;return typeof t>"u"&&(i=document.createElement("img"),i.width=200,i.height=200),typeof t=="string"&&(i=this.getMediaElement(t,"img")),t instanceof HTMLImageElement&&(i=t),i}prepareVideoElement(t){let i;return!t&&typeof document<"u"&&(i=document.createElement("video"),i.width=200,i.height=200),typeof t=="string"&&(i=this.getMediaElement(t,"video")),t instanceof HTMLVideoElement&&(i=t),i.setAttribute("autoplay","true"),i.setAttribute("muted","true"),i.setAttribute("playsinline","true"),i}decodeOnce(t,i=!0,s=!0){this._stopAsyncDecode=!1;const a=(l,u)=>{if(this._stopAsyncDecode){u(new M("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const f=this.decode(t);l(f)}catch(f){const d=i&&f instanceof M,x=(f instanceof H||f instanceof V)&&s;if(d||x)return setTimeout(a,this._timeBetweenDecodingAttempts,l,u);u(f)}};return new Promise((l,u)=>a(l,u))}decodeContinuously(t,i){this._stopContinuousDecode=!1;const s=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const a=this.decode(t);i(a,null),setTimeout(s,this.timeBetweenScansMillis)}catch(a){i(null,a);const l=a instanceof H||a instanceof V,u=a instanceof M;(l||u)&&setTimeout(s,this._timeBetweenDecodingAttempts)}};s()}decode(t){const i=this.createBinaryBitmap(t);return this.decodeBitmap(i)}_isHTMLVideoElement(t){return t.videoWidth!==0}drawFrameOnCanvas(t,i,s){i||(i={sx:0,sy:0,sWidth:t.videoWidth,sHeight:t.videoHeight,dx:0,dy:0,dWidth:t.videoWidth,dHeight:t.videoHeight}),s||(s=this.captureCanvasContext),s.drawImage(t,i.sx,i.sy,i.sWidth,i.sHeight,i.dx,i.dy,i.dWidth,i.dHeight)}drawImageOnCanvas(t,i,s=this.captureCanvasContext){i||(i={sx:0,sy:0,sWidth:t.naturalWidth,sHeight:t.naturalHeight,dx:0,dy:0,dWidth:t.naturalWidth,dHeight:t.naturalHeight}),s||(s=this.captureCanvasContext),s.drawImage(t,i.sx,i.sy,i.sWidth,i.sHeight,i.dx,i.dy,i.dWidth,i.dHeight)}createBinaryBitmap(t){this.getCaptureCanvasContext(t),this._isHTMLVideoElement(t)?this.drawFrameOnCanvas(t):this.drawImageOnCanvas(t);const i=this.getCaptureCanvas(t),s=new Pn(i),a=new Q(s);return new k(a)}getCaptureCanvasContext(t){if(!this.captureCanvasContext){const s=this.getCaptureCanvas(t).getContext("2d");this.captureCanvasContext=s}return this.captureCanvasContext}getCaptureCanvas(t){if(!this.captureCanvas){const i=this.createCaptureCanvas(t);this.captureCanvas=i}return this.captureCanvas}decodeBitmap(t){return this.reader.decode(t,this._hints)}createCaptureCanvas(t){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const i=document.createElement("canvas");let s,a;return typeof t<"u"&&(t instanceof HTMLVideoElement?(s=t.videoWidth,a=t.videoHeight):t instanceof HTMLImageElement&&(s=t.naturalWidth||t.width,a=t.naturalHeight||t.height)),i.style.width=s+"px",i.style.height=a+"px",i.width=s,i.height=a,i}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(t=>t.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){!this.videoElement||(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){!this.imageElement||(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(t,i){try{t.srcObject=i}catch{t.src=URL.createObjectURL(i)}}cleanVideoSource(t){try{t.srcObject=null}catch{t.src=""}this.videoElement.removeAttribute("src")}}class Lt{constructor(t,i,s=i==null?0:8*i.length,a,l,u=j.currentTimeMillis()){this.text=t,this.rawBytes=i,this.numBits=s,this.resultPoints=a,this.format=l,this.timestamp=u,this.text=t,this.rawBytes=i,s==null?this.numBits=i==null?0:8*i.length:this.numBits=s,this.resultPoints=a,this.format=l,this.resultMetadata=null,u==null?this.timestamp=j.currentTimeMillis():this.timestamp=u}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(t,i){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(t,i)}putAllMetadata(t){t!==null&&(this.resultMetadata===null?this.resultMetadata=t:this.resultMetadata=new Map(t))}addResultPoints(t){const i=this.resultPoints;if(i===null)this.resultPoints=t;else if(t!==null&&t.length>0){const s=new Array(i.length+t.length);j.arraycopy(i,0,s,0,i.length),j.arraycopy(t,0,s,i.length,t.length),this.resultPoints=s}}getTimestamp(){return this.timestamp}toString(){return this.text}}var Jo;(function(E){E[E.AZTEC=0]="AZTEC",E[E.CODABAR=1]="CODABAR",E[E.CODE_39=2]="CODE_39",E[E.CODE_93=3]="CODE_93",E[E.CODE_128=4]="CODE_128",E[E.DATA_MATRIX=5]="DATA_MATRIX",E[E.EAN_8=6]="EAN_8",E[E.EAN_13=7]="EAN_13",E[E.ITF=8]="ITF",E[E.MAXICODE=9]="MAXICODE",E[E.PDF_417=10]="PDF_417",E[E.QR_CODE=11]="QR_CODE",E[E.RSS_14=12]="RSS_14",E[E.RSS_EXPANDED=13]="RSS_EXPANDED",E[E.UPC_A=14]="UPC_A",E[E.UPC_E=15]="UPC_E",E[E.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(Jo||(Jo={}));var te=Jo,ea;(function(E){E[E.OTHER=0]="OTHER",E[E.ORIENTATION=1]="ORIENTATION",E[E.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",E[E.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",E[E.ISSUE_NUMBER=4]="ISSUE_NUMBER",E[E.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",E[E.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",E[E.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",E[E.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",E[E.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",E[E.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(ea||(ea={}));var ct=ea;class ci{constructor(t,i,s,a,l=-1,u=-1){this.rawBytes=t,this.text=i,this.byteSegments=s,this.ecLevel=a,this.structuredAppendSequenceNumber=l,this.structuredAppendParity=u,this.numBits=t==null?0:8*t.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(t){this.numBits=t}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(t){this.errorsCorrected=t}getErasures(){return this.erasures}setErasures(t){this.erasures=t}getOther(){return this.other}setOther(t){this.other=t}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class ui{exp(t){return this.expTable[t]}log(t){if(t===0)throw new _;return this.logTable[t]}static addOrSubtract(t,i){return t^i}}class Gt{constructor(t,i){if(i.length===0)throw new _;this.field=t;const s=i.length;if(s>1&&i[0]===0){let a=1;for(;a<s&&i[a]===0;)a++;a===s?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(s-a),j.arraycopy(i,a,this.coefficients,0,this.coefficients.length))}else this.coefficients=i}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(t){return this.coefficients[this.coefficients.length-1-t]}evaluateAt(t){if(t===0)return this.getCoefficient(0);const i=this.coefficients;let s;if(t===1){s=0;for(let u=0,f=i.length;u!==f;u++){const d=i[u];s=ui.addOrSubtract(s,d)}return s}s=i[0];const a=i.length,l=this.field;for(let u=1;u<a;u++)s=ui.addOrSubtract(l.multiply(t,s),i[u]);return s}addOrSubtract(t){if(!this.field.equals(t.field))throw new _("GenericGFPolys do not have same GenericGF field");if(this.isZero())return t;if(t.isZero())return this;let i=this.coefficients,s=t.coefficients;if(i.length>s.length){const u=i;i=s,s=u}let a=new Int32Array(s.length);const l=s.length-i.length;j.arraycopy(s,0,a,0,l);for(let u=l;u<s.length;u++)a[u]=ui.addOrSubtract(i[u-l],s[u]);return new Gt(this.field,a)}multiply(t){if(!this.field.equals(t.field))throw new _("GenericGFPolys do not have same GenericGF field");if(this.isZero()||t.isZero())return this.field.getZero();const i=this.coefficients,s=i.length,a=t.coefficients,l=a.length,u=new Int32Array(s+l-1),f=this.field;for(let d=0;d<s;d++){const g=i[d];for(let x=0;x<l;x++)u[d+x]=ui.addOrSubtract(u[d+x],f.multiply(g,a[x]))}return new Gt(f,u)}multiplyScalar(t){if(t===0)return this.field.getZero();if(t===1)return this;const i=this.coefficients.length,s=this.field,a=new Int32Array(i),l=this.coefficients;for(let u=0;u<i;u++)a[u]=s.multiply(l[u],t);return new Gt(s,a)}multiplyByMonomial(t,i){if(t<0)throw new _;if(i===0)return this.field.getZero();const s=this.coefficients,a=s.length,l=new Int32Array(a+t),u=this.field;for(let f=0;f<a;f++)l[f]=u.multiply(s[f],i);return new Gt(u,l)}divide(t){if(!this.field.equals(t.field))throw new _("GenericGFPolys do not have same GenericGF field");if(t.isZero())throw new _("Divide by 0");const i=this.field;let s=i.getZero(),a=this;const l=t.getCoefficient(t.getDegree()),u=i.inverse(l);for(;a.getDegree()>=t.getDegree()&&!a.isZero();){const f=a.getDegree()-t.getDegree(),d=i.multiply(a.getCoefficient(a.getDegree()),u),g=t.multiplyByMonomial(f,d),x=i.buildMonomial(f,d);s=s.addOrSubtract(x),a=a.addOrSubtract(g)}return[s,a]}toString(){let t="";for(let i=this.getDegree();i>=0;i--){let s=this.getCoefficient(i);if(s!==0){if(s<0?(t+=" - ",s=-s):t.length>0&&(t+=" + "),i===0||s!==1){const a=this.field.log(s);a===0?t+="1":a===1?t+="a":(t+="a^",t+=a)}i!==0&&(i===1?t+="x":(t+="x^",t+=i))}}return t}}class Is extends m{}Is.kind="ArithmeticException";class ve extends ui{constructor(t,i,s){super(),this.primitive=t,this.size=i,this.generatorBase=s;const a=new Int32Array(i);let l=1;for(let f=0;f<i;f++)a[f]=l,l*=2,l>=i&&(l^=t,l&=i-1);this.expTable=a;const u=new Int32Array(i);for(let f=0;f<i-1;f++)u[a[f]]=f;this.logTable=u,this.zero=new Gt(this,Int32Array.from([0])),this.one=new Gt(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(t,i){if(t<0)throw new _;if(i===0)return this.zero;const s=new Int32Array(t+1);return s[0]=i,new Gt(this,s)}inverse(t){if(t===0)throw new Is;return this.expTable[this.size-this.logTable[t]-1]}multiply(t,i){return t===0||i===0?0:this.expTable[(this.logTable[t]+this.logTable[i])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+Y.toHexString(this.primitive)+","+this.size+")"}equals(t){return t===this}}ve.AZTEC_DATA_12=new ve(4201,4096,1),ve.AZTEC_DATA_10=new ve(1033,1024,1),ve.AZTEC_DATA_6=new ve(67,64,1),ve.AZTEC_PARAM=new ve(19,16,1),ve.QR_CODE_FIELD_256=new ve(285,256,0),ve.DATA_MATRIX_FIELD_256=new ve(301,256,1),ve.AZTEC_DATA_8=ve.DATA_MATRIX_FIELD_256,ve.MAXICODE_FIELD_64=ve.AZTEC_DATA_6;class vr extends m{}vr.kind="ReedSolomonException";class hn extends m{}hn.kind="IllegalStateException";class hi{constructor(t){this.field=t}decode(t,i){const s=this.field,a=new Gt(s,t),l=new Int32Array(i);let u=!0;for(let T=0;T<i;T++){const v=a.evaluateAt(s.exp(T+s.getGeneratorBase()));l[l.length-1-T]=v,v!==0&&(u=!1)}if(u)return;const f=new Gt(s,l),d=this.runEuclideanAlgorithm(s.buildMonomial(i,1),f,i),g=d[0],x=d[1],y=this.findErrorLocations(g),I=this.findErrorMagnitudes(x,y);for(let T=0;T<y.length;T++){const v=t.length-1-s.log(y[T]);if(v<0)throw new vr("Bad error location");t[v]=ve.addOrSubtract(t[v],I[T])}}runEuclideanAlgorithm(t,i,s){if(t.getDegree()<i.getDegree()){const T=t;t=i,i=T}const a=this.field;let l=t,u=i,f=a.getZero(),d=a.getOne();for(;u.getDegree()>=(s/2|0);){let T=l,v=f;if(l=u,f=d,l.isZero())throw new vr("r_{i-1} was zero");u=T;let S=a.getZero();const N=l.getCoefficient(l.getDegree()),D=a.inverse(N);for(;u.getDegree()>=l.getDegree()&&!u.isZero();){const F=u.getDegree()-l.getDegree(),U=a.multiply(u.getCoefficient(u.getDegree()),D);S=S.addOrSubtract(a.buildMonomial(F,U)),u=u.addOrSubtract(l.multiplyByMonomial(F,U))}if(d=S.multiply(f).addOrSubtract(v),u.getDegree()>=l.getDegree())throw new hn("Division algorithm failed to reduce polynomial?")}const g=d.getCoefficient(0);if(g===0)throw new vr("sigmaTilde(0) was zero");const x=a.inverse(g),y=d.multiplyScalar(x),I=u.multiplyScalar(x);return[y,I]}findErrorLocations(t){const i=t.getDegree();if(i===1)return Int32Array.from([t.getCoefficient(1)]);const s=new Int32Array(i);let a=0;const l=this.field;for(let u=1;u<l.getSize()&&a<i;u++)t.evaluateAt(u)===0&&(s[a]=l.inverse(u),a++);if(a!==i)throw new vr("Error locator degree does not match number of roots");return s}findErrorMagnitudes(t,i){const s=i.length,a=new Int32Array(s),l=this.field;for(let u=0;u<s;u++){const f=l.inverse(i[u]);let d=1;for(let g=0;g<s;g++)if(u!==g){const x=l.multiply(i[g],f),y=(x&1)===0?x|1:x&-2;d=l.multiply(d,y)}a[u]=l.multiply(t.evaluateAt(f),l.inverse(d)),l.getGeneratorBase()!==0&&(a[u]=l.multiply(a[u],f))}return a}}var mt;(function(E){E[E.UPPER=0]="UPPER",E[E.LOWER=1]="LOWER",E[E.MIXED=2]="MIXED",E[E.DIGIT=3]="DIGIT",E[E.PUNCT=4]="PUNCT",E[E.BINARY=5]="BINARY"})(mt||(mt={}));class Fe{decode(t){this.ddata=t;let i=t.getBits(),s=this.extractBits(i),a=this.correctBits(s),l=Fe.convertBoolArrayToByteArray(a),u=Fe.getEncodedData(a),f=new ci(l,u,null,null);return f.setNumBits(a.length),f}static highLevelDecode(t){return this.getEncodedData(t)}static getEncodedData(t){let i=t.length,s=mt.UPPER,a=mt.UPPER,l="",u=0;for(;u<i;)if(a===mt.BINARY){if(i-u<5)break;let f=Fe.readCode(t,u,5);if(u+=5,f===0){if(i-u<11)break;f=Fe.readCode(t,u,11)+31,u+=11}for(let d=0;d<f;d++){if(i-u<8){u=i;break}const g=Fe.readCode(t,u,8);l+=ie.castAsNonUtf8Char(g),u+=8}a=s}else{let f=a===mt.DIGIT?4:5;if(i-u<f)break;let d=Fe.readCode(t,u,f);u+=f;let g=Fe.getCharacter(a,d);g.startsWith("CTRL_")?(s=a,a=Fe.getTable(g.charAt(5)),g.charAt(6)==="L"&&(s=a)):(l+=g,a=s)}return l}static getTable(t){switch(t){case"L":return mt.LOWER;case"P":return mt.PUNCT;case"M":return mt.MIXED;case"D":return mt.DIGIT;case"B":return mt.BINARY;case"U":default:return mt.UPPER}}static getCharacter(t,i){switch(t){case mt.UPPER:return Fe.UPPER_TABLE[i];case mt.LOWER:return Fe.LOWER_TABLE[i];case mt.MIXED:return Fe.MIXED_TABLE[i];case mt.PUNCT:return Fe.PUNCT_TABLE[i];case mt.DIGIT:return Fe.DIGIT_TABLE[i];default:throw new hn("Bad table")}}correctBits(t){let i,s;this.ddata.getNbLayers()<=2?(s=6,i=ve.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(s=8,i=ve.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(s=10,i=ve.AZTEC_DATA_10):(s=12,i=ve.AZTEC_DATA_12);let a=this.ddata.getNbDatablocks(),l=t.length/s;if(l<a)throw new V;let u=t.length%s,f=new Int32Array(l);for(let I=0;I<l;I++,u+=s)f[I]=Fe.readCode(t,u,s);try{new hi(i).decode(f,l-a)}catch(I){throw new V(I)}let d=(1<<s)-1,g=0;for(let I=0;I<a;I++){let T=f[I];if(T===0||T===d)throw new V;(T===1||T===d-1)&&g++}let x=new Array(a*s-g),y=0;for(let I=0;I<a;I++){let T=f[I];if(T===1||T===d-1)x.fill(T>1,y,y+s-1),y+=s-1;else for(let v=s-1;v>=0;--v)x[y++]=(T&1<<v)!==0}return x}extractBits(t){let i=this.ddata.isCompact(),s=this.ddata.getNbLayers(),a=(i?11:14)+s*4,l=new Int32Array(a),u=new Array(this.totalBitsInLayer(s,i));if(i)for(let f=0;f<l.length;f++)l[f]=f;else{let f=a+1+2*Y.truncDivision(Y.truncDivision(a,2)-1,15),d=a/2,g=Y.truncDivision(f,2);for(let x=0;x<d;x++){let y=x+Y.truncDivision(x,15);l[d-x-1]=g-y-1,l[d+x]=g+y+1}}for(let f=0,d=0;f<s;f++){let g=(s-f)*4+(i?9:12),x=f*2,y=a-1-x;for(let I=0;I<g;I++){let T=I*2;for(let v=0;v<2;v++)u[d+T+v]=t.get(l[x+v],l[x+I]),u[d+2*g+T+v]=t.get(l[x+I],l[y-v]),u[d+4*g+T+v]=t.get(l[y-v],l[y-I]),u[d+6*g+T+v]=t.get(l[y-I],l[x+v])}d+=g*8}return u}static readCode(t,i,s){let a=0;for(let l=i;l<i+s;l++)a<<=1,t[l]&&(a|=1);return a}static readByte(t,i){let s=t.length-i;return s>=8?Fe.readCode(t,i,8):Fe.readCode(t,i,s)<<8-s}static convertBoolArrayToByteArray(t){let i=new Uint8Array((t.length+7)/8);for(let s=0;s<i.length;s++)i[s]=Fe.readByte(t,8*s);return i}totalBitsInLayer(t,i){return((i?88:112)+16*t)*t}}Fe.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],Fe.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],Fe.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],Fe.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],Fe.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class be{constructor(){}static round(t){return t===NaN?0:t<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:t>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:t+(t<0?-.5:.5)|0}static distance(t,i,s,a){const l=t-s,u=i-a;return Math.sqrt(l*l+u*u)}static sum(t){let i=0;for(let s=0,a=t.length;s!==a;s++){const l=t[s];i+=l}return i}}class Cs{static floatToIntBits(t){return t}}Cs.MAX_VALUE=Number.MAX_SAFE_INTEGER;class Z{constructor(t,i){this.x=t,this.y=i}getX(){return this.x}getY(){return this.y}equals(t){if(t instanceof Z){const i=t;return this.x===i.x&&this.y===i.y}return!1}hashCode(){return 31*Cs.floatToIntBits(this.x)+Cs.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(t){const i=this.distance(t[0],t[1]),s=this.distance(t[1],t[2]),a=this.distance(t[0],t[2]);let l,u,f;if(s>=i&&s>=a?(u=t[0],l=t[1],f=t[2]):a>=s&&a>=i?(u=t[1],l=t[0],f=t[2]):(u=t[2],l=t[0],f=t[1]),this.crossProductZ(l,u,f)<0){const d=l;l=f,f=d}t[0]=l,t[1]=u,t[2]=f}static distance(t,i){return be.distance(t.x,t.y,i.x,i.y)}static crossProductZ(t,i,s){const a=i.x,l=i.y;return(s.x-a)*(t.y-l)-(s.y-l)*(t.x-a)}}class bs{constructor(t,i){this.bits=t,this.points=i}getBits(){return this.bits}getPoints(){return this.points}}class gc extends bs{constructor(t,i,s,a,l){super(t,i),this.compact=s,this.nbDatablocks=a,this.nbLayers=l}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class Cn{constructor(t,i,s,a){this.image=t,this.height=t.getHeight(),this.width=t.getWidth(),i==null&&(i=Cn.INIT_SIZE),s==null&&(s=t.getWidth()/2|0),a==null&&(a=t.getHeight()/2|0);const l=i/2|0;if(this.leftInit=s-l,this.rightInit=s+l,this.upInit=a-l,this.downInit=a+l,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new M}detect(){let t=this.leftInit,i=this.rightInit,s=this.upInit,a=this.downInit,l=!1,u=!0,f=!1,d=!1,g=!1,x=!1,y=!1;const I=this.width,T=this.height;for(;u;){u=!1;let v=!0;for(;(v||!d)&&i<I;)v=this.containsBlackPoint(s,a,i,!1),v?(i++,u=!0,d=!0):d||i++;if(i>=I){l=!0;break}let S=!0;for(;(S||!g)&&a<T;)S=this.containsBlackPoint(t,i,a,!0),S?(a++,u=!0,g=!0):g||a++;if(a>=T){l=!0;break}let N=!0;for(;(N||!x)&&t>=0;)N=this.containsBlackPoint(s,a,t,!1),N?(t--,u=!0,x=!0):x||t--;if(t<0){l=!0;break}let D=!0;for(;(D||!y)&&s>=0;)D=this.containsBlackPoint(t,i,s,!0),D?(s--,u=!0,y=!0):y||s--;if(s<0){l=!0;break}u&&(f=!0)}if(!l&&f){const v=i-t;let S=null;for(let U=1;S===null&&U<v;U++)S=this.getBlackPointOnSegment(t,a-U,t+U,a);if(S==null)throw new M;let N=null;for(let U=1;N===null&&U<v;U++)N=this.getBlackPointOnSegment(t,s+U,t+U,s);if(N==null)throw new M;let D=null;for(let U=1;D===null&&U<v;U++)D=this.getBlackPointOnSegment(i,s+U,i-U,s);if(D==null)throw new M;let F=null;for(let U=1;F===null&&U<v;U++)F=this.getBlackPointOnSegment(i,a-U,i-U,a);if(F==null)throw new M;return this.centerEdges(F,S,D,N)}else throw new M}getBlackPointOnSegment(t,i,s,a){const l=be.round(be.distance(t,i,s,a)),u=(s-t)/l,f=(a-i)/l,d=this.image;for(let g=0;g<l;g++){const x=be.round(t+g*u),y=be.round(i+g*f);if(d.get(x,y))return new Z(x,y)}return null}centerEdges(t,i,s,a){const l=t.getX(),u=t.getY(),f=i.getX(),d=i.getY(),g=s.getX(),x=s.getY(),y=a.getX(),I=a.getY(),T=Cn.CORR;return l<this.width/2?[new Z(y-T,I+T),new Z(f+T,d+T),new Z(g-T,x-T),new Z(l+T,u-T)]:[new Z(y+T,I+T),new Z(f+T,d-T),new Z(g-T,x+T),new Z(l-T,u-T)]}containsBlackPoint(t,i,s,a){const l=this.image;if(a){for(let u=t;u<=i;u++)if(l.get(u,s))return!0}else for(let u=t;u<=i;u++)if(l.get(s,u))return!0;return!1}}Cn.INIT_SIZE=10,Cn.CORR=1;class ta{static checkAndNudgePoints(t,i){const s=t.getWidth(),a=t.getHeight();let l=!0;for(let u=0;u<i.length&&l;u+=2){const f=Math.floor(i[u]),d=Math.floor(i[u+1]);if(f<-1||f>s||d<-1||d>a)throw new M;l=!1,f===-1?(i[u]=0,l=!0):f===s&&(i[u]=s-1,l=!0),d===-1?(i[u+1]=0,l=!0):d===a&&(i[u+1]=a-1,l=!0)}l=!0;for(let u=i.length-2;u>=0&&l;u-=2){const f=Math.floor(i[u]),d=Math.floor(i[u+1]);if(f<-1||f>s||d<-1||d>a)throw new M;l=!1,f===-1?(i[u]=0,l=!0):f===s&&(i[u]=s-1,l=!0),d===-1?(i[u+1]=0,l=!0):d===a&&(i[u+1]=a-1,l=!0)}}}class nn{constructor(t,i,s,a,l,u,f,d,g){this.a11=t,this.a21=i,this.a31=s,this.a12=a,this.a22=l,this.a32=u,this.a13=f,this.a23=d,this.a33=g}static quadrilateralToQuadrilateral(t,i,s,a,l,u,f,d,g,x,y,I,T,v,S,N){const D=nn.quadrilateralToSquare(t,i,s,a,l,u,f,d);return nn.squareToQuadrilateral(g,x,y,I,T,v,S,N).times(D)}transformPoints(t){const i=t.length,s=this.a11,a=this.a12,l=this.a13,u=this.a21,f=this.a22,d=this.a23,g=this.a31,x=this.a32,y=this.a33;for(let I=0;I<i;I+=2){const T=t[I],v=t[I+1],S=l*T+d*v+y;t[I]=(s*T+u*v+g)/S,t[I+1]=(a*T+f*v+x)/S}}transformPointsWithValues(t,i){const s=this.a11,a=this.a12,l=this.a13,u=this.a21,f=this.a22,d=this.a23,g=this.a31,x=this.a32,y=this.a33,I=t.length;for(let T=0;T<I;T++){const v=t[T],S=i[T],N=l*v+d*S+y;t[T]=(s*v+u*S+g)/N,i[T]=(a*v+f*S+x)/N}}static squareToQuadrilateral(t,i,s,a,l,u,f,d){const g=t-s+l-f,x=i-a+u-d;if(g===0&&x===0)return new nn(s-t,l-s,t,a-i,u-a,i,0,0,1);{const y=s-l,I=f-l,T=a-u,v=d-u,S=y*v-I*T,N=(g*v-I*x)/S,D=(y*x-g*T)/S;return new nn(s-t+N*s,f-t+D*f,t,a-i+N*a,d-i+D*d,i,N,D,1)}}static quadrilateralToSquare(t,i,s,a,l,u,f,d){return nn.squareToQuadrilateral(t,i,s,a,l,u,f,d).buildAdjoint()}buildAdjoint(){return new nn(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(t){return new nn(this.a11*t.a11+this.a21*t.a12+this.a31*t.a13,this.a11*t.a21+this.a21*t.a22+this.a31*t.a23,this.a11*t.a31+this.a21*t.a32+this.a31*t.a33,this.a12*t.a11+this.a22*t.a12+this.a32*t.a13,this.a12*t.a21+this.a22*t.a22+this.a32*t.a23,this.a12*t.a31+this.a22*t.a32+this.a32*t.a33,this.a13*t.a11+this.a23*t.a12+this.a33*t.a13,this.a13*t.a21+this.a23*t.a22+this.a33*t.a23,this.a13*t.a31+this.a23*t.a32+this.a33*t.a33)}}class pc extends ta{sampleGrid(t,i,s,a,l,u,f,d,g,x,y,I,T,v,S,N,D,F,U){const L=nn.quadrilateralToQuadrilateral(a,l,u,f,d,g,x,y,I,T,v,S,N,D,F,U);return this.sampleGridWithTransform(t,i,s,L)}sampleGridWithTransform(t,i,s,a){if(i<=0||s<=0)throw new M;const l=new _e(i,s),u=new Float32Array(2*i);for(let f=0;f<s;f++){const d=u.length,g=f+.5;for(let x=0;x<d;x+=2)u[x]=x/2+.5,u[x+1]=g;a.transformPoints(u),ta.checkAndNudgePoints(t,u);try{for(let x=0;x<d;x+=2)t.get(Math.floor(u[x]),Math.floor(u[x+1]))&&l.set(x/2,f)}catch{throw new M}}return l}}class Ln{static setGridSampler(t){Ln.gridSampler=t}static getInstance(){return Ln.gridSampler}}Ln.gridSampler=new pc;class Bt{constructor(t,i){this.x=t,this.y=i}toResultPoint(){return new Z(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class mc{constructor(t){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=t}detect(){return this.detectMirror(!1)}detectMirror(t){let i=this.getMatrixCenter(),s=this.getBullsEyeCorners(i);if(t){let u=s[0];s[0]=s[2],s[2]=u}this.extractParameters(s);let a=this.sampleGrid(this.image,s[this.shift%4],s[(this.shift+1)%4],s[(this.shift+2)%4],s[(this.shift+3)%4]),l=this.getMatrixCornerPoints(s);return new gc(a,l,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(t){if(!this.isValidPoint(t[0])||!this.isValidPoint(t[1])||!this.isValidPoint(t[2])||!this.isValidPoint(t[3]))throw new M;let i=2*this.nbCenterLayers,s=new Int32Array([this.sampleLine(t[0],t[1],i),this.sampleLine(t[1],t[2],i),this.sampleLine(t[2],t[3],i),this.sampleLine(t[3],t[0],i)]);this.shift=this.getRotation(s,i);let a=0;for(let u=0;u<4;u++){let f=s[(this.shift+u)%4];this.compact?(a<<=7,a+=f>>1&127):(a<<=10,a+=(f>>2&31<<5)+(f>>1&31))}let l=this.getCorrectedParameterData(a,this.compact);this.compact?(this.nbLayers=(l>>6)+1,this.nbDataBlocks=(l&63)+1):(this.nbLayers=(l>>11)+1,this.nbDataBlocks=(l&2047)+1)}getRotation(t,i){let s=0;t.forEach((a,l,u)=>{let f=(a>>i-2<<1)+(a&1);s=(s<<3)+f}),s=((s&1)<<11)+(s>>1);for(let a=0;a<4;a++)if(Y.bitCount(s^this.EXPECTED_CORNER_BITS[a])<=2)return a;throw new M}getCorrectedParameterData(t,i){let s,a;i?(s=7,a=2):(s=10,a=4);let l=s-a,u=new Int32Array(s);for(let d=s-1;d>=0;--d)u[d]=t&15,t>>=4;try{new hi(ve.AZTEC_PARAM).decode(u,l)}catch{throw new M}let f=0;for(let d=0;d<a;d++)f=(f<<4)+u[d];return f}getBullsEyeCorners(t){let i=t,s=t,a=t,l=t,u=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let y=this.getFirstDifferent(i,u,1,-1),I=this.getFirstDifferent(s,u,1,1),T=this.getFirstDifferent(a,u,-1,1),v=this.getFirstDifferent(l,u,-1,-1);if(this.nbCenterLayers>2){let S=this.distancePoint(v,y)*this.nbCenterLayers/(this.distancePoint(l,i)*(this.nbCenterLayers+2));if(S<.75||S>1.25||!this.isWhiteOrBlackRectangle(y,I,T,v))break}i=y,s=I,a=T,l=v,u=!u}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new M;this.compact=this.nbCenterLayers===5;let f=new Z(i.getX()+.5,i.getY()-.5),d=new Z(s.getX()+.5,s.getY()+.5),g=new Z(a.getX()-.5,a.getY()+.5),x=new Z(l.getX()-.5,l.getY()-.5);return this.expandSquare([f,d,g,x],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let t,i,s,a;try{let f=new Cn(this.image).detect();t=f[0],i=f[1],s=f[2],a=f[3]}catch{let d=this.image.getWidth()/2,g=this.image.getHeight()/2;t=this.getFirstDifferent(new Bt(d+7,g-7),!1,1,-1).toResultPoint(),i=this.getFirstDifferent(new Bt(d+7,g+7),!1,1,1).toResultPoint(),s=this.getFirstDifferent(new Bt(d-7,g+7),!1,-1,1).toResultPoint(),a=this.getFirstDifferent(new Bt(d-7,g-7),!1,-1,-1).toResultPoint()}let l=be.round((t.getX()+a.getX()+i.getX()+s.getX())/4),u=be.round((t.getY()+a.getY()+i.getY()+s.getY())/4);try{let f=new Cn(this.image,15,l,u).detect();t=f[0],i=f[1],s=f[2],a=f[3]}catch{t=this.getFirstDifferent(new Bt(l+7,u-7),!1,1,-1).toResultPoint(),i=this.getFirstDifferent(new Bt(l+7,u+7),!1,1,1).toResultPoint(),s=this.getFirstDifferent(new Bt(l-7,u+7),!1,-1,1).toResultPoint(),a=this.getFirstDifferent(new Bt(l-7,u-7),!1,-1,-1).toResultPoint()}return l=be.round((t.getX()+a.getX()+i.getX()+s.getX())/4),u=be.round((t.getY()+a.getY()+i.getY()+s.getY())/4),new Bt(l,u)}getMatrixCornerPoints(t){return this.expandSquare(t,2*this.nbCenterLayers,this.getDimension())}sampleGrid(t,i,s,a,l){let u=Ln.getInstance(),f=this.getDimension(),d=f/2-this.nbCenterLayers,g=f/2+this.nbCenterLayers;return u.sampleGrid(t,f,f,d,d,g,d,g,g,d,g,i.getX(),i.getY(),s.getX(),s.getY(),a.getX(),a.getY(),l.getX(),l.getY())}sampleLine(t,i,s){let a=0,l=this.distanceResultPoint(t,i),u=l/s,f=t.getX(),d=t.getY(),g=u*(i.getX()-t.getX())/l,x=u*(i.getY()-t.getY())/l;for(let y=0;y<s;y++)this.image.get(be.round(f+y*g),be.round(d+y*x))&&(a|=1<<s-y-1);return a}isWhiteOrBlackRectangle(t,i,s,a){let l=3;t=new Bt(t.getX()-l,t.getY()+l),i=new Bt(i.getX()-l,i.getY()-l),s=new Bt(s.getX()+l,s.getY()-l),a=new Bt(a.getX()+l,a.getY()+l);let u=this.getColor(a,t);if(u===0)return!1;let f=this.getColor(t,i);return f!==u||(f=this.getColor(i,s),f!==u)?!1:(f=this.getColor(s,a),f===u)}getColor(t,i){let s=this.distancePoint(t,i),a=(i.getX()-t.getX())/s,l=(i.getY()-t.getY())/s,u=0,f=t.getX(),d=t.getY(),g=this.image.get(t.getX(),t.getY()),x=Math.ceil(s);for(let I=0;I<x;I++)f+=a,d+=l,this.image.get(be.round(f),be.round(d))!==g&&u++;let y=u/s;return y>.1&&y<.9?0:y<=.1===g?1:-1}getFirstDifferent(t,i,s,a){let l=t.getX()+s,u=t.getY()+a;for(;this.isValid(l,u)&&this.image.get(l,u)===i;)l+=s,u+=a;for(l-=s,u-=a;this.isValid(l,u)&&this.image.get(l,u)===i;)l+=s;for(l-=s;this.isValid(l,u)&&this.image.get(l,u)===i;)u+=a;return u-=a,new Bt(l,u)}expandSquare(t,i,s){let a=s/(2*i),l=t[0].getX()-t[2].getX(),u=t[0].getY()-t[2].getY(),f=(t[0].getX()+t[2].getX())/2,d=(t[0].getY()+t[2].getY())/2,g=new Z(f+a*l,d+a*u),x=new Z(f-a*l,d-a*u);l=t[1].getX()-t[3].getX(),u=t[1].getY()-t[3].getY(),f=(t[1].getX()+t[3].getX())/2,d=(t[1].getY()+t[3].getY())/2;let y=new Z(f+a*l,d+a*u),I=new Z(f-a*l,d-a*u);return[g,y,x,I]}isValid(t,i){return t>=0&&t<this.image.getWidth()&&i>0&&i<this.image.getHeight()}isValidPoint(t){let i=be.round(t.getX()),s=be.round(t.getY());return this.isValid(i,s)}distancePoint(t,i){return be.distance(t.getX(),t.getY(),i.getX(),i.getY())}distanceResultPoint(t,i){return be.distance(t.getX(),t.getY(),i.getX(),i.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(Y.truncDivision(this.nbLayers-4,8)+1)+15}}class Ts{decode(t,i=null){let s=null,a=new mc(t.getBlackMatrix()),l=null,u=null;try{let x=a.detectMirror(!1);l=x.getPoints(),this.reportFoundResultPoints(i,l),u=new Fe().decode(x)}catch(x){s=x}if(u==null)try{let x=a.detectMirror(!0);l=x.getPoints(),this.reportFoundResultPoints(i,l),u=new Fe().decode(x)}catch(x){throw s!=null?s:x}let f=new Lt(u.getText(),u.getRawBytes(),u.getNumBits(),l,te.AZTEC,j.currentTimeMillis()),d=u.getByteSegments();d!=null&&f.putMetadata(ct.BYTE_SEGMENTS,d);let g=u.getECLevel();return g!=null&&f.putMetadata(ct.ERROR_CORRECTION_LEVEL,g),f}reportFoundResultPoints(t,i){if(t!=null){let s=t.get(de.NEED_RESULT_POINT_CALLBACK);s!=null&&i.forEach((a,l,u)=>{s.foundPossibleResultPoint(a)})}}reset(){}}class Q1 extends nr{constructor(t=500){super(new Ts,t)}}class et{decode(t,i){try{return this.doDecode(t,i)}catch{if(i&&i.get(de.TRY_HARDER)===!0&&t.isRotateSupported()){const l=t.rotateCounterClockwise(),u=this.doDecode(l,i),f=u.getResultMetadata();let d=270;f!==null&&f.get(ct.ORIENTATION)===!0&&(d=d+f.get(ct.ORIENTATION)%360),u.putMetadata(ct.ORIENTATION,d);const g=u.getResultPoints();if(g!==null){const x=l.getHeight();for(let y=0;y<g.length;y++)g[y]=new Z(x-g[y].getY()-1,g[y].getX())}return u}else throw new M}}reset(){}doDecode(t,i){const s=t.getWidth(),a=t.getHeight();let l=new fe(s);const u=i&&i.get(de.TRY_HARDER)===!0,f=Math.max(1,a>>(u?8:5));let d;u?d=a:d=15;const g=Math.trunc(a/2);for(let x=0;x<d;x++){const y=Math.trunc((x+1)/2),I=(x&1)===0,T=g+f*(I?y:-y);if(T<0||T>=a)break;try{l=t.getBlackRow(T,l)}catch{continue}for(let v=0;v<2;v++){if(v===1&&(l.reverse(),i&&i.get(de.NEED_RESULT_POINT_CALLBACK)===!0)){const S=new Map;i.forEach((N,D)=>S.set(D,N)),S.delete(de.NEED_RESULT_POINT_CALLBACK),i=S}try{const S=this.decodeRow(T,l,i);if(v===1){S.putMetadata(ct.ORIENTATION,180);const N=S.getResultPoints();N!==null&&(N[0]=new Z(s-N[0].getX()-1,N[0].getY()),N[1]=new Z(s-N[1].getX()-1,N[1].getY()))}return S}catch{}}}throw new M}static recordPattern(t,i,s){const a=s.length;for(let g=0;g<a;g++)s[g]=0;const l=t.getSize();if(i>=l)throw new M;let u=!t.get(i),f=0,d=i;for(;d<l;){if(t.get(d)!==u)s[f]++;else{if(++f===a)break;s[f]=1,u=!u}d++}if(!(f===a||f===a-1&&d===l))throw new M}static recordPatternInReverse(t,i,s){let a=s.length,l=t.get(i);for(;i>0&&a>=0;)t.get(--i)!==l&&(a--,l=!l);if(a>=0)throw new M;et.recordPattern(t,i+1,s)}static patternMatchVariance(t,i,s){const a=t.length;let l=0,u=0;for(let g=0;g<a;g++)l+=t[g],u+=i[g];if(l<u)return Number.POSITIVE_INFINITY;const f=l/u;s*=f;let d=0;for(let g=0;g<a;g++){const x=t[g],y=i[g]*f,I=x>y?x-y:y-x;if(I>s)return Number.POSITIVE_INFINITY;d+=I}return d/l}}class X extends et{static findStartPattern(t){const i=t.getSize(),s=t.getNextSet(0);let a=0,l=Int32Array.from([0,0,0,0,0,0]),u=s,f=!1;const d=6;for(let g=s;g<i;g++)if(t.get(g)!==f)l[a]++;else{if(a===d-1){let x=X.MAX_AVG_VARIANCE,y=-1;for(let I=X.CODE_START_A;I<=X.CODE_START_C;I++){const T=et.patternMatchVariance(l,X.CODE_PATTERNS[I],X.MAX_INDIVIDUAL_VARIANCE);T<x&&(x=T,y=I)}if(y>=0&&t.isRange(Math.max(0,u-(g-u)/2),u,!1))return Int32Array.from([u,g,y]);u+=l[0]+l[1],l=l.slice(2,l.length-1),l[a-1]=0,l[a]=0,a--}else a++;l[a]=1,f=!f}throw new M}static decodeCode(t,i,s){et.recordPattern(t,s,i);let a=X.MAX_AVG_VARIANCE,l=-1;for(let u=0;u<X.CODE_PATTERNS.length;u++){const f=X.CODE_PATTERNS[u],d=this.patternMatchVariance(i,f,X.MAX_INDIVIDUAL_VARIANCE);d<a&&(a=d,l=u)}if(l>=0)return l;throw new M}decodeRow(t,i,s){const a=s&&s.get(de.ASSUME_GS1)===!0,l=X.findStartPattern(i),u=l[2];let f=0;const d=new Uint8Array(20);d[f++]=u;let g;switch(u){case X.CODE_START_A:g=X.CODE_CODE_A;break;case X.CODE_START_B:g=X.CODE_CODE_B;break;case X.CODE_START_C:g=X.CODE_CODE_C;break;default:throw new V}let x=!1,y=!1,I="",T=l[0],v=l[1];const S=Int32Array.from([0,0,0,0,0,0]);let N=0,D=0,F=u,U=0,L=!0,Ee=!1,ce=!1;for(;!x;){const Lr=y;switch(y=!1,N=D,D=X.decodeCode(i,S,v),d[f++]=D,D!==X.CODE_STOP&&(L=!0),D!==X.CODE_STOP&&(U++,F+=U*D),T=v,v+=S.reduce((v0,S0)=>v0+S0,0),D){case X.CODE_START_A:case X.CODE_START_B:case X.CODE_START_C:throw new V}switch(g){case X.CODE_CODE_A:if(D<64)ce===Ee?I+=String.fromCharCode(" ".charCodeAt(0)+D):I+=String.fromCharCode(" ".charCodeAt(0)+D+128),ce=!1;else if(D<96)ce===Ee?I+=String.fromCharCode(D-64):I+=String.fromCharCode(D+64),ce=!1;else switch(D!==X.CODE_STOP&&(L=!1),D){case X.CODE_FNC_1:a&&(I.length===0?I+="]C1":I+=String.fromCharCode(29));break;case X.CODE_FNC_2:case X.CODE_FNC_3:break;case X.CODE_FNC_4_A:!Ee&&ce?(Ee=!0,ce=!1):Ee&&ce?(Ee=!1,ce=!1):ce=!0;break;case X.CODE_SHIFT:y=!0,g=X.CODE_CODE_B;break;case X.CODE_CODE_B:g=X.CODE_CODE_B;break;case X.CODE_CODE_C:g=X.CODE_CODE_C;break;case X.CODE_STOP:x=!0;break}break;case X.CODE_CODE_B:if(D<96)ce===Ee?I+=String.fromCharCode(" ".charCodeAt(0)+D):I+=String.fromCharCode(" ".charCodeAt(0)+D+128),ce=!1;else switch(D!==X.CODE_STOP&&(L=!1),D){case X.CODE_FNC_1:a&&(I.length===0?I+="]C1":I+=String.fromCharCode(29));break;case X.CODE_FNC_2:case X.CODE_FNC_3:break;case X.CODE_FNC_4_B:!Ee&&ce?(Ee=!0,ce=!1):Ee&&ce?(Ee=!1,ce=!1):ce=!0;break;case X.CODE_SHIFT:y=!0,g=X.CODE_CODE_A;break;case X.CODE_CODE_A:g=X.CODE_CODE_A;break;case X.CODE_CODE_C:g=X.CODE_CODE_C;break;case X.CODE_STOP:x=!0;break}break;case X.CODE_CODE_C:if(D<100)D<10&&(I+="0"),I+=D;else switch(D!==X.CODE_STOP&&(L=!1),D){case X.CODE_FNC_1:a&&(I.length===0?I+="]C1":I+=String.fromCharCode(29));break;case X.CODE_CODE_A:g=X.CODE_CODE_A;break;case X.CODE_CODE_B:g=X.CODE_CODE_B;break;case X.CODE_STOP:x=!0;break}break}Lr&&(g=g===X.CODE_CODE_A?X.CODE_CODE_B:X.CODE_CODE_A)}const zt=v-T;if(v=i.getNextUnset(v),!i.isRange(v,Math.min(i.getSize(),v+(v-T)/2),!1))throw new M;if(F-=U*N,F%103!==N)throw new H;const sn=I.length;if(sn===0)throw new M;sn>0&&L&&(g===X.CODE_CODE_C?I=I.substring(0,sn-2):I=I.substring(0,sn-1));const Kt=(l[1]+l[0])/2,Le=T+zt/2,Et=d.length,qt=new Uint8Array(Et);for(let Lr=0;Lr<Et;Lr++)qt[Lr]=d[Lr];const Pr=[new Z(Kt,t),new Z(Le,t)];return new Lt(I,qt,0,Pr,te.CODE_128,new Date().getTime())}}X.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],X.MAX_AVG_VARIANCE=.25,X.MAX_INDIVIDUAL_VARIANCE=.7,X.CODE_SHIFT=98,X.CODE_CODE_C=99,X.CODE_CODE_B=100,X.CODE_CODE_A=101,X.CODE_FNC_1=102,X.CODE_FNC_2=97,X.CODE_FNC_3=96,X.CODE_FNC_4_A=101,X.CODE_FNC_4_B=100,X.CODE_START_A=103,X.CODE_START_B=104,X.CODE_START_C=105,X.CODE_STOP=106;class it extends et{constructor(t=!1,i=!1){super(),this.usingCheckDigit=t,this.extendedMode=i,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(t,i,s){let a=this.counters;a.fill(0),this.decodeRowResult="";let l=it.findAsteriskPattern(i,a),u=i.getNextSet(l[1]),f=i.getSize(),d,g;do{it.recordPattern(i,u,a);let S=it.toNarrowWidePattern(a);if(S<0)throw new M;d=it.patternToChar(S),this.decodeRowResult+=d,g=u;for(let N of a)u+=N;u=i.getNextSet(u)}while(d!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let x=0;for(let S of a)x+=S;let y=u-g-x;if(u!==f&&y*2<x)throw new M;if(this.usingCheckDigit){let S=this.decodeRowResult.length-1,N=0;for(let D=0;D<S;D++)N+=it.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(D));if(this.decodeRowResult.charAt(S)!==it.ALPHABET_STRING.charAt(N%43))throw new H;this.decodeRowResult=this.decodeRowResult.substring(0,S)}if(this.decodeRowResult.length===0)throw new M;let I;this.extendedMode?I=it.decodeExtended(this.decodeRowResult):I=this.decodeRowResult;let T=(l[1]+l[0])/2,v=g+x/2;return new Lt(I,null,0,[new Z(T,t),new Z(v,t)],te.CODE_39,new Date().getTime())}static findAsteriskPattern(t,i){let s=t.getSize(),a=t.getNextSet(0),l=0,u=a,f=!1,d=i.length;for(let g=a;g<s;g++)if(t.get(g)!==f)i[l]++;else{if(l===d-1){if(this.toNarrowWidePattern(i)===it.ASTERISK_ENCODING&&t.isRange(Math.max(0,u-Math.floor((g-u)/2)),u,!1))return[u,g];u+=i[0]+i[1],i.copyWithin(0,2,2+l-1),i[l-1]=0,i[l]=0,l--}else l++;i[l]=1,f=!f}throw new M}static toNarrowWidePattern(t){let i=t.length,s=0,a;do{let l=2147483647;for(let d of t)d<l&&d>s&&(l=d);s=l,a=0;let u=0,f=0;for(let d=0;d<i;d++){let g=t[d];g>s&&(f|=1<<i-1-d,a++,u+=g)}if(a===3){for(let d=0;d<i&&a>0;d++){let g=t[d];if(g>s&&(a--,g*2>=u))return-1}return f}}while(a>3);return-1}static patternToChar(t){for(let i=0;i<it.CHARACTER_ENCODINGS.length;i++)if(it.CHARACTER_ENCODINGS[i]===t)return it.ALPHABET_STRING.charAt(i);if(t===it.ASTERISK_ENCODING)return"*";throw new M}static decodeExtended(t){let i=t.length,s="";for(let a=0;a<i;a++){let l=t.charAt(a);if(l==="+"||l==="$"||l==="%"||l==="/"){let u=t.charAt(a+1),f="\0";switch(l){case"+":if(u>="A"&&u<="Z")f=String.fromCharCode(u.charCodeAt(0)+32);else throw new V;break;case"$":if(u>="A"&&u<="Z")f=String.fromCharCode(u.charCodeAt(0)-64);else throw new V;break;case"%":if(u>="A"&&u<="E")f=String.fromCharCode(u.charCodeAt(0)-38);else if(u>="F"&&u<="J")f=String.fromCharCode(u.charCodeAt(0)-11);else if(u>="K"&&u<="O")f=String.fromCharCode(u.charCodeAt(0)+16);else if(u>="P"&&u<="T")f=String.fromCharCode(u.charCodeAt(0)+43);else if(u==="U")f="\0";else if(u==="V")f="@";else if(u==="W")f="`";else if(u==="X"||u==="Y"||u==="Z")f="\x7F";else throw new V;break;case"/":if(u>="A"&&u<="O")f=String.fromCharCode(u.charCodeAt(0)-32);else if(u==="Z")f=":";else throw new V;break}s+=f,a++}else s+=l}return s}}it.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",it.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],it.ASTERISK_ENCODING=148;class ke extends et{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(t,i,s){let a=this.decodeStart(i),l=this.decodeEnd(i),u=new le;ke.decodeMiddle(i,a[1],l[0],u);let f=u.toString(),d=null;s!=null&&(d=s.get(de.ALLOWED_LENGTHS)),d==null&&(d=ke.DEFAULT_ALLOWED_LENGTHS);let g=f.length,x=!1,y=0;for(let v of d){if(g===v){x=!0;break}v>y&&(y=v)}if(!x&&g>y&&(x=!0),!x)throw new V;const I=[new Z(a[1],t),new Z(l[0],t)];return new Lt(f,null,0,I,te.ITF,new Date().getTime())}static decodeMiddle(t,i,s,a){let l=new Int32Array(10),u=new Int32Array(5),f=new Int32Array(5);for(l.fill(0),u.fill(0),f.fill(0);i<s;){et.recordPattern(t,i,l);for(let g=0;g<5;g++){let x=2*g;u[g]=l[x],f[g]=l[x+1]}let d=ke.decodeDigit(u);a.append(d.toString()),d=this.decodeDigit(f),a.append(d.toString()),l.forEach(function(g){i+=g})}}decodeStart(t){let i=ke.skipWhiteSpace(t),s=ke.findGuardPattern(t,i,ke.START_PATTERN);return this.narrowLineWidth=(s[1]-s[0])/4,this.validateQuietZone(t,s[0]),s}validateQuietZone(t,i){let s=this.narrowLineWidth*10;s=s<i?s:i;for(let a=i-1;s>0&&a>=0&&!t.get(a);a--)s--;if(s!==0)throw new M}static skipWhiteSpace(t){const i=t.getSize(),s=t.getNextSet(0);if(s===i)throw new M;return s}decodeEnd(t){t.reverse();try{let i=ke.skipWhiteSpace(t),s;try{s=ke.findGuardPattern(t,i,ke.END_PATTERN_REVERSED[0])}catch(l){l instanceof M&&(s=ke.findGuardPattern(t,i,ke.END_PATTERN_REVERSED[1]))}this.validateQuietZone(t,s[0]);let a=s[0];return s[0]=t.getSize()-s[1],s[1]=t.getSize()-a,s}finally{t.reverse()}}static findGuardPattern(t,i,s){let a=s.length,l=new Int32Array(a),u=t.getSize(),f=!1,d=0,g=i;l.fill(0);for(let x=i;x<u;x++)if(t.get(x)!==f)l[d]++;else{if(d===a-1){if(et.patternMatchVariance(l,s,ke.MAX_INDIVIDUAL_VARIANCE)<ke.MAX_AVG_VARIANCE)return[g,x];g+=l[0]+l[1],j.arraycopy(l,2,l,0,d-1),l[d-1]=0,l[d]=0,d--}else d++;l[d]=1,f=!f}throw new M}static decodeDigit(t){let i=ke.MAX_AVG_VARIANCE,s=-1,a=ke.PATTERNS.length;for(let l=0;l<a;l++){let u=ke.PATTERNS[l],f=et.patternMatchVariance(t,u,ke.MAX_INDIVIDUAL_VARIANCE);f<i?(i=f,s=l):f===i&&(s=-1)}if(s>=0)return s%10;throw new M}}ke.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],ke.MAX_AVG_VARIANCE=.38,ke.MAX_INDIVIDUAL_VARIANCE=.5,ke.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],ke.START_PATTERN=Int32Array.from([1,1,1,1]),ke.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Ye extends et{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(t){let i=!1,s,a=0,l=Int32Array.from([0,0,0]);for(;!i;){l=Int32Array.from([0,0,0]),s=Ye.findGuardPattern(t,a,!1,this.START_END_PATTERN,l);let u=s[0];a=s[1];let f=u-(a-u);f>=0&&(i=t.isRange(f,u,!1))}return s}static checkChecksum(t){return Ye.checkStandardUPCEANChecksum(t)}static checkStandardUPCEANChecksum(t){let i=t.length;if(i===0)return!1;let s=parseInt(t.charAt(i-1),10);return Ye.getStandardUPCEANChecksum(t.substring(0,i-1))===s}static getStandardUPCEANChecksum(t){let i=t.length,s=0;for(let a=i-1;a>=0;a-=2){let l=t.charAt(a).charCodeAt(0)-"0".charCodeAt(0);if(l<0||l>9)throw new V;s+=l}s*=3;for(let a=i-2;a>=0;a-=2){let l=t.charAt(a).charCodeAt(0)-"0".charCodeAt(0);if(l<0||l>9)throw new V;s+=l}return(1e3-s)%10}static decodeEnd(t,i){return Ye.findGuardPattern(t,i,!1,Ye.START_END_PATTERN,new Int32Array(Ye.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(t,i,s,a){return this.findGuardPattern(t,i,s,a,new Int32Array(a.length))}static findGuardPattern(t,i,s,a,l){let u=t.getSize();i=s?t.getNextUnset(i):t.getNextSet(i);let f=0,d=i,g=a.length,x=s;for(let y=i;y<u;y++)if(t.get(y)!==x)l[f]++;else{if(f===g-1){if(et.patternMatchVariance(l,a,Ye.MAX_INDIVIDUAL_VARIANCE)<Ye.MAX_AVG_VARIANCE)return Int32Array.from([d,y]);d+=l[0]+l[1];let I=l.slice(2,l.length-1);for(let T=0;T<f-1;T++)l[T]=I[T];l[f-1]=0,l[f]=0,f--}else f++;l[f]=1,x=!x}throw new M}static decodeDigit(t,i,s,a){this.recordPattern(t,s,i);let l=this.MAX_AVG_VARIANCE,u=-1,f=a.length;for(let d=0;d<f;d++){let g=a[d],x=et.patternMatchVariance(i,g,Ye.MAX_INDIVIDUAL_VARIANCE);x<l&&(l=x,u=d)}if(u>=0)return u;throw new M}}Ye.MAX_AVG_VARIANCE=.48,Ye.MAX_INDIVIDUAL_VARIANCE=.7,Ye.START_END_PATTERN=Int32Array.from([1,1,1]),Ye.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Ye.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Ye.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class fi{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(t,i,s){let a=this.decodeRowStringBuffer,l=this.decodeMiddle(i,s,a),u=a.toString(),f=fi.parseExtensionString(u),d=[new Z((s[0]+s[1])/2,t),new Z(l,t)],g=new Lt(u,null,0,d,te.UPC_EAN_EXTENSION,new Date().getTime());return f!=null&&g.putAllMetadata(f),g}decodeMiddle(t,i,s){let a=this.decodeMiddleCounters;a[0]=0,a[1]=0,a[2]=0,a[3]=0;let l=t.getSize(),u=i[1],f=0;for(let g=0;g<5&&u<l;g++){let x=Ye.decodeDigit(t,a,u,Ye.L_AND_G_PATTERNS);s+=String.fromCharCode("0".charCodeAt(0)+x%10);for(let y of a)u+=y;x>=10&&(f|=1<<4-g),g!==4&&(u=t.getNextSet(u),u=t.getNextUnset(u))}if(s.length!==5)throw new M;let d=this.determineCheckDigit(f);if(fi.extensionChecksum(s.toString())!==d)throw new M;return u}static extensionChecksum(t){let i=t.length,s=0;for(let a=i-2;a>=0;a-=2)s+=t.charAt(a).charCodeAt(0)-"0".charCodeAt(0);s*=3;for(let a=i-1;a>=0;a-=2)s+=t.charAt(a).charCodeAt(0)-"0".charCodeAt(0);return s*=3,s%10}determineCheckDigit(t){for(let i=0;i<10;i++)if(t===this.CHECK_DIGIT_ENCODINGS[i])return i;throw new M}static parseExtensionString(t){if(t.length!==5)return null;let i=fi.parseExtension5String(t);return i==null?null:new Map([[ct.SUGGESTED_PRICE,i]])}static parseExtension5String(t){let i;switch(t.charAt(0)){case"0":i="\xA3";break;case"5":i="$";break;case"9":switch(t){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}i="";break;default:i="";break}let s=parseInt(t.substring(1)),a=(s/100).toString(),l=s%100,u=l<10?"0"+l:l.toString();return i+a+"."+u}}class na{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(t,i,s){let a=this.decodeRowStringBuffer,l=this.decodeMiddle(i,s,a),u=a.toString(),f=na.parseExtensionString(u),d=[new Z((s[0]+s[1])/2,t),new Z(l,t)],g=new Lt(u,null,0,d,te.UPC_EAN_EXTENSION,new Date().getTime());return f!=null&&g.putAllMetadata(f),g}decodeMiddle(t,i,s){let a=this.decodeMiddleCounters;a[0]=0,a[1]=0,a[2]=0,a[3]=0;let l=t.getSize(),u=i[1],f=0;for(let d=0;d<2&&u<l;d++){let g=Ye.decodeDigit(t,a,u,Ye.L_AND_G_PATTERNS);s+=String.fromCharCode("0".charCodeAt(0)+g%10);for(let x of a)u+=x;g>=10&&(f|=1<<1-d),d!==1&&(u=t.getNextSet(u),u=t.getNextUnset(u))}if(s.length!==2)throw new M;if(parseInt(s.toString())%4!==f)throw new M;return u}static parseExtensionString(t){return t.length!==2?null:new Map([[ct.ISSUE_NUMBER,parseInt(t)]])}}class xc{static decodeRow(t,i,s){let a=Ye.findGuardPattern(i,s,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new fi().decodeRow(t,i,a)}catch{return new na().decodeRow(t,i,a)}}}xc.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Se extends Ye{constructor(){super(),this.decodeRowStringBuffer="",Se.L_AND_G_PATTERNS=Se.L_PATTERNS.map(t=>Int32Array.from(t));for(let t=10;t<20;t++){let i=Se.L_PATTERNS[t-10],s=new Int32Array(i.length);for(let a=0;a<i.length;a++)s[a]=i[i.length-a-1];Se.L_AND_G_PATTERNS[t]=s}}decodeRow(t,i,s){let a=Se.findStartGuardPattern(i),l=s==null?null:s.get(de.NEED_RESULT_POINT_CALLBACK);if(l!=null){const L=new Z((a[0]+a[1])/2,t);l.foundPossibleResultPoint(L)}let u=this.decodeMiddle(i,a,this.decodeRowStringBuffer),f=u.rowOffset,d=u.resultString;if(l!=null){const L=new Z(f,t);l.foundPossibleResultPoint(L)}let g=this.decodeEnd(i,f);if(l!=null){const L=new Z((g[0]+g[1])/2,t);l.foundPossibleResultPoint(L)}let x=g[1],y=x+(x-g[0]);if(y>=i.getSize()||!i.isRange(x,y,!1))throw new M;let I=d.toString();if(I.length<8)throw new V;if(!Se.checkChecksum(I))throw new H;let T=(a[1]+a[0])/2,v=(g[1]+g[0])/2,S=this.getBarcodeFormat(),N=[new Z(T,t),new Z(v,t)],D=new Lt(I,null,0,N,S,new Date().getTime()),F=0;try{let L=xc.decodeRow(t,i,g[1]);D.putMetadata(ct.UPC_EAN_EXTENSION,L.getText()),D.putAllMetadata(L.getResultMetadata()),D.addResultPoints(L.getResultPoints()),F=L.getText().length}catch{}let U=s==null?null:s.get(de.ALLOWED_EAN_EXTENSIONS);if(U!=null){let L=!1;for(let Ee in U)if(F.toString()===Ee){L=!0;break}if(!L)throw new M}return D}decodeEnd(t,i){return Se.findGuardPattern(t,i,!1,Se.START_END_PATTERN,new Int32Array(Se.START_END_PATTERN.length).fill(0))}static checkChecksum(t){return Se.checkStandardUPCEANChecksum(t)}static checkStandardUPCEANChecksum(t){let i=t.length;if(i===0)return!1;let s=parseInt(t.charAt(i-1),10);return Se.getStandardUPCEANChecksum(t.substring(0,i-1))===s}static getStandardUPCEANChecksum(t){let i=t.length,s=0;for(let a=i-1;a>=0;a-=2){let l=t.charAt(a).charCodeAt(0)-"0".charCodeAt(0);if(l<0||l>9)throw new V;s+=l}s*=3;for(let a=i-2;a>=0;a-=2){let l=t.charAt(a).charCodeAt(0)-"0".charCodeAt(0);if(l<0||l>9)throw new V;s+=l}return(1e3-s)%10}}class rr extends Se{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(t,i,s){let a=this.decodeMiddleCounters;a[0]=0,a[1]=0,a[2]=0,a[3]=0;let l=t.getSize(),u=i[1],f=0;for(let g=0;g<6&&u<l;g++){let x=Se.decodeDigit(t,a,u,Se.L_AND_G_PATTERNS);s+=String.fromCharCode("0".charCodeAt(0)+x%10);for(let y of a)u+=y;x>=10&&(f|=1<<5-g)}s=rr.determineFirstDigit(s,f),u=Se.findGuardPattern(t,u,!0,Se.MIDDLE_PATTERN,new Int32Array(Se.MIDDLE_PATTERN.length).fill(0))[1];for(let g=0;g<6&&u<l;g++){let x=Se.decodeDigit(t,a,u,Se.L_PATTERNS);s+=String.fromCharCode("0".charCodeAt(0)+x);for(let y of a)u+=y}return{rowOffset:u,resultString:s}}getBarcodeFormat(){return te.EAN_13}static determineFirstDigit(t,i){for(let s=0;s<10;s++)if(i===this.FIRST_DIGIT_ENCODINGS[s])return t=String.fromCharCode("0".charCodeAt(0)+s)+t,t;throw new M}}rr.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class wc extends Se{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(t,i,s){const a=this.decodeMiddleCounters;a[0]=0,a[1]=0,a[2]=0,a[3]=0;let l=t.getSize(),u=i[1];for(let d=0;d<4&&u<l;d++){let g=Se.decodeDigit(t,a,u,Se.L_PATTERNS);s+=String.fromCharCode("0".charCodeAt(0)+g);for(let x of a)u+=x}u=Se.findGuardPattern(t,u,!0,Se.MIDDLE_PATTERN,new Int32Array(Se.MIDDLE_PATTERN.length).fill(0))[1];for(let d=0;d<4&&u<l;d++){let g=Se.decodeDigit(t,a,u,Se.L_PATTERNS);s+=String.fromCharCode("0".charCodeAt(0)+g);for(let x of a)u+=x}return{rowOffset:u,resultString:s}}getBarcodeFormat(){return te.EAN_8}}class Ec extends Se{constructor(){super(...arguments),this.ean13Reader=new rr}getBarcodeFormat(){return te.UPC_A}decode(t,i){return this.maybeReturnResult(this.ean13Reader.decode(t))}decodeRow(t,i,s){return this.maybeReturnResult(this.ean13Reader.decodeRow(t,i,s))}decodeMiddle(t,i,s){return this.ean13Reader.decodeMiddle(t,i,s)}maybeReturnResult(t){let i=t.getText();if(i.charAt(0)==="0"){let s=new Lt(i.substring(1),null,null,t.getResultPoints(),te.UPC_A);return t.getResultMetadata()!=null&&s.putAllMetadata(t.getResultMetadata()),s}else throw new M}reset(){this.ean13Reader.reset()}}class rn extends Se{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(t,i,s){const a=this.decodeMiddleCounters.map(g=>g);a[0]=0,a[1]=0,a[2]=0,a[3]=0;const l=t.getSize();let u=i[1],f=0;for(let g=0;g<6&&u<l;g++){const x=rn.decodeDigit(t,a,u,rn.L_AND_G_PATTERNS);s+=String.fromCharCode("0".charCodeAt(0)+x%10);for(let y of a)u+=y;x>=10&&(f|=1<<5-g)}let d=rn.determineNumSysAndCheckDigit(s,f);return{rowOffset:u,resultString:d}}decodeEnd(t,i){return rn.findGuardPatternWithoutCounters(t,i,!0,rn.MIDDLE_END_PATTERN)}checkChecksum(t){return Se.checkChecksum(rn.convertUPCEtoUPCA(t))}static determineNumSysAndCheckDigit(t,i){for(let s=0;s<=1;s++)for(let a=0;a<10;a++)if(i===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[s][a]){let l=String.fromCharCode("0".charCodeAt(0)+s),u=String.fromCharCode("0".charCodeAt(0)+a);return l+t+u}throw M.getNotFoundInstance()}getBarcodeFormat(){return te.UPC_E}static convertUPCEtoUPCA(t){const i=t.slice(1,7).split("").map(l=>l.charCodeAt(0)),s=new le;s.append(t.charAt(0));let a=i[5];switch(a){case 0:case 1:case 2:s.appendChars(i,0,2),s.append(a),s.append("0000"),s.appendChars(i,2,3);break;case 3:s.appendChars(i,0,3),s.append("00000"),s.appendChars(i,3,2);break;case 4:s.appendChars(i,0,4),s.append("00000"),s.append(i[4]);break;default:s.appendChars(i,0,5),s.append("0000"),s.append(a);break}return t.length>=8&&s.append(t.charAt(7)),s.toString()}}rn.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),rn.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class ra extends et{constructor(t){super();let i=t==null?null:t.get(de.POSSIBLE_FORMATS),s=[];o(i)?(s.push(new rr),s.push(new Ec),s.push(new wc),s.push(new rn)):(i.indexOf(te.EAN_13)>-1&&s.push(new rr),i.indexOf(te.UPC_A)>-1&&s.push(new Ec),i.indexOf(te.EAN_8)>-1&&s.push(new wc),i.indexOf(te.UPC_E)>-1&&s.push(new rn)),this.readers=s}decodeRow(t,i,s){for(let a of this.readers)try{const l=a.decodeRow(t,i,s),u=l.getBarcodeFormat()===te.EAN_13&&l.getText().charAt(0)==="0",f=s==null?null:s.get(de.POSSIBLE_FORMATS),d=f==null||f.includes(te.UPC_A);if(u&&d){const g=l.getRawBytes(),x=new Lt(l.getText().substring(1),g,g?g.length:null,l.getResultPoints(),te.UPC_A);return x.putAllMetadata(l.getResultMetadata()),x}return l}catch{}throw new M}reset(){for(let t of this.readers)t.reset()}}class bt extends et{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(t,i){for(let s=0;s<i.length;s++)if(et.patternMatchVariance(t,i[s],bt.MAX_INDIVIDUAL_VARIANCE)<bt.MAX_AVG_VARIANCE)return s;throw new M}static count(t){return be.sum(new Int32Array(t))}static increment(t,i){let s=0,a=i[0];for(let l=1;l<t.length;l++)i[l]>a&&(a=i[l],s=l);t[s]++}static decrement(t,i){let s=0,a=i[0];for(let l=1;l<t.length;l++)i[l]<a&&(a=i[l],s=l);t[s]--}static isFinderPattern(t){let i=t[0]+t[1],s=i+t[2]+t[3],a=i/s;if(a>=bt.MIN_FINDER_PATTERN_RATIO&&a<=bt.MAX_FINDER_PATTERN_RATIO){let l=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;for(let f of t)f>u&&(u=f),f<l&&(l=f);return u<10*l}return!1}}bt.MAX_AVG_VARIANCE=.2,bt.MAX_INDIVIDUAL_VARIANCE=.45,bt.MIN_FINDER_PATTERN_RATIO=9.5/12,bt.MAX_FINDER_PATTERN_RATIO=12.5/14;class Sr{constructor(t,i){this.value=t,this.checksumPortion=i}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(t){if(!(t instanceof Sr))return!1;const i=t;return this.value===i.value&&this.checksumPortion===i.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class _s{constructor(t,i,s,a,l){this.value=t,this.startEnd=i,this.value=t,this.startEnd=i,this.resultPoints=new Array,this.resultPoints.push(new Z(s,l)),this.resultPoints.push(new Z(a,l))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(t){if(!(t instanceof _s))return!1;const i=t;return this.value===i.value}hashCode(){return this.value}}class fn{constructor(){}static getRSSvalue(t,i,s){let a=0;for(let d of t)a+=d;let l=0,u=0,f=t.length;for(let d=0;d<f-1;d++){let g;for(g=1,u|=1<<d;g<t[d];g++,u&=~(1<<d)){let x=fn.combins(a-g-1,f-d-2);if(s&&u===0&&a-g-(f-d-1)>=f-d-1&&(x-=fn.combins(a-g-(f-d),f-d-2)),f-d-1>1){let y=0;for(let I=a-g-(f-d-2);I>i;I--)y+=fn.combins(a-g-I-1,f-d-3);x-=y*(f-1-d)}else a-g>i&&x--;l+=x}a-=g}return l}static combins(t,i){let s,a;t-i>i?(a=i,s=t-i):(a=t-i,s=i);let l=1,u=1;for(let f=t;f>s;f--)l*=f,u<=a&&(l/=u,u++);for(;u<=a;)l/=u,u++;return l}}class J1{static buildBitArray(t){let i=t.length*2-1;t[t.length-1].getRightChar()==null&&(i-=1);let s=12*i,a=new fe(s),l=0,f=t[0].getRightChar().getValue();for(let d=11;d>=0;--d)(f&1<<d)!=0&&a.set(l),l++;for(let d=1;d<t.length;++d){let g=t[d],x=g.getLeftChar().getValue();for(let y=11;y>=0;--y)(x&1<<y)!=0&&a.set(l),l++;if(g.getRightChar()!=null){let y=g.getRightChar().getValue();for(let I=11;I>=0;--I)(y&1<<I)!=0&&a.set(l),l++}}return a}}class ir{constructor(t,i){i?this.decodedInformation=null:(this.finished=t,this.decodedInformation=i)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class ia{constructor(t){this.newPosition=t}getNewPosition(){return this.newPosition}}class Wt extends ia{constructor(t,i){super(t),this.value=i}getValue(){return this.value}isFNC1(){return this.value===Wt.FNC1}}Wt.FNC1="$";class sr extends ia{constructor(t,i,s){super(t),s?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=i}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class Qt extends ia{constructor(t,i,s){if(super(t),i<0||i>10||s<0||s>10)throw new V;this.firstDigit=i,this.secondDigit=s}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===Qt.FNC1}isSecondDigitFNC1(){return this.secondDigit===Qt.FNC1}isAnyFNC1(){return this.firstDigit===Qt.FNC1||this.secondDigit===Qt.FNC1}}Qt.FNC1=10;class z{constructor(){}static parseFieldsInGeneralPurpose(t){if(!t)return null;if(t.length<2)throw new M;let i=t.substring(0,2);for(let l of z.TWO_DIGIT_DATA_LENGTH)if(l[0]===i)return l[1]===z.VARIABLE_LENGTH?z.processVariableAI(2,l[2],t):z.processFixedAI(2,l[1],t);if(t.length<3)throw new M;let s=t.substring(0,3);for(let l of z.THREE_DIGIT_DATA_LENGTH)if(l[0]===s)return l[1]===z.VARIABLE_LENGTH?z.processVariableAI(3,l[2],t):z.processFixedAI(3,l[1],t);for(let l of z.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(l[0]===s)return l[1]===z.VARIABLE_LENGTH?z.processVariableAI(4,l[2],t):z.processFixedAI(4,l[1],t);if(t.length<4)throw new M;let a=t.substring(0,4);for(let l of z.FOUR_DIGIT_DATA_LENGTH)if(l[0]===a)return l[1]===z.VARIABLE_LENGTH?z.processVariableAI(4,l[2],t):z.processFixedAI(4,l[1],t);throw new M}static processFixedAI(t,i,s){if(s.length<t)throw new M;let a=s.substring(0,t);if(s.length<t+i)throw new M;let l=s.substring(t,t+i),u=s.substring(t+i),f="("+a+")"+l,d=z.parseFieldsInGeneralPurpose(u);return d==null?f:f+d}static processVariableAI(t,i,s){let a=s.substring(0,t),l;s.length<t+i?l=s.length:l=t+i;let u=s.substring(t,l),f=s.substring(l),d="("+a+")"+u,g=z.parseFieldsInGeneralPurpose(f);return g==null?d:d+g}}z.VARIABLE_LENGTH=[],z.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",z.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",z.VARIABLE_LENGTH,20],["22",z.VARIABLE_LENGTH,29],["30",z.VARIABLE_LENGTH,8],["37",z.VARIABLE_LENGTH,8],["90",z.VARIABLE_LENGTH,30],["91",z.VARIABLE_LENGTH,30],["92",z.VARIABLE_LENGTH,30],["93",z.VARIABLE_LENGTH,30],["94",z.VARIABLE_LENGTH,30],["95",z.VARIABLE_LENGTH,30],["96",z.VARIABLE_LENGTH,30],["97",z.VARIABLE_LENGTH,3],["98",z.VARIABLE_LENGTH,30],["99",z.VARIABLE_LENGTH,30]],z.THREE_DIGIT_DATA_LENGTH=[["240",z.VARIABLE_LENGTH,30],["241",z.VARIABLE_LENGTH,30],["242",z.VARIABLE_LENGTH,6],["250",z.VARIABLE_LENGTH,30],["251",z.VARIABLE_LENGTH,30],["253",z.VARIABLE_LENGTH,17],["254",z.VARIABLE_LENGTH,20],["400",z.VARIABLE_LENGTH,30],["401",z.VARIABLE_LENGTH,30],["402",17],["403",z.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",z.VARIABLE_LENGTH,20],["421",z.VARIABLE_LENGTH,15],["422",3],["423",z.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],z.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",z.VARIABLE_LENGTH,15],["391",z.VARIABLE_LENGTH,18],["392",z.VARIABLE_LENGTH,15],["393",z.VARIABLE_LENGTH,18],["703",z.VARIABLE_LENGTH,30]],z.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",z.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",z.VARIABLE_LENGTH,20],["8003",z.VARIABLE_LENGTH,30],["8004",z.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",z.VARIABLE_LENGTH,30],["8008",z.VARIABLE_LENGTH,12],["8018",18],["8020",z.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",z.VARIABLE_LENGTH,70],["8200",z.VARIABLE_LENGTH,70]];class Nr{constructor(t){this.buffer=new le,this.information=t}decodeAllCodes(t,i){let s=i,a=null;do{let l=this.decodeGeneralPurposeField(s,a),u=z.parseFieldsInGeneralPurpose(l.getNewString());if(u!=null&&t.append(u),l.isRemaining()?a=""+l.getRemainingValue():a=null,s===l.getNewPosition())break;s=l.getNewPosition()}while(!0);return t.toString()}isStillNumeric(t){if(t+7>this.information.getSize())return t+4<=this.information.getSize();for(let i=t;i<t+3;++i)if(this.information.get(i))return!0;return this.information.get(t+3)}decodeNumeric(t){if(t+7>this.information.getSize()){let l=this.extractNumericValueFromBitArray(t,4);return l===0?new Qt(this.information.getSize(),Qt.FNC1,Qt.FNC1):new Qt(this.information.getSize(),l-1,Qt.FNC1)}let i=this.extractNumericValueFromBitArray(t,7),s=(i-8)/11,a=(i-8)%11;return new Qt(t+7,s,a)}extractNumericValueFromBitArray(t,i){return Nr.extractNumericValueFromBitArray(this.information,t,i)}static extractNumericValueFromBitArray(t,i,s){let a=0;for(let l=0;l<s;++l)t.get(i+l)&&(a|=1<<s-l-1);return a}decodeGeneralPurposeField(t,i){this.buffer.setLengthToZero(),i!=null&&this.buffer.append(i),this.current.setPosition(t);let s=this.parseBlocks();return s!=null&&s.isRemaining()?new sr(this.current.getPosition(),this.buffer.toString(),s.getRemainingValue()):new sr(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let t,i;do{let s=this.current.getPosition();if(this.current.isAlpha()?(i=this.parseAlphaBlock(),t=i.isFinished()):this.current.isIsoIec646()?(i=this.parseIsoIec646Block(),t=i.isFinished()):(i=this.parseNumericBlock(),t=i.isFinished()),!(s!==this.current.getPosition())&&!t)break}while(!t);return i.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let t=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(t.getNewPosition()),t.isFirstDigitFNC1()){let i;return t.isSecondDigitFNC1()?i=new sr(this.current.getPosition(),this.buffer.toString()):i=new sr(this.current.getPosition(),this.buffer.toString(),t.getSecondDigit()),new ir(!0,i)}if(this.buffer.append(t.getFirstDigit()),t.isSecondDigitFNC1()){let i=new sr(this.current.getPosition(),this.buffer.toString());return new ir(!0,i)}this.buffer.append(t.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new ir(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let t=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(t.getNewPosition()),t.isFNC1()){let i=new sr(this.current.getPosition(),this.buffer.toString());return new ir(!0,i)}this.buffer.append(t.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new ir(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let t=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(t.getNewPosition()),t.isFNC1()){let i=new sr(this.current.getPosition(),this.buffer.toString());return new ir(!0,i)}this.buffer.append(t.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new ir(!1)}isStillIsoIec646(t){if(t+5>this.information.getSize())return!1;let i=this.extractNumericValueFromBitArray(t,5);if(i>=5&&i<16)return!0;if(t+7>this.information.getSize())return!1;let s=this.extractNumericValueFromBitArray(t,7);if(s>=64&&s<116)return!0;if(t+8>this.information.getSize())return!1;let a=this.extractNumericValueFromBitArray(t,8);return a>=232&&a<253}decodeIsoIec646(t){let i=this.extractNumericValueFromBitArray(t,5);if(i===15)return new Wt(t+5,Wt.FNC1);if(i>=5&&i<15)return new Wt(t+5,"0"+(i-5));let s=this.extractNumericValueFromBitArray(t,7);if(s>=64&&s<90)return new Wt(t+7,""+(s+1));if(s>=90&&s<116)return new Wt(t+7,""+(s+7));let a=this.extractNumericValueFromBitArray(t,8),l;switch(a){case 232:l="!";break;case 233:l='"';break;case 234:l="%";break;case 235:l="&";break;case 236:l="'";break;case 237:l="(";break;case 238:l=")";break;case 239:l="*";break;case 240:l="+";break;case 241:l=",";break;case 242:l="-";break;case 243:l=".";break;case 244:l="/";break;case 245:l=":";break;case 246:l=";";break;case 247:l="<";break;case 248:l="=";break;case 249:l=">";break;case 250:l="?";break;case 251:l="_";break;case 252:l=" ";break;default:throw new V}return new Wt(t+8,l)}isStillAlpha(t){if(t+5>this.information.getSize())return!1;let i=this.extractNumericValueFromBitArray(t,5);if(i>=5&&i<16)return!0;if(t+6>this.information.getSize())return!1;let s=this.extractNumericValueFromBitArray(t,6);return s>=16&&s<63}decodeAlphanumeric(t){let i=this.extractNumericValueFromBitArray(t,5);if(i===15)return new Wt(t+5,Wt.FNC1);if(i>=5&&i<15)return new Wt(t+5,"0"+(i-5));let s=this.extractNumericValueFromBitArray(t,6);if(s>=32&&s<58)return new Wt(t+6,""+(s+33));let a;switch(s){case 58:a="*";break;case 59:a=",";break;case 60:a="-";break;case 61:a=".";break;case 62:a="/";break;default:throw new hn("Decoding invalid alphanumeric value: "+s)}return new Wt(t+6,a)}isAlphaTo646ToAlphaLatch(t){if(t+1>this.information.getSize())return!1;for(let i=0;i<5&&i+t<this.information.getSize();++i)if(i===2){if(!this.information.get(t+2))return!1}else if(this.information.get(t+i))return!1;return!0}isAlphaOr646ToNumericLatch(t){if(t+3>this.information.getSize())return!1;for(let i=t;i<t+3;++i)if(this.information.get(i))return!1;return!0}isNumericToAlphaNumericLatch(t){if(t+1>this.information.getSize())return!1;for(let i=0;i<4&&i+t<this.information.getSize();++i)if(this.information.get(t+i))return!1;return!0}}class sa{constructor(t){this.information=t,this.generalDecoder=new Nr(t)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class Xt extends sa{constructor(t){super(t)}encodeCompressedGtin(t,i){t.append("(01)");let s=t.length();t.append("9"),this.encodeCompressedGtinWithoutAI(t,i,s)}encodeCompressedGtinWithoutAI(t,i,s){for(let a=0;a<4;++a){let l=this.getGeneralDecoder().extractNumericValueFromBitArray(i+10*a,10);l/100===0&&t.append("0"),l/10===0&&t.append("0"),t.append(l)}Xt.appendCheckDigit(t,s)}static appendCheckDigit(t,i){let s=0;for(let a=0;a<13;a++){let l=t.charAt(a+i).charCodeAt(0)-"0".charCodeAt(0);s+=(a&1)===0?3*l:l}s=10-s%10,s===10&&(s=0),t.append(s)}}Xt.GTIN_SIZE=40;class Rr extends Xt{constructor(t){super(t)}parseInformation(){let t=new le;t.append("(01)");let i=t.length(),s=this.getGeneralDecoder().extractNumericValueFromBitArray(Rr.HEADER_SIZE,4);return t.append(s),this.encodeCompressedGtinWithoutAI(t,Rr.HEADER_SIZE+4,i),this.getGeneralDecoder().decodeAllCodes(t,Rr.HEADER_SIZE+44)}}Rr.HEADER_SIZE=1+1+2;class vs extends sa{constructor(t){super(t)}parseInformation(){let t=new le;return this.getGeneralDecoder().decodeAllCodes(t,vs.HEADER_SIZE)}}vs.HEADER_SIZE=2+1+2;class Ss extends Xt{constructor(t){super(t)}encodeCompressedWeight(t,i,s){let a=this.getGeneralDecoder().extractNumericValueFromBitArray(i,s);this.addWeightCode(t,a);let l=this.checkWeight(a),u=1e5;for(let f=0;f<5;++f)l/u===0&&t.append("0"),u/=10;t.append(l)}}class dn extends Ss{constructor(t){super(t)}parseInformation(){if(this.getInformation().getSize()!=dn.HEADER_SIZE+Ss.GTIN_SIZE+dn.WEIGHT_SIZE)throw new M;let t=new le;return this.encodeCompressedGtin(t,dn.HEADER_SIZE),this.encodeCompressedWeight(t,dn.HEADER_SIZE+Ss.GTIN_SIZE,dn.WEIGHT_SIZE),t.toString()}}dn.HEADER_SIZE=4+1,dn.WEIGHT_SIZE=15;class e0 extends dn{constructor(t){super(t)}addWeightCode(t,i){t.append("(3103)")}checkWeight(t){return t}}class t0 extends dn{constructor(t){super(t)}addWeightCode(t,i){i<1e4?t.append("(3202)"):t.append("(3203)")}checkWeight(t){return t<1e4?t:t-1e4}}class gn extends Xt{constructor(t){super(t)}parseInformation(){if(this.getInformation().getSize()<gn.HEADER_SIZE+Xt.GTIN_SIZE)throw new M;let t=new le;this.encodeCompressedGtin(t,gn.HEADER_SIZE);let i=this.getGeneralDecoder().extractNumericValueFromBitArray(gn.HEADER_SIZE+Xt.GTIN_SIZE,gn.LAST_DIGIT_SIZE);t.append("(392"),t.append(i),t.append(")");let s=this.getGeneralDecoder().decodeGeneralPurposeField(gn.HEADER_SIZE+Xt.GTIN_SIZE+gn.LAST_DIGIT_SIZE,null);return t.append(s.getNewString()),t.toString()}}gn.HEADER_SIZE=5+1+2,gn.LAST_DIGIT_SIZE=2;class Ft extends Xt{constructor(t){super(t)}parseInformation(){if(this.getInformation().getSize()<Ft.HEADER_SIZE+Xt.GTIN_SIZE)throw new M;let t=new le;this.encodeCompressedGtin(t,Ft.HEADER_SIZE);let i=this.getGeneralDecoder().extractNumericValueFromBitArray(Ft.HEADER_SIZE+Xt.GTIN_SIZE,Ft.LAST_DIGIT_SIZE);t.append("(393"),t.append(i),t.append(")");let s=this.getGeneralDecoder().extractNumericValueFromBitArray(Ft.HEADER_SIZE+Xt.GTIN_SIZE+Ft.LAST_DIGIT_SIZE,Ft.FIRST_THREE_DIGITS_SIZE);s/100==0&&t.append("0"),s/10==0&&t.append("0"),t.append(s);let a=this.getGeneralDecoder().decodeGeneralPurposeField(Ft.HEADER_SIZE+Xt.GTIN_SIZE+Ft.LAST_DIGIT_SIZE+Ft.FIRST_THREE_DIGITS_SIZE,null);return t.append(a.getNewString()),t.toString()}}Ft.HEADER_SIZE=5+1+2,Ft.LAST_DIGIT_SIZE=2,Ft.FIRST_THREE_DIGITS_SIZE=10;class We extends Ss{constructor(t,i,s){super(t),this.dateCode=s,this.firstAIdigits=i}parseInformation(){if(this.getInformation().getSize()!=We.HEADER_SIZE+We.GTIN_SIZE+We.WEIGHT_SIZE+We.DATE_SIZE)throw new M;let t=new le;return this.encodeCompressedGtin(t,We.HEADER_SIZE),this.encodeCompressedWeight(t,We.HEADER_SIZE+We.GTIN_SIZE,We.WEIGHT_SIZE),this.encodeCompressedDate(t,We.HEADER_SIZE+We.GTIN_SIZE+We.WEIGHT_SIZE),t.toString()}encodeCompressedDate(t,i){let s=this.getGeneralDecoder().extractNumericValueFromBitArray(i,We.DATE_SIZE);if(s==38400)return;t.append("("),t.append(this.dateCode),t.append(")");let a=s%32;s/=32;let l=s%12+1;s/=12;let u=s;u/10==0&&t.append("0"),t.append(u),l/10==0&&t.append("0"),t.append(l),a/10==0&&t.append("0"),t.append(a)}addWeightCode(t,i){t.append("("),t.append(this.firstAIdigits),t.append(i/1e5),t.append(")")}checkWeight(t){return t%1e5}}We.HEADER_SIZE=7+1,We.WEIGHT_SIZE=20,We.DATE_SIZE=16;function yc(E){try{if(E.get(1))return new Rr(E);if(!E.get(2))return new vs(E);switch(Nr.extractNumericValueFromBitArray(E,1,4)){case 4:return new e0(E);case 5:return new t0(E)}switch(Nr.extractNumericValueFromBitArray(E,1,5)){case 12:return new gn(E);case 13:return new Ft(E)}switch(Nr.extractNumericValueFromBitArray(E,1,7)){case 56:return new We(E,"310","11");case 57:return new We(E,"320","11");case 58:return new We(E,"310","13");case 59:return new We(E,"320","13");case 60:return new We(E,"310","15");case 61:return new We(E,"320","15");case 62:return new We(E,"310","17");case 63:return new We(E,"320","17")}}catch(t){throw console.log(t),new hn("unknown decoder: "+E)}}class Bn{constructor(t,i,s,a){this.leftchar=t,this.rightchar=i,this.finderpattern=s,this.maybeLast=a}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(t,i){return t instanceof Bn?Bn.equalsOrNull(t.leftchar,i.leftchar)&&Bn.equalsOrNull(t.rightchar,i.rightchar)&&Bn.equalsOrNull(t.finderpattern,i.finderpattern):!1}static equalsOrNull(t,i){return t===null?i===null:Bn.equals(t,i)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class oa{constructor(t,i,s){this.pairs=t,this.rowNumber=i,this.wasReversed=s}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(t){return this.checkEqualitity(this,t)}toString(){return"{ "+this.pairs+" }"}equals(t,i){return t instanceof oa?this.checkEqualitity(t,i)&&t.wasReversed===i.wasReversed:!1}checkEqualitity(t,i){if(!t||!i)return;let s;return t.forEach((a,l)=>{i.forEach(u=>{a.getLeftChar().getValue()===u.getLeftChar().getValue()&&a.getRightChar().getValue()===u.getRightChar().getValue()&&a.getFinderPatter().getValue()===u.getFinderPatter().getValue()&&(s=!0)})}),s}}class P extends bt{constructor(t){super(...arguments),this.pairs=new Array(P.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=t===!0}decodeRow(t,i,s){this.pairs.length=0,this.startFromEven=!1;try{return P.constructResult(this.decodeRow2pairs(t,i))}catch(a){this.verbose&&console.log(a)}return this.pairs.length=0,this.startFromEven=!0,P.constructResult(this.decodeRow2pairs(t,i))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(t,i){let s=!1;for(;!s;)try{this.pairs.push(this.retrieveNextPair(i,this.pairs,t))}catch(l){if(l instanceof M){if(!this.pairs.length)throw new M;s=!0}}if(this.checkChecksum())return this.pairs;let a;if(this.rows.length?a=!0:a=!1,this.storeRow(t,!1),a){let l=this.checkRowsBoolean(!1);if(l!=null||(l=this.checkRowsBoolean(!0),l!=null))return l}throw new M}checkRowsBoolean(t){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,t&&(this.rows=this.rows.reverse());let i=null;try{i=this.checkRows(new Array,0)}catch(s){this.verbose&&console.log(s)}return t&&(this.rows=this.rows.reverse()),i}checkRows(t,i){for(let s=i;s<this.rows.length;s++){let a=this.rows[s];this.pairs.length=0;for(let u of t)this.pairs.push(u.getPairs());if(this.pairs.push(a.getPairs()),!P.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let l=new Array(t);l.push(a);try{return this.checkRows(l,s+1)}catch(u){this.verbose&&console.log(u)}}throw new M}static isValidSequence(t){for(let i of P.FINDER_PATTERN_SEQUENCES){if(t.length>i.length)continue;let s=!0;for(let a=0;a<t.length;a++)if(t[a].getFinderPattern().getValue()!=i[a]){s=!1;break}if(s)return!0}return!1}storeRow(t,i){let s=0,a=!1,l=!1;for(;s<this.rows.length;){let u=this.rows[s];if(u.getRowNumber()>t){l=u.isEquivalent(this.pairs);break}a=u.isEquivalent(this.pairs),s++}l||a||P.isPartialRow(this.pairs,this.rows)||(this.rows.push(s,new oa(this.pairs,t,i)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(t,i){for(let s of i)if(s.getPairs().length!==t.length){for(let a of s.getPairs())for(let l of t)if(Bn.equals(a,l))break}}static isPartialRow(t,i){for(let s of i){let a=!0;for(let l of t){let u=!1;for(let f of s.getPairs())if(l.equals(f)){u=!0;break}if(!u){a=!1;break}}if(a)return!0}return!1}getRows(){return this.rows}static constructResult(t){let i=J1.buildBitArray(t),a=yc(i).parseInformation(),l=t[0].getFinderPattern().getResultPoints(),u=t[t.length-1].getFinderPattern().getResultPoints(),f=[l[0],l[1],u[0],u[1]];return new Lt(a,null,null,f,te.RSS_EXPANDED,null)}checkChecksum(){let t=this.pairs.get(0),i=t.getLeftChar(),s=t.getRightChar();if(s==null)return!1;let a=s.getChecksumPortion(),l=2;for(let f=1;f<this.pairs.size();++f){let d=this.pairs.get(f);a+=d.getLeftChar().getChecksumPortion(),l++;let g=d.getRightChar();g!=null&&(a+=g.getChecksumPortion(),l++)}return a%=211,211*(l-4)+a==i.getValue()}static getNextSecondBar(t,i){let s;return t.get(i)?(s=t.getNextUnset(i),s=t.getNextSet(s)):(s=t.getNextSet(i),s=t.getNextUnset(s)),s}retrieveNextPair(t,i,s){let a=i.length%2==0;this.startFromEven&&(a=!a);let l,u=!0,f=-1;do this.findNextPair(t,i,f),l=this.parseFoundFinderPattern(t,s,a),l==null?f=P.getNextSecondBar(t,this.startEnd[0]):u=!1;while(u);let d=this.decodeDataCharacter(t,l,a,!0);if(!this.isEmptyPair(i)&&i[i.length-1].mustBeLast())throw new M;let g;try{g=this.decodeDataCharacter(t,l,a,!1)}catch(x){g=null,this.verbose&&console.log(x)}return new Bn(d,g,l,!0)}isEmptyPair(t){return t.length===0}findNextPair(t,i,s){let a=this.getDecodeFinderCounters();a[0]=0,a[1]=0,a[2]=0,a[3]=0;let l=t.getSize(),u;s>=0?u=s:this.isEmptyPair(i)?u=0:u=i[i.length-1].getFinderPattern().getStartEnd()[1];let f=i.length%2!=0;this.startFromEven&&(f=!f);let d=!1;for(;u<l&&(d=!t.get(u),!!d);)u++;let g=0,x=u;for(let y=u;y<l;y++)if(t.get(y)!=d)a[g]++;else{if(g==3){if(f&&P.reverseCounters(a),P.isFinderPattern(a)){this.startEnd[0]=x,this.startEnd[1]=y;return}f&&P.reverseCounters(a),x+=a[0]+a[1],a[0]=a[2],a[1]=a[3],a[2]=0,a[3]=0,g--}else g++;a[g]=1,d=!d}throw new M}static reverseCounters(t){let i=t.length;for(let s=0;s<i/2;++s){let a=t[s];t[s]=t[i-s-1],t[i-s-1]=a}}parseFoundFinderPattern(t,i,s){let a,l,u;if(s){let g=this.startEnd[0]-1;for(;g>=0&&!t.get(g);)g--;g++,a=this.startEnd[0]-g,l=g,u=this.startEnd[1]}else l=this.startEnd[0],u=t.getNextUnset(this.startEnd[1]+1),a=u-this.startEnd[1];let f=this.getDecodeFinderCounters();j.arraycopy(f,0,f,1,f.length-1),f[0]=a;let d;try{d=this.parseFinderValue(f,P.FINDER_PATTERNS)}catch{return null}return new _s(d,[l,u],l,u,i)}decodeDataCharacter(t,i,s,a){let l=this.getDataCharacterCounters();for(let Le=0;Le<l.length;Le++)l[Le]=0;if(a)P.recordPatternInReverse(t,i.getStartEnd()[0],l);else{P.recordPattern(t,i.getStartEnd()[1],l);for(let Le=0,Et=l.length-1;Le<Et;Le++,Et--){let qt=l[Le];l[Le]=l[Et],l[Et]=qt}}let u=17,f=be.sum(new Int32Array(l))/u,d=(i.getStartEnd()[1]-i.getStartEnd()[0])/15;if(Math.abs(f-d)/d>.3)throw new M;let g=this.getOddCounts(),x=this.getEvenCounts(),y=this.getOddRoundingErrors(),I=this.getEvenRoundingErrors();for(let Le=0;Le<l.length;Le++){let Et=1*l[Le]/f,qt=Et+.5;if(qt<1){if(Et<.3)throw new M;qt=1}else if(qt>8){if(Et>8.7)throw new M;qt=8}let Pr=Le/2;(Le&1)==0?(g[Pr]=qt,y[Pr]=Et-qt):(x[Pr]=qt,I[Pr]=Et-qt)}this.adjustOddEvenCounts(u);let T=4*i.getValue()+(s?0:2)+(a?0:1)-1,v=0,S=0;for(let Le=g.length-1;Le>=0;Le--){if(P.isNotA1left(i,s,a)){let Et=P.WEIGHTS[T][2*Le];S+=g[Le]*Et}v+=g[Le]}let N=0;for(let Le=x.length-1;Le>=0;Le--)if(P.isNotA1left(i,s,a)){let Et=P.WEIGHTS[T][2*Le+1];N+=x[Le]*Et}let D=S+N;if((v&1)!=0||v>13||v<4)throw new M;let F=(13-v)/2,U=P.SYMBOL_WIDEST[F],L=9-U,Ee=fn.getRSSvalue(g,U,!0),ce=fn.getRSSvalue(x,L,!1),zt=P.EVEN_TOTAL_SUBSET[F],sn=P.GSUM[F],Kt=Ee*zt+ce+sn;return new Sr(Kt,D)}static isNotA1left(t,i,s){return!(t.getValue()==0&&i&&s)}adjustOddEvenCounts(t){let i=be.sum(new Int32Array(this.getOddCounts())),s=be.sum(new Int32Array(this.getEvenCounts())),a=!1,l=!1;i>13?l=!0:i<4&&(a=!0);let u=!1,f=!1;s>13?f=!0:s<4&&(u=!0);let d=i+s-t,g=(i&1)==1,x=(s&1)==0;if(d==1)if(g){if(x)throw new M;l=!0}else{if(!x)throw new M;f=!0}else if(d==-1)if(g){if(x)throw new M;a=!0}else{if(!x)throw new M;u=!0}else if(d==0){if(g){if(!x)throw new M;i<s?(a=!0,f=!0):(l=!0,u=!0)}else if(x)throw new M}else throw new M;if(a){if(l)throw new M;P.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(l&&P.decrement(this.getOddCounts(),this.getOddRoundingErrors()),u){if(f)throw new M;P.increment(this.getEvenCounts(),this.getOddRoundingErrors())}f&&P.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}P.SYMBOL_WIDEST=[7,5,4,3,1],P.EVEN_TOTAL_SUBSET=[4,20,52,104,204],P.GSUM=[0,348,1388,2948,3988],P.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],P.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],P.FINDER_PAT_A=0,P.FINDER_PAT_B=1,P.FINDER_PAT_C=2,P.FINDER_PAT_D=3,P.FINDER_PAT_E=4,P.FINDER_PAT_F=5,P.FINDER_PATTERN_SEQUENCES=[[P.FINDER_PAT_A,P.FINDER_PAT_A],[P.FINDER_PAT_A,P.FINDER_PAT_B,P.FINDER_PAT_B],[P.FINDER_PAT_A,P.FINDER_PAT_C,P.FINDER_PAT_B,P.FINDER_PAT_D],[P.FINDER_PAT_A,P.FINDER_PAT_E,P.FINDER_PAT_B,P.FINDER_PAT_D,P.FINDER_PAT_C],[P.FINDER_PAT_A,P.FINDER_PAT_E,P.FINDER_PAT_B,P.FINDER_PAT_D,P.FINDER_PAT_D,P.FINDER_PAT_F],[P.FINDER_PAT_A,P.FINDER_PAT_E,P.FINDER_PAT_B,P.FINDER_PAT_D,P.FINDER_PAT_E,P.FINDER_PAT_F,P.FINDER_PAT_F],[P.FINDER_PAT_A,P.FINDER_PAT_A,P.FINDER_PAT_B,P.FINDER_PAT_B,P.FINDER_PAT_C,P.FINDER_PAT_C,P.FINDER_PAT_D,P.FINDER_PAT_D],[P.FINDER_PAT_A,P.FINDER_PAT_A,P.FINDER_PAT_B,P.FINDER_PAT_B,P.FINDER_PAT_C,P.FINDER_PAT_C,P.FINDER_PAT_D,P.FINDER_PAT_E,P.FINDER_PAT_E],[P.FINDER_PAT_A,P.FINDER_PAT_A,P.FINDER_PAT_B,P.FINDER_PAT_B,P.FINDER_PAT_C,P.FINDER_PAT_C,P.FINDER_PAT_D,P.FINDER_PAT_E,P.FINDER_PAT_F,P.FINDER_PAT_F],[P.FINDER_PAT_A,P.FINDER_PAT_A,P.FINDER_PAT_B,P.FINDER_PAT_B,P.FINDER_PAT_C,P.FINDER_PAT_D,P.FINDER_PAT_D,P.FINDER_PAT_E,P.FINDER_PAT_E,P.FINDER_PAT_F,P.FINDER_PAT_F]],P.MAX_PAIRS=11;class n0 extends Sr{constructor(t,i,s){super(t,i),this.count=0,this.finderPattern=s}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class qe extends bt{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(t,i,s){const a=this.decodePair(i,!1,t,s);qe.addOrTally(this.possibleLeftPairs,a),i.reverse();let l=this.decodePair(i,!0,t,s);qe.addOrTally(this.possibleRightPairs,l),i.reverse();for(let u of this.possibleLeftPairs)if(u.getCount()>1){for(let f of this.possibleRightPairs)if(f.getCount()>1&&qe.checkChecksum(u,f))return qe.constructResult(u,f)}throw new M}static addOrTally(t,i){if(i==null)return;let s=!1;for(let a of t)if(a.getValue()===i.getValue()){a.incrementCount(),s=!0;break}s||t.push(i)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(t,i){let s=4537077*t.getValue()+i.getValue(),a=new String(s).toString(),l=new le;for(let g=13-a.length;g>0;g--)l.append("0");l.append(a);let u=0;for(let g=0;g<13;g++){let x=l.charAt(g).charCodeAt(0)-"0".charCodeAt(0);u+=(g&1)===0?3*x:x}u=10-u%10,u===10&&(u=0),l.append(u.toString());let f=t.getFinderPattern().getResultPoints(),d=i.getFinderPattern().getResultPoints();return new Lt(l.toString(),null,0,[f[0],f[1],d[0],d[1]],te.RSS_14,new Date().getTime())}static checkChecksum(t,i){let s=(t.getChecksumPortion()+16*i.getChecksumPortion())%79,a=9*t.getFinderPattern().getValue()+i.getFinderPattern().getValue();return a>72&&a--,a>8&&a--,s===a}decodePair(t,i,s,a){try{let l=this.findFinderPattern(t,i),u=this.parseFoundFinderPattern(t,s,i,l),f=a==null?null:a.get(de.NEED_RESULT_POINT_CALLBACK);if(f!=null){let x=(l[0]+l[1])/2;i&&(x=t.getSize()-1-x),f.foundPossibleResultPoint(new Z(x,s))}let d=this.decodeDataCharacter(t,u,!0),g=this.decodeDataCharacter(t,u,!1);return new n0(1597*d.getValue()+g.getValue(),d.getChecksumPortion()+4*g.getChecksumPortion(),u)}catch{return null}}decodeDataCharacter(t,i,s){let a=this.getDataCharacterCounters();for(let N=0;N<a.length;N++)a[N]=0;if(s)et.recordPatternInReverse(t,i.getStartEnd()[0],a);else{et.recordPattern(t,i.getStartEnd()[1]+1,a);for(let N=0,D=a.length-1;N<D;N++,D--){let F=a[N];a[N]=a[D],a[D]=F}}let l=s?16:15,u=be.sum(new Int32Array(a))/l,f=this.getOddCounts(),d=this.getEvenCounts(),g=this.getOddRoundingErrors(),x=this.getEvenRoundingErrors();for(let N=0;N<a.length;N++){let D=a[N]/u,F=Math.floor(D+.5);F<1?F=1:F>8&&(F=8);let U=Math.floor(N/2);(N&1)===0?(f[U]=F,g[U]=D-F):(d[U]=F,x[U]=D-F)}this.adjustOddEvenCounts(s,l);let y=0,I=0;for(let N=f.length-1;N>=0;N--)I*=9,I+=f[N],y+=f[N];let T=0,v=0;for(let N=d.length-1;N>=0;N--)T*=9,T+=d[N],v+=d[N];let S=I+3*T;if(s){if((y&1)!==0||y>12||y<4)throw new M;let N=(12-y)/2,D=qe.OUTSIDE_ODD_WIDEST[N],F=9-D,U=fn.getRSSvalue(f,D,!1),L=fn.getRSSvalue(d,F,!0),Ee=qe.OUTSIDE_EVEN_TOTAL_SUBSET[N],ce=qe.OUTSIDE_GSUM[N];return new Sr(U*Ee+L+ce,S)}else{if((v&1)!==0||v>10||v<4)throw new M;let N=(10-v)/2,D=qe.INSIDE_ODD_WIDEST[N],F=9-D,U=fn.getRSSvalue(f,D,!0),L=fn.getRSSvalue(d,F,!1),Ee=qe.INSIDE_ODD_TOTAL_SUBSET[N],ce=qe.INSIDE_GSUM[N];return new Sr(L*Ee+U+ce,S)}}findFinderPattern(t,i){let s=this.getDecodeFinderCounters();s[0]=0,s[1]=0,s[2]=0,s[3]=0;let a=t.getSize(),l=!1,u=0;for(;u<a&&(l=!t.get(u),i!==l);)u++;let f=0,d=u;for(let g=u;g<a;g++)if(t.get(g)!==l)s[f]++;else{if(f===3){if(bt.isFinderPattern(s))return[d,g];d+=s[0]+s[1],s[0]=s[2],s[1]=s[3],s[2]=0,s[3]=0,f--}else f++;s[f]=1,l=!l}throw new M}parseFoundFinderPattern(t,i,s,a){let l=t.get(a[0]),u=a[0]-1;for(;u>=0&&l!==t.get(u);)u--;u++;const f=a[0]-u,d=this.getDecodeFinderCounters(),g=new Int32Array(d.length);j.arraycopy(d,0,g,1,d.length-1),g[0]=f;const x=this.parseFinderValue(g,qe.FINDER_PATTERNS);let y=u,I=a[1];return s&&(y=t.getSize()-1-y,I=t.getSize()-1-I),new _s(x,[u,a[1]],y,I,i)}adjustOddEvenCounts(t,i){let s=be.sum(new Int32Array(this.getOddCounts())),a=be.sum(new Int32Array(this.getEvenCounts())),l=!1,u=!1,f=!1,d=!1;t?(s>12?u=!0:s<4&&(l=!0),a>12?d=!0:a<4&&(f=!0)):(s>11?u=!0:s<5&&(l=!0),a>10?d=!0:a<4&&(f=!0));let g=s+a-i,x=(s&1)===(t?1:0),y=(a&1)===1;if(g===1)if(x){if(y)throw new M;u=!0}else{if(!y)throw new M;d=!0}else if(g===-1)if(x){if(y)throw new M;l=!0}else{if(!y)throw new M;f=!0}else if(g===0){if(x){if(!y)throw new M;s<a?(l=!0,d=!0):(u=!0,f=!0)}else if(y)throw new M}else throw new M;if(l){if(u)throw new M;bt.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(u&&bt.decrement(this.getOddCounts(),this.getOddRoundingErrors()),f){if(d)throw new M;bt.increment(this.getEvenCounts(),this.getOddRoundingErrors())}d&&bt.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}qe.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],qe.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],qe.OUTSIDE_GSUM=[0,161,961,2015,2715],qe.INSIDE_GSUM=[0,336,1036,1516],qe.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],qe.INSIDE_ODD_WIDEST=[2,4,6,8],qe.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class Or extends et{constructor(t,i){super(),this.readers=[],this.verbose=i===!0;const s=t?t.get(de.POSSIBLE_FORMATS):null,a=t&&t.get(de.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;s?((s.includes(te.EAN_13)||s.includes(te.UPC_A)||s.includes(te.EAN_8)||s.includes(te.UPC_E))&&this.readers.push(new ra(t)),s.includes(te.CODE_39)&&this.readers.push(new it(a)),s.includes(te.CODE_128)&&this.readers.push(new X),s.includes(te.ITF)&&this.readers.push(new ke),s.includes(te.RSS_14)&&this.readers.push(new qe),s.includes(te.RSS_EXPANDED)&&this.readers.push(new P(this.verbose))):(this.readers.push(new ra(t)),this.readers.push(new it),this.readers.push(new ra(t)),this.readers.push(new X),this.readers.push(new ke),this.readers.push(new qe),this.readers.push(new P(this.verbose)))}decodeRow(t,i,s){for(let a=0;a<this.readers.length;a++)try{return this.readers[a].decodeRow(t,i,s)}catch{}throw new M}reset(){this.readers.forEach(t=>t.reset())}}class r0 extends nr{constructor(t=500,i){super(new Or(i),t,i)}}class Oe{constructor(t,i,s){this.ecCodewords=t,this.ecBlocks=[i],s&&this.ecBlocks.push(s)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class Ne{constructor(t,i){this.count=t,this.dataCodewords=i}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class ye{constructor(t,i,s,a,l,u){this.versionNumber=t,this.symbolSizeRows=i,this.symbolSizeColumns=s,this.dataRegionSizeRows=a,this.dataRegionSizeColumns=l,this.ecBlocks=u;let f=0;const d=u.getECCodewords(),g=u.getECBlocks();for(let x of g)f+=x.getCount()*(x.getDataCodewords()+d);this.totalCodewords=f}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(t,i){if((t&1)!==0||(i&1)!==0)throw new V;for(let s of ye.VERSIONS)if(s.symbolSizeRows===t&&s.symbolSizeColumns===i)return s;throw new V}toString(){return""+this.versionNumber}static buildVersions(){return[new ye(1,10,10,8,8,new Oe(5,new Ne(1,3))),new ye(2,12,12,10,10,new Oe(7,new Ne(1,5))),new ye(3,14,14,12,12,new Oe(10,new Ne(1,8))),new ye(4,16,16,14,14,new Oe(12,new Ne(1,12))),new ye(5,18,18,16,16,new Oe(14,new Ne(1,18))),new ye(6,20,20,18,18,new Oe(18,new Ne(1,22))),new ye(7,22,22,20,20,new Oe(20,new Ne(1,30))),new ye(8,24,24,22,22,new Oe(24,new Ne(1,36))),new ye(9,26,26,24,24,new Oe(28,new Ne(1,44))),new ye(10,32,32,14,14,new Oe(36,new Ne(1,62))),new ye(11,36,36,16,16,new Oe(42,new Ne(1,86))),new ye(12,40,40,18,18,new Oe(48,new Ne(1,114))),new ye(13,44,44,20,20,new Oe(56,new Ne(1,144))),new ye(14,48,48,22,22,new Oe(68,new Ne(1,174))),new ye(15,52,52,24,24,new Oe(42,new Ne(2,102))),new ye(16,64,64,14,14,new Oe(56,new Ne(2,140))),new ye(17,72,72,16,16,new Oe(36,new Ne(4,92))),new ye(18,80,80,18,18,new Oe(48,new Ne(4,114))),new ye(19,88,88,20,20,new Oe(56,new Ne(4,144))),new ye(20,96,96,22,22,new Oe(68,new Ne(4,174))),new ye(21,104,104,24,24,new Oe(56,new Ne(6,136))),new ye(22,120,120,18,18,new Oe(68,new Ne(6,175))),new ye(23,132,132,20,20,new Oe(62,new Ne(8,163))),new ye(24,144,144,22,22,new Oe(62,new Ne(8,156),new Ne(2,155))),new ye(25,8,18,6,16,new Oe(7,new Ne(1,5))),new ye(26,8,32,6,14,new Oe(11,new Ne(1,10))),new ye(27,12,26,10,24,new Oe(14,new Ne(1,16))),new ye(28,12,36,10,16,new Oe(18,new Ne(1,22))),new ye(29,16,36,14,16,new Oe(24,new Ne(1,32))),new ye(30,16,48,14,22,new Oe(28,new Ne(1,49)))]}}ye.VERSIONS=ye.buildVersions();class aa{constructor(t){const i=t.getHeight();if(i<8||i>144||(i&1)!==0)throw new V;this.version=aa.readVersion(t),this.mappingBitMatrix=this.extractDataRegion(t),this.readMappingMatrix=new _e(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(t){const i=t.getHeight(),s=t.getWidth();return ye.getVersionForDimensions(i,s)}readCodewords(){const t=new Int8Array(this.version.getTotalCodewords());let i=0,s=4,a=0;const l=this.mappingBitMatrix.getHeight(),u=this.mappingBitMatrix.getWidth();let f=!1,d=!1,g=!1,x=!1;do if(s===l&&a===0&&!f)t[i++]=this.readCorner1(l,u)&255,s-=2,a+=2,f=!0;else if(s===l-2&&a===0&&(u&3)!==0&&!d)t[i++]=this.readCorner2(l,u)&255,s-=2,a+=2,d=!0;else if(s===l+4&&a===2&&(u&7)===0&&!g)t[i++]=this.readCorner3(l,u)&255,s-=2,a+=2,g=!0;else if(s===l-2&&a===0&&(u&7)===4&&!x)t[i++]=this.readCorner4(l,u)&255,s-=2,a+=2,x=!0;else{do s<l&&a>=0&&!this.readMappingMatrix.get(a,s)&&(t[i++]=this.readUtah(s,a,l,u)&255),s-=2,a+=2;while(s>=0&&a<u);s+=1,a+=3;do s>=0&&a<u&&!this.readMappingMatrix.get(a,s)&&(t[i++]=this.readUtah(s,a,l,u)&255),s+=2,a-=2;while(s<l&&a>=0);s+=3,a+=1}while(s<l||a<u);if(i!==this.version.getTotalCodewords())throw new V;return t}readModule(t,i,s,a){return t<0&&(t+=s,i+=4-(s+4&7)),i<0&&(i+=a,t+=4-(a+4&7)),this.readMappingMatrix.set(i,t),this.mappingBitMatrix.get(i,t)}readUtah(t,i,s,a){let l=0;return this.readModule(t-2,i-2,s,a)&&(l|=1),l<<=1,this.readModule(t-2,i-1,s,a)&&(l|=1),l<<=1,this.readModule(t-1,i-2,s,a)&&(l|=1),l<<=1,this.readModule(t-1,i-1,s,a)&&(l|=1),l<<=1,this.readModule(t-1,i,s,a)&&(l|=1),l<<=1,this.readModule(t,i-2,s,a)&&(l|=1),l<<=1,this.readModule(t,i-1,s,a)&&(l|=1),l<<=1,this.readModule(t,i,s,a)&&(l|=1),l}readCorner1(t,i){let s=0;return this.readModule(t-1,0,t,i)&&(s|=1),s<<=1,this.readModule(t-1,1,t,i)&&(s|=1),s<<=1,this.readModule(t-1,2,t,i)&&(s|=1),s<<=1,this.readModule(0,i-2,t,i)&&(s|=1),s<<=1,this.readModule(0,i-1,t,i)&&(s|=1),s<<=1,this.readModule(1,i-1,t,i)&&(s|=1),s<<=1,this.readModule(2,i-1,t,i)&&(s|=1),s<<=1,this.readModule(3,i-1,t,i)&&(s|=1),s}readCorner2(t,i){let s=0;return this.readModule(t-3,0,t,i)&&(s|=1),s<<=1,this.readModule(t-2,0,t,i)&&(s|=1),s<<=1,this.readModule(t-1,0,t,i)&&(s|=1),s<<=1,this.readModule(0,i-4,t,i)&&(s|=1),s<<=1,this.readModule(0,i-3,t,i)&&(s|=1),s<<=1,this.readModule(0,i-2,t,i)&&(s|=1),s<<=1,this.readModule(0,i-1,t,i)&&(s|=1),s<<=1,this.readModule(1,i-1,t,i)&&(s|=1),s}readCorner3(t,i){let s=0;return this.readModule(t-1,0,t,i)&&(s|=1),s<<=1,this.readModule(t-1,i-1,t,i)&&(s|=1),s<<=1,this.readModule(0,i-3,t,i)&&(s|=1),s<<=1,this.readModule(0,i-2,t,i)&&(s|=1),s<<=1,this.readModule(0,i-1,t,i)&&(s|=1),s<<=1,this.readModule(1,i-3,t,i)&&(s|=1),s<<=1,this.readModule(1,i-2,t,i)&&(s|=1),s<<=1,this.readModule(1,i-1,t,i)&&(s|=1),s}readCorner4(t,i){let s=0;return this.readModule(t-3,0,t,i)&&(s|=1),s<<=1,this.readModule(t-2,0,t,i)&&(s|=1),s<<=1,this.readModule(t-1,0,t,i)&&(s|=1),s<<=1,this.readModule(0,i-2,t,i)&&(s|=1),s<<=1,this.readModule(0,i-1,t,i)&&(s|=1),s<<=1,this.readModule(1,i-1,t,i)&&(s|=1),s<<=1,this.readModule(2,i-1,t,i)&&(s|=1),s<<=1,this.readModule(3,i-1,t,i)&&(s|=1),s}extractDataRegion(t){const i=this.version.getSymbolSizeRows(),s=this.version.getSymbolSizeColumns();if(t.getHeight()!==i)throw new _("Dimension of bitMatrix must match the version size");const a=this.version.getDataRegionSizeRows(),l=this.version.getDataRegionSizeColumns(),u=i/a|0,f=s/l|0,d=u*a,g=f*l,x=new _e(g,d);for(let y=0;y<u;++y){const I=y*a;for(let T=0;T<f;++T){const v=T*l;for(let S=0;S<a;++S){const N=y*(a+2)+1+S,D=I+S;for(let F=0;F<l;++F){const U=T*(l+2)+1+F;if(t.get(U,N)){const L=v+F;x.set(L,D)}}}}}return x}}class la{constructor(t,i){this.numDataCodewords=t,this.codewords=i}static getDataBlocks(t,i){const s=i.getECBlocks();let a=0;const l=s.getECBlocks();for(let S of l)a+=S.getCount();const u=new Array(a);let f=0;for(let S of l)for(let N=0;N<S.getCount();N++){const D=S.getDataCodewords(),F=s.getECCodewords()+D;u[f++]=new la(D,new Uint8Array(F))}const g=u[0].codewords.length-s.getECCodewords(),x=g-1;let y=0;for(let S=0;S<x;S++)for(let N=0;N<f;N++)u[N].codewords[S]=t[y++];const I=i.getVersionNumber()===24,T=I?8:f;for(let S=0;S<T;S++)u[S].codewords[g-1]=t[y++];const v=u[0].codewords.length;for(let S=g;S<v;S++)for(let N=0;N<f;N++){const D=I?(N+8)%f:N,F=I&&D>7?S-1:S;u[D].codewords[F]=t[y++]}if(y!==t.length)throw new _;return u}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class ca{constructor(t){this.bytes=t,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(t){if(t<1||t>32||t>this.available())throw new _(""+t);let i=0,s=this.bitOffset,a=this.byteOffset;const l=this.bytes;if(s>0){const u=8-s,f=t<u?t:u,d=u-f,g=255>>8-f<<d;i=(l[a]&g)>>d,t-=f,s+=f,s===8&&(s=0,a++)}if(t>0){for(;t>=8;)i=i<<8|l[a]&255,a++,t-=8;if(t>0){const u=8-t,f=255>>u<<u;i=i<<t|(l[a]&f)>>u,s+=t}}return this.bitOffset=s,this.byteOffset=a,i}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var st;(function(E){E[E.PAD_ENCODE=0]="PAD_ENCODE",E[E.ASCII_ENCODE=1]="ASCII_ENCODE",E[E.C40_ENCODE=2]="C40_ENCODE",E[E.TEXT_ENCODE=3]="TEXT_ENCODE",E[E.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",E[E.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",E[E.BASE256_ENCODE=6]="BASE256_ENCODE"})(st||(st={}));class Fn{static decode(t){const i=new ca(t),s=new le,a=new le,l=new Array;let u=st.ASCII_ENCODE;do if(u===st.ASCII_ENCODE)u=this.decodeAsciiSegment(i,s,a);else{switch(u){case st.C40_ENCODE:this.decodeC40Segment(i,s);break;case st.TEXT_ENCODE:this.decodeTextSegment(i,s);break;case st.ANSIX12_ENCODE:this.decodeAnsiX12Segment(i,s);break;case st.EDIFACT_ENCODE:this.decodeEdifactSegment(i,s);break;case st.BASE256_ENCODE:this.decodeBase256Segment(i,s,l);break;default:throw new V}u=st.ASCII_ENCODE}while(u!==st.PAD_ENCODE&&i.available()>0);return a.length()>0&&s.append(a.toString()),new ci(t,s.toString(),l.length===0?null:l,null)}static decodeAsciiSegment(t,i,s){let a=!1;do{let l=t.readBits(8);if(l===0)throw new V;if(l<=128)return a&&(l+=128),i.append(String.fromCharCode(l-1)),st.ASCII_ENCODE;if(l===129)return st.PAD_ENCODE;if(l<=229){const u=l-130;u<10&&i.append("0"),i.append(""+u)}else switch(l){case 230:return st.C40_ENCODE;case 231:return st.BASE256_ENCODE;case 232:i.append(String.fromCharCode(29));break;case 233:case 234:break;case 235:a=!0;break;case 236:i.append("[)>05"),s.insert(0,"");break;case 237:i.append("[)>06"),s.insert(0,"");break;case 238:return st.ANSIX12_ENCODE;case 239:return st.TEXT_ENCODE;case 240:return st.EDIFACT_ENCODE;case 241:break;default:if(l!==254||t.available()!==0)throw new V;break}}while(t.available()>0);return st.ASCII_ENCODE}static decodeC40Segment(t,i){let s=!1;const a=[];let l=0;do{if(t.available()===8)return;const u=t.readBits(8);if(u===254)return;this.parseTwoBytes(u,t.readBits(8),a);for(let f=0;f<3;f++){const d=a[f];switch(l){case 0:if(d<3)l=d+1;else if(d<this.C40_BASIC_SET_CHARS.length){const g=this.C40_BASIC_SET_CHARS[d];s?(i.append(String.fromCharCode(g.charCodeAt(0)+128)),s=!1):i.append(g)}else throw new V;break;case 1:s?(i.append(String.fromCharCode(d+128)),s=!1):i.append(String.fromCharCode(d)),l=0;break;case 2:if(d<this.C40_SHIFT2_SET_CHARS.length){const g=this.C40_SHIFT2_SET_CHARS[d];s?(i.append(String.fromCharCode(g.charCodeAt(0)+128)),s=!1):i.append(g)}else switch(d){case 27:i.append(String.fromCharCode(29));break;case 30:s=!0;break;default:throw new V}l=0;break;case 3:s?(i.append(String.fromCharCode(d+224)),s=!1):i.append(String.fromCharCode(d+96)),l=0;break;default:throw new V}}}while(t.available()>0)}static decodeTextSegment(t,i){let s=!1,a=[],l=0;do{if(t.available()===8)return;const u=t.readBits(8);if(u===254)return;this.parseTwoBytes(u,t.readBits(8),a);for(let f=0;f<3;f++){const d=a[f];switch(l){case 0:if(d<3)l=d+1;else if(d<this.TEXT_BASIC_SET_CHARS.length){const g=this.TEXT_BASIC_SET_CHARS[d];s?(i.append(String.fromCharCode(g.charCodeAt(0)+128)),s=!1):i.append(g)}else throw new V;break;case 1:s?(i.append(String.fromCharCode(d+128)),s=!1):i.append(String.fromCharCode(d)),l=0;break;case 2:if(d<this.TEXT_SHIFT2_SET_CHARS.length){const g=this.TEXT_SHIFT2_SET_CHARS[d];s?(i.append(String.fromCharCode(g.charCodeAt(0)+128)),s=!1):i.append(g)}else switch(d){case 27:i.append(String.fromCharCode(29));break;case 30:s=!0;break;default:throw new V}l=0;break;case 3:if(d<this.TEXT_SHIFT3_SET_CHARS.length){const g=this.TEXT_SHIFT3_SET_CHARS[d];s?(i.append(String.fromCharCode(g.charCodeAt(0)+128)),s=!1):i.append(g),l=0}else throw new V;break;default:throw new V}}}while(t.available()>0)}static decodeAnsiX12Segment(t,i){const s=[];do{if(t.available()===8)return;const a=t.readBits(8);if(a===254)return;this.parseTwoBytes(a,t.readBits(8),s);for(let l=0;l<3;l++){const u=s[l];switch(u){case 0:i.append("\r");break;case 1:i.append("*");break;case 2:i.append(">");break;case 3:i.append(" ");break;default:if(u<14)i.append(String.fromCharCode(u+44));else if(u<40)i.append(String.fromCharCode(u+51));else throw new V;break}}}while(t.available()>0)}static parseTwoBytes(t,i,s){let a=(t<<8)+i-1,l=Math.floor(a/1600);s[0]=l,a-=l*1600,l=Math.floor(a/40),s[1]=l,s[2]=a-l*40}static decodeEdifactSegment(t,i){do{if(t.available()<=16)return;for(let s=0;s<4;s++){let a=t.readBits(6);if(a===31){const l=8-t.getBitOffset();l!==8&&t.readBits(l);return}(a&32)===0&&(a|=64),i.append(String.fromCharCode(a))}}while(t.available()>0)}static decodeBase256Segment(t,i,s){let a=1+t.getByteOffset();const l=this.unrandomize255State(t.readBits(8),a++);let u;if(l===0?u=t.available()/8|0:l<250?u=l:u=250*(l-249)+this.unrandomize255State(t.readBits(8),a++),u<0)throw new V;const f=new Uint8Array(u);for(let d=0;d<u;d++){if(t.available()<8)throw new V;f[d]=this.unrandomize255State(t.readBits(8),a++)}s.push(f);try{i.append(lt.decode(f,ie.ISO88591))}catch(d){throw new hn("Platform does not support required encoding: "+d.message)}}static unrandomize255State(t,i){const s=149*i%255+1,a=t-s;return a>=0?a:a+256}}Fn.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Fn.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Fn.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Fn.TEXT_SHIFT2_SET_CHARS=Fn.C40_SHIFT2_SET_CHARS,Fn.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)];class i0{constructor(){this.rsDecoder=new hi(ve.DATA_MATRIX_FIELD_256)}decode(t){const i=new aa(t),s=i.getVersion(),a=i.readCodewords(),l=la.getDataBlocks(a,s);let u=0;for(let g of l)u+=g.getNumDataCodewords();const f=new Uint8Array(u),d=l.length;for(let g=0;g<d;g++){const x=l[g],y=x.getCodewords(),I=x.getNumDataCodewords();this.correctErrors(y,I);for(let T=0;T<I;T++)f[T*d+g]=y[T]}return Fn.decode(f)}correctErrors(t,i){const s=new Int32Array(t);try{this.rsDecoder.decode(s,t.length-i)}catch{throw new H}for(let a=0;a<i;a++)t[a]=s[a]}}class Je{constructor(t){this.image=t,this.rectangleDetector=new Cn(this.image)}detect(){const t=this.rectangleDetector.detect();let i=this.detectSolid1(t);if(i=this.detectSolid2(i),i[3]=this.correctTopRight(i),!i[3])throw new M;i=this.shiftToModuleCenter(i);const s=i[0],a=i[1],l=i[2],u=i[3];let f=this.transitionsBetween(s,u)+1,d=this.transitionsBetween(l,u)+1;(f&1)===1&&(f+=1),(d&1)===1&&(d+=1),4*f<7*d&&4*d<7*f&&(f=d=Math.max(f,d));let g=Je.sampleGrid(this.image,s,a,l,u,f,d);return new bs(g,[s,a,l,u])}static shiftPoint(t,i,s){let a=(i.getX()-t.getX())/(s+1),l=(i.getY()-t.getY())/(s+1);return new Z(t.getX()+a,t.getY()+l)}static moveAway(t,i,s){let a=t.getX(),l=t.getY();return a<i?a-=1:a+=1,l<s?l-=1:l+=1,new Z(a,l)}detectSolid1(t){let i=t[0],s=t[1],a=t[3],l=t[2],u=this.transitionsBetween(i,s),f=this.transitionsBetween(s,a),d=this.transitionsBetween(a,l),g=this.transitionsBetween(l,i),x=u,y=[l,i,s,a];return x>f&&(x=f,y[0]=i,y[1]=s,y[2]=a,y[3]=l),x>d&&(x=d,y[0]=s,y[1]=a,y[2]=l,y[3]=i),x>g&&(y[0]=a,y[1]=l,y[2]=i,y[3]=s),y}detectSolid2(t){let i=t[0],s=t[1],a=t[2],l=t[3],u=this.transitionsBetween(i,l),f=Je.shiftPoint(s,a,(u+1)*4),d=Je.shiftPoint(a,s,(u+1)*4),g=this.transitionsBetween(f,i),x=this.transitionsBetween(d,l);return g<x?(t[0]=i,t[1]=s,t[2]=a,t[3]=l):(t[0]=s,t[1]=a,t[2]=l,t[3]=i),t}correctTopRight(t){let i=t[0],s=t[1],a=t[2],l=t[3],u=this.transitionsBetween(i,l),f=this.transitionsBetween(s,l),d=Je.shiftPoint(i,s,(f+1)*4),g=Je.shiftPoint(a,s,(u+1)*4);u=this.transitionsBetween(d,l),f=this.transitionsBetween(g,l);let x=new Z(l.getX()+(a.getX()-s.getX())/(u+1),l.getY()+(a.getY()-s.getY())/(u+1)),y=new Z(l.getX()+(i.getX()-s.getX())/(f+1),l.getY()+(i.getY()-s.getY())/(f+1));if(!this.isValid(x))return this.isValid(y)?y:null;if(!this.isValid(y))return x;let I=this.transitionsBetween(d,x)+this.transitionsBetween(g,x),T=this.transitionsBetween(d,y)+this.transitionsBetween(g,y);return I>T?x:y}shiftToModuleCenter(t){let i=t[0],s=t[1],a=t[2],l=t[3],u=this.transitionsBetween(i,l)+1,f=this.transitionsBetween(a,l)+1,d=Je.shiftPoint(i,s,f*4),g=Je.shiftPoint(a,s,u*4);u=this.transitionsBetween(d,l)+1,f=this.transitionsBetween(g,l)+1,(u&1)===1&&(u+=1),(f&1)===1&&(f+=1);let x=(i.getX()+s.getX()+a.getX()+l.getX())/4,y=(i.getY()+s.getY()+a.getY()+l.getY())/4;i=Je.moveAway(i,x,y),s=Je.moveAway(s,x,y),a=Je.moveAway(a,x,y),l=Je.moveAway(l,x,y);let I,T;return d=Je.shiftPoint(i,s,f*4),d=Je.shiftPoint(d,l,u*4),I=Je.shiftPoint(s,i,f*4),I=Je.shiftPoint(I,a,u*4),g=Je.shiftPoint(a,l,f*4),g=Je.shiftPoint(g,s,u*4),T=Je.shiftPoint(l,a,f*4),T=Je.shiftPoint(T,i,u*4),[d,I,g,T]}isValid(t){return t.getX()>=0&&t.getX()<this.image.getWidth()&&t.getY()>0&&t.getY()<this.image.getHeight()}static sampleGrid(t,i,s,a,l,u,f){return Ln.getInstance().sampleGrid(t,u,f,.5,.5,u-.5,.5,u-.5,f-.5,.5,f-.5,i.getX(),i.getY(),l.getX(),l.getY(),a.getX(),a.getY(),s.getX(),s.getY())}transitionsBetween(t,i){let s=Math.trunc(t.getX()),a=Math.trunc(t.getY()),l=Math.trunc(i.getX()),u=Math.trunc(i.getY()),f=Math.abs(u-a)>Math.abs(l-s);if(f){let S=s;s=a,a=S,S=l,l=u,u=S}let d=Math.abs(l-s),g=Math.abs(u-a),x=-d/2,y=a<u?1:-1,I=s<l?1:-1,T=0,v=this.image.get(f?a:s,f?s:a);for(let S=s,N=a;S!==l;S+=I){let D=this.image.get(f?N:S,f?S:N);if(D!==v&&(T++,v=D),x+=g,x>0){if(N===u)break;N+=y,x-=d}}return T}}class Un{constructor(){this.decoder=new i0}decode(t,i=null){let s,a;if(i!=null&&i.has(de.PURE_BARCODE)){const g=Un.extractPureBits(t.getBlackMatrix());s=this.decoder.decode(g),a=Un.NO_POINTS}else{const g=new Je(t.getBlackMatrix()).detect();s=this.decoder.decode(g.getBits()),a=g.getPoints()}const l=s.getRawBytes(),u=new Lt(s.getText(),l,8*l.length,a,te.DATA_MATRIX,j.currentTimeMillis()),f=s.getByteSegments();f!=null&&u.putMetadata(ct.BYTE_SEGMENTS,f);const d=s.getECLevel();return d!=null&&u.putMetadata(ct.ERROR_CORRECTION_LEVEL,d),u}reset(){}static extractPureBits(t){const i=t.getTopLeftOnBit(),s=t.getBottomRightOnBit();if(i==null||s==null)throw new M;const a=this.moduleSize(i,t);let l=i[1];const u=s[1];let f=i[0];const g=(s[0]-f+1)/a,x=(u-l+1)/a;if(g<=0||x<=0)throw new M;const y=a/2;l+=y,f+=y;const I=new _e(g,x);for(let T=0;T<x;T++){const v=l+T*a;for(let S=0;S<g;S++)t.get(f+S*a,v)&&I.set(S,T)}return I}static moduleSize(t,i){const s=i.getWidth();let a=t[0];const l=t[1];for(;a<s&&i.get(a,l);)a++;if(a===s)throw new M;const u=a-t[0];if(u===0)throw new M;return u}}Un.NO_POINTS=[];class s0 extends nr{constructor(t=500){super(new Un,t)}}var Dr;(function(E){E[E.L=0]="L",E[E.M=1]="M",E[E.Q=2]="Q",E[E.H=3]="H"})(Dr||(Dr={}));class Ue{constructor(t,i,s){this.value=t,this.stringValue=i,this.bits=s,Ue.FOR_BITS.set(s,this),Ue.FOR_VALUE.set(t,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(t){switch(t){case"L":return Ue.L;case"M":return Ue.M;case"Q":return Ue.Q;case"H":return Ue.H;default:throw new C(t+"not available")}}toString(){return this.stringValue}equals(t){if(!(t instanceof Ue))return!1;const i=t;return this.value===i.value}static forBits(t){if(t<0||t>=Ue.FOR_BITS.size)throw new _;return Ue.FOR_BITS.get(t)}}Ue.FOR_BITS=new Map,Ue.FOR_VALUE=new Map,Ue.L=new Ue(Dr.L,"L",1),Ue.M=new Ue(Dr.M,"M",0),Ue.Q=new Ue(Dr.Q,"Q",3),Ue.H=new Ue(Dr.H,"H",2);class Tt{constructor(t){this.errorCorrectionLevel=Ue.forBits(t>>3&3),this.dataMask=t&7}static numBitsDiffering(t,i){return Y.bitCount(t^i)}static decodeFormatInformation(t,i){const s=Tt.doDecodeFormatInformation(t,i);return s!==null?s:Tt.doDecodeFormatInformation(t^Tt.FORMAT_INFO_MASK_QR,i^Tt.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(t,i){let s=Number.MAX_SAFE_INTEGER,a=0;for(const l of Tt.FORMAT_INFO_DECODE_LOOKUP){const u=l[0];if(u===t||u===i)return new Tt(l[1]);let f=Tt.numBitsDiffering(t,u);f<s&&(a=l[1],s=f),t!==i&&(f=Tt.numBitsDiffering(i,u),f<s&&(a=l[1],s=f))}return s<=3?new Tt(a):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(t){if(!(t instanceof Tt))return!1;const i=t;return this.errorCorrectionLevel===i.errorCorrectionLevel&&this.dataMask===i.dataMask}}Tt.FORMAT_INFO_MASK_QR=21522,Tt.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class R{constructor(t,...i){this.ecCodewordsPerBlock=t,this.ecBlocks=i}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let t=0;const i=this.ecBlocks;for(const s of i)t+=s.getCount();return t}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class b{constructor(t,i){this.count=t,this.dataCodewords=i}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class J{constructor(t,i,...s){this.versionNumber=t,this.alignmentPatternCenters=i,this.ecBlocks=s;let a=0;const l=s[0].getECCodewordsPerBlock(),u=s[0].getECBlocks();for(const f of u)a+=f.getCount()*(f.getDataCodewords()+l);this.totalCodewords=a}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(t){return this.ecBlocks[t.getValue()]}static getProvisionalVersionForDimension(t){if(t%4!==1)throw new V;try{return this.getVersionForNumber((t-17)/4)}catch{throw new V}}static getVersionForNumber(t){if(t<1||t>40)throw new _;return J.VERSIONS[t-1]}static decodeVersionInformation(t){let i=Number.MAX_SAFE_INTEGER,s=0;for(let a=0;a<J.VERSION_DECODE_INFO.length;a++){const l=J.VERSION_DECODE_INFO[a];if(l===t)return J.getVersionForNumber(a+7);const u=Tt.numBitsDiffering(t,l);u<i&&(s=a+7,i=u)}return i<=3?J.getVersionForNumber(s):null}buildFunctionPattern(){const t=this.getDimensionForVersion(),i=new _e(t);i.setRegion(0,0,9,9),i.setRegion(t-8,0,8,9),i.setRegion(0,t-8,9,8);const s=this.alignmentPatternCenters.length;for(let a=0;a<s;a++){const l=this.alignmentPatternCenters[a]-2;for(let u=0;u<s;u++)a===0&&(u===0||u===s-1)||a===s-1&&u===0||i.setRegion(this.alignmentPatternCenters[u]-2,l,5,5)}return i.setRegion(6,9,1,t-17),i.setRegion(9,6,t-17,1),this.versionNumber>6&&(i.setRegion(t-11,0,3,6),i.setRegion(0,t-11,6,3)),i}toString(){return""+this.versionNumber}}J.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),J.VERSIONS=[new J(1,new Int32Array(0),new R(7,new b(1,19)),new R(10,new b(1,16)),new R(13,new b(1,13)),new R(17,new b(1,9))),new J(2,Int32Array.from([6,18]),new R(10,new b(1,34)),new R(16,new b(1,28)),new R(22,new b(1,22)),new R(28,new b(1,16))),new J(3,Int32Array.from([6,22]),new R(15,new b(1,55)),new R(26,new b(1,44)),new R(18,new b(2,17)),new R(22,new b(2,13))),new J(4,Int32Array.from([6,26]),new R(20,new b(1,80)),new R(18,new b(2,32)),new R(26,new b(2,24)),new R(16,new b(4,9))),new J(5,Int32Array.from([6,30]),new R(26,new b(1,108)),new R(24,new b(2,43)),new R(18,new b(2,15),new b(2,16)),new R(22,new b(2,11),new b(2,12))),new J(6,Int32Array.from([6,34]),new R(18,new b(2,68)),new R(16,new b(4,27)),new R(24,new b(4,19)),new R(28,new b(4,15))),new J(7,Int32Array.from([6,22,38]),new R(20,new b(2,78)),new R(18,new b(4,31)),new R(18,new b(2,14),new b(4,15)),new R(26,new b(4,13),new b(1,14))),new J(8,Int32Array.from([6,24,42]),new R(24,new b(2,97)),new R(22,new b(2,38),new b(2,39)),new R(22,new b(4,18),new b(2,19)),new R(26,new b(4,14),new b(2,15))),new J(9,Int32Array.from([6,26,46]),new R(30,new b(2,116)),new R(22,new b(3,36),new b(2,37)),new R(20,new b(4,16),new b(4,17)),new R(24,new b(4,12),new b(4,13))),new J(10,Int32Array.from([6,28,50]),new R(18,new b(2,68),new b(2,69)),new R(26,new b(4,43),new b(1,44)),new R(24,new b(6,19),new b(2,20)),new R(28,new b(6,15),new b(2,16))),new J(11,Int32Array.from([6,30,54]),new R(20,new b(4,81)),new R(30,new b(1,50),new b(4,51)),new R(28,new b(4,22),new b(4,23)),new R(24,new b(3,12),new b(8,13))),new J(12,Int32Array.from([6,32,58]),new R(24,new b(2,92),new b(2,93)),new R(22,new b(6,36),new b(2,37)),new R(26,new b(4,20),new b(6,21)),new R(28,new b(7,14),new b(4,15))),new J(13,Int32Array.from([6,34,62]),new R(26,new b(4,107)),new R(22,new b(8,37),new b(1,38)),new R(24,new b(8,20),new b(4,21)),new R(22,new b(12,11),new b(4,12))),new J(14,Int32Array.from([6,26,46,66]),new R(30,new b(3,115),new b(1,116)),new R(24,new b(4,40),new b(5,41)),new R(20,new b(11,16),new b(5,17)),new R(24,new b(11,12),new b(5,13))),new J(15,Int32Array.from([6,26,48,70]),new R(22,new b(5,87),new b(1,88)),new R(24,new b(5,41),new b(5,42)),new R(30,new b(5,24),new b(7,25)),new R(24,new b(11,12),new b(7,13))),new J(16,Int32Array.from([6,26,50,74]),new R(24,new b(5,98),new b(1,99)),new R(28,new b(7,45),new b(3,46)),new R(24,new b(15,19),new b(2,20)),new R(30,new b(3,15),new b(13,16))),new J(17,Int32Array.from([6,30,54,78]),new R(28,new b(1,107),new b(5,108)),new R(28,new b(10,46),new b(1,47)),new R(28,new b(1,22),new b(15,23)),new R(28,new b(2,14),new b(17,15))),new J(18,Int32Array.from([6,30,56,82]),new R(30,new b(5,120),new b(1,121)),new R(26,new b(9,43),new b(4,44)),new R(28,new b(17,22),new b(1,23)),new R(28,new b(2,14),new b(19,15))),new J(19,Int32Array.from([6,30,58,86]),new R(28,new b(3,113),new b(4,114)),new R(26,new b(3,44),new b(11,45)),new R(26,new b(17,21),new b(4,22)),new R(26,new b(9,13),new b(16,14))),new J(20,Int32Array.from([6,34,62,90]),new R(28,new b(3,107),new b(5,108)),new R(26,new b(3,41),new b(13,42)),new R(30,new b(15,24),new b(5,25)),new R(28,new b(15,15),new b(10,16))),new J(21,Int32Array.from([6,28,50,72,94]),new R(28,new b(4,116),new b(4,117)),new R(26,new b(17,42)),new R(28,new b(17,22),new b(6,23)),new R(30,new b(19,16),new b(6,17))),new J(22,Int32Array.from([6,26,50,74,98]),new R(28,new b(2,111),new b(7,112)),new R(28,new b(17,46)),new R(30,new b(7,24),new b(16,25)),new R(24,new b(34,13))),new J(23,Int32Array.from([6,30,54,78,102]),new R(30,new b(4,121),new b(5,122)),new R(28,new b(4,47),new b(14,48)),new R(30,new b(11,24),new b(14,25)),new R(30,new b(16,15),new b(14,16))),new J(24,Int32Array.from([6,28,54,80,106]),new R(30,new b(6,117),new b(4,118)),new R(28,new b(6,45),new b(14,46)),new R(30,new b(11,24),new b(16,25)),new R(30,new b(30,16),new b(2,17))),new J(25,Int32Array.from([6,32,58,84,110]),new R(26,new b(8,106),new b(4,107)),new R(28,new b(8,47),new b(13,48)),new R(30,new b(7,24),new b(22,25)),new R(30,new b(22,15),new b(13,16))),new J(26,Int32Array.from([6,30,58,86,114]),new R(28,new b(10,114),new b(2,115)),new R(28,new b(19,46),new b(4,47)),new R(28,new b(28,22),new b(6,23)),new R(30,new b(33,16),new b(4,17))),new J(27,Int32Array.from([6,34,62,90,118]),new R(30,new b(8,122),new b(4,123)),new R(28,new b(22,45),new b(3,46)),new R(30,new b(8,23),new b(26,24)),new R(30,new b(12,15),new b(28,16))),new J(28,Int32Array.from([6,26,50,74,98,122]),new R(30,new b(3,117),new b(10,118)),new R(28,new b(3,45),new b(23,46)),new R(30,new b(4,24),new b(31,25)),new R(30,new b(11,15),new b(31,16))),new J(29,Int32Array.from([6,30,54,78,102,126]),new R(30,new b(7,116),new b(7,117)),new R(28,new b(21,45),new b(7,46)),new R(30,new b(1,23),new b(37,24)),new R(30,new b(19,15),new b(26,16))),new J(30,Int32Array.from([6,26,52,78,104,130]),new R(30,new b(5,115),new b(10,116)),new R(28,new b(19,47),new b(10,48)),new R(30,new b(15,24),new b(25,25)),new R(30,new b(23,15),new b(25,16))),new J(31,Int32Array.from([6,30,56,82,108,134]),new R(30,new b(13,115),new b(3,116)),new R(28,new b(2,46),new b(29,47)),new R(30,new b(42,24),new b(1,25)),new R(30,new b(23,15),new b(28,16))),new J(32,Int32Array.from([6,34,60,86,112,138]),new R(30,new b(17,115)),new R(28,new b(10,46),new b(23,47)),new R(30,new b(10,24),new b(35,25)),new R(30,new b(19,15),new b(35,16))),new J(33,Int32Array.from([6,30,58,86,114,142]),new R(30,new b(17,115),new b(1,116)),new R(28,new b(14,46),new b(21,47)),new R(30,new b(29,24),new b(19,25)),new R(30,new b(11,15),new b(46,16))),new J(34,Int32Array.from([6,34,62,90,118,146]),new R(30,new b(13,115),new b(6,116)),new R(28,new b(14,46),new b(23,47)),new R(30,new b(44,24),new b(7,25)),new R(30,new b(59,16),new b(1,17))),new J(35,Int32Array.from([6,30,54,78,102,126,150]),new R(30,new b(12,121),new b(7,122)),new R(28,new b(12,47),new b(26,48)),new R(30,new b(39,24),new b(14,25)),new R(30,new b(22,15),new b(41,16))),new J(36,Int32Array.from([6,24,50,76,102,128,154]),new R(30,new b(6,121),new b(14,122)),new R(28,new b(6,47),new b(34,48)),new R(30,new b(46,24),new b(10,25)),new R(30,new b(2,15),new b(64,16))),new J(37,Int32Array.from([6,28,54,80,106,132,158]),new R(30,new b(17,122),new b(4,123)),new R(28,new b(29,46),new b(14,47)),new R(30,new b(49,24),new b(10,25)),new R(30,new b(24,15),new b(46,16))),new J(38,Int32Array.from([6,32,58,84,110,136,162]),new R(30,new b(4,122),new b(18,123)),new R(28,new b(13,46),new b(32,47)),new R(30,new b(48,24),new b(14,25)),new R(30,new b(42,15),new b(32,16))),new J(39,Int32Array.from([6,26,54,82,110,138,166]),new R(30,new b(20,117),new b(4,118)),new R(28,new b(40,47),new b(7,48)),new R(30,new b(43,24),new b(22,25)),new R(30,new b(10,15),new b(67,16))),new J(40,Int32Array.from([6,30,58,86,114,142,170]),new R(30,new b(19,118),new b(6,119)),new R(28,new b(18,47),new b(31,48)),new R(30,new b(34,24),new b(34,25)),new R(30,new b(20,15),new b(61,16)))];var ut;(function(E){E[E.DATA_MASK_000=0]="DATA_MASK_000",E[E.DATA_MASK_001=1]="DATA_MASK_001",E[E.DATA_MASK_010=2]="DATA_MASK_010",E[E.DATA_MASK_011=3]="DATA_MASK_011",E[E.DATA_MASK_100=4]="DATA_MASK_100",E[E.DATA_MASK_101=5]="DATA_MASK_101",E[E.DATA_MASK_110=6]="DATA_MASK_110",E[E.DATA_MASK_111=7]="DATA_MASK_111"})(ut||(ut={}));class Jt{constructor(t,i){this.value=t,this.isMasked=i}unmaskBitMatrix(t,i){for(let s=0;s<i;s++)for(let a=0;a<i;a++)this.isMasked(s,a)&&t.flip(a,s)}}Jt.values=new Map([[ut.DATA_MASK_000,new Jt(ut.DATA_MASK_000,(E,t)=>(E+t&1)===0)],[ut.DATA_MASK_001,new Jt(ut.DATA_MASK_001,(E,t)=>(E&1)===0)],[ut.DATA_MASK_010,new Jt(ut.DATA_MASK_010,(E,t)=>t%3===0)],[ut.DATA_MASK_011,new Jt(ut.DATA_MASK_011,(E,t)=>(E+t)%3===0)],[ut.DATA_MASK_100,new Jt(ut.DATA_MASK_100,(E,t)=>(Math.floor(E/2)+Math.floor(t/3)&1)===0)],[ut.DATA_MASK_101,new Jt(ut.DATA_MASK_101,(E,t)=>E*t%6===0)],[ut.DATA_MASK_110,new Jt(ut.DATA_MASK_110,(E,t)=>E*t%6<3)],[ut.DATA_MASK_111,new Jt(ut.DATA_MASK_111,(E,t)=>(E+t+E*t%3&1)===0)]]);class o0{constructor(t){const i=t.getHeight();if(i<21||(i&3)!==1)throw new V;this.bitMatrix=t}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let t=0;for(let l=0;l<6;l++)t=this.copyBit(l,8,t);t=this.copyBit(7,8,t),t=this.copyBit(8,8,t),t=this.copyBit(8,7,t);for(let l=5;l>=0;l--)t=this.copyBit(8,l,t);const i=this.bitMatrix.getHeight();let s=0;const a=i-7;for(let l=i-1;l>=a;l--)s=this.copyBit(8,l,s);for(let l=i-8;l<i;l++)s=this.copyBit(l,8,s);if(this.parsedFormatInfo=Tt.decodeFormatInformation(t,s),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new V}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const t=this.bitMatrix.getHeight(),i=Math.floor((t-17)/4);if(i<=6)return J.getVersionForNumber(i);let s=0;const a=t-11;for(let u=5;u>=0;u--)for(let f=t-9;f>=a;f--)s=this.copyBit(f,u,s);let l=J.decodeVersionInformation(s);if(l!==null&&l.getDimensionForVersion()===t)return this.parsedVersion=l,l;s=0;for(let u=5;u>=0;u--)for(let f=t-9;f>=a;f--)s=this.copyBit(u,f,s);if(l=J.decodeVersionInformation(s),l!==null&&l.getDimensionForVersion()===t)return this.parsedVersion=l,l;throw new V}copyBit(t,i,s){return(this.isMirror?this.bitMatrix.get(i,t):this.bitMatrix.get(t,i))?s<<1|1:s<<1}readCodewords(){const t=this.readFormatInformation(),i=this.readVersion(),s=Jt.values.get(t.getDataMask()),a=this.bitMatrix.getHeight();s.unmaskBitMatrix(this.bitMatrix,a);const l=i.buildFunctionPattern();let u=!0;const f=new Uint8Array(i.getTotalCodewords());let d=0,g=0,x=0;for(let y=a-1;y>0;y-=2){y===6&&y--;for(let I=0;I<a;I++){const T=u?a-1-I:I;for(let v=0;v<2;v++)l.get(y-v,T)||(x++,g<<=1,this.bitMatrix.get(y-v,T)&&(g|=1),x===8&&(f[d++]=g,x=0,g=0))}u=!u}if(d!==i.getTotalCodewords())throw new V;return f}remask(){if(this.parsedFormatInfo===null)return;const t=Jt.values[this.parsedFormatInfo.getDataMask()],i=this.bitMatrix.getHeight();t.unmaskBitMatrix(this.bitMatrix,i)}setMirror(t){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=t}mirror(){const t=this.bitMatrix;for(let i=0,s=t.getWidth();i<s;i++)for(let a=i+1,l=t.getHeight();a<l;a++)t.get(i,a)!==t.get(a,i)&&(t.flip(a,i),t.flip(i,a))}}class ua{constructor(t,i){this.numDataCodewords=t,this.codewords=i}static getDataBlocks(t,i,s){if(t.length!==i.getTotalCodewords())throw new _;const a=i.getECBlocksForLevel(s);let l=0;const u=a.getECBlocks();for(const v of u)l+=v.getCount();const f=new Array(l);let d=0;for(const v of u)for(let S=0;S<v.getCount();S++){const N=v.getDataCodewords(),D=a.getECCodewordsPerBlock()+N;f[d++]=new ua(N,new Uint8Array(D))}const g=f[0].codewords.length;let x=f.length-1;for(;x>=0&&f[x].codewords.length!==g;)x--;x++;const y=g-a.getECCodewordsPerBlock();let I=0;for(let v=0;v<y;v++)for(let S=0;S<d;S++)f[S].codewords[v]=t[I++];for(let v=x;v<d;v++)f[v].codewords[y]=t[I++];const T=f[0].codewords.length;for(let v=y;v<T;v++)for(let S=0;S<d;S++){const N=S<x?v:v+1;f[S].codewords[N]=t[I++]}return f}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var en;(function(E){E[E.TERMINATOR=0]="TERMINATOR",E[E.NUMERIC=1]="NUMERIC",E[E.ALPHANUMERIC=2]="ALPHANUMERIC",E[E.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",E[E.BYTE=4]="BYTE",E[E.ECI=5]="ECI",E[E.KANJI=6]="KANJI",E[E.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",E[E.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",E[E.HANZI=9]="HANZI"})(en||(en={}));class ee{constructor(t,i,s,a){this.value=t,this.stringValue=i,this.characterCountBitsForVersions=s,this.bits=a,ee.FOR_BITS.set(a,this),ee.FOR_VALUE.set(t,this)}static forBits(t){const i=ee.FOR_BITS.get(t);if(i===void 0)throw new _;return i}getCharacterCountBits(t){const i=t.getVersionNumber();let s;return i<=9?s=0:i<=26?s=1:s=2,this.characterCountBitsForVersions[s]}getValue(){return this.value}getBits(){return this.bits}equals(t){if(!(t instanceof ee))return!1;const i=t;return this.value===i.value}toString(){return this.stringValue}}ee.FOR_BITS=new Map,ee.FOR_VALUE=new Map,ee.TERMINATOR=new ee(en.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),ee.NUMERIC=new ee(en.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),ee.ALPHANUMERIC=new ee(en.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),ee.STRUCTURED_APPEND=new ee(en.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),ee.BYTE=new ee(en.BYTE,"BYTE",Int32Array.from([8,16,16]),4),ee.ECI=new ee(en.ECI,"ECI",Int32Array.from([0,0,0]),7),ee.KANJI=new ee(en.KANJI,"KANJI",Int32Array.from([8,10,12]),8),ee.FNC1_FIRST_POSITION=new ee(en.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),ee.FNC1_SECOND_POSITION=new ee(en.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),ee.HANZI=new ee(en.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class ze{static decode(t,i,s,a){const l=new ca(t);let u=new le;const f=new Array;let d=-1,g=-1;try{let x=null,y=!1,I;do{if(l.available()<4)I=ee.TERMINATOR;else{const T=l.readBits(4);I=ee.forBits(T)}switch(I){case ee.TERMINATOR:break;case ee.FNC1_FIRST_POSITION:case ee.FNC1_SECOND_POSITION:y=!0;break;case ee.STRUCTURED_APPEND:if(l.available()<16)throw new V;d=l.readBits(8),g=l.readBits(8);break;case ee.ECI:const T=ze.parseECIValue(l);if(x=B.getCharacterSetECIByValue(T),x===null)throw new V;break;case ee.HANZI:const v=l.readBits(4),S=l.readBits(I.getCharacterCountBits(i));v===ze.GB2312_SUBSET&&ze.decodeHanziSegment(l,u,S);break;default:const N=l.readBits(I.getCharacterCountBits(i));switch(I){case ee.NUMERIC:ze.decodeNumericSegment(l,u,N);break;case ee.ALPHANUMERIC:ze.decodeAlphanumericSegment(l,u,N,y);break;case ee.BYTE:ze.decodeByteSegment(l,u,N,x,f,a);break;case ee.KANJI:ze.decodeKanjiSegment(l,u,N);break;default:throw new V}break}}while(I!==ee.TERMINATOR)}catch{throw new V}return new ci(t,u.toString(),f.length===0?null:f,s===null?null:s.toString(),d,g)}static decodeHanziSegment(t,i,s){if(s*13>t.available())throw new V;const a=new Uint8Array(2*s);let l=0;for(;s>0;){const u=t.readBits(13);let f=u/96<<8&4294967295|u%96;f<959?f+=41377:f+=42657,a[l]=f>>8&255,a[l+1]=f&255,l+=2,s--}try{i.append(lt.decode(a,ie.GB2312))}catch(u){throw new V(u)}}static decodeKanjiSegment(t,i,s){if(s*13>t.available())throw new V;const a=new Uint8Array(2*s);let l=0;for(;s>0;){const u=t.readBits(13);let f=u/192<<8&4294967295|u%192;f<7936?f+=33088:f+=49472,a[l]=f>>8,a[l+1]=f,l+=2,s--}try{i.append(lt.decode(a,ie.SHIFT_JIS))}catch(u){throw new V(u)}}static decodeByteSegment(t,i,s,a,l,u){if(8*s>t.available())throw new V;const f=new Uint8Array(s);for(let g=0;g<s;g++)f[g]=t.readBits(8);let d;a===null?d=ie.guessEncoding(f,u):d=a.getName();try{i.append(lt.decode(f,d))}catch(g){throw new V(g)}l.push(f)}static toAlphaNumericChar(t){if(t>=ze.ALPHANUMERIC_CHARS.length)throw new V;return ze.ALPHANUMERIC_CHARS[t]}static decodeAlphanumericSegment(t,i,s,a){const l=i.length();for(;s>1;){if(t.available()<11)throw new V;const u=t.readBits(11);i.append(ze.toAlphaNumericChar(Math.floor(u/45))),i.append(ze.toAlphaNumericChar(u%45)),s-=2}if(s===1){if(t.available()<6)throw new V;i.append(ze.toAlphaNumericChar(t.readBits(6)))}if(a)for(let u=l;u<i.length();u++)i.charAt(u)==="%"&&(u<i.length()-1&&i.charAt(u+1)==="%"?i.deleteCharAt(u+1):i.setCharAt(u,String.fromCharCode(29)))}static decodeNumericSegment(t,i,s){for(;s>=3;){if(t.available()<10)throw new V;const a=t.readBits(10);if(a>=1e3)throw new V;i.append(ze.toAlphaNumericChar(Math.floor(a/100))),i.append(ze.toAlphaNumericChar(Math.floor(a/10)%10)),i.append(ze.toAlphaNumericChar(a%10)),s-=3}if(s===2){if(t.available()<7)throw new V;const a=t.readBits(7);if(a>=100)throw new V;i.append(ze.toAlphaNumericChar(Math.floor(a/10))),i.append(ze.toAlphaNumericChar(a%10))}else if(s===1){if(t.available()<4)throw new V;const a=t.readBits(4);if(a>=10)throw new V;i.append(ze.toAlphaNumericChar(a))}}static parseECIValue(t){const i=t.readBits(8);if((i&128)===0)return i&127;if((i&192)===128){const s=t.readBits(8);return(i&63)<<8&4294967295|s}if((i&224)===192){const s=t.readBits(16);return(i&31)<<16&4294967295|s}throw new V}}ze.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",ze.GB2312_SUBSET=1;class Ac{constructor(t){this.mirrored=t}isMirrored(){return this.mirrored}applyMirroredCorrection(t){if(!this.mirrored||t===null||t.length<3)return;const i=t[0];t[0]=t[2],t[2]=i}}class a0{constructor(){this.rsDecoder=new hi(ve.QR_CODE_FIELD_256)}decodeBooleanArray(t,i){return this.decodeBitMatrix(_e.parseFromBooleanArray(t),i)}decodeBitMatrix(t,i){const s=new o0(t);let a=null;try{return this.decodeBitMatrixParser(s,i)}catch(l){a=l}try{s.remask(),s.setMirror(!0),s.readVersion(),s.readFormatInformation(),s.mirror();const l=this.decodeBitMatrixParser(s,i);return l.setOther(new Ac(!0)),l}catch(l){throw a!==null?a:l}}decodeBitMatrixParser(t,i){const s=t.readVersion(),a=t.readFormatInformation().getErrorCorrectionLevel(),l=t.readCodewords(),u=ua.getDataBlocks(l,s,a);let f=0;for(const x of u)f+=x.getNumDataCodewords();const d=new Uint8Array(f);let g=0;for(const x of u){const y=x.getCodewords(),I=x.getNumDataCodewords();this.correctErrors(y,I);for(let T=0;T<I;T++)d[g++]=y[T]}return ze.decode(d,s,a,i)}correctErrors(t,i){const s=new Int32Array(t);try{this.rsDecoder.decode(s,t.length-i)}catch{throw new H}for(let a=0;a<i;a++)t[a]=s[a]}}class ha extends Z{constructor(t,i,s){super(t,i),this.estimatedModuleSize=s}aboutEquals(t,i,s){if(Math.abs(i-this.getY())<=t&&Math.abs(s-this.getX())<=t){const a=Math.abs(t-this.estimatedModuleSize);return a<=1||a<=this.estimatedModuleSize}return!1}combineEstimate(t,i,s){const a=(this.getX()+i)/2,l=(this.getY()+t)/2,u=(this.estimatedModuleSize+s)/2;return new ha(a,l,u)}}class Ns{constructor(t,i,s,a,l,u,f){this.image=t,this.startX=i,this.startY=s,this.width=a,this.height=l,this.moduleSize=u,this.resultPointCallback=f,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const t=this.startX,i=this.height,s=this.width,a=t+s,l=this.startY+i/2,u=new Int32Array(3),f=this.image;for(let d=0;d<i;d++){const g=l+((d&1)===0?Math.floor((d+1)/2):-Math.floor((d+1)/2));u[0]=0,u[1]=0,u[2]=0;let x=t;for(;x<a&&!f.get(x,g);)x++;let y=0;for(;x<a;){if(f.get(x,g))if(y===1)u[1]++;else if(y===2){if(this.foundPatternCross(u)){const I=this.handlePossibleCenter(u,g,x);if(I!==null)return I}u[0]=u[2],u[1]=1,u[2]=0,y=1}else u[++y]++;else y===1&&y++,u[y]++;x++}if(this.foundPatternCross(u)){const I=this.handlePossibleCenter(u,g,a);if(I!==null)return I}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new M}static centerFromEnd(t,i){return i-t[2]-t[1]/2}foundPatternCross(t){const i=this.moduleSize,s=i/2;for(let a=0;a<3;a++)if(Math.abs(i-t[a])>=s)return!1;return!0}crossCheckVertical(t,i,s,a){const l=this.image,u=l.getHeight(),f=this.crossCheckStateCount;f[0]=0,f[1]=0,f[2]=0;let d=t;for(;d>=0&&l.get(i,d)&&f[1]<=s;)f[1]++,d--;if(d<0||f[1]>s)return NaN;for(;d>=0&&!l.get(i,d)&&f[0]<=s;)f[0]++,d--;if(f[0]>s)return NaN;for(d=t+1;d<u&&l.get(i,d)&&f[1]<=s;)f[1]++,d++;if(d===u||f[1]>s)return NaN;for(;d<u&&!l.get(i,d)&&f[2]<=s;)f[2]++,d++;if(f[2]>s)return NaN;const g=f[0]+f[1]+f[2];return 5*Math.abs(g-a)>=2*a?NaN:this.foundPatternCross(f)?Ns.centerFromEnd(f,d):NaN}handlePossibleCenter(t,i,s){const a=t[0]+t[1]+t[2],l=Ns.centerFromEnd(t,s),u=this.crossCheckVertical(i,l,2*t[1],a);if(!isNaN(u)){const f=(t[0]+t[1]+t[2])/3;for(const g of this.possibleCenters)if(g.aboutEquals(f,u,l))return g.combineEstimate(u,l,f);const d=new ha(l,u,f);this.possibleCenters.push(d),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(d)}return null}}class fa extends Z{constructor(t,i,s,a){super(t,i),this.estimatedModuleSize=s,this.count=a,a===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(t,i,s){if(Math.abs(i-this.getY())<=t&&Math.abs(s-this.getX())<=t){const a=Math.abs(t-this.estimatedModuleSize);return a<=1||a<=this.estimatedModuleSize}return!1}combineEstimate(t,i,s){const a=this.count+1,l=(this.count*this.getX()+i)/a,u=(this.count*this.getY()+t)/a,f=(this.count*this.estimatedModuleSize+s)/a;return new fa(l,u,f,a)}}class l0{constructor(t){this.bottomLeft=t[0],this.topLeft=t[1],this.topRight=t[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class ht{constructor(t,i){this.image=t,this.resultPointCallback=i,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=i}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(t){const i=t!=null&&t.get(de.TRY_HARDER)!==void 0,s=t!=null&&t.get(de.PURE_BARCODE)!==void 0,a=this.image,l=a.getHeight(),u=a.getWidth();let f=Math.floor(3*l/(4*ht.MAX_MODULES));(f<ht.MIN_SKIP||i)&&(f=ht.MIN_SKIP);let d=!1;const g=new Int32Array(5);for(let y=f-1;y<l&&!d;y+=f){g[0]=0,g[1]=0,g[2]=0,g[3]=0,g[4]=0;let I=0;for(let T=0;T<u;T++)if(a.get(T,y))(I&1)===1&&I++,g[I]++;else if((I&1)===0)if(I===4)if(ht.foundPatternCross(g)){if(this.handlePossibleCenter(g,y,T,s)===!0)if(f=2,this.hasSkipped===!0)d=this.haveMultiplyConfirmedCenters();else{const S=this.findRowSkip();S>g[2]&&(y+=S-g[2]-f,T=u-1)}else{g[0]=g[2],g[1]=g[3],g[2]=g[4],g[3]=1,g[4]=0,I=3;continue}I=0,g[0]=0,g[1]=0,g[2]=0,g[3]=0,g[4]=0}else g[0]=g[2],g[1]=g[3],g[2]=g[4],g[3]=1,g[4]=0,I=3;else g[++I]++;else g[I]++;ht.foundPatternCross(g)&&this.handlePossibleCenter(g,y,u,s)===!0&&(f=g[0],this.hasSkipped&&(d=this.haveMultiplyConfirmedCenters()))}const x=this.selectBestPatterns();return Z.orderBestPatterns(x),new l0(x)}static centerFromEnd(t,i){return i-t[4]-t[3]-t[2]/2}static foundPatternCross(t){let i=0;for(let l=0;l<5;l++){const u=t[l];if(u===0)return!1;i+=u}if(i<7)return!1;const s=i/7,a=s/2;return Math.abs(s-t[0])<a&&Math.abs(s-t[1])<a&&Math.abs(3*s-t[2])<3*a&&Math.abs(s-t[3])<a&&Math.abs(s-t[4])<a}getCrossCheckStateCount(){const t=this.crossCheckStateCount;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t}crossCheckDiagonal(t,i,s,a){const l=this.getCrossCheckStateCount();let u=0;const f=this.image;for(;t>=u&&i>=u&&f.get(i-u,t-u);)l[2]++,u++;if(t<u||i<u)return!1;for(;t>=u&&i>=u&&!f.get(i-u,t-u)&&l[1]<=s;)l[1]++,u++;if(t<u||i<u||l[1]>s)return!1;for(;t>=u&&i>=u&&f.get(i-u,t-u)&&l[0]<=s;)l[0]++,u++;if(l[0]>s)return!1;const d=f.getHeight(),g=f.getWidth();for(u=1;t+u<d&&i+u<g&&f.get(i+u,t+u);)l[2]++,u++;if(t+u>=d||i+u>=g)return!1;for(;t+u<d&&i+u<g&&!f.get(i+u,t+u)&&l[3]<s;)l[3]++,u++;if(t+u>=d||i+u>=g||l[3]>=s)return!1;for(;t+u<d&&i+u<g&&f.get(i+u,t+u)&&l[4]<s;)l[4]++,u++;if(l[4]>=s)return!1;const x=l[0]+l[1]+l[2]+l[3]+l[4];return Math.abs(x-a)<2*a&&ht.foundPatternCross(l)}crossCheckVertical(t,i,s,a){const l=this.image,u=l.getHeight(),f=this.getCrossCheckStateCount();let d=t;for(;d>=0&&l.get(i,d);)f[2]++,d--;if(d<0)return NaN;for(;d>=0&&!l.get(i,d)&&f[1]<=s;)f[1]++,d--;if(d<0||f[1]>s)return NaN;for(;d>=0&&l.get(i,d)&&f[0]<=s;)f[0]++,d--;if(f[0]>s)return NaN;for(d=t+1;d<u&&l.get(i,d);)f[2]++,d++;if(d===u)return NaN;for(;d<u&&!l.get(i,d)&&f[3]<s;)f[3]++,d++;if(d===u||f[3]>=s)return NaN;for(;d<u&&l.get(i,d)&&f[4]<s;)f[4]++,d++;if(f[4]>=s)return NaN;const g=f[0]+f[1]+f[2]+f[3]+f[4];return 5*Math.abs(g-a)>=2*a?NaN:ht.foundPatternCross(f)?ht.centerFromEnd(f,d):NaN}crossCheckHorizontal(t,i,s,a){const l=this.image,u=l.getWidth(),f=this.getCrossCheckStateCount();let d=t;for(;d>=0&&l.get(d,i);)f[2]++,d--;if(d<0)return NaN;for(;d>=0&&!l.get(d,i)&&f[1]<=s;)f[1]++,d--;if(d<0||f[1]>s)return NaN;for(;d>=0&&l.get(d,i)&&f[0]<=s;)f[0]++,d--;if(f[0]>s)return NaN;for(d=t+1;d<u&&l.get(d,i);)f[2]++,d++;if(d===u)return NaN;for(;d<u&&!l.get(d,i)&&f[3]<s;)f[3]++,d++;if(d===u||f[3]>=s)return NaN;for(;d<u&&l.get(d,i)&&f[4]<s;)f[4]++,d++;if(f[4]>=s)return NaN;const g=f[0]+f[1]+f[2]+f[3]+f[4];return 5*Math.abs(g-a)>=a?NaN:ht.foundPatternCross(f)?ht.centerFromEnd(f,d):NaN}handlePossibleCenter(t,i,s,a){const l=t[0]+t[1]+t[2]+t[3]+t[4];let u=ht.centerFromEnd(t,s),f=this.crossCheckVertical(i,Math.floor(u),t[2],l);if(!isNaN(f)&&(u=this.crossCheckHorizontal(Math.floor(u),Math.floor(f),t[2],l),!isNaN(u)&&(!a||this.crossCheckDiagonal(Math.floor(f),Math.floor(u),t[2],l)))){const d=l/7;let g=!1;const x=this.possibleCenters;for(let y=0,I=x.length;y<I;y++){const T=x[y];if(T.aboutEquals(d,f,u)){x[y]=T.combineEstimate(f,u,d),g=!0;break}}if(!g){const y=new fa(u,f,d);x.push(y),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(y)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let i=null;for(const s of this.possibleCenters)if(s.getCount()>=ht.CENTER_QUORUM)if(i==null)i=s;else return this.hasSkipped=!0,Math.floor((Math.abs(i.getX()-s.getX())-Math.abs(i.getY()-s.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let t=0,i=0;const s=this.possibleCenters.length;for(const u of this.possibleCenters)u.getCount()>=ht.CENTER_QUORUM&&(t++,i+=u.getEstimatedModuleSize());if(t<3)return!1;const a=i/s;let l=0;for(const u of this.possibleCenters)l+=Math.abs(u.getEstimatedModuleSize()-a);return l<=.05*i}selectBestPatterns(){const t=this.possibleCenters.length;if(t<3)throw new M;const i=this.possibleCenters;let s;if(t>3){let a=0,l=0;for(const d of this.possibleCenters){const g=d.getEstimatedModuleSize();a+=g,l+=g*g}s=a/t;let u=Math.sqrt(l/t-s*s);i.sort((d,g)=>{const x=Math.abs(g.getEstimatedModuleSize()-s),y=Math.abs(d.getEstimatedModuleSize()-s);return x<y?-1:x>y?1:0});const f=Math.max(.2*s,u);for(let d=0;d<i.length&&i.length>3;d++){const g=i[d];Math.abs(g.getEstimatedModuleSize()-s)>f&&(i.splice(d,1),d--)}}if(i.length>3){let a=0;for(const l of i)a+=l.getEstimatedModuleSize();s=a/i.length,i.sort((l,u)=>{if(u.getCount()===l.getCount()){const f=Math.abs(u.getEstimatedModuleSize()-s),d=Math.abs(l.getEstimatedModuleSize()-s);return f<d?1:f>d?-1:0}else return u.getCount()-l.getCount()}),i.splice(3)}return[i[0],i[1],i[2]]}}ht.CENTER_QUORUM=2,ht.MIN_SKIP=3,ht.MAX_MODULES=57;class di{constructor(t){this.image=t}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(t){this.resultPointCallback=t==null?null:t.get(de.NEED_RESULT_POINT_CALLBACK);const s=new ht(this.image,this.resultPointCallback).find(t);return this.processFinderPatternInfo(s)}processFinderPatternInfo(t){const i=t.getTopLeft(),s=t.getTopRight(),a=t.getBottomLeft(),l=this.calculateModuleSize(i,s,a);if(l<1)throw new M("No pattern found in proccess finder.");const u=di.computeDimension(i,s,a,l),f=J.getProvisionalVersionForDimension(u),d=f.getDimensionForVersion()-7;let g=null;if(f.getAlignmentPatternCenters().length>0){const T=s.getX()-i.getX()+a.getX(),v=s.getY()-i.getY()+a.getY(),S=1-3/d,N=Math.floor(i.getX()+S*(T-i.getX())),D=Math.floor(i.getY()+S*(v-i.getY()));for(let F=4;F<=16;F<<=1)try{g=this.findAlignmentInRegion(l,N,D,F);break}catch(U){if(!(U instanceof M))throw U}}const x=di.createTransform(i,s,a,g,u),y=di.sampleGrid(this.image,x,u);let I;return g===null?I=[a,i,s]:I=[a,i,s,g],new bs(y,I)}static createTransform(t,i,s,a,l){const u=l-3.5;let f,d,g,x;return a!==null?(f=a.getX(),d=a.getY(),g=u-3,x=g):(f=i.getX()-t.getX()+s.getX(),d=i.getY()-t.getY()+s.getY(),g=u,x=u),nn.quadrilateralToQuadrilateral(3.5,3.5,u,3.5,g,x,3.5,u,t.getX(),t.getY(),i.getX(),i.getY(),f,d,s.getX(),s.getY())}static sampleGrid(t,i,s){return Ln.getInstance().sampleGridWithTransform(t,s,s,i)}static computeDimension(t,i,s,a){const l=be.round(Z.distance(t,i)/a),u=be.round(Z.distance(t,s)/a);let f=Math.floor((l+u)/2)+7;switch(f&3){case 0:f++;break;case 2:f--;break;case 3:throw new M("Dimensions could be not found.")}return f}calculateModuleSize(t,i,s){return(this.calculateModuleSizeOneWay(t,i)+this.calculateModuleSizeOneWay(t,s))/2}calculateModuleSizeOneWay(t,i){const s=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(i.getX()),Math.floor(i.getY())),a=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(i.getX()),Math.floor(i.getY()),Math.floor(t.getX()),Math.floor(t.getY()));return isNaN(s)?a/7:isNaN(a)?s/7:(s+a)/14}sizeOfBlackWhiteBlackRunBothWays(t,i,s,a){let l=this.sizeOfBlackWhiteBlackRun(t,i,s,a),u=1,f=t-(s-t);f<0?(u=t/(t-f),f=0):f>=this.image.getWidth()&&(u=(this.image.getWidth()-1-t)/(f-t),f=this.image.getWidth()-1);let d=Math.floor(i-(a-i)*u);return u=1,d<0?(u=i/(i-d),d=0):d>=this.image.getHeight()&&(u=(this.image.getHeight()-1-i)/(d-i),d=this.image.getHeight()-1),f=Math.floor(t+(f-t)*u),l+=this.sizeOfBlackWhiteBlackRun(t,i,f,d),l-1}sizeOfBlackWhiteBlackRun(t,i,s,a){const l=Math.abs(a-i)>Math.abs(s-t);if(l){let T=t;t=i,i=T,T=s,s=a,a=T}const u=Math.abs(s-t),f=Math.abs(a-i);let d=-u/2;const g=t<s?1:-1,x=i<a?1:-1;let y=0;const I=s+g;for(let T=t,v=i;T!==I;T+=g){const S=l?v:T,N=l?T:v;if(y===1===this.image.get(S,N)){if(y===2)return be.distance(T,v,t,i);y++}if(d+=f,d>0){if(v===a)break;v+=x,d-=u}}return y===2?be.distance(s+g,a,t,i):NaN}findAlignmentInRegion(t,i,s,a){const l=Math.floor(a*t),u=Math.max(0,i-l),f=Math.min(this.image.getWidth()-1,i+l);if(f-u<t*3)throw new M("Alignment top exceeds estimated module size.");const d=Math.max(0,s-l),g=Math.min(this.image.getHeight()-1,s+l);if(g-d<t*3)throw new M("Alignment bottom exceeds estimated module size.");return new Ns(this.image,u,d,f-u,g-d,t,this.resultPointCallback).find()}}class Vn{constructor(){this.decoder=new a0}getDecoder(){return this.decoder}decode(t,i){let s,a;if(i!=null&&i.get(de.PURE_BARCODE)!==void 0){const d=Vn.extractPureBits(t.getBlackMatrix());s=this.decoder.decodeBitMatrix(d,i),a=Vn.NO_POINTS}else{const d=new di(t.getBlackMatrix()).detect(i);s=this.decoder.decodeBitMatrix(d.getBits(),i),a=d.getPoints()}s.getOther()instanceof Ac&&s.getOther().applyMirroredCorrection(a);const l=new Lt(s.getText(),s.getRawBytes(),void 0,a,te.QR_CODE,void 0),u=s.getByteSegments();u!==null&&l.putMetadata(ct.BYTE_SEGMENTS,u);const f=s.getECLevel();return f!==null&&l.putMetadata(ct.ERROR_CORRECTION_LEVEL,f),s.hasStructuredAppend()&&(l.putMetadata(ct.STRUCTURED_APPEND_SEQUENCE,s.getStructuredAppendSequenceNumber()),l.putMetadata(ct.STRUCTURED_APPEND_PARITY,s.getStructuredAppendParity())),l}reset(){}static extractPureBits(t){const i=t.getTopLeftOnBit(),s=t.getBottomRightOnBit();if(i===null||s===null)throw new M;const a=this.moduleSize(i,t);let l=i[1],u=s[1],f=i[0],d=s[0];if(f>=d||l>=u)throw new M;if(u-l!==d-f&&(d=f+(u-l),d>=t.getWidth()))throw new M;const g=Math.round((d-f+1)/a),x=Math.round((u-l+1)/a);if(g<=0||x<=0)throw new M;if(x!==g)throw new M;const y=Math.floor(a/2);l+=y,f+=y;const I=f+Math.floor((g-1)*a)-d;if(I>0){if(I>y)throw new M;f-=I}const T=l+Math.floor((x-1)*a)-u;if(T>0){if(T>y)throw new M;l-=T}const v=new _e(g,x);for(let S=0;S<x;S++){const N=l+Math.floor(S*a);for(let D=0;D<g;D++)t.get(f+Math.floor(D*a),N)&&v.set(D,S)}return v}static moduleSize(t,i){const s=i.getHeight(),a=i.getWidth();let l=t[0],u=t[1],f=!0,d=0;for(;l<a&&u<s;){if(f!==i.get(l,u)){if(++d===5)break;f=!f}l++,u++}if(l===a||u===s)throw new M;return(l-t[0])/7}}Vn.NO_POINTS=new Array;class se{PDF417Common(){}static getBitCountSum(t){return be.sum(t)}static toIntArray(t){if(t==null||!t.length)return se.EMPTY_INT_ARRAY;const i=new Int32Array(t.length);let s=0;for(const a of t)i[s++]=a;return i}static getCodeword(t){const i=he.binarySearch(se.SYMBOL_TABLE,t&262143);return i<0?-1:(se.CODEWORD_TABLE[i]-1)%se.NUMBER_OF_CODEWORDS}}se.NUMBER_OF_CODEWORDS=929,se.MAX_CODEWORDS_IN_BARCODE=se.NUMBER_OF_CODEWORDS-1,se.MIN_ROWS_IN_BARCODE=3,se.MAX_ROWS_IN_BARCODE=90,se.MODULES_IN_CODEWORD=17,se.MODULES_IN_STOP_PATTERN=18,se.BARS_IN_MODULE=8,se.EMPTY_INT_ARRAY=new Int32Array([]),se.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),se.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class c0{constructor(t,i){this.bits=t,this.points=i}getBits(){return this.bits}getPoints(){return this.points}}class ge{static detectMultiple(t,i,s){let a=t.getBlackMatrix(),l=ge.detect(s,a);return l.length||(a=a.clone(),a.rotate180(),l=ge.detect(s,a)),new c0(a,l)}static detect(t,i){const s=new Array;let a=0,l=0,u=!1;for(;a<i.getHeight();){const f=ge.findVertices(i,a,l);if(f[0]==null&&f[3]==null){if(!u)break;u=!1,l=0;for(const d of s)d[1]!=null&&(a=Math.trunc(Math.max(a,d[1].getY()))),d[3]!=null&&(a=Math.max(a,Math.trunc(d[3].getY())));a+=ge.ROW_STEP;continue}if(u=!0,s.push(f),!t)break;f[2]!=null?(l=Math.trunc(f[2].getX()),a=Math.trunc(f[2].getY())):(l=Math.trunc(f[4].getX()),a=Math.trunc(f[4].getY()))}return s}static findVertices(t,i,s){const a=t.getHeight(),l=t.getWidth(),u=new Array(8);return ge.copyToResult(u,ge.findRowsWithPattern(t,a,l,i,s,ge.START_PATTERN),ge.INDEXES_START_PATTERN),u[4]!=null&&(s=Math.trunc(u[4].getX()),i=Math.trunc(u[4].getY())),ge.copyToResult(u,ge.findRowsWithPattern(t,a,l,i,s,ge.STOP_PATTERN),ge.INDEXES_STOP_PATTERN),u}static copyToResult(t,i,s){for(let a=0;a<s.length;a++)t[s[a]]=i[a]}static findRowsWithPattern(t,i,s,a,l,u){const f=new Array(4);let d=!1;const g=new Int32Array(u.length);for(;a<i;a+=ge.ROW_STEP){let y=ge.findGuardPattern(t,l,a,s,!1,u,g);if(y!=null){for(;a>0;){const I=ge.findGuardPattern(t,l,--a,s,!1,u,g);if(I!=null)y=I;else{a++;break}}f[0]=new Z(y[0],a),f[1]=new Z(y[1],a),d=!0;break}}let x=a+1;if(d){let y=0,I=Int32Array.from([Math.trunc(f[0].getX()),Math.trunc(f[1].getX())]);for(;x<i;x++){const T=ge.findGuardPattern(t,I[0],x,s,!1,u,g);if(T!=null&&Math.abs(I[0]-T[0])<ge.MAX_PATTERN_DRIFT&&Math.abs(I[1]-T[1])<ge.MAX_PATTERN_DRIFT)I=T,y=0;else{if(y>ge.SKIPPED_ROW_COUNT_MAX)break;y++}}x-=y+1,f[2]=new Z(I[0],x),f[3]=new Z(I[1],x)}return x-a<ge.BARCODE_MIN_HEIGHT&&he.fill(f,null),f}static findGuardPattern(t,i,s,a,l,u,f){he.fillWithin(f,0,f.length,0);let d=i,g=0;for(;t.get(d,s)&&d>0&&g++<ge.MAX_PIXEL_DRIFT;)d--;let x=d,y=0,I=u.length;for(let T=l;x<a;x++)if(t.get(x,s)!==T)f[y]++;else{if(y===I-1){if(ge.patternMatchVariance(f,u,ge.MAX_INDIVIDUAL_VARIANCE)<ge.MAX_AVG_VARIANCE)return new Int32Array([d,x]);d+=f[0]+f[1],j.arraycopy(f,2,f,0,y-1),f[y-1]=0,f[y]=0,y--}else y++;f[y]=1,T=!T}return y===I-1&&ge.patternMatchVariance(f,u,ge.MAX_INDIVIDUAL_VARIANCE)<ge.MAX_AVG_VARIANCE?new Int32Array([d,x-1]):null}static patternMatchVariance(t,i,s){let a=t.length,l=0,u=0;for(let g=0;g<a;g++)l+=t[g],u+=i[g];if(l<u)return 1/0;let f=l/u;s*=f;let d=0;for(let g=0;g<a;g++){let x=t[g],y=i[g]*f,I=x>y?x-y:y-x;if(I>s)return 1/0;d+=I}return d/l}}ge.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),ge.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),ge.MAX_AVG_VARIANCE=.42,ge.MAX_INDIVIDUAL_VARIANCE=.8,ge.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),ge.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),ge.MAX_PIXEL_DRIFT=3,ge.MAX_PATTERN_DRIFT=5,ge.SKIPPED_ROW_COUNT_MAX=25,ge.ROW_STEP=5,ge.BARCODE_MIN_HEIGHT=10;class xt{constructor(t,i){if(i.length===0)throw new _;this.field=t;let s=i.length;if(s>1&&i[0]===0){let a=1;for(;a<s&&i[a]===0;)a++;a===s?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(s-a),j.arraycopy(i,a,this.coefficients,0,this.coefficients.length))}else this.coefficients=i}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(t){return this.coefficients[this.coefficients.length-1-t]}evaluateAt(t){if(t===0)return this.getCoefficient(0);if(t===1){let a=0;for(let l of this.coefficients)a=this.field.add(a,l);return a}let i=this.coefficients[0],s=this.coefficients.length;for(let a=1;a<s;a++)i=this.field.add(this.field.multiply(t,i),this.coefficients[a]);return i}add(t){if(!this.field.equals(t.field))throw new _("ModulusPolys do not have same ModulusGF field");if(this.isZero())return t;if(t.isZero())return this;let i=this.coefficients,s=t.coefficients;if(i.length>s.length){let u=i;i=s,s=u}let a=new Int32Array(s.length),l=s.length-i.length;j.arraycopy(s,0,a,0,l);for(let u=l;u<s.length;u++)a[u]=this.field.add(i[u-l],s[u]);return new xt(this.field,a)}subtract(t){if(!this.field.equals(t.field))throw new _("ModulusPolys do not have same ModulusGF field");return t.isZero()?this:this.add(t.negative())}multiply(t){return t instanceof xt?this.multiplyOther(t):this.multiplyScalar(t)}multiplyOther(t){if(!this.field.equals(t.field))throw new _("ModulusPolys do not have same ModulusGF field");if(this.isZero()||t.isZero())return new xt(this.field,new Int32Array([0]));let i=this.coefficients,s=i.length,a=t.coefficients,l=a.length,u=new Int32Array(s+l-1);for(let f=0;f<s;f++){let d=i[f];for(let g=0;g<l;g++)u[f+g]=this.field.add(u[f+g],this.field.multiply(d,a[g]))}return new xt(this.field,u)}negative(){let t=this.coefficients.length,i=new Int32Array(t);for(let s=0;s<t;s++)i[s]=this.field.subtract(0,this.coefficients[s]);return new xt(this.field,i)}multiplyScalar(t){if(t===0)return new xt(this.field,new Int32Array([0]));if(t===1)return this;let i=this.coefficients.length,s=new Int32Array(i);for(let a=0;a<i;a++)s[a]=this.field.multiply(this.coefficients[a],t);return new xt(this.field,s)}multiplyByMonomial(t,i){if(t<0)throw new _;if(i===0)return new xt(this.field,new Int32Array([0]));let s=this.coefficients.length,a=new Int32Array(s+t);for(let l=0;l<s;l++)a[l]=this.field.multiply(this.coefficients[l],i);return new xt(this.field,a)}toString(){let t=new le;for(let i=this.getDegree();i>=0;i--){let s=this.getCoefficient(i);s!==0&&(s<0?(t.append(" - "),s=-s):t.length()>0&&t.append(" + "),(i===0||s!==1)&&t.append(s),i!==0&&(i===1?t.append("x"):(t.append("x^"),t.append(i))))}return t.toString()}}class u0{add(t,i){return(t+i)%this.modulus}subtract(t,i){return(this.modulus+t-i)%this.modulus}exp(t){return this.expTable[t]}log(t){if(t===0)throw new _;return this.logTable[t]}inverse(t){if(t===0)throw new Is;return this.expTable[this.modulus-this.logTable[t]-1]}multiply(t,i){return t===0||i===0?0:this.expTable[(this.logTable[t]+this.logTable[i])%(this.modulus-1)]}getSize(){return this.modulus}equals(t){return t===this}}class da extends u0{constructor(t,i){super(),this.modulus=t,this.expTable=new Int32Array(t),this.logTable=new Int32Array(t);let s=1;for(let a=0;a<t;a++)this.expTable[a]=s,s=s*i%t;for(let a=0;a<t-1;a++)this.logTable[this.expTable[a]]=a;this.zero=new xt(this,new Int32Array([0])),this.one=new xt(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(t,i){if(t<0)throw new _;if(i===0)return this.zero;let s=new Int32Array(t+1);return s[0]=i,new xt(this,s)}}da.PDF417_GF=new da(se.NUMBER_OF_CODEWORDS,3);class Ic{constructor(){this.field=da.PDF417_GF}decode(t,i,s){let a=new xt(this.field,t),l=new Int32Array(i),u=!1;for(let v=i;v>0;v--){let S=a.evaluateAt(this.field.exp(v));l[i-v]=S,S!==0&&(u=!0)}if(!u)return 0;let f=this.field.getOne();if(s!=null)for(const v of s){let S=this.field.exp(t.length-1-v),N=new xt(this.field,new Int32Array([this.field.subtract(0,S),1]));f=f.multiply(N)}let d=new xt(this.field,l),g=this.runEuclideanAlgorithm(this.field.buildMonomial(i,1),d,i),x=g[0],y=g[1],I=this.findErrorLocations(x),T=this.findErrorMagnitudes(y,x,I);for(let v=0;v<I.length;v++){let S=t.length-1-this.field.log(I[v]);if(S<0)throw H.getChecksumInstance();t[S]=this.field.subtract(t[S],T[v])}return I.length}runEuclideanAlgorithm(t,i,s){if(t.getDegree()<i.getDegree()){let I=t;t=i,i=I}let a=t,l=i,u=this.field.getZero(),f=this.field.getOne();for(;l.getDegree()>=Math.round(s/2);){let I=a,T=u;if(a=l,u=f,a.isZero())throw H.getChecksumInstance();l=I;let v=this.field.getZero(),S=a.getCoefficient(a.getDegree()),N=this.field.inverse(S);for(;l.getDegree()>=a.getDegree()&&!l.isZero();){let D=l.getDegree()-a.getDegree(),F=this.field.multiply(l.getCoefficient(l.getDegree()),N);v=v.add(this.field.buildMonomial(D,F)),l=l.subtract(a.multiplyByMonomial(D,F))}f=v.multiply(u).subtract(T).negative()}let d=f.getCoefficient(0);if(d===0)throw H.getChecksumInstance();let g=this.field.inverse(d),x=f.multiply(g),y=l.multiply(g);return[x,y]}findErrorLocations(t){let i=t.getDegree(),s=new Int32Array(i),a=0;for(let l=1;l<this.field.getSize()&&a<i;l++)t.evaluateAt(l)===0&&(s[a]=this.field.inverse(l),a++);if(a!==i)throw H.getChecksumInstance();return s}findErrorMagnitudes(t,i,s){let a=i.getDegree(),l=new Int32Array(a);for(let g=1;g<=a;g++)l[a-g]=this.field.multiply(g,i.getCoefficient(g));let u=new xt(this.field,l),f=s.length,d=new Int32Array(f);for(let g=0;g<f;g++){let x=this.field.inverse(s[g]),y=this.field.subtract(0,t.evaluateAt(x)),I=this.field.inverse(u.evaluateAt(x));d[g]=this.field.multiply(y,I)}return d}}class or{constructor(t,i,s,a,l){t instanceof or?this.constructor_2(t):this.constructor_1(t,i,s,a,l)}constructor_1(t,i,s,a,l){const u=i==null||s==null,f=a==null||l==null;if(u&&f)throw new M;u?(i=new Z(0,a.getY()),s=new Z(0,l.getY())):f&&(a=new Z(t.getWidth()-1,i.getY()),l=new Z(t.getWidth()-1,s.getY())),this.image=t,this.topLeft=i,this.bottomLeft=s,this.topRight=a,this.bottomRight=l,this.minX=Math.trunc(Math.min(i.getX(),s.getX())),this.maxX=Math.trunc(Math.max(a.getX(),l.getX())),this.minY=Math.trunc(Math.min(i.getY(),a.getY())),this.maxY=Math.trunc(Math.max(s.getY(),l.getY()))}constructor_2(t){this.image=t.image,this.topLeft=t.getTopLeft(),this.bottomLeft=t.getBottomLeft(),this.topRight=t.getTopRight(),this.bottomRight=t.getBottomRight(),this.minX=t.getMinX(),this.maxX=t.getMaxX(),this.minY=t.getMinY(),this.maxY=t.getMaxY()}static merge(t,i){return t==null?i:i==null?t:new or(t.image,t.topLeft,t.bottomLeft,i.topRight,i.bottomRight)}addMissingRows(t,i,s){let a=this.topLeft,l=this.bottomLeft,u=this.topRight,f=this.bottomRight;if(t>0){let d=s?this.topLeft:this.topRight,g=Math.trunc(d.getY()-t);g<0&&(g=0);let x=new Z(d.getX(),g);s?a=x:u=x}if(i>0){let d=s?this.bottomLeft:this.bottomRight,g=Math.trunc(d.getY()+i);g>=this.image.getHeight()&&(g=this.image.getHeight()-1);let x=new Z(d.getX(),g);s?l=x:f=x}return new or(this.image,a,l,u,f)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class h0{constructor(t,i,s,a){this.columnCount=t,this.errorCorrectionLevel=a,this.rowCountUpperPart=i,this.rowCountLowerPart=s,this.rowCount=i+s}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class gi{constructor(){this.buffer=""}static form(t,i){let s=-1;function a(u,f,d,g,x,y){if(u==="%%")return"%";if(i[++s]===void 0)return;u=g?parseInt(g.substr(1)):void 0;let I=x?parseInt(x.substr(1)):void 0,T;switch(y){case"s":T=i[s];break;case"c":T=i[s][0];break;case"f":T=parseFloat(i[s]).toFixed(u);break;case"p":T=parseFloat(i[s]).toPrecision(u);break;case"e":T=parseFloat(i[s]).toExponential(u);break;case"x":T=parseInt(i[s]).toString(I||16);break;case"d":T=parseFloat(parseInt(i[s],I||10).toPrecision(u)).toFixed(0);break}T=typeof T=="object"?JSON.stringify(T):(+T).toString(I);let v=parseInt(d),S=d&&d[0]+""=="0"?"0":" ";for(;T.length<v;)T=f!==void 0?T+S:S+T;return T}let l=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return t.replace(l,a)}format(t,...i){this.buffer+=gi.form(t,i)}toString(){return this.buffer}}class pi{constructor(t){this.boundingBox=new or(t),this.codewords=new Array(t.getMaxY()-t.getMinY()+1)}getCodewordNearby(t){let i=this.getCodeword(t);if(i!=null)return i;for(let s=1;s<pi.MAX_NEARBY_DISTANCE;s++){let a=this.imageRowToCodewordIndex(t)-s;if(a>=0&&(i=this.codewords[a],i!=null)||(a=this.imageRowToCodewordIndex(t)+s,a<this.codewords.length&&(i=this.codewords[a],i!=null)))return i}return null}imageRowToCodewordIndex(t){return t-this.boundingBox.getMinY()}setCodeword(t,i){this.codewords[this.imageRowToCodewordIndex(t)]=i}getCodeword(t){return this.codewords[this.imageRowToCodewordIndex(t)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const t=new gi;let i=0;for(const s of this.codewords){if(s==null){t.format("%3d:    |   %n",i++);continue}t.format("%3d: %3d|%3d%n",i++,s.getRowNumber(),s.getValue())}return t.toString()}}pi.MAX_NEARBY_DISTANCE=5;class mi{constructor(){this.values=new Map}setValue(t){t=Math.trunc(t);let i=this.values.get(t);i==null&&(i=0),i++,this.values.set(t,i)}getValue(){let t=-1,i=new Array;for(const[s,a]of this.values.entries()){const l={getKey:()=>s,getValue:()=>a};l.getValue()>t?(t=l.getValue(),i=[],i.push(l.getKey())):l.getValue()===t&&i.push(l.getKey())}return se.toIntArray(i)}getConfidence(t){return this.values.get(t)}}class Cc extends pi{constructor(t,i){super(t),this._isLeft=i}setRowNumbers(){for(let t of this.getCodewords())t!=null&&t.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(t){let i=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(i,t);let s=this.getBoundingBox(),a=this._isLeft?s.getTopLeft():s.getTopRight(),l=this._isLeft?s.getBottomLeft():s.getBottomRight(),u=this.imageRowToCodewordIndex(Math.trunc(a.getY())),f=this.imageRowToCodewordIndex(Math.trunc(l.getY())),d=-1,g=1,x=0;for(let y=u;y<f;y++){if(i[y]==null)continue;let I=i[y],T=I.getRowNumber()-d;if(T===0)x++;else if(T===1)g=Math.max(g,x),x=1,d=I.getRowNumber();else if(T<0||I.getRowNumber()>=t.getRowCount()||T>y)i[y]=null;else{let v;g>2?v=(g-2)*T:v=T;let S=v>=y;for(let N=1;N<=v&&!S;N++)S=i[y-N]!=null;S?i[y]=null:(d=I.getRowNumber(),x=1)}}}getRowHeights(){let t=this.getBarcodeMetadata();if(t==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(t);let i=new Int32Array(t.getRowCount());for(let s of this.getCodewords())if(s!=null){let a=s.getRowNumber();if(a>=i.length)continue;i[a]++}return i}adjustIncompleteIndicatorColumnRowNumbers(t){let i=this.getBoundingBox(),s=this._isLeft?i.getTopLeft():i.getTopRight(),a=this._isLeft?i.getBottomLeft():i.getBottomRight(),l=this.imageRowToCodewordIndex(Math.trunc(s.getY())),u=this.imageRowToCodewordIndex(Math.trunc(a.getY())),f=this.getCodewords(),d=-1;for(let g=l;g<u;g++){if(f[g]==null)continue;let x=f[g];x.setRowNumberAsRowIndicatorColumn();let y=x.getRowNumber()-d;y===0||(y===1?d=x.getRowNumber():x.getRowNumber()>=t.getRowCount()?f[g]=null:d=x.getRowNumber())}}getBarcodeMetadata(){let t=this.getCodewords(),i=new mi,s=new mi,a=new mi,l=new mi;for(let f of t){if(f==null)continue;f.setRowNumberAsRowIndicatorColumn();let d=f.getValue()%30,g=f.getRowNumber();switch(this._isLeft||(g+=2),g%3){case 0:s.setValue(d*3+1);break;case 1:l.setValue(d/3),a.setValue(d%3);break;case 2:i.setValue(d+1);break}}if(i.getValue().length===0||s.getValue().length===0||a.getValue().length===0||l.getValue().length===0||i.getValue()[0]<1||s.getValue()[0]+a.getValue()[0]<se.MIN_ROWS_IN_BARCODE||s.getValue()[0]+a.getValue()[0]>se.MAX_ROWS_IN_BARCODE)return null;let u=new h0(i.getValue()[0],s.getValue()[0],a.getValue()[0],l.getValue()[0]);return this.removeIncorrectCodewords(t,u),u}removeIncorrectCodewords(t,i){for(let s=0;s<t.length;s++){let a=t[s];if(t[s]==null)continue;let l=a.getValue()%30,u=a.getRowNumber();if(u>i.getRowCount()){t[s]=null;continue}switch(this._isLeft||(u+=2),u%3){case 0:l*3+1!==i.getRowCountUpperPart()&&(t[s]=null);break;case 1:(Math.trunc(l/3)!==i.getErrorCorrectionLevel()||l%3!==i.getRowCountLowerPart())&&(t[s]=null);break;case 2:l+1!==i.getColumnCount()&&(t[s]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class xi{constructor(t,i){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=t,this.barcodeColumnCount=t.getColumnCount(),this.boundingBox=i,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let t=se.MAX_CODEWORDS_IN_BARCODE,i;do i=t,t=this.adjustRowNumbersAndGetCount();while(t>0&&t<i);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(t){t!=null&&t.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let t=this.adjustRowNumbersByRow();if(t===0)return 0;for(let i=1;i<this.barcodeColumnCount+1;i++){let s=this.detectionResultColumns[i].getCodewords();for(let a=0;a<s.length;a++)s[a]!=null&&(s[a].hasValidRowNumber()||this.adjustRowNumbers(i,a,s))}return t}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let t=this.detectionResultColumns[0].getCodewords(),i=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let s=0;s<t.length;s++)if(t[s]!=null&&i[s]!=null&&t[s].getRowNumber()===i[s].getRowNumber())for(let a=1;a<=this.barcodeColumnCount;a++){let l=this.detectionResultColumns[a].getCodewords()[s];l!=null&&(l.setRowNumber(t[s].getRowNumber()),l.hasValidRowNumber()||(this.detectionResultColumns[a].getCodewords()[s]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let t=0,i=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let s=0;s<i.length;s++){if(i[s]==null)continue;let a=i[s].getRowNumber(),l=0;for(let u=this.barcodeColumnCount+1;u>0&&l<this.ADJUST_ROW_NUMBER_SKIP;u--){let f=this.detectionResultColumns[u].getCodewords()[s];f!=null&&(l=xi.adjustRowNumberIfValid(a,l,f),f.hasValidRowNumber()||t++)}}return t}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let t=0,i=this.detectionResultColumns[0].getCodewords();for(let s=0;s<i.length;s++){if(i[s]==null)continue;let a=i[s].getRowNumber(),l=0;for(let u=1;u<this.barcodeColumnCount+1&&l<this.ADJUST_ROW_NUMBER_SKIP;u++){let f=this.detectionResultColumns[u].getCodewords()[s];f!=null&&(l=xi.adjustRowNumberIfValid(a,l,f),f.hasValidRowNumber()||t++)}}return t}static adjustRowNumberIfValid(t,i,s){return s==null||s.hasValidRowNumber()||(s.isValidRowNumber(t)?(s.setRowNumber(t),i=0):++i),i}adjustRowNumbers(t,i,s){if(!this.detectionResultColumns[t-1])return;let a=s[i],l=this.detectionResultColumns[t-1].getCodewords(),u=l;this.detectionResultColumns[t+1]!=null&&(u=this.detectionResultColumns[t+1].getCodewords());let f=new Array(14);f[2]=l[i],f[3]=u[i],i>0&&(f[0]=s[i-1],f[4]=l[i-1],f[5]=u[i-1]),i>1&&(f[8]=s[i-2],f[10]=l[i-2],f[11]=u[i-2]),i<s.length-1&&(f[1]=s[i+1],f[6]=l[i+1],f[7]=u[i+1]),i<s.length-2&&(f[9]=s[i+2],f[12]=l[i+2],f[13]=u[i+2]);for(let d of f)if(xi.adjustRowNumber(a,d))return}static adjustRowNumber(t,i){return i==null?!1:i.hasValidRowNumber()&&i.getBucket()===t.getBucket()?(t.setRowNumber(i.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(t){this.boundingBox=t}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(t,i){this.detectionResultColumns[t]=i}getDetectionResultColumn(t){return this.detectionResultColumns[t]}toString(){let t=this.detectionResultColumns[0];t==null&&(t=this.detectionResultColumns[this.barcodeColumnCount+1]);let i=new gi;for(let s=0;s<t.getCodewords().length;s++){i.format("CW %3d:",s);for(let a=0;a<this.barcodeColumnCount+2;a++){if(this.detectionResultColumns[a]==null){i.format("    |   ");continue}let l=this.detectionResultColumns[a].getCodewords()[s];if(l==null){i.format("    |   ");continue}i.format(" %3d|%3d",l.getRowNumber(),l.getValue())}i.format("%n")}return i.toString()}}class wi{constructor(t,i,s,a){this.rowNumber=wi.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(t),this.endX=Math.trunc(i),this.bucket=Math.trunc(s),this.value=Math.trunc(a)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(t){return t!==wi.BARCODE_ROW_UNKNOWN&&this.bucket===t%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(t){this.rowNumber=t}toString(){return this.rowNumber+"|"+this.value}}wi.BARCODE_ROW_UNKNOWN=-1;class jt{static initialize(){for(let t=0;t<se.SYMBOL_TABLE.length;t++){let i=se.SYMBOL_TABLE[t],s=i&1;for(let a=0;a<se.BARS_IN_MODULE;a++){let l=0;for(;(i&1)===s;)l+=1,i>>=1;s=i&1,jt.RATIOS_TABLE[t]||(jt.RATIOS_TABLE[t]=new Array(se.BARS_IN_MODULE)),jt.RATIOS_TABLE[t][se.BARS_IN_MODULE-a-1]=Math.fround(l/se.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(t){let i=jt.getDecodedCodewordValue(jt.sampleBitCounts(t));return i!==-1?i:jt.getClosestDecodedValue(t)}static sampleBitCounts(t){let i=be.sum(t),s=new Int32Array(se.BARS_IN_MODULE),a=0,l=0;for(let u=0;u<se.MODULES_IN_CODEWORD;u++){let f=i/(2*se.MODULES_IN_CODEWORD)+u*i/se.MODULES_IN_CODEWORD;l+t[a]<=f&&(l+=t[a],a++),s[a]++}return s}static getDecodedCodewordValue(t){let i=jt.getBitValue(t);return se.getCodeword(i)===-1?-1:i}static getBitValue(t){let i=0;for(let s=0;s<t.length;s++)for(let a=0;a<t[s];a++)i=i<<1|(s%2===0?1:0);return Math.trunc(i)}static getClosestDecodedValue(t){let i=be.sum(t),s=new Array(se.BARS_IN_MODULE);if(i>1)for(let u=0;u<s.length;u++)s[u]=Math.fround(t[u]/i);let a=Cs.MAX_VALUE,l=-1;this.bSymbolTableReady||jt.initialize();for(let u=0;u<jt.RATIOS_TABLE.length;u++){let f=0,d=jt.RATIOS_TABLE[u];for(let g=0;g<se.BARS_IN_MODULE;g++){let x=Math.fround(d[g]-s[g]);if(f+=Math.fround(x*x),f>=a)break}f<a&&(a=f,l=se.SYMBOL_TABLE[u])}return l}}jt.bSymbolTableReady=!1,jt.RATIOS_TABLE=new Array(se.SYMBOL_TABLE.length).map(E=>new Array(se.BARS_IN_MODULE));class bc{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(t){this.segmentIndex=t}getFileId(){return this.fileId}setFileId(t){this.fileId=t}getOptionalData(){return this.optionalData}setOptionalData(t){this.optionalData=t}isLastSegment(){return this.lastSegment}setLastSegment(t){this.lastSegment=t}getSegmentCount(){return this.segmentCount}setSegmentCount(t){this.segmentCount=t}getSender(){return this.sender||null}setSender(t){this.sender=t}getAddressee(){return this.addressee||null}setAddressee(t){this.addressee=t}getFileName(){return this.fileName}setFileName(t){this.fileName=t}getFileSize(){return this.fileSize}setFileSize(t){this.fileSize=t}getChecksum(){return this.checksum}setChecksum(t){this.checksum=t}getTimestamp(){return this.timestamp}setTimestamp(t){this.timestamp=t}}class Tc{static parseLong(t,i=void 0){return parseInt(t,i)}}class _c extends m{}_c.kind="NullPointerException";class f0{writeBytes(t){this.writeBytesOffset(t,0,t.length)}writeBytesOffset(t,i,s){if(t==null)throw new _c;if(i<0||i>t.length||s<0||i+s>t.length||i+s<0)throw new Ce;if(s===0)return;for(let a=0;a<s;a++)this.write(t[i+a])}flush(){}close(){}}class d0 extends m{}class g0 extends f0{constructor(t=32){if(super(),this.count=0,t<0)throw new _("Negative initial size: "+t);this.buf=new Uint8Array(t)}ensureCapacity(t){t-this.buf.length>0&&this.grow(t)}grow(t){let s=this.buf.length<<1;if(s-t<0&&(s=t),s<0){if(t<0)throw new d0;s=Y.MAX_VALUE}this.buf=he.copyOfUint8Array(this.buf,s)}write(t){this.ensureCapacity(this.count+1),this.buf[this.count]=t,this.count+=1}writeBytesOffset(t,i,s){if(i<0||i>t.length||s<0||i+s-t.length>0)throw new Ce;this.ensureCapacity(this.count+s),j.arraycopy(t,i,this.buf,this.count,s),this.count+=s}writeTo(t){t.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return he.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(t){return t?typeof t=="string"?this.toString_string(t):this.toString_number(t):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(t){return new String(this.buf).toString()}toString_number(t){return new String(this.buf).toString()}close(){}}var Me;(function(E){E[E.ALPHA=0]="ALPHA",E[E.LOWER=1]="LOWER",E[E.MIXED=2]="MIXED",E[E.PUNCT=3]="PUNCT",E[E.ALPHA_SHIFT=4]="ALPHA_SHIFT",E[E.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(Me||(Me={}));function vc(){if(typeof window<"u")return window.BigInt||null;if(typeof Ai<"u")return Ai.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Rs;function Hn(E){if(typeof Rs>"u"&&(Rs=vc()),Rs===null)throw new Error("BigInt is not supported!");return Rs(E)}function p0(){let E=[];E[0]=Hn(1);let t=Hn(900);E[1]=t;for(let i=2;i<16;i++)E[i]=E[i-1]*t;return E}class O{static decode(t,i){let s=new le(""),a=B.ISO8859_1;s.enableDecoding(a);let l=1,u=t[l++],f=new bc;for(;l<t[0];){switch(u){case O.TEXT_COMPACTION_MODE_LATCH:l=O.textCompaction(t,l,s);break;case O.BYTE_COMPACTION_MODE_LATCH:case O.BYTE_COMPACTION_MODE_LATCH_6:l=O.byteCompaction(u,t,a,l,s);break;case O.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s.append(t[l++]);break;case O.NUMERIC_COMPACTION_MODE_LATCH:l=O.numericCompaction(t,l,s);break;case O.ECI_CHARSET:B.getCharacterSetECIByValue(t[l++]);break;case O.ECI_GENERAL_PURPOSE:l+=2;break;case O.ECI_USER_DEFINED:l++;break;case O.BEGIN_MACRO_PDF417_CONTROL_BLOCK:l=O.decodeMacroBlock(t,l,f);break;case O.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case O.MACRO_PDF417_TERMINATOR:throw new V;default:l--,l=O.textCompaction(t,l,s);break}if(l<t.length)u=t[l++];else throw V.getFormatInstance()}if(s.length()===0)throw V.getFormatInstance();let d=new ci(null,s.toString(),null,i);return d.setOther(f),d}static decodeMacroBlock(t,i,s){if(i+O.NUMBER_OF_SEQUENCE_CODEWORDS>t[0])throw V.getFormatInstance();let a=new Int32Array(O.NUMBER_OF_SEQUENCE_CODEWORDS);for(let f=0;f<O.NUMBER_OF_SEQUENCE_CODEWORDS;f++,i++)a[f]=t[i];s.setSegmentIndex(Y.parseInt(O.decodeBase900toBase10(a,O.NUMBER_OF_SEQUENCE_CODEWORDS)));let l=new le;i=O.textCompaction(t,i,l),s.setFileId(l.toString());let u=-1;for(t[i]===O.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(u=i+1);i<t[0];)switch(t[i]){case O.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(i++,t[i]){case O.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let f=new le;i=O.textCompaction(t,i+1,f),s.setFileName(f.toString());break;case O.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let d=new le;i=O.textCompaction(t,i+1,d),s.setSender(d.toString());break;case O.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let g=new le;i=O.textCompaction(t,i+1,g),s.setAddressee(g.toString());break;case O.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let x=new le;i=O.numericCompaction(t,i+1,x),s.setSegmentCount(Y.parseInt(x.toString()));break;case O.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let y=new le;i=O.numericCompaction(t,i+1,y),s.setTimestamp(Tc.parseLong(y.toString()));break;case O.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let I=new le;i=O.numericCompaction(t,i+1,I),s.setChecksum(Y.parseInt(I.toString()));break;case O.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let T=new le;i=O.numericCompaction(t,i+1,T),s.setFileSize(Tc.parseLong(T.toString()));break;default:throw V.getFormatInstance()}break;case O.MACRO_PDF417_TERMINATOR:i++,s.setLastSegment(!0);break;default:throw V.getFormatInstance()}if(u!==-1){let f=i-u;s.isLastSegment()&&f--,s.setOptionalData(he.copyOfRange(t,u,u+f))}return i}static textCompaction(t,i,s){let a=new Int32Array((t[0]-i)*2),l=new Int32Array((t[0]-i)*2),u=0,f=!1;for(;i<t[0]&&!f;){let d=t[i++];if(d<O.TEXT_COMPACTION_MODE_LATCH)a[u]=d/30,a[u+1]=d%30,u+=2;else switch(d){case O.TEXT_COMPACTION_MODE_LATCH:a[u++]=O.TEXT_COMPACTION_MODE_LATCH;break;case O.BYTE_COMPACTION_MODE_LATCH:case O.BYTE_COMPACTION_MODE_LATCH_6:case O.NUMERIC_COMPACTION_MODE_LATCH:case O.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case O.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case O.MACRO_PDF417_TERMINATOR:i--,f=!0;break;case O.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a[u]=O.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,d=t[i++],l[u]=d,u++;break}}return O.decodeTextCompaction(a,l,u,s),i}static decodeTextCompaction(t,i,s,a){let l=Me.ALPHA,u=Me.ALPHA,f=0;for(;f<s;){let d=t[f],g="";switch(l){case Me.ALPHA:if(d<26)g=String.fromCharCode(65+d);else switch(d){case 26:g=" ";break;case O.LL:l=Me.LOWER;break;case O.ML:l=Me.MIXED;break;case O.PS:u=l,l=Me.PUNCT_SHIFT;break;case O.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(i[f]);break;case O.TEXT_COMPACTION_MODE_LATCH:l=Me.ALPHA;break}break;case Me.LOWER:if(d<26)g=String.fromCharCode(97+d);else switch(d){case 26:g=" ";break;case O.AS:u=l,l=Me.ALPHA_SHIFT;break;case O.ML:l=Me.MIXED;break;case O.PS:u=l,l=Me.PUNCT_SHIFT;break;case O.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(i[f]);break;case O.TEXT_COMPACTION_MODE_LATCH:l=Me.ALPHA;break}break;case Me.MIXED:if(d<O.PL)g=O.MIXED_CHARS[d];else switch(d){case O.PL:l=Me.PUNCT;break;case 26:g=" ";break;case O.LL:l=Me.LOWER;break;case O.AL:l=Me.ALPHA;break;case O.PS:u=l,l=Me.PUNCT_SHIFT;break;case O.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(i[f]);break;case O.TEXT_COMPACTION_MODE_LATCH:l=Me.ALPHA;break}break;case Me.PUNCT:if(d<O.PAL)g=O.PUNCT_CHARS[d];else switch(d){case O.PAL:l=Me.ALPHA;break;case O.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(i[f]);break;case O.TEXT_COMPACTION_MODE_LATCH:l=Me.ALPHA;break}break;case Me.ALPHA_SHIFT:if(l=u,d<26)g=String.fromCharCode(65+d);else switch(d){case 26:g=" ";break;case O.TEXT_COMPACTION_MODE_LATCH:l=Me.ALPHA;break}break;case Me.PUNCT_SHIFT:if(l=u,d<O.PAL)g=O.PUNCT_CHARS[d];else switch(d){case O.PAL:l=Me.ALPHA;break;case O.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(i[f]);break;case O.TEXT_COMPACTION_MODE_LATCH:l=Me.ALPHA;break}break}g!==""&&a.append(g),f++}}static byteCompaction(t,i,s,a,l){let u=new g0,f=0,d=0,g=!1;switch(t){case O.BYTE_COMPACTION_MODE_LATCH:let x=new Int32Array(6),y=i[a++];for(;a<i[0]&&!g;)switch(x[f++]=y,d=900*d+y,y=i[a++],y){case O.TEXT_COMPACTION_MODE_LATCH:case O.BYTE_COMPACTION_MODE_LATCH:case O.NUMERIC_COMPACTION_MODE_LATCH:case O.BYTE_COMPACTION_MODE_LATCH_6:case O.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case O.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case O.MACRO_PDF417_TERMINATOR:a--,g=!0;break;default:if(f%5===0&&f>0){for(let I=0;I<6;++I)u.write(Number(Hn(d)>>Hn(8*(5-I))));d=0,f=0}break}a===i[0]&&y<O.TEXT_COMPACTION_MODE_LATCH&&(x[f++]=y);for(let I=0;I<f;I++)u.write(x[I]);break;case O.BYTE_COMPACTION_MODE_LATCH_6:for(;a<i[0]&&!g;){let I=i[a++];if(I<O.TEXT_COMPACTION_MODE_LATCH)f++,d=900*d+I;else switch(I){case O.TEXT_COMPACTION_MODE_LATCH:case O.BYTE_COMPACTION_MODE_LATCH:case O.NUMERIC_COMPACTION_MODE_LATCH:case O.BYTE_COMPACTION_MODE_LATCH_6:case O.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case O.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case O.MACRO_PDF417_TERMINATOR:a--,g=!0;break}if(f%5===0&&f>0){for(let T=0;T<6;++T)u.write(Number(Hn(d)>>Hn(8*(5-T))));d=0,f=0}}break}return l.append(lt.decode(u.toByteArray(),s)),a}static numericCompaction(t,i,s){let a=0,l=!1,u=new Int32Array(O.MAX_NUMERIC_CODEWORDS);for(;i<t[0]&&!l;){let f=t[i++];if(i===t[0]&&(l=!0),f<O.TEXT_COMPACTION_MODE_LATCH)u[a]=f,a++;else switch(f){case O.TEXT_COMPACTION_MODE_LATCH:case O.BYTE_COMPACTION_MODE_LATCH:case O.BYTE_COMPACTION_MODE_LATCH_6:case O.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case O.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case O.MACRO_PDF417_TERMINATOR:i--,l=!0;break}(a%O.MAX_NUMERIC_CODEWORDS===0||f===O.NUMERIC_COMPACTION_MODE_LATCH||l)&&a>0&&(s.append(O.decodeBase900toBase10(u,a)),a=0)}return i}static decodeBase900toBase10(t,i){let s=Hn(0);for(let l=0;l<i;l++)s+=O.EXP900[i-l-1]*Hn(t[l]);let a=s.toString();if(a.charAt(0)!=="1")throw new V;return a.substring(1)}}O.TEXT_COMPACTION_MODE_LATCH=900,O.BYTE_COMPACTION_MODE_LATCH=901,O.NUMERIC_COMPACTION_MODE_LATCH=902,O.BYTE_COMPACTION_MODE_LATCH_6=924,O.ECI_USER_DEFINED=925,O.ECI_GENERAL_PURPOSE=926,O.ECI_CHARSET=927,O.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,O.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,O.MACRO_PDF417_TERMINATOR=922,O.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,O.MAX_NUMERIC_CODEWORDS=15,O.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,O.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,O.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,O.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,O.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,O.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,O.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,O.PL=25,O.LL=27,O.AS=27,O.ML=28,O.AL=28,O.PS=29,O.PAL=29,O.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,O.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",O.EXP900=vc()?p0():[],O.NUMBER_OF_SEQUENCE_CODEWORDS=2;class pe{constructor(){}static decode(t,i,s,a,l,u,f){let d=new or(t,i,s,a,l),g=null,x=null,y;for(let v=!0;;v=!1){if(i!=null&&(g=pe.getRowIndicatorColumn(t,d,i,!0,u,f)),a!=null&&(x=pe.getRowIndicatorColumn(t,d,a,!1,u,f)),y=pe.merge(g,x),y==null)throw M.getNotFoundInstance();let S=y.getBoundingBox();if(v&&S!=null&&(S.getMinY()<d.getMinY()||S.getMaxY()>d.getMaxY()))d=S;else break}y.setBoundingBox(d);let I=y.getBarcodeColumnCount()+1;y.setDetectionResultColumn(0,g),y.setDetectionResultColumn(I,x);let T=g!=null;for(let v=1;v<=I;v++){let S=T?v:I-v;if(y.getDetectionResultColumn(S)!==void 0)continue;let N;S===0||S===I?N=new Cc(d,S===0):N=new pi(d),y.setDetectionResultColumn(S,N);let D=-1,F=D;for(let U=d.getMinY();U<=d.getMaxY();U++){if(D=pe.getStartColumn(y,S,U,T),D<0||D>d.getMaxX()){if(F===-1)continue;D=F}let L=pe.detectCodeword(t,d.getMinX(),d.getMaxX(),T,D,U,u,f);L!=null&&(N.setCodeword(U,L),F=D,u=Math.min(u,L.getWidth()),f=Math.max(f,L.getWidth()))}}return pe.createDecoderResult(y)}static merge(t,i){if(t==null&&i==null)return null;let s=pe.getBarcodeMetadata(t,i);if(s==null)return null;let a=or.merge(pe.adjustBoundingBox(t),pe.adjustBoundingBox(i));return new xi(s,a)}static adjustBoundingBox(t){if(t==null)return null;let i=t.getRowHeights();if(i==null)return null;let s=pe.getMax(i),a=0;for(let f of i)if(a+=s-f,f>0)break;let l=t.getCodewords();for(let f=0;a>0&&l[f]==null;f++)a--;let u=0;for(let f=i.length-1;f>=0&&(u+=s-i[f],!(i[f]>0));f--);for(let f=l.length-1;u>0&&l[f]==null;f--)u--;return t.getBoundingBox().addMissingRows(a,u,t.isLeft())}static getMax(t){let i=-1;for(let s of t)i=Math.max(i,s);return i}static getBarcodeMetadata(t,i){let s;if(t==null||(s=t.getBarcodeMetadata())==null)return i==null?null:i.getBarcodeMetadata();let a;return i==null||(a=i.getBarcodeMetadata())==null?s:s.getColumnCount()!==a.getColumnCount()&&s.getErrorCorrectionLevel()!==a.getErrorCorrectionLevel()&&s.getRowCount()!==a.getRowCount()?null:s}static getRowIndicatorColumn(t,i,s,a,l,u){let f=new Cc(i,a);for(let d=0;d<2;d++){let g=d===0?1:-1,x=Math.trunc(Math.trunc(s.getX()));for(let y=Math.trunc(Math.trunc(s.getY()));y<=i.getMaxY()&&y>=i.getMinY();y+=g){let I=pe.detectCodeword(t,0,t.getWidth(),a,x,y,l,u);I!=null&&(f.setCodeword(y,I),a?x=I.getStartX():x=I.getEndX())}}return f}static adjustCodewordCount(t,i){let s=i[0][1],a=s.getValue(),l=t.getBarcodeColumnCount()*t.getBarcodeRowCount()-pe.getNumberOfECCodeWords(t.getBarcodeECLevel());if(a.length===0){if(l<1||l>se.MAX_CODEWORDS_IN_BARCODE)throw M.getNotFoundInstance();s.setValue(l)}else a[0]!==l&&s.setValue(l)}static createDecoderResult(t){let i=pe.createBarcodeMatrix(t);pe.adjustCodewordCount(t,i);let s=new Array,a=new Int32Array(t.getBarcodeRowCount()*t.getBarcodeColumnCount()),l=[],u=new Array;for(let d=0;d<t.getBarcodeRowCount();d++)for(let g=0;g<t.getBarcodeColumnCount();g++){let x=i[d][g+1].getValue(),y=d*t.getBarcodeColumnCount()+g;x.length===0?s.push(y):x.length===1?a[y]=x[0]:(u.push(y),l.push(x))}let f=new Array(l.length);for(let d=0;d<f.length;d++)f[d]=l[d];return pe.createDecoderResultFromAmbiguousValues(t.getBarcodeECLevel(),a,se.toIntArray(s),se.toIntArray(u),f)}static createDecoderResultFromAmbiguousValues(t,i,s,a,l){let u=new Int32Array(a.length),f=100;for(;f-- >0;){for(let d=0;d<u.length;d++)i[a[d]]=l[d][u[d]];try{return pe.decodeCodewords(i,t,s)}catch(d){if(!(d instanceof H))throw d}if(u.length===0)throw H.getChecksumInstance();for(let d=0;d<u.length;d++)if(u[d]<l[d].length-1){u[d]++;break}else if(u[d]=0,d===u.length-1)throw H.getChecksumInstance()}throw H.getChecksumInstance()}static createBarcodeMatrix(t){let i=Array.from({length:t.getBarcodeRowCount()},()=>new Array(t.getBarcodeColumnCount()+2));for(let a=0;a<i.length;a++)for(let l=0;l<i[a].length;l++)i[a][l]=new mi;let s=0;for(let a of t.getDetectionResultColumns()){if(a!=null){for(let l of a.getCodewords())if(l!=null){let u=l.getRowNumber();if(u>=0){if(u>=i.length)continue;i[u][s].setValue(l.getValue())}}}s++}return i}static isValidBarcodeColumn(t,i){return i>=0&&i<=t.getBarcodeColumnCount()+1}static getStartColumn(t,i,s,a){let l=a?1:-1,u=null;if(pe.isValidBarcodeColumn(t,i-l)&&(u=t.getDetectionResultColumn(i-l).getCodeword(s)),u!=null)return a?u.getEndX():u.getStartX();if(u=t.getDetectionResultColumn(i).getCodewordNearby(s),u!=null)return a?u.getStartX():u.getEndX();if(pe.isValidBarcodeColumn(t,i-l)&&(u=t.getDetectionResultColumn(i-l).getCodewordNearby(s)),u!=null)return a?u.getEndX():u.getStartX();let f=0;for(;pe.isValidBarcodeColumn(t,i-l);){i-=l;for(let d of t.getDetectionResultColumn(i).getCodewords())if(d!=null)return(a?d.getEndX():d.getStartX())+l*f*(d.getEndX()-d.getStartX());f++}return a?t.getBoundingBox().getMinX():t.getBoundingBox().getMaxX()}static detectCodeword(t,i,s,a,l,u,f,d){l=pe.adjustCodewordStartColumn(t,i,s,a,l,u);let g=pe.getModuleBitCount(t,i,s,a,l,u);if(g==null)return null;let x,y=be.sum(g);if(a)x=l+y;else{for(let v=0;v<g.length/2;v++){let S=g[v];g[v]=g[g.length-1-v],g[g.length-1-v]=S}x=l,l=x-y}if(!pe.checkCodewordSkew(y,f,d))return null;let I=jt.getDecodedValue(g),T=se.getCodeword(I);return T===-1?null:new wi(l,x,pe.getCodewordBucketNumber(I),T)}static getModuleBitCount(t,i,s,a,l,u){let f=l,d=new Int32Array(8),g=0,x=a?1:-1,y=a;for(;(a?f<s:f>=i)&&g<d.length;)t.get(f,u)===y?(d[g]++,f+=x):(g++,y=!y);return g===d.length||f===(a?s:i)&&g===d.length-1?d:null}static getNumberOfECCodeWords(t){return 2<<t}static adjustCodewordStartColumn(t,i,s,a,l,u){let f=l,d=a?-1:1;for(let g=0;g<2;g++){for(;(a?f>=i:f<s)&&a===t.get(f,u);){if(Math.abs(l-f)>pe.CODEWORD_SKEW_SIZE)return l;f+=d}d=-d,a=!a}return f}static checkCodewordSkew(t,i,s){return i-pe.CODEWORD_SKEW_SIZE<=t&&t<=s+pe.CODEWORD_SKEW_SIZE}static decodeCodewords(t,i,s){if(t.length===0)throw V.getFormatInstance();let a=1<<i+1,l=pe.correctErrors(t,s,a);pe.verifyCodewordCount(t,a);let u=O.decode(t,""+i);return u.setErrorsCorrected(l),u.setErasures(s.length),u}static correctErrors(t,i,s){if(i!=null&&i.length>s/2+pe.MAX_ERRORS||s<0||s>pe.MAX_EC_CODEWORDS)throw H.getChecksumInstance();return pe.errorCorrection.decode(t,s,i)}static verifyCodewordCount(t,i){if(t.length<4)throw V.getFormatInstance();let s=t[0];if(s>t.length)throw V.getFormatInstance();if(s===0)if(i<t.length)t[0]=t.length-i;else throw V.getFormatInstance()}static getBitCountForCodeword(t){let i=new Int32Array(8),s=0,a=i.length-1;for(;!((t&1)!==s&&(s=t&1,a--,a<0));)i[a]++,t>>=1;return i}static getCodewordBucketNumber(t){return t instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(t):this.getCodewordBucketNumber_number(t)}static getCodewordBucketNumber_number(t){return pe.getCodewordBucketNumber(pe.getBitCountForCodeword(t))}static getCodewordBucketNumber_Int32Array(t){return(t[0]-t[2]+t[4]-t[6]+9)%9}static toString(t){let i=new gi;for(let s=0;s<t.length;s++){i.format("Row %2d: ",s);for(let a=0;a<t[s].length;a++){let l=t[s][a];l.getValue().length===0?i.format("        ",null):i.format("%4d(%2d)",l.getValue()[0],l.getConfidence(l.getValue()[0]))}i.format("%n")}return i.toString()}}pe.CODEWORD_SKEW_SIZE=2,pe.MAX_ERRORS=3,pe.MAX_EC_CODEWORDS=512,pe.errorCorrection=new Ic;class wt{decode(t,i=null){let s=wt.decode(t,i,!1);if(s==null||s.length===0||s[0]==null)throw M.getNotFoundInstance();return s[0]}decodeMultiple(t,i=null){try{return wt.decode(t,i,!0)}catch(s){throw s instanceof V||s instanceof H?M.getNotFoundInstance():s}}static decode(t,i,s){const a=new Array,l=ge.detectMultiple(t,i,s);for(const u of l.getPoints()){const f=pe.decode(l.getBits(),u[4],u[5],u[6],u[7],wt.getMinCodewordWidth(u),wt.getMaxCodewordWidth(u)),d=new Lt(f.getText(),f.getRawBytes(),void 0,u,te.PDF_417);d.putMetadata(ct.ERROR_CORRECTION_LEVEL,f.getECLevel());const g=f.getOther();g!=null&&d.putMetadata(ct.PDF417_EXTRA_METADATA,g),a.push(d)}return a.map(u=>u)}static getMaxWidth(t,i){return t==null||i==null?0:Math.trunc(Math.abs(t.getX()-i.getX()))}static getMinWidth(t,i){return t==null||i==null?Y.MAX_VALUE:Math.trunc(Math.abs(t.getX()-i.getX()))}static getMaxCodewordWidth(t){return Math.floor(Math.max(Math.max(wt.getMaxWidth(t[0],t[4]),wt.getMaxWidth(t[6],t[2])*se.MODULES_IN_CODEWORD/se.MODULES_IN_STOP_PATTERN),Math.max(wt.getMaxWidth(t[1],t[5]),wt.getMaxWidth(t[7],t[3])*se.MODULES_IN_CODEWORD/se.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(t){return Math.floor(Math.min(Math.min(wt.getMinWidth(t[0],t[4]),wt.getMinWidth(t[6],t[2])*se.MODULES_IN_CODEWORD/se.MODULES_IN_STOP_PATTERN),Math.min(wt.getMinWidth(t[1],t[5]),wt.getMinWidth(t[7],t[3])*se.MODULES_IN_CODEWORD/se.MODULES_IN_STOP_PATTERN)))}reset(){}}class Os extends m{}Os.kind="ReaderException";class Sc{constructor(t,i){this.verbose=t===!0,i&&this.setHints(i)}decode(t,i){return i&&this.setHints(i),this.decodeInternal(t)}decodeWithState(t){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(t)}setHints(t){this.hints=t;const i=!o(t)&&t.get(de.TRY_HARDER)===!0,s=o(t)?null:t.get(de.POSSIBLE_FORMATS),a=new Array;if(!o(s)){const l=s.some(u=>u===te.UPC_A||u===te.UPC_E||u===te.EAN_13||u===te.EAN_8||u===te.CODABAR||u===te.CODE_39||u===te.CODE_93||u===te.CODE_128||u===te.ITF||u===te.RSS_14||u===te.RSS_EXPANDED);l&&!i&&a.push(new Or(t,this.verbose)),s.includes(te.QR_CODE)&&a.push(new Vn),s.includes(te.DATA_MATRIX)&&a.push(new Un),s.includes(te.AZTEC)&&a.push(new Ts),s.includes(te.PDF_417)&&a.push(new wt),l&&i&&a.push(new Or(t,this.verbose))}a.length===0&&(i||a.push(new Or(t,this.verbose)),a.push(new Vn),a.push(new Un),a.push(new Ts),a.push(new wt),i&&a.push(new Or(t,this.verbose))),this.readers=a}reset(){if(this.readers!==null)for(const t of this.readers)t.reset()}decodeInternal(t){if(this.readers===null)throw new Os("No readers where selected, nothing can be read.");for(const i of this.readers)try{return i.decode(t,this.hints)}catch(s){if(s instanceof Os)continue}throw new M("No MultiFormat Readers were able to detect the code.")}}class m0 extends nr{constructor(t=null,i=500){const s=new Sc;s.setHints(t),super(s,i)}decodeBitmap(t){return this.reader.decodeWithState(t)}}class x0 extends nr{constructor(t=500){super(new wt,t)}}class w0 extends nr{constructor(t=500){super(new Vn,t)}}var ga;(function(E){E[E.ERROR_CORRECTION=0]="ERROR_CORRECTION",E[E.CHARACTER_SET=1]="CHARACTER_SET",E[E.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",E[E.MIN_SIZE=3]="MIN_SIZE",E[E.MAX_SIZE=4]="MAX_SIZE",E[E.MARGIN=5]="MARGIN",E[E.PDF417_COMPACT=6]="PDF417_COMPACT",E[E.PDF417_COMPACTION=7]="PDF417_COMPACTION",E[E.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",E[E.AZTEC_LAYERS=9]="AZTEC_LAYERS",E[E.QR_VERSION=10]="QR_VERSION"})(ga||(ga={}));var ot=ga;class pa{constructor(t){this.field=t,this.cachedGenerators=[],this.cachedGenerators.push(new Gt(t,Int32Array.from([1])))}buildGenerator(t){const i=this.cachedGenerators;if(t>=i.length){let s=i[i.length-1];const a=this.field;for(let l=i.length;l<=t;l++){const u=s.multiply(new Gt(a,Int32Array.from([1,a.exp(l-1+a.getGeneratorBase())])));i.push(u),s=u}}return i[t]}encode(t,i){if(i===0)throw new _("No error correction bytes");const s=t.length-i;if(s<=0)throw new _("No data bytes provided");const a=this.buildGenerator(i),l=new Int32Array(s);j.arraycopy(t,0,l,0,s);let u=new Gt(this.field,l);u=u.multiplyByMonomial(i,1);const d=u.divide(a)[1].getCoefficients(),g=i-d.length;for(let x=0;x<g;x++)t[s+x]=0;j.arraycopy(d,0,t,s+g,d.length)}}class Ze{constructor(){}static applyMaskPenaltyRule1(t){return Ze.applyMaskPenaltyRule1Internal(t,!0)+Ze.applyMaskPenaltyRule1Internal(t,!1)}static applyMaskPenaltyRule2(t){let i=0;const s=t.getArray(),a=t.getWidth(),l=t.getHeight();for(let u=0;u<l-1;u++){const f=s[u];for(let d=0;d<a-1;d++){const g=f[d];g===f[d+1]&&g===s[u+1][d]&&g===s[u+1][d+1]&&i++}}return Ze.N2*i}static applyMaskPenaltyRule3(t){let i=0;const s=t.getArray(),a=t.getWidth(),l=t.getHeight();for(let u=0;u<l;u++)for(let f=0;f<a;f++){const d=s[u];f+6<a&&d[f]===1&&d[f+1]===0&&d[f+2]===1&&d[f+3]===1&&d[f+4]===1&&d[f+5]===0&&d[f+6]===1&&(Ze.isWhiteHorizontal(d,f-4,f)||Ze.isWhiteHorizontal(d,f+7,f+11))&&i++,u+6<l&&s[u][f]===1&&s[u+1][f]===0&&s[u+2][f]===1&&s[u+3][f]===1&&s[u+4][f]===1&&s[u+5][f]===0&&s[u+6][f]===1&&(Ze.isWhiteVertical(s,f,u-4,u)||Ze.isWhiteVertical(s,f,u+7,u+11))&&i++}return i*Ze.N3}static isWhiteHorizontal(t,i,s){i=Math.max(i,0),s=Math.min(s,t.length);for(let a=i;a<s;a++)if(t[a]===1)return!1;return!0}static isWhiteVertical(t,i,s,a){s=Math.max(s,0),a=Math.min(a,t.length);for(let l=s;l<a;l++)if(t[l][i]===1)return!1;return!0}static applyMaskPenaltyRule4(t){let i=0;const s=t.getArray(),a=t.getWidth(),l=t.getHeight();for(let d=0;d<l;d++){const g=s[d];for(let x=0;x<a;x++)g[x]===1&&i++}const u=t.getHeight()*t.getWidth();return Math.floor(Math.abs(i*2-u)*10/u)*Ze.N4}static getDataMaskBit(t,i,s){let a,l;switch(t){case 0:a=s+i&1;break;case 1:a=s&1;break;case 2:a=i%3;break;case 3:a=(s+i)%3;break;case 4:a=Math.floor(s/2)+Math.floor(i/3)&1;break;case 5:l=s*i,a=(l&1)+l%3;break;case 6:l=s*i,a=(l&1)+l%3&1;break;case 7:l=s*i,a=l%3+(s+i&1)&1;break;default:throw new _("Invalid mask pattern: "+t)}return a===0}static applyMaskPenaltyRule1Internal(t,i){let s=0;const a=i?t.getHeight():t.getWidth(),l=i?t.getWidth():t.getHeight(),u=t.getArray();for(let f=0;f<a;f++){let d=0,g=-1;for(let x=0;x<l;x++){const y=i?u[f][x]:u[x][f];y===g?d++:(d>=5&&(s+=Ze.N1+(d-5)),d=1,g=y)}d>=5&&(s+=Ze.N1+(d-5))}return s}}Ze.N1=3,Ze.N2=3,Ze.N3=40,Ze.N4=10;class Ds{constructor(t,i){this.width=t,this.height=i;const s=new Array(i);for(let a=0;a!==i;a++)s[a]=new Uint8Array(t);this.bytes=s}getHeight(){return this.height}getWidth(){return this.width}get(t,i){return this.bytes[i][t]}getArray(){return this.bytes}setNumber(t,i,s){this.bytes[i][t]=s}setBoolean(t,i,s){this.bytes[i][t]=s?1:0}clear(t){for(const i of this.bytes)he.fill(i,t)}equals(t){if(!(t instanceof Ds))return!1;const i=t;if(this.width!==i.width||this.height!==i.height)return!1;for(let s=0,a=this.height;s<a;++s){const l=this.bytes[s],u=i.bytes[s];for(let f=0,d=this.width;f<d;++f)if(l[f]!==u[f])return!1}return!0}toString(){const t=new le;for(let i=0,s=this.height;i<s;++i){const a=this.bytes[i];for(let l=0,u=this.width;l<u;++l)switch(a[l]){case 0:t.append(" 0");break;case 1:t.append(" 1");break;default:t.append("  ");break}t.append(`
`)}return t.toString()}}class ar{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const t=new le;return t.append(`<<
`),t.append(" mode: "),t.append(this.mode?this.mode.toString():"null"),t.append(`
 ecLevel: `),t.append(this.ecLevel?this.ecLevel.toString():"null"),t.append(`
 version: `),t.append(this.version?this.version.toString():"null"),t.append(`
 maskPattern: `),t.append(this.maskPattern.toString()),this.matrix?(t.append(`
 matrix:
`),t.append(this.matrix.toString())):t.append(`
 matrix: null
`),t.append(`>>
`),t.toString()}setMode(t){this.mode=t}setECLevel(t){this.ecLevel=t}setVersion(t){this.version=t}setMaskPattern(t){this.maskPattern=t}setMatrix(t){this.matrix=t}static isValidMaskPattern(t){return t>=0&&t<ar.NUM_MASK_PATTERNS}}ar.NUM_MASK_PATTERNS=8;class Pe extends m{}Pe.kind="WriterException";class ne{constructor(){}static clearMatrix(t){t.clear(255)}static buildMatrix(t,i,s,a,l){ne.clearMatrix(l),ne.embedBasicPatterns(s,l),ne.embedTypeInfo(i,a,l),ne.maybeEmbedVersionInfo(s,l),ne.embedDataBits(t,a,l)}static embedBasicPatterns(t,i){ne.embedPositionDetectionPatternsAndSeparators(i),ne.embedDarkDotAtLeftBottomCorner(i),ne.maybeEmbedPositionAdjustmentPatterns(t,i),ne.embedTimingPatterns(i)}static embedTypeInfo(t,i,s){const a=new fe;ne.makeTypeInfoBits(t,i,a);for(let l=0,u=a.getSize();l<u;++l){const f=a.get(a.getSize()-1-l),d=ne.TYPE_INFO_COORDINATES[l],g=d[0],x=d[1];if(s.setBoolean(g,x,f),l<8){const y=s.getWidth()-l-1,I=8;s.setBoolean(y,I,f)}else{const I=s.getHeight()-7+(l-8);s.setBoolean(8,I,f)}}}static maybeEmbedVersionInfo(t,i){if(t.getVersionNumber()<7)return;const s=new fe;ne.makeVersionInfoBits(t,s);let a=6*3-1;for(let l=0;l<6;++l)for(let u=0;u<3;++u){const f=s.get(a);a--,i.setBoolean(l,i.getHeight()-11+u,f),i.setBoolean(i.getHeight()-11+u,l,f)}}static embedDataBits(t,i,s){let a=0,l=-1,u=s.getWidth()-1,f=s.getHeight()-1;for(;u>0;){for(u===6&&(u-=1);f>=0&&f<s.getHeight();){for(let d=0;d<2;++d){const g=u-d;if(!ne.isEmpty(s.get(g,f)))continue;let x;a<t.getSize()?(x=t.get(a),++a):x=!1,i!==255&&Ze.getDataMaskBit(i,g,f)&&(x=!x),s.setBoolean(g,f,x)}f+=l}l=-l,f+=l,u-=2}if(a!==t.getSize())throw new Pe("Not all bits consumed: "+a+"/"+t.getSize())}static findMSBSet(t){return 32-Y.numberOfLeadingZeros(t)}static calculateBCHCode(t,i){if(i===0)throw new _("0 polynomial");const s=ne.findMSBSet(i);for(t<<=s-1;ne.findMSBSet(t)>=s;)t^=i<<ne.findMSBSet(t)-s;return t}static makeTypeInfoBits(t,i,s){if(!ar.isValidMaskPattern(i))throw new Pe("Invalid mask pattern");const a=t.getBits()<<3|i;s.appendBits(a,5);const l=ne.calculateBCHCode(a,ne.TYPE_INFO_POLY);s.appendBits(l,10);const u=new fe;if(u.appendBits(ne.TYPE_INFO_MASK_PATTERN,15),s.xor(u),s.getSize()!==15)throw new Pe("should not happen but we got: "+s.getSize())}static makeVersionInfoBits(t,i){i.appendBits(t.getVersionNumber(),6);const s=ne.calculateBCHCode(t.getVersionNumber(),ne.VERSION_INFO_POLY);if(i.appendBits(s,12),i.getSize()!==18)throw new Pe("should not happen but we got: "+i.getSize())}static isEmpty(t){return t===255}static embedTimingPatterns(t){for(let i=8;i<t.getWidth()-8;++i){const s=(i+1)%2;ne.isEmpty(t.get(i,6))&&t.setNumber(i,6,s),ne.isEmpty(t.get(6,i))&&t.setNumber(6,i,s)}}static embedDarkDotAtLeftBottomCorner(t){if(t.get(8,t.getHeight()-8)===0)throw new Pe;t.setNumber(8,t.getHeight()-8,1)}static embedHorizontalSeparationPattern(t,i,s){for(let a=0;a<8;++a){if(!ne.isEmpty(s.get(t+a,i)))throw new Pe;s.setNumber(t+a,i,0)}}static embedVerticalSeparationPattern(t,i,s){for(let a=0;a<7;++a){if(!ne.isEmpty(s.get(t,i+a)))throw new Pe;s.setNumber(t,i+a,0)}}static embedPositionAdjustmentPattern(t,i,s){for(let a=0;a<5;++a){const l=ne.POSITION_ADJUSTMENT_PATTERN[a];for(let u=0;u<5;++u)s.setNumber(t+u,i+a,l[u])}}static embedPositionDetectionPattern(t,i,s){for(let a=0;a<7;++a){const l=ne.POSITION_DETECTION_PATTERN[a];for(let u=0;u<7;++u)s.setNumber(t+u,i+a,l[u])}}static embedPositionDetectionPatternsAndSeparators(t){const i=ne.POSITION_DETECTION_PATTERN[0].length;ne.embedPositionDetectionPattern(0,0,t),ne.embedPositionDetectionPattern(t.getWidth()-i,0,t),ne.embedPositionDetectionPattern(0,t.getWidth()-i,t);const s=8;ne.embedHorizontalSeparationPattern(0,s-1,t),ne.embedHorizontalSeparationPattern(t.getWidth()-s,s-1,t),ne.embedHorizontalSeparationPattern(0,t.getWidth()-s,t);const a=7;ne.embedVerticalSeparationPattern(a,0,t),ne.embedVerticalSeparationPattern(t.getHeight()-a-1,0,t),ne.embedVerticalSeparationPattern(a,t.getHeight()-a,t)}static maybeEmbedPositionAdjustmentPatterns(t,i){if(t.getVersionNumber()<2)return;const s=t.getVersionNumber()-1,a=ne.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[s];for(let l=0,u=a.length;l!==u;l++){const f=a[l];if(f>=0)for(let d=0;d!==u;d++){const g=a[d];g>=0&&ne.isEmpty(i.get(g,f))&&ne.embedPositionAdjustmentPattern(g-2,f-2,i)}}}}ne.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),ne.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),ne.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),ne.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),ne.VERSION_INFO_POLY=7973,ne.TYPE_INFO_POLY=1335,ne.TYPE_INFO_MASK_PATTERN=21522;class E0{constructor(t,i){this.dataBytes=t,this.errorCorrectionBytes=i}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class He{constructor(){}static calculateMaskPenalty(t){return Ze.applyMaskPenaltyRule1(t)+Ze.applyMaskPenaltyRule2(t)+Ze.applyMaskPenaltyRule3(t)+Ze.applyMaskPenaltyRule4(t)}static encode(t,i,s=null){let a=He.DEFAULT_BYTE_MODE_ENCODING;const l=s!==null&&s.get(ot.CHARACTER_SET)!==void 0;l&&(a=s.get(ot.CHARACTER_SET).toString());const u=this.chooseMode(t,a),f=new fe;if(u===ee.BYTE&&(l||He.DEFAULT_BYTE_MODE_ENCODING!==a)){const U=B.getCharacterSetECIByName(a);U!==void 0&&this.appendECI(U,f)}this.appendModeInfo(u,f);const d=new fe;this.appendBytes(t,u,d,a);let g;if(s!==null&&s.get(ot.QR_VERSION)!==void 0){const U=Number.parseInt(s.get(ot.QR_VERSION).toString(),10);g=J.getVersionForNumber(U);const L=this.calculateBitsNeeded(u,f,d,g);if(!this.willFit(L,g,i))throw new Pe("Data too big for requested version")}else g=this.recommendVersion(i,u,f,d);const x=new fe;x.appendBitArray(f);const y=u===ee.BYTE?d.getSizeInBytes():t.length;this.appendLengthInfo(y,g,u,x),x.appendBitArray(d);const I=g.getECBlocksForLevel(i),T=g.getTotalCodewords()-I.getTotalECCodewords();this.terminateBits(T,x);const v=this.interleaveWithECBytes(x,g.getTotalCodewords(),T,I.getNumBlocks()),S=new ar;S.setECLevel(i),S.setMode(u),S.setVersion(g);const N=g.getDimensionForVersion(),D=new Ds(N,N),F=this.chooseMaskPattern(v,i,g,D);return S.setMaskPattern(F),ne.buildMatrix(v,i,g,F,D),S.setMatrix(D),S}static recommendVersion(t,i,s,a){const l=this.calculateBitsNeeded(i,s,a,J.getVersionForNumber(1)),u=this.chooseVersion(l,t),f=this.calculateBitsNeeded(i,s,a,u);return this.chooseVersion(f,t)}static calculateBitsNeeded(t,i,s,a){return i.getSize()+t.getCharacterCountBits(a)+s.getSize()}static getAlphanumericCode(t){return t<He.ALPHANUMERIC_TABLE.length?He.ALPHANUMERIC_TABLE[t]:-1}static chooseMode(t,i=null){if(B.SJIS.getName()===i&&this.isOnlyDoubleByteKanji(t))return ee.KANJI;let s=!1,a=!1;for(let l=0,u=t.length;l<u;++l){const f=t.charAt(l);if(He.isDigit(f))s=!0;else if(this.getAlphanumericCode(f.charCodeAt(0))!==-1)a=!0;else return ee.BYTE}return a?ee.ALPHANUMERIC:s?ee.NUMERIC:ee.BYTE}static isOnlyDoubleByteKanji(t){let i;try{i=lt.encode(t,B.SJIS)}catch{return!1}const s=i.length;if(s%2!==0)return!1;for(let a=0;a<s;a+=2){const l=i[a]&255;if((l<129||l>159)&&(l<224||l>235))return!1}return!0}static chooseMaskPattern(t,i,s,a){let l=Number.MAX_SAFE_INTEGER,u=-1;for(let f=0;f<ar.NUM_MASK_PATTERNS;f++){ne.buildMatrix(t,i,s,f,a);let d=this.calculateMaskPenalty(a);d<l&&(l=d,u=f)}return u}static chooseVersion(t,i){for(let s=1;s<=40;s++){const a=J.getVersionForNumber(s);if(He.willFit(t,a,i))return a}throw new Pe("Data too big")}static willFit(t,i,s){const a=i.getTotalCodewords(),u=i.getECBlocksForLevel(s).getTotalECCodewords(),f=a-u,d=(t+7)/8;return f>=d}static terminateBits(t,i){const s=t*8;if(i.getSize()>s)throw new Pe("data bits cannot fit in the QR Code"+i.getSize()+" > "+s);for(let u=0;u<4&&i.getSize()<s;++u)i.appendBit(!1);const a=i.getSize()&7;if(a>0)for(let u=a;u<8;u++)i.appendBit(!1);const l=t-i.getSizeInBytes();for(let u=0;u<l;++u)i.appendBits((u&1)===0?236:17,8);if(i.getSize()!==s)throw new Pe("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(t,i,s,a,l,u){if(a>=s)throw new Pe("Block ID too large");const f=t%s,d=s-f,g=Math.floor(t/s),x=g+1,y=Math.floor(i/s),I=y+1,T=g-y,v=x-I;if(T!==v)throw new Pe("EC bytes mismatch");if(s!==d+f)throw new Pe("RS blocks mismatch");if(t!==(y+T)*d+(I+v)*f)throw new Pe("Total bytes mismatch");a<d?(l[0]=y,u[0]=T):(l[0]=I,u[0]=v)}static interleaveWithECBytes(t,i,s,a){if(t.getSizeInBytes()!==s)throw new Pe("Number of bits and data bytes does not match");let l=0,u=0,f=0;const d=new Array;for(let x=0;x<a;++x){const y=new Int32Array(1),I=new Int32Array(1);He.getNumDataBytesAndNumECBytesForBlockID(i,s,a,x,y,I);const T=y[0],v=new Uint8Array(T);t.toBytes(8*l,v,0,T);const S=He.generateECBytes(v,I[0]);d.push(new E0(v,S)),u=Math.max(u,T),f=Math.max(f,S.length),l+=y[0]}if(s!==l)throw new Pe("Data bytes does not match offset");const g=new fe;for(let x=0;x<u;++x)for(const y of d){const I=y.getDataBytes();x<I.length&&g.appendBits(I[x],8)}for(let x=0;x<f;++x)for(const y of d){const I=y.getErrorCorrectionBytes();x<I.length&&g.appendBits(I[x],8)}if(i!==g.getSizeInBytes())throw new Pe("Interleaving error: "+i+" and "+g.getSizeInBytes()+" differ.");return g}static generateECBytes(t,i){const s=t.length,a=new Int32Array(s+i);for(let u=0;u<s;u++)a[u]=t[u]&255;new pa(ve.QR_CODE_FIELD_256).encode(a,i);const l=new Uint8Array(i);for(let u=0;u<i;u++)l[u]=a[s+u];return l}static appendModeInfo(t,i){i.appendBits(t.getBits(),4)}static appendLengthInfo(t,i,s,a){const l=s.getCharacterCountBits(i);if(t>=1<<l)throw new Pe(t+" is bigger than "+((1<<l)-1));a.appendBits(t,l)}static appendBytes(t,i,s,a){switch(i){case ee.NUMERIC:He.appendNumericBytes(t,s);break;case ee.ALPHANUMERIC:He.appendAlphanumericBytes(t,s);break;case ee.BYTE:He.append8BitBytes(t,s,a);break;case ee.KANJI:He.appendKanjiBytes(t,s);break;default:throw new Pe("Invalid mode: "+i)}}static getDigit(t){return t.charCodeAt(0)-48}static isDigit(t){const i=He.getDigit(t);return i>=0&&i<=9}static appendNumericBytes(t,i){const s=t.length;let a=0;for(;a<s;){const l=He.getDigit(t.charAt(a));if(a+2<s){const u=He.getDigit(t.charAt(a+1)),f=He.getDigit(t.charAt(a+2));i.appendBits(l*100+u*10+f,10),a+=3}else if(a+1<s){const u=He.getDigit(t.charAt(a+1));i.appendBits(l*10+u,7),a+=2}else i.appendBits(l,4),a++}}static appendAlphanumericBytes(t,i){const s=t.length;let a=0;for(;a<s;){const l=He.getAlphanumericCode(t.charCodeAt(a));if(l===-1)throw new Pe;if(a+1<s){const u=He.getAlphanumericCode(t.charCodeAt(a+1));if(u===-1)throw new Pe;i.appendBits(l*45+u,11),a+=2}else i.appendBits(l,6),a++}}static append8BitBytes(t,i,s){let a;try{a=lt.encode(t,s)}catch(l){throw new Pe(l)}for(let l=0,u=a.length;l!==u;l++){const f=a[l];i.appendBits(f,8)}}static appendKanjiBytes(t,i){let s;try{s=lt.encode(t,B.SJIS)}catch(l){throw new Pe(l)}const a=s.length;for(let l=0;l<a;l+=2){const u=s[l]&255,f=s[l+1]&255,d=u<<8&4294967295|f;let g=-1;if(d>=33088&&d<=40956?g=d-33088:d>=57408&&d<=60351&&(g=d-49472),g===-1)throw new Pe("Invalid byte sequence");const x=(g>>8)*192+(g&255);i.appendBits(x,13)}}static appendECI(t,i){i.appendBits(ee.ECI.getBits(),4),i.appendBits(t.getValue(),8)}}He.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),He.DEFAULT_BYTE_MODE_ENCODING=B.UTF8.getName();class lr{write(t,i,s,a=null){if(t.length===0)throw new _("Found empty contents");if(i<0||s<0)throw new _("Requested dimensions are too small: "+i+"x"+s);let l=Ue.L,u=lr.QUIET_ZONE_SIZE;a!==null&&(a.get(ot.ERROR_CORRECTION)!==void 0&&(l=Ue.fromString(a.get(ot.ERROR_CORRECTION).toString())),a.get(ot.MARGIN)!==void 0&&(u=Number.parseInt(a.get(ot.MARGIN).toString(),10)));const f=He.encode(t,l,a);return this.renderResult(f,i,s,u)}writeToDom(t,i,s,a,l=null){typeof t=="string"&&(t=document.querySelector(t));const u=this.write(i,s,a,l);t&&t.appendChild(u)}renderResult(t,i,s,a){const l=t.getMatrix();if(l===null)throw new hn;const u=l.getWidth(),f=l.getHeight(),d=u+a*2,g=f+a*2,x=Math.max(i,d),y=Math.max(s,g),I=Math.min(Math.floor(x/d),Math.floor(y/g)),T=Math.floor((x-u*I)/2),v=Math.floor((y-f*I)/2),S=this.createSVGElement(x,y);for(let N=0,D=v;N<f;N++,D+=I)for(let F=0,U=T;F<u;F++,U+=I)if(l.get(F,N)===1){const L=this.createSvgRectElement(U,D,I,I);S.appendChild(L)}return S}createSVGElement(t,i){const s=document.createElementNS(lr.SVG_NS,"svg");return s.setAttributeNS(null,"height",t.toString()),s.setAttributeNS(null,"width",i.toString()),s}createSvgRectElement(t,i,s,a){const l=document.createElementNS(lr.SVG_NS,"rect");return l.setAttributeNS(null,"x",t.toString()),l.setAttributeNS(null,"y",i.toString()),l.setAttributeNS(null,"height",s.toString()),l.setAttributeNS(null,"width",a.toString()),l.setAttributeNS(null,"fill","#000000"),l}}lr.QUIET_ZONE_SIZE=4,lr.SVG_NS="http://www.w3.org/2000/svg";class Mr{encode(t,i,s,a,l){if(t.length===0)throw new _("Found empty contents");if(i!==te.QR_CODE)throw new _("Can only encode QR_CODE, but got "+i);if(s<0||a<0)throw new _(`Requested dimensions are too small: ${s}x${a}`);let u=Ue.L,f=Mr.QUIET_ZONE_SIZE;l!==null&&(l.get(ot.ERROR_CORRECTION)!==void 0&&(u=Ue.fromString(l.get(ot.ERROR_CORRECTION).toString())),l.get(ot.MARGIN)!==void 0&&(f=Number.parseInt(l.get(ot.MARGIN).toString(),10)));const d=He.encode(t,u,l);return Mr.renderResult(d,s,a,f)}static renderResult(t,i,s,a){const l=t.getMatrix();if(l===null)throw new hn;const u=l.getWidth(),f=l.getHeight(),d=u+a*2,g=f+a*2,x=Math.max(i,d),y=Math.max(s,g),I=Math.min(Math.floor(x/d),Math.floor(y/g)),T=Math.floor((x-u*I)/2),v=Math.floor((y-f*I)/2),S=new _e(x,y);for(let N=0,D=v;N<f;N++,D+=I)for(let F=0,U=T;F<u;F++,U+=I)l.get(F,N)===1&&S.setRegion(U,D,I,I);return S}}Mr.QUIET_ZONE_SIZE=4;class y0{encode(t,i,s,a,l){let u;switch(i){case te.QR_CODE:u=new Mr;break;default:throw new _("No encoder available for format "+i)}return u.encode(t,i,s,a,l)}}class pn extends Ht{constructor(t,i,s,a,l,u,f,d){if(super(u,f),this.yuvData=t,this.dataWidth=i,this.dataHeight=s,this.left=a,this.top=l,a+u>i||l+f>s)throw new _("Crop rectangle does not fit within image data.");d&&this.reverseHorizontal(u,f)}getRow(t,i){if(t<0||t>=this.getHeight())throw new _("Requested row is outside the image: "+t);const s=this.getWidth();(i==null||i.length<s)&&(i=new Uint8ClampedArray(s));const a=(t+this.top)*this.dataWidth+this.left;return j.arraycopy(this.yuvData,a,i,0,s),i}getMatrix(){const t=this.getWidth(),i=this.getHeight();if(t===this.dataWidth&&i===this.dataHeight)return this.yuvData;const s=t*i,a=new Uint8ClampedArray(s);let l=this.top*this.dataWidth+this.left;if(t===this.dataWidth)return j.arraycopy(this.yuvData,l,a,0,s),a;for(let u=0;u<i;u++){const f=u*t;j.arraycopy(this.yuvData,l,a,f,t),l+=this.dataWidth}return a}isCropSupported(){return!0}crop(t,i,s,a){return new pn(this.yuvData,this.dataWidth,this.dataHeight,this.left+t,this.top+i,s,a,!1)}renderThumbnail(){const t=this.getWidth()/pn.THUMBNAIL_SCALE_FACTOR,i=this.getHeight()/pn.THUMBNAIL_SCALE_FACTOR,s=new Int32Array(t*i),a=this.yuvData;let l=this.top*this.dataWidth+this.left;for(let u=0;u<i;u++){const f=u*t;for(let d=0;d<t;d++){const g=a[l+d*pn.THUMBNAIL_SCALE_FACTOR]&255;s[f+d]=4278190080|g*65793}l+=this.dataWidth*pn.THUMBNAIL_SCALE_FACTOR}return s}getThumbnailWidth(){return this.getWidth()/pn.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/pn.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(t,i){const s=this.yuvData;for(let a=0,l=this.top*this.dataWidth+this.left;a<i;a++,l+=this.dataWidth){const u=l+t/2;for(let f=l,d=l+t-1;f<u;f++,d--){const g=s[f];s[f]=s[d],s[d]=g}}}invert(){return new kn(this)}}pn.THUMBNAIL_SCALE_FACTOR=2;class ma extends Ht{constructor(t,i,s,a,l,u,f){if(super(i,s),this.dataWidth=a,this.dataHeight=l,this.left=u,this.top=f,t.BYTES_PER_ELEMENT===4){const d=i*s,g=new Uint8ClampedArray(d);for(let x=0;x<d;x++){const y=t[x],I=y>>16&255,T=y>>7&510,v=y&255;g[x]=(I+T+v)/4&255}this.luminances=g}else this.luminances=t;if(a===void 0&&(this.dataWidth=i),l===void 0&&(this.dataHeight=s),u===void 0&&(this.left=0),f===void 0&&(this.top=0),this.left+i>this.dataWidth||this.top+s>this.dataHeight)throw new _("Crop rectangle does not fit within image data.")}getRow(t,i){if(t<0||t>=this.getHeight())throw new _("Requested row is outside the image: "+t);const s=this.getWidth();(i==null||i.length<s)&&(i=new Uint8ClampedArray(s));const a=(t+this.top)*this.dataWidth+this.left;return j.arraycopy(this.luminances,a,i,0,s),i}getMatrix(){const t=this.getWidth(),i=this.getHeight();if(t===this.dataWidth&&i===this.dataHeight)return this.luminances;const s=t*i,a=new Uint8ClampedArray(s);let l=this.top*this.dataWidth+this.left;if(t===this.dataWidth)return j.arraycopy(this.luminances,l,a,0,s),a;for(let u=0;u<i;u++){const f=u*t;j.arraycopy(this.luminances,l,a,f,t),l+=this.dataWidth}return a}isCropSupported(){return!0}crop(t,i,s,a){return new ma(this.luminances,s,a,this.dataWidth,this.dataHeight,this.left+t,this.top+i)}invert(){return new kn(this)}}class Nc extends B{static forName(t){return this.getCharacterSetECIByName(t)}}class xa{}xa.ISO_8859_1=B.ISO8859_1;class Rc{isCompact(){return this.compact}setCompact(t){this.compact=t}getSize(){return this.size}setSize(t){this.size=t}getLayers(){return this.layers}setLayers(t){this.layers=t}getCodeWords(){return this.codeWords}setCodeWords(t){this.codeWords=t}getMatrix(){return this.matrix}setMatrix(t){this.matrix=t}}class Oc{static singletonList(t){return[t]}static min(t,i){return t.sort(i)[0]}}class A0{constructor(t){this.previous=t}getPrevious(){return this.previous}}class kr extends A0{constructor(t,i,s){super(t),this.value=i,this.bitCount=s}appendTo(t,i){t.appendBits(this.value,this.bitCount)}add(t,i){return new kr(this,t,i)}addBinaryShift(t,i){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new kr(this,t,i)}toString(){let t=this.value&(1<<this.bitCount)-1;return t|=1<<this.bitCount,"<"+Y.toBinaryString(t|1<<this.bitCount).substring(1)+">"}}class wa extends kr{constructor(t,i,s){super(t,0,0),this.binaryShiftStart=i,this.binaryShiftByteCount=s}appendTo(t,i){for(let s=0;s<this.binaryShiftByteCount;s++)(s===0||s===31&&this.binaryShiftByteCount<=62)&&(t.appendBits(31,5),this.binaryShiftByteCount>62?t.appendBits(this.binaryShiftByteCount-31,16):s===0?t.appendBits(Math.min(this.binaryShiftByteCount,31),5):t.appendBits(this.binaryShiftByteCount-31,5)),t.appendBits(i[this.binaryShiftStart+s],8)}addBinaryShift(t,i){return new wa(this,t,i)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function I0(E,t,i){return new wa(E,t,i)}function Ei(E,t,i){return new kr(E,t,i)}const C0=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],Gn=0,Ms=1,tn=2,Dc=3,mn=4,b0=new kr(null,0,0),Ea=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,(10<<16)+(29<<5)+30]),Int32Array.from([(9<<16)+(30<<4)+14,0,(5<<16)+30,(5<<16)+29,(10<<16)+(29<<5)+30]),Int32Array.from([(4<<16)+14,(9<<16)+(14<<5)+28,0,(9<<16)+(14<<5)+29,(14<<16)+(14<<10)+(29<<5)+30]),Int32Array.from([(5<<16)+29,(5<<16)+28,(10<<16)+(29<<5)+30,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,(10<<16)+(31<<5)+28,(10<<16)+(31<<5)+30,(10<<16)+(31<<5)+29,0])];function T0(E){for(let t of E)he.fill(t,-1);return E[Gn][mn]=0,E[Ms][mn]=0,E[Ms][Gn]=28,E[Dc][mn]=0,E[tn][mn]=0,E[tn][Gn]=15,E}const Mc=T0(he.createInt32Array(6,6));class xn{constructor(t,i,s,a){this.token=t,this.mode=i,this.binaryShiftByteCount=s,this.bitCount=a}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(t,i){let s=this.bitCount,a=this.token;if(t!==this.mode){let u=Ea[this.mode][t];a=Ei(a,u&65535,u>>16),s+=u>>16}let l=t===tn?4:5;return a=Ei(a,i,l),new xn(a,t,0,s+l)}shiftAndAppend(t,i){let s=this.token,a=this.mode===tn?4:5;return s=Ei(s,Mc[this.mode][t],a),s=Ei(s,i,5),new xn(s,this.mode,0,this.bitCount+a+5)}addBinaryShiftChar(t){let i=this.token,s=this.mode,a=this.bitCount;if(this.mode===mn||this.mode===tn){let f=Ea[s][Gn];i=Ei(i,f&65535,f>>16),a+=f>>16,s=Gn}let l=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,u=new xn(i,s,this.binaryShiftByteCount+1,a+l);return u.binaryShiftByteCount===2047+31&&(u=u.endBinaryShift(t+1)),u}endBinaryShift(t){if(this.binaryShiftByteCount===0)return this;let i=this.token;return i=I0(i,t-this.binaryShiftByteCount,this.binaryShiftByteCount),new xn(i,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(t){let i=this.bitCount+(Ea[this.mode][t.mode]>>16);return this.binaryShiftByteCount<t.binaryShiftByteCount?i+=xn.calculateBinaryShiftCost(t)-xn.calculateBinaryShiftCost(this):this.binaryShiftByteCount>t.binaryShiftByteCount&&t.binaryShiftByteCount>0&&(i+=10),i<=t.bitCount}toBitArray(t){let i=[];for(let a=this.endBinaryShift(t.length).token;a!==null;a=a.getPrevious())i.unshift(a);let s=new fe;for(const a of i)a.appendTo(s,t);return s}toString(){return ie.format("%s bits=%d bytes=%d",C0[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(t){return t.binaryShiftByteCount>62?21:t.binaryShiftByteCount>31?20:t.binaryShiftByteCount>0?10:0}}xn.INITIAL_STATE=new xn(b0,Gn,0,0);function _0(E){const t=ie.getCharCode(" "),i=ie.getCharCode("."),s=ie.getCharCode(",");E[Gn][t]=1;const a=ie.getCharCode("Z"),l=ie.getCharCode("A");for(let I=l;I<=a;I++)E[Gn][I]=I-l+2;E[Ms][t]=1;const u=ie.getCharCode("z"),f=ie.getCharCode("a");for(let I=f;I<=u;I++)E[Ms][I]=I-f+2;E[tn][t]=1;const d=ie.getCharCode("9"),g=ie.getCharCode("0");for(let I=g;I<=d;I++)E[tn][I]=I-g+2;E[tn][s]=12,E[tn][i]=13;const x=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~","\x7F"];for(let I=0;I<x.length;I++)E[Dc][ie.getCharCode(x[I])]=I;const y=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let I=0;I<y.length;I++)ie.getCharCode(y[I])>0&&(E[mn][ie.getCharCode(y[I])]=I);return E}const ya=_0(he.createInt32Array(5,256));class yi{constructor(t){this.text=t}encode(){const t=ie.getCharCode(" "),i=ie.getCharCode(`
`);let s=Oc.singletonList(xn.INITIAL_STATE);for(let l=0;l<this.text.length;l++){let u,f=l+1<this.text.length?this.text[l+1]:0;switch(this.text[l]){case ie.getCharCode("\r"):u=f===i?2:0;break;case ie.getCharCode("."):u=f===t?3:0;break;case ie.getCharCode(","):u=f===t?4:0;break;case ie.getCharCode(":"):u=f===t?5:0;break;default:u=0}u>0?(s=yi.updateStateListForPair(s,l,u),l++):s=this.updateStateListForChar(s,l)}return Oc.min(s,(l,u)=>l.getBitCount()-u.getBitCount()).toBitArray(this.text)}updateStateListForChar(t,i){const s=[];for(let a of t)this.updateStateForChar(a,i,s);return yi.simplifyStates(s)}updateStateForChar(t,i,s){let a=this.text[i]&255,l=ya[t.getMode()][a]>0,u=null;for(let f=0;f<=mn;f++){let d=ya[f][a];if(d>0){if(u==null&&(u=t.endBinaryShift(i)),!l||f===t.getMode()||f===tn){const g=u.latchAndAppend(f,d);s.push(g)}if(!l&&Mc[t.getMode()][f]>=0){const g=u.shiftAndAppend(f,d);s.push(g)}}}if(t.getBinaryShiftByteCount()>0||ya[t.getMode()][a]===0){let f=t.addBinaryShiftChar(i);s.push(f)}}static updateStateListForPair(t,i,s){const a=[];for(let l of t)this.updateStateForPair(l,i,s,a);return this.simplifyStates(a)}static updateStateForPair(t,i,s,a){let l=t.endBinaryShift(i);if(a.push(l.latchAndAppend(mn,s)),t.getMode()!==mn&&a.push(l.shiftAndAppend(mn,s)),s===3||s===4){let u=l.latchAndAppend(tn,16-s).latchAndAppend(tn,1);a.push(u)}if(t.getBinaryShiftByteCount()>0){let u=t.addBinaryShiftChar(i).addBinaryShiftChar(i+1);a.push(u)}}static simplifyStates(t){let i=[];for(const s of t){let a=!0;for(const l of i){if(l.isBetterThanOrEqualTo(s)){a=!1;break}s.isBetterThanOrEqualTo(l)&&(i=i.filter(u=>u!==l))}a&&i.push(s)}return i}}class Te{constructor(){}static encodeBytes(t){return Te.encode(t,Te.DEFAULT_EC_PERCENT,Te.DEFAULT_AZTEC_LAYERS)}static encode(t,i,s){let a=new yi(t).encode(),l=Y.truncDivision(a.getSize()*i,100)+11,u=a.getSize()+l,f,d,g,x,y;if(s!==Te.DEFAULT_AZTEC_LAYERS){if(f=s<0,d=Math.abs(s),d>(f?Te.MAX_NB_BITS_COMPACT:Te.MAX_NB_BITS))throw new _(ie.format("Illegal value %s for layers",s));g=Te.totalBitsInLayer(d,f),x=Te.WORD_SIZE[d];let L=g-g%x;if(y=Te.stuffBits(a,x),y.getSize()+l>L)throw new _("Data to large for user specified layer");if(f&&y.getSize()>x*64)throw new _("Data to large for user specified layer")}else{x=0,y=null;for(let L=0;;L++){if(L>Te.MAX_NB_BITS)throw new _("Data too large for an Aztec code");if(f=L<=3,d=f?L+1:L,g=Te.totalBitsInLayer(d,f),u>g)continue;(y==null||x!==Te.WORD_SIZE[d])&&(x=Te.WORD_SIZE[d],y=Te.stuffBits(a,x));let Ee=g-g%x;if(!(f&&y.getSize()>x*64)&&y.getSize()+l<=Ee)break}}let I=Te.generateCheckWords(y,g,x),T=y.getSize()/x,v=Te.generateModeMessage(f,d,T),S=(f?11:14)+d*4,N=new Int32Array(S),D;if(f){D=S;for(let L=0;L<N.length;L++)N[L]=L}else{D=S+1+2*Y.truncDivision(Y.truncDivision(S,2)-1,15);let L=Y.truncDivision(S,2),Ee=Y.truncDivision(D,2);for(let ce=0;ce<L;ce++){let zt=ce+Y.truncDivision(ce,15);N[L-ce-1]=Ee-zt-1,N[L+ce]=Ee+zt+1}}let F=new _e(D);for(let L=0,Ee=0;L<d;L++){let ce=(d-L)*4+(f?9:12);for(let zt=0;zt<ce;zt++){let sn=zt*2;for(let Kt=0;Kt<2;Kt++)I.get(Ee+sn+Kt)&&F.set(N[L*2+Kt],N[L*2+zt]),I.get(Ee+ce*2+sn+Kt)&&F.set(N[L*2+zt],N[S-1-L*2-Kt]),I.get(Ee+ce*4+sn+Kt)&&F.set(N[S-1-L*2-Kt],N[S-1-L*2-zt]),I.get(Ee+ce*6+sn+Kt)&&F.set(N[S-1-L*2-zt],N[L*2+Kt])}Ee+=ce*8}if(Te.drawModeMessage(F,f,D,v),f)Te.drawBullsEye(F,Y.truncDivision(D,2),5);else{Te.drawBullsEye(F,Y.truncDivision(D,2),7);for(let L=0,Ee=0;L<Y.truncDivision(S,2)-1;L+=15,Ee+=16)for(let ce=Y.truncDivision(D,2)&1;ce<D;ce+=2)F.set(Y.truncDivision(D,2)-Ee,ce),F.set(Y.truncDivision(D,2)+Ee,ce),F.set(ce,Y.truncDivision(D,2)-Ee),F.set(ce,Y.truncDivision(D,2)+Ee)}let U=new Rc;return U.setCompact(f),U.setSize(D),U.setLayers(d),U.setCodeWords(T),U.setMatrix(F),U}static drawBullsEye(t,i,s){for(let a=0;a<s;a+=2)for(let l=i-a;l<=i+a;l++)t.set(l,i-a),t.set(l,i+a),t.set(i-a,l),t.set(i+a,l);t.set(i-s,i-s),t.set(i-s+1,i-s),t.set(i-s,i-s+1),t.set(i+s,i-s),t.set(i+s,i-s+1),t.set(i+s,i+s-1)}static generateModeMessage(t,i,s){let a=new fe;return t?(a.appendBits(i-1,2),a.appendBits(s-1,6),a=Te.generateCheckWords(a,28,4)):(a.appendBits(i-1,5),a.appendBits(s-1,11),a=Te.generateCheckWords(a,40,4)),a}static drawModeMessage(t,i,s,a){let l=Y.truncDivision(s,2);if(i)for(let u=0;u<7;u++){let f=l-3+u;a.get(u)&&t.set(f,l-5),a.get(u+7)&&t.set(l+5,f),a.get(20-u)&&t.set(f,l+5),a.get(27-u)&&t.set(l-5,f)}else for(let u=0;u<10;u++){let f=l-5+u+Y.truncDivision(u,5);a.get(u)&&t.set(f,l-7),a.get(u+10)&&t.set(l+7,f),a.get(29-u)&&t.set(f,l+7),a.get(39-u)&&t.set(l-7,f)}}static generateCheckWords(t,i,s){let a=t.getSize()/s,l=new pa(Te.getGF(s)),u=Y.truncDivision(i,s),f=Te.bitsToWords(t,s,u);l.encode(f,u-a);let d=i%s,g=new fe;g.appendBits(0,d);for(const x of Array.from(f))g.appendBits(x,s);return g}static bitsToWords(t,i,s){let a=new Int32Array(s),l,u;for(l=0,u=t.getSize()/i;l<u;l++){let f=0;for(let d=0;d<i;d++)f|=t.get(l*i+d)?1<<i-d-1:0;a[l]=f}return a}static getGF(t){switch(t){case 4:return ve.AZTEC_PARAM;case 6:return ve.AZTEC_DATA_6;case 8:return ve.AZTEC_DATA_8;case 10:return ve.AZTEC_DATA_10;case 12:return ve.AZTEC_DATA_12;default:throw new _("Unsupported word size "+t)}}static stuffBits(t,i){let s=new fe,a=t.getSize(),l=(1<<i)-2;for(let u=0;u<a;u+=i){let f=0;for(let d=0;d<i;d++)(u+d>=a||t.get(u+d))&&(f|=1<<i-1-d);(f&l)===l?(s.appendBits(f&l,i),u--):(f&l)===0?(s.appendBits(f|1,i),u--):s.appendBits(f,i)}return s}static totalBitsInLayer(t,i){return((i?88:112)+16*t)*t}}Te.DEFAULT_EC_PERCENT=33,Te.DEFAULT_AZTEC_LAYERS=0,Te.MAX_NB_BITS=32,Te.MAX_NB_BITS_COMPACT=4,Te.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class ks{encode(t,i,s,a){return this.encodeWithHints(t,i,s,a,null)}encodeWithHints(t,i,s,a,l){let u=xa.ISO_8859_1,f=Te.DEFAULT_EC_PERCENT,d=Te.DEFAULT_AZTEC_LAYERS;return l!=null&&(l.has(ot.CHARACTER_SET)&&(u=Nc.forName(l.get(ot.CHARACTER_SET).toString())),l.has(ot.ERROR_CORRECTION)&&(f=Y.parseInt(l.get(ot.ERROR_CORRECTION).toString())),l.has(ot.AZTEC_LAYERS)&&(d=Y.parseInt(l.get(ot.AZTEC_LAYERS).toString()))),ks.encodeLayers(t,i,s,a,u,f,d)}static encodeLayers(t,i,s,a,l,u,f){if(i!==te.AZTEC)throw new _("Can only encode AZTEC, but got "+i);let d=Te.encode(ie.getBytes(t,l),u,f);return ks.renderResult(d,s,a)}static renderResult(t,i,s){let a=t.getMatrix();if(a==null)throw new hn;let l=a.getWidth(),u=a.getHeight(),f=Math.max(i,l),d=Math.max(s,u),g=Math.min(f/l,d/u),x=(f-l*g)/2,y=(d-u*g)/2,I=new _e(f,d);for(let T=0,v=y;T<u;T++,v+=g)for(let S=0,N=x;S<l;S++,N+=g)a.get(S,T)&&I.setRegion(N,v,g,g);return I}}r.AbstractExpandedDecoder=sa,r.ArgumentException=C,r.ArithmeticException=Is,r.AztecCode=Rc,r.AztecCodeReader=Ts,r.AztecCodeWriter=ks,r.AztecDecoder=Fe,r.AztecDetector=mc,r.AztecDetectorResult=gc,r.AztecEncoder=Te,r.AztecHighLevelEncoder=yi,r.AztecPoint=Bt,r.BarcodeFormat=te,r.Binarizer=q,r.BinaryBitmap=k,r.BitArray=fe,r.BitMatrix=_e,r.BitSource=ca,r.BrowserAztecCodeReader=Q1,r.BrowserBarcodeReader=r0,r.BrowserCodeReader=nr,r.BrowserDatamatrixCodeReader=s0,r.BrowserMultiFormatReader=m0,r.BrowserPDF417Reader=x0,r.BrowserQRCodeReader=w0,r.BrowserQRCodeSvgWriter=lr,r.CharacterSetECI=B,r.ChecksumException=H,r.Code128Reader=X,r.Code39Reader=it,r.DataMatrixDecodedBitStreamParser=Fn,r.DataMatrixReader=Un,r.DecodeHintType=de,r.DecoderResult=ci,r.DefaultGridSampler=pc,r.DetectorResult=bs,r.EAN13Reader=rr,r.EncodeHintType=ot,r.Exception=m,r.FormatException=V,r.GenericGF=ve,r.GenericGFPoly=Gt,r.GlobalHistogramBinarizer=we,r.GridSampler=ta,r.GridSamplerInstance=Ln,r.HTMLCanvasElementLuminanceSource=Pn,r.HybridBinarizer=Q,r.ITFReader=ke,r.IllegalArgumentException=_,r.IllegalStateException=hn,r.InvertedLuminanceSource=kn,r.LuminanceSource=Ht,r.MathUtils=be,r.MultiFormatOneDReader=Or,r.MultiFormatReader=Sc,r.MultiFormatWriter=y0,r.NotFoundException=M,r.OneDReader=et,r.PDF417DecodedBitStreamParser=O,r.PDF417DecoderErrorCorrection=Ic,r.PDF417Reader=wt,r.PDF417ResultMetadata=bc,r.PerspectiveTransform=nn,r.PlanarYUVLuminanceSource=pn,r.QRCodeByteMatrix=Ds,r.QRCodeDataMask=Jt,r.QRCodeDecodedBitStreamParser=ze,r.QRCodeDecoderErrorCorrectionLevel=Ue,r.QRCodeDecoderFormatInformation=Tt,r.QRCodeEncoder=He,r.QRCodeEncoderQRCode=ar,r.QRCodeMaskUtil=Ze,r.QRCodeMatrixUtil=ne,r.QRCodeMode=ee,r.QRCodeReader=Vn,r.QRCodeVersion=J,r.QRCodeWriter=Mr,r.RGBLuminanceSource=ma,r.RSS14Reader=qe,r.RSSExpandedReader=P,r.ReaderException=Os,r.ReedSolomonDecoder=hi,r.ReedSolomonEncoder=pa,r.ReedSolomonException=vr,r.Result=Lt,r.ResultMetadataType=ct,r.ResultPoint=Z,r.StringUtils=ie,r.UnsupportedOperationException=kt,r.VideoInputDevice=dc,r.WhiteRectangleDetector=Cn,r.WriterException=Pe,r.ZXingArrays=he,r.ZXingCharset=Nc,r.ZXingInteger=Y,r.ZXingStandardCharsets=xa,r.ZXingStringBuilder=le,r.ZXingStringEncoding=lt,r.ZXingSystem=j,r.createAbstractExpandedDecoder=yc,Object.defineProperty(r,"__esModule",{value:!0})})})(Be,Be.exports);const q0=Y0(Be.exports),Z0=N0({__proto__:null,default:q0},[Be.exports]);var Vc=function(){function n(e,r,o){if(this.formatMap=new Map([[K.QR_CODE,Be.exports.BarcodeFormat.QR_CODE],[K.AZTEC,Be.exports.BarcodeFormat.AZTEC],[K.CODABAR,Be.exports.BarcodeFormat.CODABAR],[K.CODE_39,Be.exports.BarcodeFormat.CODE_39],[K.CODE_93,Be.exports.BarcodeFormat.CODE_93],[K.CODE_128,Be.exports.BarcodeFormat.CODE_128],[K.DATA_MATRIX,Be.exports.BarcodeFormat.DATA_MATRIX],[K.MAXICODE,Be.exports.BarcodeFormat.MAXICODE],[K.ITF,Be.exports.BarcodeFormat.ITF],[K.EAN_13,Be.exports.BarcodeFormat.EAN_13],[K.EAN_8,Be.exports.BarcodeFormat.EAN_8],[K.PDF_417,Be.exports.BarcodeFormat.PDF_417],[K.RSS_14,Be.exports.BarcodeFormat.RSS_14],[K.RSS_EXPANDED,Be.exports.BarcodeFormat.RSS_EXPANDED],[K.UPC_A,Be.exports.BarcodeFormat.UPC_A],[K.UPC_E,Be.exports.BarcodeFormat.UPC_E],[K.UPC_EAN_EXTENSION,Be.exports.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!Z0)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=r,this.logger=o;var c=this.createZXingFormats(e),h=new Map;h.set(Be.exports.DecodeHintType.POSSIBLE_FORMATS,c),h.set(Be.exports.DecodeHintType.TRY_HARDER,!1),this.hints=h}return n.prototype.decodeAsync=function(e){var r=this;return new Promise(function(o,c){try{o(r.decode(e))}catch(h){c(h)}})},n.prototype.decode=function(e){var r=new Be.exports.MultiFormatReader(this.verbose,this.hints),o=new Be.exports.HTMLCanvasElementLuminanceSource(e),c=new Be.exports.BinaryBitmap(new Be.exports.HybridBinarizer(o)),h=r.decode(c);return{text:h.text,format:fh.create(this.toHtml5QrcodeSupportedFormats(h.format)),debugData:this.createDebugData()}},n.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(r,o,c){e.set(r,o)}),e},n.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have "+e;return this.reverseFormatMap.get(e)},n.prototype.createZXingFormats=function(e){for(var r=[],o=0,c=e;o<c.length;o++){var h=c[o];this.formatMap.has(h)?r.push(this.formatMap.get(h)):this.logger.logError(h+" is not supported byZXingHtml5QrcodeShim")}return r},n.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},n}(),$0=globalThis&&globalThis.__awaiter||function(n,e,r,o){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function w(C){try{m(o.next(C))}catch(_){p(_)}}function A(C){try{m(o.throw(C))}catch(_){p(_)}}function m(C){C.done?h(C.value):c(C.value).then(w,A)}m((o=o.apply(n,e||[])).next())})},Q0=globalThis&&globalThis.__generator||function(n,e){var r={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},o,c,h,p;return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(C){return A([m,C])}}function A(m){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,c&&(h=m[0]&2?c.return:m[0]?c.throw||((h=c.return)&&h.call(c),0):c.next)&&!(h=h.call(c,m[1])).done)return h;switch(c=0,h&&(m=[m[0]&2,h.value]),m[0]){case 0:case 1:h=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,c=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(h=r.trys,!(h=h.length>0&&h[h.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!h||m[1]>h[0]&&m[1]<h[3])){r.label=m[1];break}if(m[0]===6&&r.label<h[1]){r.label=h[1],h=m;break}if(h&&r.label<h[2]){r.label=h[2],r.ops.push(m);break}h[2]&&r.ops.pop(),r.trys.pop();continue}m=e.call(n,r)}catch(C){m=[6,C],c=0}finally{o=h=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Hc=function(){function n(e,r,o){if(this.formatMap=new Map([[K.QR_CODE,"qr_code"],[K.AZTEC,"aztec"],[K.CODABAR,"codabar"],[K.CODE_39,"code_39"],[K.CODE_93,"code_93"],[K.CODE_128,"code_128"],[K.DATA_MATRIX,"data_matrix"],[K.ITF,"itf"],[K.EAN_13,"ean_13"],[K.EAN_8,"ean_8"],[K.PDF_417,"pdf417"],[K.UPC_A,"upc_a"],[K.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!n.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=r,this.logger=o;var c=this.createBarcodeDetectorFormats(e);if(this.detector=new BarcodeDetector(c),!this.detector)throw"BarcodeDetector detector not supported"}return n.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var e=new BarcodeDetector({formats:["qr_code"]});return typeof e<"u"},n.prototype.decodeAsync=function(e){return $0(this,void 0,void 0,function(){var r,o;return Q0(this,function(c){switch(c.label){case 0:return[4,this.detector.detect(e)];case 1:if(r=c.sent(),!r||r.length===0)throw"No barcode or QR code detected.";return o=this.selectLargestBarcode(r),[2,{text:o.rawValue,format:fh.create(this.toHtml5QrcodeSupportedFormats(o.format)),debugData:this.createDebugData()}]}})})},n.prototype.selectLargestBarcode=function(e){for(var r=null,o=0,c=0,h=e;c<h.length;c++){var p=h[c],w=p.boundingBox.width*p.boundingBox.height;w>o&&(o=w,r=p)}if(!r)throw"No largest barcode found";return r},n.prototype.createBarcodeDetectorFormats=function(e){for(var r=[],o=0,c=e;o<c.length;o++){var h=c[o];this.formatMap.has(h)?r.push(this.formatMap.get(h)):this.logger.warn(h+" is not supported byBarcodeDetectorDelegate")}return{formats:r}},n.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have "+e;return this.reverseFormatMap.get(e)},n.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(r,o,c){e.set(r,o)}),e},n.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},n}(),Gc=globalThis&&globalThis.__awaiter||function(n,e,r,o){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function w(C){try{m(o.next(C))}catch(_){p(_)}}function A(C){try{m(o.throw(C))}catch(_){p(_)}}function m(C){C.done?h(C.value):c(C.value).then(w,A)}m((o=o.apply(n,e||[])).next())})},Wc=globalThis&&globalThis.__generator||function(n,e){var r={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},o,c,h,p;return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(C){return A([m,C])}}function A(m){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,c&&(h=m[0]&2?c.return:m[0]?c.throw||((h=c.return)&&h.call(c),0):c.next)&&!(h=h.call(c,m[1])).done)return h;switch(c=0,h&&(m=[m[0]&2,h.value]),m[0]){case 0:case 1:h=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,c=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(h=r.trys,!(h=h.length>0&&h[h.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!h||m[1]>h[0]&&m[1]<h[3])){r.label=m[1];break}if(m[0]===6&&r.label<h[1]){r.label=h[1],h=m;break}if(h&&r.label<h[2]){r.label=h[2],r.ops.push(m);break}h[2]&&r.ops.pop(),r.trys.pop();continue}m=e.call(n,r)}catch(C){m=[6,C],c=0}finally{o=h=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},J0=function(){function n(e,r,o,c){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=o,r&&Hc.isSupported()?(this.primaryDecoder=new Hc(e,o,c),this.secondaryDecoder=new Vc(e,o,c)):this.primaryDecoder=new Vc(e,o,c)}return n.prototype.decodeAsync=function(e){return Gc(this,void 0,void 0,function(){var r;return Wc(this,function(o){switch(o.label){case 0:r=performance.now(),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(e)];case 2:return[2,o.sent()];case 3:return this.possiblyLogPerformance(r),[7];case 4:return[2]}})})},n.prototype.decodeRobustlyAsync=function(e){return Gc(this,void 0,void 0,function(){var r,o;return Wc(this,function(c){switch(c.label){case 0:r=performance.now(),c.label=1;case 1:return c.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(e)];case 2:return[2,c.sent()];case 3:if(o=c.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(e)];throw o;case 4:return this.possiblyLogPerformance(r),[7];case 5:return[2]}})})},n.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},n.prototype.possiblyLogPerformance=function(e){if(!!this.verbose){var r=performance.now()-e;this.executionResults.push(r),this.executions++,this.possiblyFlushPerformanceReport()}},n.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var e=0,r=0,o=this.executionResults;r<o.length;r++){var c=o[r];e+=c}var h=e/this.executionResults.length;console.log(h+" ms for "+this.executionResults.length+" last runs."),this.executions=0,this.executionResults=[]}},n}(),xl=globalThis&&globalThis.__extends||function(){var n=function(e,r){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(o[h]=c[h])},n(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");n(e,r);function o(){this.constructor=e}e.prototype=r===null?Object.create(r):(o.prototype=r.prototype,new o)}}(),Qs=globalThis&&globalThis.__awaiter||function(n,e,r,o){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function w(C){try{m(o.next(C))}catch(_){p(_)}}function A(C){try{m(o.throw(C))}catch(_){p(_)}}function m(C){C.done?h(C.value):c(C.value).then(w,A)}m((o=o.apply(n,e||[])).next())})},Js=globalThis&&globalThis.__generator||function(n,e){var r={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},o,c,h,p;return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(C){return A([m,C])}}function A(m){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,c&&(h=m[0]&2?c.return:m[0]?c.throw||((h=c.return)&&h.call(c),0):c.next)&&!(h=h.call(c,m[1])).done)return h;switch(c=0,h&&(m=[m[0]&2,h.value]),m[0]){case 0:case 1:h=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,c=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(h=r.trys,!(h=h.length>0&&h[h.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!h||m[1]>h[0]&&m[1]<h[3])){r.label=m[1];break}if(m[0]===6&&r.label<h[1]){r.label=h[1],h=m;break}if(h&&r.label<h[2]){r.label=h[2],r.ops.push(m);break}h[2]&&r.ops.pop(),r.trys.pop();continue}m=e.call(n,r)}catch(C){m=[6,C],c=0}finally{o=h=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},gh=function(){function n(e,r){this.name=e,this.track=r}return n.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},n.prototype.apply=function(e){var r={};r[this.name]=e;var o={advanced:[r]};return this.track.applyConstraints(o)},n.prototype.value=function(){var e=this.track.getSettings();if(this.name in e){var r=e[this.name];return r}return null},n}(),ed=function(n){xl(e,n);function e(r,o){return n.call(this,r,o)||this}return e.prototype.min=function(){return this.getCapabilities().min},e.prototype.max=function(){return this.getCapabilities().max},e.prototype.step=function(){return this.getCapabilities().step},e.prototype.apply=function(r){var o={};o[this.name]=r;var c={advanced:[o]};return this.track.applyConstraints(c)},e.prototype.getCapabilities=function(){this.failIfNotSupported();var r=this.track.getCapabilities(),o=r[this.name];return{min:o.min,max:o.max,step:o.step}},e.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error(this.name+" capability not supported")},e}(gh),td=function(n){xl(e,n);function e(r){return n.call(this,"zoom",r)||this}return e}(ed),nd=function(n){xl(e,n);function e(r){return n.call(this,"torch",r)||this}return e}(gh),rd=function(){function n(e){this.track=e}return n.prototype.zoomFeature=function(){return new td(this.track)},n.prototype.torchFeature=function(){return new nd(this.track)},n}(),id=function(){function n(e,r,o){this.isClosed=!1,this.parentElement=e,this.mediaStream=r,this.callbacks=o,this.surface=this.createVideoElement(this.parentElement.clientWidth),e.append(this.surface)}return n.prototype.createVideoElement=function(e){var r=document.createElement("video");return r.style.width=e+"px",r.style.display="block",r.muted=!0,r.setAttribute("muted","true"),r.playsInline=!0,r},n.prototype.setupSurface=function(){var e=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var r=function(){var o=e.surface.clientWidth,c=e.surface.clientHeight;e.callbacks.onRenderSurfaceReady(o,c),e.surface.removeEventListener("playing",r)};this.surface.addEventListener("playing",r),this.surface.srcObject=this.mediaStream,this.surface.play()},n.create=function(e,r,o,c){return Qs(this,void 0,void 0,function(){var h,p;return Js(this,function(w){switch(w.label){case 0:return h=new n(e,r,c),o.aspectRatio?(p={aspectRatio:o.aspectRatio},[4,h.getFirstTrackOrFail().applyConstraints(p)]):[3,2];case 1:w.sent(),w.label=2;case 2:return h.setupSurface(),[2,h]}})})},n.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},n.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},n.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},n.prototype.resume=function(e){this.failIfClosed();var r=this,o=function(){setTimeout(e,200),r.surface.removeEventListener("playing",o)};this.surface.addEventListener("playing",o),this.surface.play()},n.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},n.prototype.getSurface=function(){return this.failIfClosed(),this.surface},n.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},n.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},n.prototype.applyVideoConstraints=function(e){return Qs(this,void 0,void 0,function(){return Js(this,function(r){if("aspectRatio"in e)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(e)]})})},n.prototype.close=function(){if(this.isClosed)return Promise.resolve();var e=this;return new Promise(function(r,o){var c=e.mediaStream.getVideoTracks(),h=c.length,p=0;e.mediaStream.getVideoTracks().forEach(function(w){e.mediaStream.removeTrack(w),w.stop(),++p,p>=h&&(e.isClosed=!0,e.parentElement.removeChild(e.surface),r())})})},n.prototype.getCapabilities=function(){return new rd(this.getFirstTrackOrFail())},n}(),sd=function(){function n(e){this.mediaStream=e}return n.prototype.render=function(e,r,o){return Qs(this,void 0,void 0,function(){return Js(this,function(c){return[2,id.create(e,this.mediaStream,r,o)]})})},n.create=function(e){return Qs(this,void 0,void 0,function(){var r,o;return Js(this,function(c){switch(c.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return r={audio:!1,video:e},[4,navigator.mediaDevices.getUserMedia(r)];case 1:return o=c.sent(),[2,new n(o)]}})})},n}(),Xc=globalThis&&globalThis.__awaiter||function(n,e,r,o){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function w(C){try{m(o.next(C))}catch(_){p(_)}}function A(C){try{m(o.throw(C))}catch(_){p(_)}}function m(C){C.done?h(C.value):c(C.value).then(w,A)}m((o=o.apply(n,e||[])).next())})},jc=globalThis&&globalThis.__generator||function(n,e){var r={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},o,c,h,p;return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(C){return A([m,C])}}function A(m){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,c&&(h=m[0]&2?c.return:m[0]?c.throw||((h=c.return)&&h.call(c),0):c.next)&&!(h=h.call(c,m[1])).done)return h;switch(c=0,h&&(m=[m[0]&2,h.value]),m[0]){case 0:case 1:h=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,c=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(h=r.trys,!(h=h.length>0&&h[h.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!h||m[1]>h[0]&&m[1]<h[3])){r.label=m[1];break}if(m[0]===6&&r.label<h[1]){r.label=h[1],h=m;break}if(h&&r.label<h[2]){r.label=h[2],r.ops.push(m);break}h[2]&&r.ops.pop(),r.trys.pop();continue}m=e.call(n,r)}catch(C){m=[6,C],c=0}finally{o=h=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},od=function(){function n(){}return n.failIfNotSupported=function(){return Xc(this,void 0,void 0,function(){return jc(this,function(e){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new n]})})},n.prototype.create=function(e){return Xc(this,void 0,void 0,function(){return jc(this,function(r){return[2,sd.create(e)]})})},n}(),ad=globalThis&&globalThis.__awaiter||function(n,e,r,o){function c(h){return h instanceof r?h:new r(function(p){p(h)})}return new(r||(r=Promise))(function(h,p){function w(C){try{m(o.next(C))}catch(_){p(_)}}function A(C){try{m(o.throw(C))}catch(_){p(_)}}function m(C){C.done?h(C.value):c(C.value).then(w,A)}m((o=o.apply(n,e||[])).next())})},ld=globalThis&&globalThis.__generator||function(n,e){var r={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},o,c,h,p;return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(C){return A([m,C])}}function A(m){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,c&&(h=m[0]&2?c.return:m[0]?c.throw||((h=c.return)&&h.call(c),0):c.next)&&!(h=h.call(c,m[1])).done)return h;switch(c=0,h&&(m=[m[0]&2,h.value]),m[0]){case 0:case 1:h=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,c=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(h=r.trys,!(h=h.length>0&&h[h.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!h||m[1]>h[0]&&m[1]<h[3])){r.label=m[1];break}if(m[0]===6&&r.label<h[1]){r.label=h[1],h=m;break}if(h&&r.label<h[2]){r.label=h[2],r.ops.push(m);break}h[2]&&r.ops.pop(),r.trys.pop();continue}m=e.call(n,r)}catch(C){m=[6,C],c=0}finally{o=h=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},cd=function(){function n(){}return n.retrieve=function(){if(navigator.mediaDevices)return n.getCamerasFromMediaDevices();var e=MediaStreamTrack;return MediaStreamTrack&&e.getSources?n.getCamerasFromMediaStreamTrack():n.rejectWithError()},n.rejectWithError=function(){var e=Di.unableToQuerySupportedDevices();return n.isHttpsOrLocalhost()||(e=Di.insecureContextCameraQueryError()),Promise.reject(e)},n.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var e=location.host.split(":")[0];return e==="127.0.0.1"||e==="localhost"},n.getCamerasFromMediaDevices=function(){return ad(this,void 0,void 0,function(){var e,r,o,c,h,p,w;return ld(this,function(A){switch(A.label){case 0:return e=function(m){for(var C=m.getVideoTracks(),_=0,k=C;_<k.length;_++){var H=k[_];H.enabled=!1,H.stop(),m.removeTrack(H)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return r=A.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(o=A.sent(),c=[],h=0,p=o;h<p.length;h++)w=p[h],w.kind==="videoinput"&&c.push({id:w.deviceId,label:w.label});return e(r),[2,c]}})})},n.getCamerasFromMediaStreamTrack=function(){return new Promise(function(e,r){var o=function(h){for(var p=[],w=0,A=h;w<A.length;w++){var m=A[w];m.kind==="video"&&p.push({id:m.id,label:m.label})}e(p)},c=MediaStreamTrack;c.getSources(o)})},n}(),$e;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.NOT_STARTED=1]="NOT_STARTED",n[n.SCANNING=2]="SCANNING",n[n.PAUSED=3]="PAUSED"})($e||($e={}));var ud=function(){function n(){this.state=$e.NOT_STARTED,this.onGoingTransactionNewState=$e.UNKNOWN}return n.prototype.directTransition=function(e){this.failIfTransitionOngoing(),this.validateTransition(e),this.state=e},n.prototype.startTransition=function(e){return this.failIfTransitionOngoing(),this.validateTransition(e),this.onGoingTransactionNewState=e,this},n.prototype.execute=function(){if(this.onGoingTransactionNewState===$e.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var e=this.onGoingTransactionNewState;this.onGoingTransactionNewState=$e.UNKNOWN,this.directTransition(e)},n.prototype.cancel=function(){if(this.onGoingTransactionNewState===$e.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=$e.UNKNOWN},n.prototype.getState=function(){return this.state},n.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==$e.UNKNOWN)throw"Cannot transition to a new state, already under transition"},n.prototype.validateTransition=function(e){switch(this.state){case $e.UNKNOWN:throw"Transition from unknown is not allowed";case $e.NOT_STARTED:this.failIfNewStateIs(e,[$e.PAUSED]);break;case $e.SCANNING:break;case $e.PAUSED:break}},n.prototype.failIfNewStateIs=function(e,r){for(var o=0,c=r;o<c.length;o++){var h=c[o];if(e===h)throw"Cannot transition from "+this.state+" to "+e}},n}(),hd=function(){function n(e){this.stateManager=e}return n.prototype.startTransition=function(e){return this.stateManager.startTransition(e)},n.prototype.directTransition=function(e){this.stateManager.directTransition(e)},n.prototype.getState=function(){return this.stateManager.getState()},n.prototype.canScanFile=function(){return this.stateManager.getState()===$e.NOT_STARTED},n.prototype.isScanning=function(){return this.stateManager.getState()!==$e.NOT_STARTED},n.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===$e.SCANNING},n.prototype.isPaused=function(){return this.stateManager.getState()===$e.PAUSED},n}(),fd=function(){function n(){}return n.create=function(){return new hd(new ud)},n}(),dd=globalThis&&globalThis.__extends||function(){var n=function(e,r){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(o[h]=c[h])},n(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");n(e,r);function o(){this.constructor=e}e.prototype=r===null?Object.create(r):(o.prototype=r.prototype,new o)}}(),Zt=function(n){dd(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.DEFAULT_WIDTH=300,e.DEFAULT_WIDTH_OFFSET=2,e.FILE_SCAN_MIN_HEIGHT=300,e.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,e.MIN_QR_BOX_SIZE=50,e.SHADED_LEFT=1,e.SHADED_RIGHT=2,e.SHADED_TOP=3,e.SHADED_BOTTOM=4,e.SHADED_REGION_ELEMENT_ID="qr-shaded-region",e.VERBOSE=!1,e.BORDER_SHADER_DEFAULT_COLOR="#ffffff",e.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",e}(j0),gd=function(){function n(e,r){this.logger=r,this.fps=Zt.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=e.disableFlip===!0,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=Zt.DEFAULT_DISABLE_FLIP}return n.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?dh.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},n.prototype.isShadedBoxEnabled=function(){return!bn(this.qrbox)},n.create=function(e,r){return new n(e,r)},n}(),pd=function(){function n(e,r){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id="+e+" not found";this.elementId=e,this.verbose=!1;var o;typeof r=="boolean"?this.verbose=r===!0:r&&(o=r,this.verbose=o.verbose===!0,o.experimentalFeatures),this.logger=new K0(this.verbose),this.qrcode=new J0(this.getSupportedFormats(r),this.getUseBarCodeDetectorIfSupported(o),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=fd.create()}return n.prototype.start=function(e,r,o,c){var h=this;if(!e)throw"cameraIdOrConfig is required";if(!o||typeof o!="function")throw"qrCodeSuccessCallback is required and should be a function.";var p;c?p=c:p=this.verbose?this.logger.log:function(){};var w=gd.create(r,this.logger);this.clearElement();var A=!1;w.videoConstraints&&(w.isMediaStreamConstraintsValid()?A=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var m=A,C=document.getElementById(this.elementId);C.clientWidth?C.clientWidth:Zt.DEFAULT_WIDTH,C.style.position="relative",this.shouldScan=!0,this.element=C;var _=this,k=this.stateManagerProxy.startTransition($e.SCANNING);return new Promise(function(H,q){var j=m?w.videoConstraints:_.createVideoConstraints(e);if(!j){k.cancel(),q("videoConstraints should be defined");return}var Ce={};(!m||w.aspectRatio)&&(Ce.aspectRatio=w.aspectRatio);var De={onRenderSurfaceReady:function(he,Y){_.setupUi(he,Y,w),_.isScanning=!0,_.foreverScan(w,o,p)}};od.failIfNotSupported().then(function(he){he.create(j).then(function(Y){return Y.render(h.element,Ce,De).then(function(fe){_.renderedCamera=fe,k.execute(),H(null)}).catch(function(fe){k.cancel(),q(fe)})}).catch(function(Y){k.cancel(),q(Di.errorGettingUserMedia(Y))})}).catch(function(he){k.cancel(),q(Di.cameraStreamingNotSupported())})})},n.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition($e.PAUSED),this.showPausedState(),(bn(e)||e!==!0)&&(e=!1),e&&this.renderedCamera&&this.renderedCamera.pause()},n.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var e=this,r=function(){e.stateManagerProxy.directTransition($e.SCANNING),e.hidePausedState()};if(!this.renderedCamera.isPaused()){r();return}this.renderedCamera.resume(function(){r()})},n.prototype.getState=function(){return this.stateManagerProxy.getState()},n.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var r=this.stateManagerProxy.startTransition($e.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var o=function(){if(!!e.element){var h=document.getElementById(Zt.SHADED_REGION_ELEMENT_ID);h&&e.element.removeChild(h)}},c=this;return this.renderedCamera.close().then(function(){return c.renderedCamera=null,c.element&&(c.element.removeChild(c.canvasElement),c.canvasElement=null),o(),c.qrRegion&&(c.qrRegion=null),c.context&&(c.context=null),r.execute(),c.hidePausedState(),c.isScanning=!1,Promise.resolve()})},n.prototype.scanFile=function(e,r){return this.scanFileV2(e,r).then(function(o){return o.decodedText})},n.prototype.scanFileV2=function(e,r){var o=this;if(!e||!(e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(bn(r)&&(r=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(c,h){o.possiblyCloseLastScanImageFile(),o.clearElement(),o.lastScanImageFile=URL.createObjectURL(e);var p=new Image;p.onload=function(){var w=p.width,A=p.height,m=document.getElementById(o.elementId),C=m.clientWidth?m.clientWidth:Zt.DEFAULT_WIDTH,_=Math.max(m.clientHeight?m.clientHeight:A,Zt.FILE_SCAN_MIN_HEIGHT),k=o.computeCanvasDrawConfig(w,A,C,_);if(r){var H=o.createCanvasElement(C,_,"qr-canvas-visible");H.style.display="inline-block",m.appendChild(H);var q=H.getContext("2d");if(!q)throw"Unable to get 2d context from canvas";q.canvas.width=C,q.canvas.height=_,q.drawImage(p,0,0,w,A,k.x,k.y,k.width,k.height)}var j=Zt.FILE_SCAN_HIDDEN_CANVAS_PADDING,Ce=Math.max(p.width,k.width),De=Math.max(p.height,k.height),he=Ce+2*j,Y=De+2*j,fe=o.createCanvasElement(he,Y);m.appendChild(fe);var rt=fe.getContext("2d");if(!rt)throw"Unable to get 2d context from canvas";rt.canvas.width=he,rt.canvas.height=Y,rt.drawImage(p,0,0,w,A,j,j,Ce,De);try{o.qrcode.decodeRobustlyAsync(fe).then(function(de){c(Uc.createFromQrcodeResult(de))}).catch(h)}catch(de){h("QR code parse error, error = "+de)}},p.onerror=h,p.onabort=h,p.onstalled=h,p.onsuspend=h,p.src=URL.createObjectURL(e)})},n.prototype.clear=function(){this.clearElement()},n.getCameras=function(){return cd.retrieve()},n.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},n.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},n.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},n.prototype.applyVideoConstraints=function(e){if(e){if(!dh.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(e)},n.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},n.prototype.getSupportedFormats=function(e){var r=[K.QR_CODE,K.AZTEC,K.CODABAR,K.CODE_39,K.CODE_93,K.CODE_128,K.DATA_MATRIX,K.MAXICODE,K.ITF,K.EAN_13,K.EAN_8,K.PDF_417,K.RSS_14,K.RSS_EXPANDED,K.UPC_A,K.UPC_E,K.UPC_EAN_EXTENSION];if(!e||typeof e=="boolean"||!e.formatsToSupport)return r;if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(e.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var o=[],c=0,h=e.formatsToSupport;c<h.length;c++){var p=h[c];X0(p)?o.push(p):this.logger.warn("Invalid format: "+p+" passed in config, ignoring.")}if(o.length===0)throw"None of formatsToSupport match supported values.";return o},n.prototype.getUseBarCodeDetectorIfSupported=function(e){if(bn(e))return!0;if(!bn(e.useBarCodeDetectorIfSupported))return e.useBarCodeDetectorIfSupported!==!1;if(bn(e.experimentalFeatures))return!0;var r=e.experimentalFeatures;return bn(r.useBarCodeDetectorIfSupported)?!0:r.useBarCodeDetectorIfSupported!==!1},n.prototype.validateQrboxSize=function(e,r,o){var c=this,h=o.qrbox;this.validateQrboxConfig(h);var p=this.toQrdimensions(e,r,h),w=function(m){if(m<Zt.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+(" "+Zt.MIN_QR_BOX_SIZE+"px.")},A=function(m){return m>e&&(c.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),m=e),m};w(p.width),w(p.height),p.width=A(p.width)},n.prototype.validateQrboxConfig=function(e){if(typeof e!="number"&&typeof e!="function"&&(e.width===void 0||e.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},n.prototype.toQrdimensions=function(e,r,o){if(typeof o=="number")return{width:o,height:o};if(typeof o=="function")try{return o(e,r)}catch(c){throw new Error("qrbox config was passed as a function but it failed with unknown error"+c)}return o},n.prototype.setupUi=function(e,r,o){o.isShadedBoxEnabled()&&this.validateQrboxSize(e,r,o);var c=bn(o.qrbox)?{width:e,height:r}:o.qrbox;this.validateQrboxConfig(c);var h=this.toQrdimensions(e,r,c);h.height>r&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var p=o.isShadedBoxEnabled()&&h.height<=r,w={x:0,y:0,width:e,height:r},A=p?this.getShadedRegionBounds(e,r,h):w,m=this.createCanvasElement(A.width,A.height),C={willReadFrequently:!0},_=m.getContext("2d",C);_.canvas.width=A.width,_.canvas.height=A.height,this.element.append(m),p&&this.possiblyInsertShadingElement(this.element,e,r,h),this.createScannerPausedUiElement(this.element),this.qrRegion=A,this.context=_,this.canvasElement=m},n.prototype.createScannerPausedUiElement=function(e){var r=document.createElement("div");r.innerText="Scanner paused",r.style.display="none",r.style.position="absolute",r.style.top="0px",r.style.zIndex="1",r.style.background="yellow",r.style.textAlign="center",r.style.width="100%",e.appendChild(r),this.scannerPausedUiElement=r},n.prototype.scanContext=function(e,r){var o=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(c){return e(c.text,Uc.createFromQrcodeResult(c)),o.possiblyUpdateShaders(!0),!0}).catch(function(c){o.possiblyUpdateShaders(!1);var h=Di.codeParseError(c);return r(h,z0.createFrom(h)),!1})},n.prototype.foreverScan=function(e,r,o){var c=this;if(!!this.shouldScan&&!!this.renderedCamera){var h=this.renderedCamera.getSurface(),p=h.videoWidth/h.clientWidth,w=h.videoHeight/h.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var A=this.qrRegion.width*p,m=this.qrRegion.height*w,C=this.qrRegion.x*p,_=this.qrRegion.y*w;this.context.drawImage(h,C,_,A,m,0,0,this.qrRegion.width,this.qrRegion.height);var k=function(){c.foreverScanTimeout=setTimeout(function(){c.foreverScan(e,r,o)},c.getTimeoutFps(e.fps))};this.scanContext(r,o).then(function(H){!H&&e.disableFlip!==!0?(c.context.translate(c.context.canvas.width,0),c.context.scale(-1,1),c.scanContext(r,o).finally(function(){k()})):k()}).catch(function(H){c.logger.logError("Error happend while scanning context",H),k()})}},n.prototype.createVideoConstraints=function(e){if(typeof e=="string")return{deviceId:{exact:e}};if(typeof e=="object"){var r="facingMode",o="deviceId",c={user:!0,environment:!0},h="exact",p=function(q){if(q in c)return!0;throw"config has invalid 'facingMode' value = "+("'"+q+"'")},w=Object.keys(e);if(w.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+(" if passed as an object, found "+w.length+" keys");var A=Object.keys(e)[0];if(A!==r&&A!==o)throw"Only '"+r+"' and '"+o+"'  are supported for 'cameraIdOrConfig'";if(A===r){var m=e.facingMode;if(typeof m=="string"){if(p(m))return{facingMode:m}}else if(typeof m=="object")if(h in m){if(p(m[""+h]))return{facingMode:{exact:m[""+h]}}}else throw"'facingMode' should be string or object with"+(" "+h+" as key.");else{var C=typeof m;throw"Invalid type of 'facingMode' = "+C}}else{var _=e.deviceId;if(typeof _=="string")return{deviceId:_};if(typeof _=="object"){if(h in _)return{deviceId:{exact:_[""+h]}};throw"'deviceId' should be string or object with"+(" "+h+" as key.")}else{var k=typeof _;throw"Invalid type of 'deviceId' = "+k}}}var H=typeof e;throw"Invalid type of 'cameraIdOrConfig' = "+H},n.prototype.computeCanvasDrawConfig=function(e,r,o,c){if(e<=o&&r<=c){var h=(o-e)/2,p=(c-r)/2;return{x:h,y:p,width:e,height:r}}else{var w=e,A=r;return e>o&&(r=o/e*r,e=o),r>c&&(e=c/r*e,r=c),this.logger.log("Image downsampled from "+(w+"X"+A)+(" to "+e+"X"+r+".")),this.computeCanvasDrawConfig(e,r,o,c)}},n.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},n.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(r){r.style.backgroundColor=e?Zt.BORDER_SHADER_MATCH_COLOR:Zt.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=e)},n.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},n.prototype.createCanvasElement=function(e,r,o){var c=e,h=r,p=document.createElement("canvas");return p.style.width=c+"px",p.style.height=h+"px",p.style.display="none",p.id=bn(o)?"qr-canvas":o,p},n.prototype.getShadedRegionBounds=function(e,r,o){if(o.width>e||o.height>r)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-o.width)/2,y:(r-o.height)/2,width:o.width,height:o.height}},n.prototype.possiblyInsertShadingElement=function(e,r,o,c){if(!(r-c.width<1||o-c.height<1)){var h=document.createElement("div");h.style.position="absolute";var p=(r-c.width)/2,w=(o-c.height)/2;if(h.style.borderLeft=p+"px solid rgba(0, 0, 0, 0.48)",h.style.borderRight=p+"px solid rgba(0, 0, 0, 0.48)",h.style.borderTop=w+"px solid rgba(0, 0, 0, 0.48)",h.style.borderBottom=w+"px solid rgba(0, 0, 0, 0.48)",h.style.boxSizing="border-box",h.style.top="0px",h.style.bottom="0px",h.style.left="0px",h.style.right="0px",h.id=""+Zt.SHADED_REGION_ELEMENT_ID,r-c.width<11||o-c.height<11)this.hasBorderShaders=!1;else{var A=5,m=40;this.insertShaderBorders(h,m,A,-A,null,0,!0),this.insertShaderBorders(h,m,A,-A,null,0,!1),this.insertShaderBorders(h,m,A,null,-A,0,!0),this.insertShaderBorders(h,m,A,null,-A,0,!1),this.insertShaderBorders(h,A,m+A,-A,null,-A,!0),this.insertShaderBorders(h,A,m+A,null,-A,-A,!0),this.insertShaderBorders(h,A,m+A,-A,null,-A,!1),this.insertShaderBorders(h,A,m+A,null,-A,-A,!1),this.hasBorderShaders=!0}e.append(h)}},n.prototype.insertShaderBorders=function(e,r,o,c,h,p,w){var A=document.createElement("div");A.style.position="absolute",A.style.backgroundColor=Zt.BORDER_SHADER_DEFAULT_COLOR,A.style.width=r+"px",A.style.height=o+"px",c!==null&&(A.style.top=c+"px"),h!==null&&(A.style.bottom=h+"px"),w?A.style.left=p+"px":A.style.right=p+"px",this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(A),e.appendChild(A)},n.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},n.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},n.prototype.getTimeoutFps=function(e){return 1e3/e},n}();globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;var zc;(function(n){n[n.STATUS_DEFAULT=0]="STATUS_DEFAULT",n[n.STATUS_SUCCESS=1]="STATUS_SUCCESS",n[n.STATUS_WARNING=2]="STATUS_WARNING",n[n.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(zc||(zc={}));function md(n){let e;return{c(){e=vt("div"),Ni(e,"id","reader")},m(r,o){ri(r,e,o)},p:gr,i:gr,o:gr,d(r){r&&br(e)}}}function xd(n,e,r){let o,{result:c}=e,{close:h}=e;M0(p);function p(){o=new pd("reader"),w()}function w(){o.start({facingMode:"environment"},{fps:10,qrbox:{width:800,height:800}},m,null)}async function A(){await o.stop()}function m(C,_){r(0,c=C)}return n.$$set=C=>{"result"in C&&r(0,c=C.result),"close"in C&&r(1,h=C.close)},n.$$.update=()=>{n.$$.dirty&3&&c&&A()&&h()},[c,h]}class wd extends hh{constructor(e){super(),uh(this,e,xd,md,sh,{result:0,close:1})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ph=function(n){const e=[];let r=0;for(let o=0;o<n.length;o++){let c=n.charCodeAt(o);c<128?e[r++]=c:c<2048?(e[r++]=c>>6|192,e[r++]=c&63|128):(c&64512)===55296&&o+1<n.length&&(n.charCodeAt(o+1)&64512)===56320?(c=65536+((c&1023)<<10)+(n.charCodeAt(++o)&1023),e[r++]=c>>18|240,e[r++]=c>>12&63|128,e[r++]=c>>6&63|128,e[r++]=c&63|128):(e[r++]=c>>12|224,e[r++]=c>>6&63|128,e[r++]=c&63|128)}return e},Ed=function(n){const e=[];let r=0,o=0;for(;r<n.length;){const c=n[r++];if(c<128)e[o++]=String.fromCharCode(c);else if(c>191&&c<224){const h=n[r++];e[o++]=String.fromCharCode((c&31)<<6|h&63)}else if(c>239&&c<365){const h=n[r++],p=n[r++],w=n[r++],A=((c&7)<<18|(h&63)<<12|(p&63)<<6|w&63)-65536;e[o++]=String.fromCharCode(55296+(A>>10)),e[o++]=String.fromCharCode(56320+(A&1023))}else{const h=n[r++],p=n[r++];e[o++]=String.fromCharCode((c&15)<<12|(h&63)<<6|p&63)}}return e.join("")},mh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let c=0;c<n.length;c+=3){const h=n[c],p=c+1<n.length,w=p?n[c+1]:0,A=c+2<n.length,m=A?n[c+2]:0,C=h>>2,_=(h&3)<<4|w>>4;let k=(w&15)<<2|m>>6,H=m&63;A||(H=64,p||(k=64)),o.push(r[C],r[_],r[k],r[H])}return o.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(ph(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Ed(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let c=0;c<n.length;){const h=r[n.charAt(c++)],w=c<n.length?r[n.charAt(c)]:0;++c;const m=c<n.length?r[n.charAt(c)]:64;++c;const _=c<n.length?r[n.charAt(c)]:64;if(++c,h==null||w==null||m==null||_==null)throw new yd;const k=h<<2|w>>4;if(o.push(k),m!==64){const H=w<<4&240|m>>2;if(o.push(H),_!==64){const q=m<<6&192|_;o.push(q)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class yd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ad=function(n){const e=ph(n);return mh.encodeByteArray(e,!0)},eo=function(n){return Ad(n).replace(/\./g,"")},xh=function(n){try{return mh.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Id(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cd=()=>Id().__FIREBASE_DEFAULTS__,bd=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Td=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&xh(n[1]);return e&&JSON.parse(e)},wl=()=>{try{return Cd()||bd()||Td()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},wh=n=>{var e,r;return(r=(e=wl())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[n]},_d=n=>{const e=wh(n);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),o]:[e.substring(0,r),o]},vd=()=>{var n;return(n=wl())===null||n===void 0?void 0:n.config},Eh=n=>{var e;return(e=wl())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sd{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,o)=>{r?this.reject(r):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nd(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},o=e||"demo-project",c=n.iat||0,h=n.sub||n.user_id;if(!h)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:c,exp:c+3600,auth_time:c,sub:h,user_id:h,firebase:{sign_in_provider:"custom",identities:{}}},n),w="";return[eo(JSON.stringify(r)),eo(JSON.stringify(p)),w].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Rd(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Mt())}function Od(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Dd(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Md(){const n=Mt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function kd(){try{return typeof indexedDB=="object"}catch{return!1}}function Pd(){return new Promise((n,e)=>{try{let r=!0;const o="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(o);c.onsuccess=()=>{c.result.close(),r||self.indexedDB.deleteDatabase(o),n(!0)},c.onupgradeneeded=()=>{r=!1},c.onerror=()=>{var h;e(((h=c.error)===null||h===void 0?void 0:h.message)||"")}}catch(r){e(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ld="FirebaseError";class Mn extends Error{constructor(e,r,o){super(r),this.code=e,this.customData=o,this.name=Ld,Object.setPrototypeOf(this,Mn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ns.prototype.create)}}class ns{constructor(e,r,o){this.service=e,this.serviceName=r,this.errors=o}create(e,...r){const o=r[0]||{},c=`${this.service}/${e}`,h=this.errors[e],p=h?Bd(h,o):"Error",w=`${this.serviceName}: ${p} (${c}).`;return new Mn(c,w,o)}}function Bd(n,e){return n.replace(Fd,(r,o)=>{const c=e[o];return c!=null?String(c):`<${o}?>`})}const Fd=/\{\$([^}]+)}/g;function Ud(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function to(n,e){if(n===e)return!0;const r=Object.keys(n),o=Object.keys(e);for(const c of r){if(!o.includes(c))return!1;const h=n[c],p=e[c];if(Kc(h)&&Kc(p)){if(!to(h,p))return!1}else if(h!==p)return!1}for(const c of o)if(!r.includes(c))return!1;return!0}function Kc(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rs(n){const e=[];for(const[r,o]of Object.entries(n))Array.isArray(o)?o.forEach(c=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function Ti(n){const e={};return n.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[c,h]=o.split("=");e[decodeURIComponent(c)]=decodeURIComponent(h)}}),e}function _i(n){const e=n.indexOf("?");if(!e)return"";const r=n.indexOf("#",e);return n.substring(e,r>0?r:void 0)}function Vd(n,e){const r=new Hd(n,e);return r.subscribe.bind(r)}class Hd{constructor(e,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(r=>{r.next(e)})}error(e){this.forEachObserver(r=>{r.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,r,o){let c;if(e===void 0&&r===void 0&&o===void 0)throw new Error("Missing Observer.");Gd(e,["next","error","complete"])?c=e:c={next:e,error:r,complete:o},c.next===void 0&&(c.next=Ia),c.error===void 0&&(c.error=Ia),c.complete===void 0&&(c.complete=Ia);const h=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),h}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,e)}sendOne(e,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{r(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Gd(n,e){if(typeof n!="object"||n===null)return!1;for(const r of e)if(r in n&&typeof n[r]=="function")return!0;return!1}function Ia(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cn(n){return n&&n._delegate?n._delegate:n}class wr{constructor(e,r,o){this.name=e,this.instanceFactory=r,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wd{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const o=new Sd;if(this.instancesDeferred.set(r,o),this.isInitialized(r)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:r});c&&o.resolve(c)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),c=(r=e==null?void 0:e.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(h){if(c)return null;throw h}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(jd(e))try{this.getOrInitializeService({instanceIdentifier:cr})}catch{}for(const[r,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(r);try{const h=this.getOrInitializeService({instanceIdentifier:c});o.resolve(h)}catch{}}}}clearInstance(e=cr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=cr){return this.instances.has(e)}getOptions(e=cr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:o,options:r});for(const[h,p]of this.instancesDeferred.entries()){const w=this.normalizeInstanceIdentifier(h);o===w&&p.resolve(c)}return c}onInit(e,r){var o;const c=this.normalizeInstanceIdentifier(r),h=(o=this.onInitCallbacks.get(c))!==null&&o!==void 0?o:new Set;h.add(e),this.onInitCallbacks.set(c,h);const p=this.instances.get(c);return p&&e(p,c),()=>{h.delete(e)}}invokeOnInitCallbacks(e,r){const o=this.onInitCallbacks.get(r);if(!!o)for(const c of o)try{c(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:Xd(e),options:r}),this.instances.set(e,o),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=cr){return this.component?this.component.multipleInstances?e:cr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Xd(n){return n===cr?void 0:n}function jd(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zd{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new Wd(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Re;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Re||(Re={}));const Kd={debug:Re.DEBUG,verbose:Re.VERBOSE,info:Re.INFO,warn:Re.WARN,error:Re.ERROR,silent:Re.SILENT},Yd=Re.INFO,qd={[Re.DEBUG]:"log",[Re.VERBOSE]:"log",[Re.INFO]:"info",[Re.WARN]:"warn",[Re.ERROR]:"error"},Zd=(n,e,...r)=>{if(e<n.logLevel)return;const o=new Date().toISOString(),c=qd[e];if(c)console[c](`[${o}]  ${n.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class El{constructor(e){this.name=e,this._logLevel=Yd,this._logHandler=Zd,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Re))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Kd[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Re.DEBUG,...e),this._logHandler(this,Re.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Re.VERBOSE,...e),this._logHandler(this,Re.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Re.INFO,...e),this._logHandler(this,Re.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Re.WARN,...e),this._logHandler(this,Re.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Re.ERROR,...e),this._logHandler(this,Re.ERROR,...e)}}const $d=(n,e)=>e.some(r=>n instanceof r);let Yc,qc;function Qd(){return Yc||(Yc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Jd(){return qc||(qc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const yh=new WeakMap,ja=new WeakMap,Ah=new WeakMap,Ca=new WeakMap,yl=new WeakMap;function eg(n){const e=new Promise((r,o)=>{const c=()=>{n.removeEventListener("success",h),n.removeEventListener("error",p)},h=()=>{r(Yn(n.result)),c()},p=()=>{o(n.error),c()};n.addEventListener("success",h),n.addEventListener("error",p)});return e.then(r=>{r instanceof IDBCursor&&yh.set(r,n)}).catch(()=>{}),yl.set(e,n),e}function tg(n){if(ja.has(n))return;const e=new Promise((r,o)=>{const c=()=>{n.removeEventListener("complete",h),n.removeEventListener("error",p),n.removeEventListener("abort",p)},h=()=>{r(),c()},p=()=>{o(n.error||new DOMException("AbortError","AbortError")),c()};n.addEventListener("complete",h),n.addEventListener("error",p),n.addEventListener("abort",p)});ja.set(n,e)}let za={get(n,e,r){if(n instanceof IDBTransaction){if(e==="done")return ja.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ah.get(n);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Yn(n[e])},set(n,e,r){return n[e]=r,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ng(n){za=n(za)}function rg(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const o=n.call(ba(this),e,...r);return Ah.set(o,e.sort?e.sort():[e]),Yn(o)}:Jd().includes(n)?function(...e){return n.apply(ba(this),e),Yn(yh.get(this))}:function(...e){return Yn(n.apply(ba(this),e))}}function ig(n){return typeof n=="function"?rg(n):(n instanceof IDBTransaction&&tg(n),$d(n,Qd())?new Proxy(n,za):n)}function Yn(n){if(n instanceof IDBRequest)return eg(n);if(Ca.has(n))return Ca.get(n);const e=ig(n);return e!==n&&(Ca.set(n,e),yl.set(e,n)),e}const ba=n=>yl.get(n);function sg(n,e,{blocked:r,upgrade:o,blocking:c,terminated:h}={}){const p=indexedDB.open(n,e),w=Yn(p);return o&&p.addEventListener("upgradeneeded",A=>{o(Yn(p.result),A.oldVersion,A.newVersion,Yn(p.transaction))}),r&&p.addEventListener("blocked",()=>r()),w.then(A=>{h&&A.addEventListener("close",()=>h()),c&&A.addEventListener("versionchange",()=>c())}).catch(()=>{}),w}const og=["get","getKey","getAll","getAllKeys","count"],ag=["put","add","delete","clear"],Ta=new Map;function Zc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ta.get(e))return Ta.get(e);const r=e.replace(/FromIndex$/,""),o=e!==r,c=ag.includes(r);if(!(r in(o?IDBIndex:IDBObjectStore).prototype)||!(c||og.includes(r)))return;const h=async function(p,...w){const A=this.transaction(p,c?"readwrite":"readonly");let m=A.store;return o&&(m=m.index(w.shift())),(await Promise.all([m[r](...w),c&&A.done]))[0]};return Ta.set(e,h),h}ng(n=>({...n,get:(e,r,o)=>Zc(e,r)||n.get(e,r,o),has:(e,r)=>!!Zc(e,r)||n.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(cg(r)){const o=r.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(r=>r).join(" ")}}function cg(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ka="@firebase/app",$c="0.9.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Er=new El("@firebase/app"),ug="@firebase/app-compat",hg="@firebase/analytics-compat",fg="@firebase/analytics",dg="@firebase/app-check-compat",gg="@firebase/app-check",pg="@firebase/auth",mg="@firebase/auth-compat",xg="@firebase/database",wg="@firebase/database-compat",Eg="@firebase/functions",yg="@firebase/functions-compat",Ag="@firebase/installations",Ig="@firebase/installations-compat",Cg="@firebase/messaging",bg="@firebase/messaging-compat",Tg="@firebase/performance",_g="@firebase/performance-compat",vg="@firebase/remote-config",Sg="@firebase/remote-config-compat",Ng="@firebase/storage",Rg="@firebase/storage-compat",Og="@firebase/firestore",Dg="@firebase/firestore-compat",Mg="firebase",kg="9.18.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ya="[DEFAULT]",Pg={[Ka]:"fire-core",[ug]:"fire-core-compat",[fg]:"fire-analytics",[hg]:"fire-analytics-compat",[gg]:"fire-app-check",[dg]:"fire-app-check-compat",[pg]:"fire-auth",[mg]:"fire-auth-compat",[xg]:"fire-rtdb",[wg]:"fire-rtdb-compat",[Eg]:"fire-fn",[yg]:"fire-fn-compat",[Ag]:"fire-iid",[Ig]:"fire-iid-compat",[Cg]:"fire-fcm",[bg]:"fire-fcm-compat",[Tg]:"fire-perf",[_g]:"fire-perf-compat",[vg]:"fire-rc",[Sg]:"fire-rc-compat",[Ng]:"fire-gcs",[Rg]:"fire-gcs-compat",[Og]:"fire-fst",[Dg]:"fire-fst-compat","fire-js":"fire-js",[Mg]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const no=new Map,qa=new Map;function Lg(n,e){try{n.container.addComponent(e)}catch(r){Er.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,r)}}function Kr(n){const e=n.name;if(qa.has(e))return Er.debug(`There were multiple attempts to register component ${e}.`),!1;qa.set(e,n);for(const r of no.values())Lg(r,n);return!0}function Al(n,e){const r=n.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),n.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bg={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},qn=new ns("app","Firebase",Bg);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fg{constructor(e,r,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new wr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw qn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const is=kg;function Ih(n,e={}){let r=n;typeof e!="object"&&(e={name:e});const o=Object.assign({name:Ya,automaticDataCollectionEnabled:!1},e),c=o.name;if(typeof c!="string"||!c)throw qn.create("bad-app-name",{appName:String(c)});if(r||(r=vd()),!r)throw qn.create("no-options");const h=no.get(c);if(h){if(to(r,h.options)&&to(o,h.config))return h;throw qn.create("duplicate-app",{appName:c})}const p=new zd(c);for(const A of qa.values())p.addComponent(A);const w=new Fg(r,o,p);return no.set(c,w),w}function Ch(n=Ya){const e=no.get(n);if(!e&&n===Ya)return Ih();if(!e)throw qn.create("no-app",{appName:n});return e}function Zn(n,e,r){var o;let c=(o=Pg[n])!==null&&o!==void 0?o:n;r&&(c+=`-${r}`);const h=c.match(/\s|\//),p=e.match(/\s|\//);if(h||p){const w=[`Unable to register library "${c}" with version "${e}":`];h&&w.push(`library name "${c}" contains illegal characters (whitespace or "/")`),h&&p&&w.push("and"),p&&w.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Er.warn(w.join(" "));return}Kr(new wr(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ug="firebase-heartbeat-database",Vg=1,Vi="firebase-heartbeat-store";let _a=null;function bh(){return _a||(_a=sg(Ug,Vg,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Vi)}}}).catch(n=>{throw qn.create("idb-open",{originalErrorMessage:n.message})})),_a}async function Hg(n){try{return(await bh()).transaction(Vi).objectStore(Vi).get(Th(n))}catch(e){if(e instanceof Mn)Er.warn(e.message);else{const r=qn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Er.warn(r.message)}}}async function Qc(n,e){try{const o=(await bh()).transaction(Vi,"readwrite");return await o.objectStore(Vi).put(e,Th(n)),o.done}catch(r){if(r instanceof Mn)Er.warn(r.message);else{const o=qn.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});Er.warn(o.message)}}}function Th(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gg=1024,Wg=30*24*60*60*1e3;class Xg{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new zg(r),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Jc();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(c=>c.date===o)))return this._heartbeatsCache.heartbeats.push({date:o,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(c=>{const h=new Date(c.date).valueOf();return Date.now()-h<=Wg}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Jc(),{heartbeatsToSend:r,unsentEntries:o}=jg(this._heartbeatsCache.heartbeats),c=eo(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=e,o.length>0?(this._heartbeatsCache.heartbeats=o,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),c}}function Jc(){return new Date().toISOString().substring(0,10)}function jg(n,e=Gg){const r=[];let o=n.slice();for(const c of n){const h=r.find(p=>p.agent===c.agent);if(h){if(h.dates.push(c.date),eu(r)>e){h.dates.pop();break}}else if(r.push({agent:c.agent,dates:[c.date]}),eu(r)>e){r.pop();break}o=o.slice(1)}return{heartbeatsToSend:r,unsentEntries:o}}class zg{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return kd()?Pd().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await Hg(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const c=await this.read();return Qc(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const c=await this.read();return Qc(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function eu(n){return eo(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kg(n){Kr(new wr("platform-logger",e=>new lg(e),"PRIVATE")),Kr(new wr("heartbeat",e=>new Xg(e),"PRIVATE")),Zn(Ka,$c,n),Zn(Ka,$c,"esm2017"),Zn("fire-js","")}Kg("");var Yg="firebase",qg="9.18.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zn(Yg,qg,"app");var Zg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$,Il=Il||{},ae=Zg||self;function ro(){}function bo(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function ss(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function $g(n){return Object.prototype.hasOwnProperty.call(n,va)&&n[va]||(n[va]=++Qg)}var va="closure_uid_"+(1e9*Math.random()>>>0),Qg=0;function Jg(n,e,r){return n.call.apply(n.bind,arguments)}function ep(n,e,r){if(!n)throw Error();if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,o),n.apply(e,c)}}return function(){return n.apply(e,arguments)}}function Ot(n,e,r){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Ot=Jg:Ot=ep,Ot.apply(null,arguments)}function Ps(n,e){var r=Array.prototype.slice.call(arguments,1);return function(){var o=r.slice();return o.push.apply(o,arguments),n.apply(this,o)}}function Ct(n,e){function r(){}r.prototype=e.prototype,n.X=e.prototype,n.prototype=new r,n.prototype.constructor=n,n.Wb=function(o,c,h){for(var p=Array(arguments.length-2),w=2;w<arguments.length;w++)p[w-2]=arguments[w];return e.prototype[c].apply(o,p)}}function er(){this.s=this.s,this.o=this.o}var tp=0;er.prototype.s=!1;er.prototype.na=function(){!this.s&&(this.s=!0,this.M(),tp!=0)&&$g(this)};er.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const _h=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let r=0;r<n.length;r++)if(r in n&&n[r]===e)return r;return-1};function Cl(n){const e=n.length;if(0<e){const r=Array(e);for(let o=0;o<e;o++)r[o]=n[o];return r}return[]}function tu(n,e){for(let r=1;r<arguments.length;r++){const o=arguments[r];if(bo(o)){const c=n.length||0,h=o.length||0;n.length=c+h;for(let p=0;p<h;p++)n[c+p]=o[p]}else n.push(o)}}function Dt(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Dt.prototype.h=function(){this.defaultPrevented=!0};var np=function(){if(!ae.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{ae.addEventListener("test",ro,e),ae.removeEventListener("test",ro,e)}catch{}return n}();function io(n){return/^[\s\xa0]*$/.test(n)}var nu=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function Sa(n,e){return n<e?-1:n>e?1:0}function To(){var n=ae.navigator;return n&&(n=n.userAgent)?n:""}function En(n){return To().indexOf(n)!=-1}function bl(n){return bl[" "](n),n}bl[" "]=ro;function rp(n){var e=op;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}var ip=En("Opera"),Yr=En("Trident")||En("MSIE"),vh=En("Edge"),Za=vh||Yr,Sh=En("Gecko")&&!(To().toLowerCase().indexOf("webkit")!=-1&&!En("Edge"))&&!(En("Trident")||En("MSIE"))&&!En("Edge"),sp=To().toLowerCase().indexOf("webkit")!=-1&&!En("Edge");function Nh(){var n=ae.document;return n?n.documentMode:void 0}var so;e:{var Na="",Ra=function(){var n=To();if(Sh)return/rv:([^\);]+)(\)|;)/.exec(n);if(vh)return/Edge\/([\d\.]+)/.exec(n);if(Yr)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(sp)return/WebKit\/(\S+)/.exec(n);if(ip)return/(?:Version)[ \/]?(\S+)/.exec(n)}();if(Ra&&(Na=Ra?Ra[1]:""),Yr){var Oa=Nh();if(Oa!=null&&Oa>parseFloat(Na)){so=String(Oa);break e}}so=Na}var op={};function ap(){return rp(function(){let n=0;const e=nu(String(so)).split("."),r=nu("9").split("."),o=Math.max(e.length,r.length);for(let p=0;n==0&&p<o;p++){var c=e[p]||"",h=r[p]||"";do{if(c=/(\d*)(\D*)(.*)/.exec(c)||["","","",""],h=/(\d*)(\D*)(.*)/.exec(h)||["","","",""],c[0].length==0&&h[0].length==0)break;n=Sa(c[1].length==0?0:parseInt(c[1],10),h[1].length==0?0:parseInt(h[1],10))||Sa(c[2].length==0,h[2].length==0)||Sa(c[2],h[2]),c=c[3],h=h[3]}while(n==0)}return 0<=n})}var $a;if(ae.document&&Yr){var ru=Nh();$a=ru||parseInt(so,10)||void 0}else $a=void 0;var lp=$a;function Hi(n,e){if(Dt.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var r=this.type=n.type,o=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Sh){e:{try{bl(e.nodeName);var c=!0;break e}catch{}c=!1}c||(e=null)}}else r=="mouseover"?e=n.fromElement:r=="mouseout"&&(e=n.toElement);this.relatedTarget=e,o?(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:cp[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Hi.X.h.call(this)}}Ct(Hi,Dt);var cp={2:"touch",3:"pen",4:"mouse"};Hi.prototype.h=function(){Hi.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var os="closure_listenable_"+(1e6*Math.random()|0),up=0;function hp(n,e,r,o,c){this.listener=n,this.proxy=null,this.src=e,this.type=r,this.capture=!!o,this.ha=c,this.key=++up,this.ba=this.ea=!1}function _o(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function Tl(n,e,r){for(const o in n)e.call(r,n[o],o,n)}function Rh(n){const e={};for(const r in n)e[r]=n[r];return e}const iu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Oh(n,e){let r,o;for(let c=1;c<arguments.length;c++){o=arguments[c];for(r in o)n[r]=o[r];for(let h=0;h<iu.length;h++)r=iu[h],Object.prototype.hasOwnProperty.call(o,r)&&(n[r]=o[r])}}function vo(n){this.src=n,this.g={},this.h=0}vo.prototype.add=function(n,e,r,o,c){var h=n.toString();n=this.g[h],n||(n=this.g[h]=[],this.h++);var p=Ja(n,e,o,c);return-1<p?(e=n[p],r||(e.ea=!1)):(e=new hp(e,this.src,h,!!o,c),e.ea=r,n.push(e)),e};function Qa(n,e){var r=e.type;if(r in n.g){var o=n.g[r],c=_h(o,e),h;(h=0<=c)&&Array.prototype.splice.call(o,c,1),h&&(_o(e),n.g[r].length==0&&(delete n.g[r],n.h--))}}function Ja(n,e,r,o){for(var c=0;c<n.length;++c){var h=n[c];if(!h.ba&&h.listener==e&&h.capture==!!r&&h.ha==o)return c}return-1}var _l="closure_lm_"+(1e6*Math.random()|0),Da={};function Dh(n,e,r,o,c){if(o&&o.once)return kh(n,e,r,o,c);if(Array.isArray(e)){for(var h=0;h<e.length;h++)Dh(n,e[h],r,o,c);return null}return r=Nl(r),n&&n[os]?n.N(e,r,ss(o)?!!o.capture:!!o,c):Mh(n,e,r,!1,o,c)}function Mh(n,e,r,o,c,h){if(!e)throw Error("Invalid event type");var p=ss(c)?!!c.capture:!!c,w=Sl(n);if(w||(n[_l]=w=new vo(n)),r=w.add(e,r,o,p,h),r.proxy)return r;if(o=fp(),r.proxy=o,o.src=n,o.listener=r,n.addEventListener)np||(c=p),c===void 0&&(c=!1),n.addEventListener(e.toString(),o,c);else if(n.attachEvent)n.attachEvent(Lh(e.toString()),o);else if(n.addListener&&n.removeListener)n.addListener(o);else throw Error("addEventListener and attachEvent are unavailable.");return r}function fp(){function n(r){return e.call(n.src,n.listener,r)}const e=dp;return n}function kh(n,e,r,o,c){if(Array.isArray(e)){for(var h=0;h<e.length;h++)kh(n,e[h],r,o,c);return null}return r=Nl(r),n&&n[os]?n.O(e,r,ss(o)?!!o.capture:!!o,c):Mh(n,e,r,!0,o,c)}function Ph(n,e,r,o,c){if(Array.isArray(e))for(var h=0;h<e.length;h++)Ph(n,e[h],r,o,c);else o=ss(o)?!!o.capture:!!o,r=Nl(r),n&&n[os]?(n=n.i,e=String(e).toString(),e in n.g&&(h=n.g[e],r=Ja(h,r,o,c),-1<r&&(_o(h[r]),Array.prototype.splice.call(h,r,1),h.length==0&&(delete n.g[e],n.h--)))):n&&(n=Sl(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Ja(e,r,o,c)),(r=-1<n?e[n]:null)&&vl(r))}function vl(n){if(typeof n!="number"&&n&&!n.ba){var e=n.src;if(e&&e[os])Qa(e.i,n);else{var r=n.type,o=n.proxy;e.removeEventListener?e.removeEventListener(r,o,n.capture):e.detachEvent?e.detachEvent(Lh(r),o):e.addListener&&e.removeListener&&e.removeListener(o),(r=Sl(e))?(Qa(r,n),r.h==0&&(r.src=null,e[_l]=null)):_o(n)}}}function Lh(n){return n in Da?Da[n]:Da[n]="on"+n}function dp(n,e){if(n.ba)n=!0;else{e=new Hi(e,this);var r=n.listener,o=n.ha||n.src;n.ea&&vl(n),n=r.call(o,e)}return n}function Sl(n){return n=n[_l],n instanceof vo?n:null}var Ma="__closure_events_fn_"+(1e9*Math.random()>>>0);function Nl(n){return typeof n=="function"?n:(n[Ma]||(n[Ma]=function(e){return n.handleEvent(e)}),n[Ma])}function pt(){er.call(this),this.i=new vo(this),this.P=this,this.I=null}Ct(pt,er);pt.prototype[os]=!0;pt.prototype.removeEventListener=function(n,e,r,o){Ph(this,n,e,r,o)};function It(n,e){var r,o=n.I;if(o)for(r=[];o;o=o.I)r.push(o);if(n=n.P,o=e.type||e,typeof e=="string")e=new Dt(e,n);else if(e instanceof Dt)e.target=e.target||n;else{var c=e;e=new Dt(o,n),Oh(e,c)}if(c=!0,r)for(var h=r.length-1;0<=h;h--){var p=e.g=r[h];c=Ls(p,o,!0,e)&&c}if(p=e.g=n,c=Ls(p,o,!0,e)&&c,c=Ls(p,o,!1,e)&&c,r)for(h=0;h<r.length;h++)p=e.g=r[h],c=Ls(p,o,!1,e)&&c}pt.prototype.M=function(){if(pt.X.M.call(this),this.i){var n=this.i,e;for(e in n.g){for(var r=n.g[e],o=0;o<r.length;o++)_o(r[o]);delete n.g[e],n.h--}}this.I=null};pt.prototype.N=function(n,e,r,o){return this.i.add(String(n),e,!1,r,o)};pt.prototype.O=function(n,e,r,o){return this.i.add(String(n),e,!0,r,o)};function Ls(n,e,r,o){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var c=!0,h=0;h<e.length;++h){var p=e[h];if(p&&!p.ba&&p.capture==r){var w=p.listener,A=p.ha||p.src;p.ea&&Qa(n.i,p),c=w.call(A,o)!==!1&&c}}return c&&!o.defaultPrevented}var Rl=ae.JSON.stringify;function gp(){var n=Uh;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}class pp{constructor(){this.h=this.g=null}add(e,r){const o=Bh.get();o.set(e,r),this.h?this.h.next=o:this.g=o,this.h=o}}var Bh=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new mp,n=>n.reset());class mp{constructor(){this.next=this.g=this.h=null}set(e,r){this.h=e,this.g=r,this.next=null}reset(){this.next=this.g=this.h=null}}function xp(n){ae.setTimeout(()=>{throw n},0)}function Fh(n,e){el||wp(),tl||(el(),tl=!0),Uh.add(n,e)}var el;function wp(){var n=ae.Promise.resolve(void 0);el=function(){n.then(Ep)}}var tl=!1,Uh=new pp;function Ep(){for(var n;n=gp();){try{n.h.call(n.g)}catch(r){xp(r)}var e=Bh;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}tl=!1}function So(n,e){pt.call(this),this.h=n||1,this.g=e||ae,this.j=Ot(this.lb,this),this.l=Date.now()}Ct(So,pt);$=So.prototype;$.ca=!1;$.R=null;$.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),It(this,"tick"),this.ca&&(Ol(this),this.start()))}};$.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Ol(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}$.M=function(){So.X.M.call(this),Ol(this),delete this.g};function Dl(n,e,r){if(typeof n=="function")r&&(n=Ot(n,r));else if(n&&typeof n.handleEvent=="function")n=Ot(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:ae.setTimeout(n,e||0)}function Vh(n){n.g=Dl(()=>{n.g=null,n.i&&(n.i=!1,Vh(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}class yp extends er{constructor(e,r){super(),this.m=e,this.j=r,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Vh(this)}M(){super.M(),this.g&&(ae.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Gi(n){er.call(this),this.h=n,this.g={}}Ct(Gi,er);var su=[];function Hh(n,e,r,o){Array.isArray(r)||(r&&(su[0]=r.toString()),r=su);for(var c=0;c<r.length;c++){var h=Dh(e,r[c],o||n.handleEvent,!1,n.h||n);if(!h)break;n.g[h.key]=h}}function Gh(n){Tl(n.g,function(e,r){this.g.hasOwnProperty(r)&&vl(e)},n),n.g={}}Gi.prototype.M=function(){Gi.X.M.call(this),Gh(this)};Gi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function No(){this.g=!0}No.prototype.Aa=function(){this.g=!1};function Ap(n,e,r,o,c,h){n.info(function(){if(n.g)if(h)for(var p="",w=h.split("&"),A=0;A<w.length;A++){var m=w[A].split("=");if(1<m.length){var C=m[0];m=m[1];var _=C.split("_");p=2<=_.length&&_[1]=="type"?p+(C+"="+m+"&"):p+(C+"=redacted&")}}else p=null;else p=h;return"XMLHTTP REQ ("+o+") [attempt "+c+"]: "+e+`
`+r+`
`+p})}function Ip(n,e,r,o,c,h,p){n.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+c+"]: "+e+`
`+r+`
`+h+" "+p})}function Vr(n,e,r,o){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+bp(n,r)+(o?" "+o:"")})}function Cp(n,e){n.info(function(){return"TIMEOUT: "+e})}No.prototype.info=function(){};function bp(n,e){if(!n.g)return e;if(!e)return null;try{var r=JSON.parse(e);if(r){for(n=0;n<r.length;n++)if(Array.isArray(r[n])){var o=r[n];if(!(2>o.length)){var c=o[1];if(Array.isArray(c)&&!(1>c.length)){var h=c[0];if(h!="noop"&&h!="stop"&&h!="close")for(var p=1;p<c.length;p++)c[p]=""}}}}return Rl(r)}catch{return e}}var Tr={},ou=null;function Ro(){return ou=ou||new pt}Tr.Pa="serverreachability";function Wh(n){Dt.call(this,Tr.Pa,n)}Ct(Wh,Dt);function Wi(n){const e=Ro();It(e,new Wh(e))}Tr.STAT_EVENT="statevent";function Xh(n,e){Dt.call(this,Tr.STAT_EVENT,n),this.stat=e}Ct(Xh,Dt);function Ut(n){const e=Ro();It(e,new Xh(e,n))}Tr.Qa="timingevent";function jh(n,e){Dt.call(this,Tr.Qa,n),this.size=e}Ct(jh,Dt);function as(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return ae.setTimeout(function(){n()},e)}var Oo={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},zh={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Ml(){}Ml.prototype.h=null;function au(n){return n.h||(n.h=n.i())}function Kh(){}var ls={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function kl(){Dt.call(this,"d")}Ct(kl,Dt);function Pl(){Dt.call(this,"c")}Ct(Pl,Dt);var nl;function Do(){}Ct(Do,Ml);Do.prototype.g=function(){return new XMLHttpRequest};Do.prototype.i=function(){return{}};nl=new Do;function cs(n,e,r,o){this.l=n,this.j=e,this.m=r,this.U=o||1,this.S=new Gi(this),this.O=Tp,n=Za?125:void 0,this.T=new So(n),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Yh}function Yh(){this.i=null,this.g="",this.h=!1}var Tp=45e3,rl={},oo={};$=cs.prototype;$.setTimeout=function(n){this.O=n};function il(n,e,r){n.K=1,n.v=ko(Rn(e)),n.s=r,n.P=!0,qh(n,null)}function qh(n,e){n.F=Date.now(),us(n),n.A=Rn(n.v);var r=n.A,o=n.U;Array.isArray(o)||(o=[String(o)]),rf(r.i,"t",o),n.C=0,r=n.l.H,n.h=new Yh,n.g=Tf(n.l,r?e:null,!n.s),0<n.N&&(n.L=new yp(Ot(n.La,n,n.g),n.N)),Hh(n.S,n.g,"readystatechange",n.ib),e=n.H?Rh(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),Wi(),Ap(n.j,n.u,n.A,n.m,n.U,n.s)}$.ib=function(n){n=n.target;const e=this.L;e&&Tn(n)==3?e.l():this.La(n)};$.La=function(n){try{if(n==this.g)e:{const C=Tn(this.g);var e=this.g.Ea();const _=this.g.aa();if(!(3>C)&&(C!=3||Za||this.g&&(this.h.h||this.g.fa()||hu(this.g)))){this.I||C!=4||e==7||(e==8||0>=_?Wi(3):Wi(2)),Mo(this);var r=this.g.aa();this.Y=r;t:if(Zh(this)){var o=hu(this.g);n="";var c=o.length,h=Tn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){hr(this),Mi(this);var p="";break t}this.h.i=new ae.TextDecoder}for(e=0;e<c;e++)this.h.h=!0,n+=this.h.i.decode(o[e],{stream:h&&e==c-1});o.splice(0,c),this.h.g+=n,this.C=0,p=this.h.g}else p=this.g.fa();if(this.i=r==200,Ip(this.j,this.u,this.A,this.m,this.U,C,r),this.i){if(this.Z&&!this.J){t:{if(this.g){var w,A=this.g;if((w=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!io(w)){var m=w;break t}}m=null}if(r=m)Vr(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,sl(this,r);else{this.i=!1,this.o=3,Ut(12),hr(this),Mi(this);break e}}this.P?($h(this,C,p),Za&&this.i&&C==3&&(Hh(this.S,this.T,"tick",this.hb),this.T.start())):(Vr(this.j,this.m,p,null),sl(this,p)),C==4&&hr(this),this.i&&!this.I&&(C==4?Af(this.l,this):(this.i=!1,us(this)))}else r==400&&0<p.indexOf("Unknown SID")?(this.o=3,Ut(12)):(this.o=0,Ut(13)),hr(this),Mi(this)}}}catch{}finally{}};function Zh(n){return n.g?n.u=="GET"&&n.K!=2&&n.l.Da:!1}function $h(n,e,r){let o=!0,c;for(;!n.I&&n.C<r.length;)if(c=_p(n,r),c==oo){e==4&&(n.o=4,Ut(14),o=!1),Vr(n.j,n.m,null,"[Incomplete Response]");break}else if(c==rl){n.o=4,Ut(15),Vr(n.j,n.m,r,"[Invalid Chunk]"),o=!1;break}else Vr(n.j,n.m,c,null),sl(n,c);Zh(n)&&c!=oo&&c!=rl&&(n.h.g="",n.C=0),e!=4||r.length!=0||n.h.h||(n.o=1,Ut(16),o=!1),n.i=n.i&&o,o?0<r.length&&!n.$&&(n.$=!0,e=n.l,e.g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),Gl(e),e.K=!0,Ut(11))):(Vr(n.j,n.m,r,"[Invalid Chunked Response]"),hr(n),Mi(n))}$.hb=function(){if(this.g){var n=Tn(this.g),e=this.g.fa();this.C<e.length&&(Mo(this),$h(this,n,e),this.i&&n!=4&&us(this))}};function _p(n,e){var r=n.C,o=e.indexOf(`
`,r);return o==-1?oo:(r=Number(e.substring(r,o)),isNaN(r)?rl:(o+=1,o+r>e.length?oo:(e=e.substr(o,r),n.C=o+r,e)))}$.cancel=function(){this.I=!0,hr(this)};function us(n){n.V=Date.now()+n.O,Qh(n,n.O)}function Qh(n,e){if(n.B!=null)throw Error("WatchDog timer not null");n.B=as(Ot(n.gb,n),e)}function Mo(n){n.B&&(ae.clearTimeout(n.B),n.B=null)}$.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(Cp(this.j,this.A),this.K!=2&&(Wi(),Ut(17)),hr(this),this.o=2,Mi(this)):Qh(this,this.V-n)};function Mi(n){n.l.G==0||n.I||Af(n.l,n)}function hr(n){Mo(n);var e=n.L;e&&typeof e.na=="function"&&e.na(),n.L=null,Ol(n.T),Gh(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function sl(n,e){try{var r=n.l;if(r.G!=0&&(r.g==n||ol(r.h,n))){if(!n.J&&ol(r.h,n)&&r.G==3){try{var o=r.Fa.g.parse(e)}catch{o=null}if(Array.isArray(o)&&o.length==3){var c=o;if(c[0]==0){e:if(!r.u){if(r.g)if(r.g.F+3e3<n.F)co(r),Bo(r);else break e;Hl(r),Ut(18)}}else r.Ba=c[1],0<r.Ba-r.T&&37500>c[2]&&r.L&&r.A==0&&!r.v&&(r.v=as(Ot(r.cb,r),6e3));if(1>=af(r.h)&&r.ja){try{r.ja()}catch{}r.ja=void 0}}else fr(r,11)}else if((n.J||r.g==n)&&co(r),!io(e))for(c=r.Fa.g.parse(e),e=0;e<c.length;e++){let m=c[e];if(r.T=m[0],m=m[1],r.G==2)if(m[0]=="c"){r.I=m[1],r.ka=m[2];const C=m[3];C!=null&&(r.ma=C,r.j.info("VER="+r.ma));const _=m[4];_!=null&&(r.Ca=_,r.j.info("SVER="+r.Ca));const k=m[5];k!=null&&typeof k=="number"&&0<k&&(o=1.5*k,r.J=o,r.j.info("backChannelRequestTimeoutMs_="+o)),o=r;const H=n.g;if(H){const q=H.g?H.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(q){var h=o.h;h.g||q.indexOf("spdy")==-1&&q.indexOf("quic")==-1&&q.indexOf("h2")==-1||(h.j=h.l,h.g=new Set,h.h&&(Ll(h,h.h),h.h=null))}if(o.D){const j=H.g?H.g.getResponseHeader("X-HTTP-Session-Id"):null;j&&(o.za=j,je(o.F,o.D,j))}}r.G=3,r.l&&r.l.xa(),r.$&&(r.P=Date.now()-n.F,r.j.info("Handshake RTT: "+r.P+"ms")),o=r;var p=n;if(o.sa=bf(o,o.H?o.ka:null,o.V),p.J){lf(o.h,p);var w=p,A=o.J;A&&w.setTimeout(A),w.B&&(Mo(w),us(w)),o.g=p}else Ef(o);0<r.i.length&&Fo(r)}else m[0]!="stop"&&m[0]!="close"||fr(r,7);else r.G==3&&(m[0]=="stop"||m[0]=="close"?m[0]=="stop"?fr(r,7):Vl(r):m[0]!="noop"&&r.l&&r.l.wa(m),r.A=0)}}Wi(4)}catch{}}function vp(n){if(n.W&&typeof n.W=="function")return n.W();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(bo(n)){for(var e=[],r=n.length,o=0;o<r;o++)e.push(n[o]);return e}e=[],r=0;for(o in n)e[r++]=n[o];return e}function Sp(n){if(n.oa&&typeof n.oa=="function")return n.oa();if(!n.W||typeof n.W!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(bo(n)||typeof n=="string"){var e=[];n=n.length;for(var r=0;r<n;r++)e.push(r);return e}e=[],r=0;for(const o in n)e[r++]=o;return e}}}function Jh(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(bo(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var r=Sp(n),o=vp(n),c=o.length,h=0;h<c;h++)e.call(void 0,o[h],r&&r[h],n)}var ef=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Np(n,e){if(n){n=n.split("&");for(var r=0;r<n.length;r++){var o=n[r].indexOf("="),c=null;if(0<=o){var h=n[r].substring(0,o);c=n[r].substring(o+1)}else h=n[r];e(h,c?decodeURIComponent(c.replace(/\+/g," ")):"")}}}function pr(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof pr){this.h=e!==void 0?e:n.h,ao(this,n.j),this.s=n.s,this.g=n.g,lo(this,n.m),this.l=n.l,e=n.i;var r=new Xi;r.i=e.i,e.g&&(r.g=new Map(e.g),r.h=e.h),lu(this,r),this.o=n.o}else n&&(r=String(n).match(ef))?(this.h=!!e,ao(this,r[1]||"",!0),this.s=vi(r[2]||""),this.g=vi(r[3]||"",!0),lo(this,r[4]),this.l=vi(r[5]||"",!0),lu(this,r[6]||"",!0),this.o=vi(r[7]||"")):(this.h=!!e,this.i=new Xi(null,this.h))}pr.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Si(e,cu,!0),":");var r=this.g;return(r||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Si(e,cu,!0),"@"),n.push(encodeURIComponent(String(r)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),r=this.m,r!=null&&n.push(":",String(r))),(r=this.l)&&(this.g&&r.charAt(0)!="/"&&n.push("/"),n.push(Si(r,r.charAt(0)=="/"?Dp:Op,!0))),(r=this.i.toString())&&n.push("?",r),(r=this.o)&&n.push("#",Si(r,kp)),n.join("")};function Rn(n){return new pr(n)}function ao(n,e,r){n.j=r?vi(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function lo(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function lu(n,e,r){e instanceof Xi?(n.i=e,Pp(n.i,n.h)):(r||(e=Si(e,Mp)),n.i=new Xi(e,n.h))}function je(n,e,r){n.i.set(e,r)}function ko(n){return je(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function vi(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Si(n,e,r){return typeof n=="string"?(n=encodeURI(n).replace(e,Rp),r&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Rp(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var cu=/[#\/\?@]/g,Op=/[#\?:]/g,Dp=/[#\?]/g,Mp=/[#\?@]/g,kp=/#/g;function Xi(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function tr(n){n.g||(n.g=new Map,n.h=0,n.i&&Np(n.i,function(e,r){n.add(decodeURIComponent(e.replace(/\+/g," ")),r)}))}$=Xi.prototype;$.add=function(n,e){tr(this),this.i=null,n=ii(this,n);var r=this.g.get(n);return r||this.g.set(n,r=[]),r.push(e),this.h+=1,this};function tf(n,e){tr(n),e=ii(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function nf(n,e){return tr(n),e=ii(n,e),n.g.has(e)}$.forEach=function(n,e){tr(this),this.g.forEach(function(r,o){r.forEach(function(c){n.call(e,c,o,this)},this)},this)};$.oa=function(){tr(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),r=[];for(let o=0;o<e.length;o++){const c=n[o];for(let h=0;h<c.length;h++)r.push(e[o])}return r};$.W=function(n){tr(this);let e=[];if(typeof n=="string")nf(this,n)&&(e=e.concat(this.g.get(ii(this,n))));else{n=Array.from(this.g.values());for(let r=0;r<n.length;r++)e=e.concat(n[r])}return e};$.set=function(n,e){return tr(this),this.i=null,n=ii(this,n),nf(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};$.get=function(n,e){return n?(n=this.W(n),0<n.length?String(n[0]):e):e};function rf(n,e,r){tf(n,e),0<r.length&&(n.i=null,n.g.set(ii(n,e),Cl(r)),n.h+=r.length)}$.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var r=0;r<e.length;r++){var o=e[r];const h=encodeURIComponent(String(o)),p=this.W(o);for(o=0;o<p.length;o++){var c=h;p[o]!==""&&(c+="="+encodeURIComponent(String(p[o]))),n.push(c)}}return this.i=n.join("&")};function ii(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Pp(n,e){e&&!n.j&&(tr(n),n.i=null,n.g.forEach(function(r,o){var c=o.toLowerCase();o!=c&&(tf(this,o),rf(this,c,r))},n)),n.j=e}var Lp=class{constructor(n,e){this.h=n,this.g=e}};function sf(n){this.l=n||Bp,ae.PerformanceNavigationTiming?(n=ae.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(ae.g&&ae.g.Ga&&ae.g.Ga()&&ae.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Bp=10;function of(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function af(n){return n.h?1:n.g?n.g.size:0}function ol(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Ll(n,e){n.g?n.g.add(e):n.h=e}function lf(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}sf.prototype.cancel=function(){if(this.i=cf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const n of this.g.values())n.cancel();this.g.clear()}};function cf(n){if(n.h!=null)return n.i.concat(n.h.D);if(n.g!=null&&n.g.size!==0){let e=n.i;for(const r of n.g.values())e=e.concat(r.D);return e}return Cl(n.i)}function Bl(){}Bl.prototype.stringify=function(n){return ae.JSON.stringify(n,void 0)};Bl.prototype.parse=function(n){return ae.JSON.parse(n,void 0)};function Fp(){this.g=new Bl}function Up(n,e,r){const o=r||"";try{Jh(n,function(c,h){let p=c;ss(c)&&(p=Rl(c)),e.push(o+h+"="+encodeURIComponent(p))})}catch(c){throw e.push(o+"type="+encodeURIComponent("_badmap")),c}}function Vp(n,e){const r=new No;if(ae.Image){const o=new Image;o.onload=Ps(Bs,r,o,"TestLoadImage: loaded",!0,e),o.onerror=Ps(Bs,r,o,"TestLoadImage: error",!1,e),o.onabort=Ps(Bs,r,o,"TestLoadImage: abort",!1,e),o.ontimeout=Ps(Bs,r,o,"TestLoadImage: timeout",!1,e),ae.setTimeout(function(){o.ontimeout&&o.ontimeout()},1e4),o.src=n}else e(!1)}function Bs(n,e,r,o,c){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,c(o)}catch{}}function hs(n){this.l=n.ac||null,this.j=n.jb||!1}Ct(hs,Ml);hs.prototype.g=function(){return new Po(this.l,this.j)};hs.prototype.i=function(n){return function(){return n}}({});function Po(n,e){pt.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Fl,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ct(Po,pt);var Fl=0;$=Po.prototype;$.open=function(n,e){if(this.readyState!=Fl)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,ji(this)};$.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||ae).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))};$.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,fs(this)),this.readyState=Fl};$.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,ji(this)),this.g&&(this.readyState=3,ji(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(typeof ae.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;uf(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))};function uf(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}$.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?fs(this):ji(this),this.readyState==3&&uf(this)}};$.Va=function(n){this.g&&(this.response=this.responseText=n,fs(this))};$.Ua=function(n){this.g&&(this.response=n,fs(this))};$.ga=function(){this.g&&fs(this)};function fs(n){n.readyState=4,n.l=null,n.j=null,n.A=null,ji(n)}$.setRequestHeader=function(n,e){this.v.append(n,e)};$.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};$.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var r=e.next();!r.done;)r=r.value,n.push(r[0]+": "+r[1]),r=e.next();return n.join(`\r
`)};function ji(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Po.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var Hp=ae.JSON.parse;function Qe(n){pt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=hf,this.K=this.L=!1}Ct(Qe,pt);var hf="",Gp=/^https?$/i,Wp=["POST","PUT"];$=Qe.prototype;$.Ka=function(n){this.L=n};$.da=function(n,e,r,o){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():nl.g(),this.C=this.u?au(this.u):au(nl),this.g.onreadystatechange=Ot(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(h){uu(this,h);return}if(n=r||"",r=new Map(this.headers),o)if(Object.getPrototypeOf(o)===Object.prototype)for(var c in o)r.set(c,o[c]);else if(typeof o.keys=="function"&&typeof o.get=="function")for(const h of o.keys())r.set(h,o.get(h));else throw Error("Unknown input type for opt_headers: "+String(o));o=Array.from(r.keys()).find(h=>h.toLowerCase()=="content-type"),c=ae.FormData&&n instanceof ae.FormData,!(0<=_h(Wp,e))||o||c||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[h,p]of r)this.g.setRequestHeader(h,p);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{gf(this),0<this.B&&((this.K=Xp(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ot(this.qa,this)):this.A=Dl(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(h){uu(this,h)}};function Xp(n){return Yr&&ap()&&typeof n.timeout=="number"&&n.ontimeout!==void 0}$.qa=function(){typeof Il<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,It(this,"timeout"),this.abort(8))};function uu(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,ff(n),Lo(n)}function ff(n){n.D||(n.D=!0,It(n,"complete"),It(n,"error"))}$.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,It(this,"complete"),It(this,"abort"),Lo(this))};$.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Lo(this,!0)),Qe.X.M.call(this)};$.Ha=function(){this.s||(this.F||this.v||this.l?df(this):this.fb())};$.fb=function(){df(this)};function df(n){if(n.h&&typeof Il<"u"&&(!n.C[1]||Tn(n)!=4||n.aa()!=2)){if(n.v&&Tn(n)==4)Dl(n.Ha,0,n);else if(It(n,"readystatechange"),Tn(n)==4){n.h=!1;try{const w=n.aa();e:switch(w){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var r;if(!(r=e)){var o;if(o=w===0){var c=String(n.H).match(ef)[1]||null;if(!c&&ae.self&&ae.self.location){var h=ae.self.location.protocol;c=h.substr(0,h.length-1)}o=!Gp.test(c?c.toLowerCase():"")}r=o}if(r)It(n,"complete"),It(n,"success");else{n.m=6;try{var p=2<Tn(n)?n.g.statusText:""}catch{p=""}n.j=p+" ["+n.aa()+"]",ff(n)}}finally{Lo(n)}}}}function Lo(n,e){if(n.g){gf(n);const r=n.g,o=n.C[0]?ro:null;n.g=null,n.C=null,e||It(n,"ready");try{r.onreadystatechange=o}catch{}}}function gf(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(ae.clearTimeout(n.A),n.A=null)}function Tn(n){return n.g?n.g.readyState:0}$.aa=function(){try{return 2<Tn(this)?this.g.status:-1}catch{return-1}};$.fa=function(){try{return this.g?this.g.responseText:""}catch{return""}};$.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),Hp(e)}};function hu(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case hf:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}$.Ea=function(){return this.m};$.Oa=function(){return typeof this.j=="string"?this.j:String(this.j)};function pf(n){let e="";return Tl(n,function(r,o){e+=o,e+=":",e+=r,e+=`\r
`}),e}function Ul(n,e,r){e:{for(o in r){var o=!1;break e}o=!0}o||(r=pf(r),typeof n=="string"?r!=null&&encodeURIComponent(String(r)):je(n,e,r))}function Ii(n,e,r){return r&&r.internalChannelParams&&r.internalChannelParams[n]||e}function mf(n){this.Ca=0,this.i=[],this.j=new No,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Ii("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Ii("baseRetryDelayMs",5e3,n),this.bb=Ii("retryDelaySeedMs",1e4,n),this.$a=Ii("forwardChannelMaxRetries",2,n),this.ta=Ii("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new sf(n&&n.concurrentRequestLimit),this.Fa=new Fp,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}$=mf.prototype;$.ma=8;$.G=1;function Vl(n){if(xf(n),n.G==3){var e=n.U++,r=Rn(n.F);je(r,"SID",n.I),je(r,"RID",e),je(r,"TYPE","terminate"),ds(n,r),e=new cs(n,n.j,e,void 0),e.K=2,e.v=ko(Rn(r)),r=!1,ae.navigator&&ae.navigator.sendBeacon&&(r=ae.navigator.sendBeacon(e.v.toString(),"")),!r&&ae.Image&&(new Image().src=e.v,r=!0),r||(e.g=Tf(e.l,null),e.g.da(e.v)),e.F=Date.now(),us(e)}Cf(n)}function Bo(n){n.g&&(Gl(n),n.g.cancel(),n.g=null)}function xf(n){Bo(n),n.u&&(ae.clearTimeout(n.u),n.u=null),co(n),n.h.cancel(),n.m&&(typeof n.m=="number"&&ae.clearTimeout(n.m),n.m=null)}function Fo(n){of(n.h)||n.m||(n.m=!0,Fh(n.Ja,n),n.C=0)}function jp(n,e){return af(n.h)>=n.h.j-(n.m?1:0)?!1:n.m?(n.i=e.D.concat(n.i),!0):n.G==1||n.G==2||n.C>=(n.Za?0:n.$a)?!1:(n.m=as(Ot(n.Ja,n,e),If(n,n.C)),n.C++,!0)}$.Ja=function(n){if(this.m)if(this.m=null,this.G==1){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const c=new cs(this,this.j,n,void 0);let h=this.s;if(this.S&&(h?(h=Rh(h),Oh(h,this.S)):h=this.S),this.o!==null||this.N||(c.H=h,h=null),this.O)e:{for(var e=0,r=0;r<this.i.length;r++){t:{var o=this.i[r];if("__data__"in o.g&&(o=o.g.__data__,typeof o=="string")){o=o.length;break t}o=void 0}if(o===void 0)break;if(e+=o,4096<e){e=r;break e}if(e===4096||r===this.i.length-1){e=r+1;break e}}e=1e3}else e=1e3;e=wf(this,c,e),r=Rn(this.F),je(r,"RID",n),je(r,"CVER",22),this.D&&je(r,"X-HTTP-Session-Id",this.D),ds(this,r),h&&(this.N?e="headers="+encodeURIComponent(String(pf(h)))+"&"+e:this.o&&Ul(r,this.o,h)),Ll(this.h,c),this.Ya&&je(r,"TYPE","init"),this.O?(je(r,"$req",e),je(r,"SID","null"),c.Z=!0,il(c,r,null)):il(c,r,e),this.G=2}}else this.G==3&&(n?fu(this,n):this.i.length==0||of(this.h)||fu(this))};function fu(n,e){var r;e?r=e.m:r=n.U++;const o=Rn(n.F);je(o,"SID",n.I),je(o,"RID",r),je(o,"AID",n.T),ds(n,o),n.o&&n.s&&Ul(o,n.o,n.s),r=new cs(n,n.j,r,n.C+1),n.o===null&&(r.H=n.s),e&&(n.i=e.D.concat(n.i)),e=wf(n,r,1e3),r.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),Ll(n.h,r),il(r,o,e)}function ds(n,e){n.ia&&Tl(n.ia,function(r,o){je(e,o,r)}),n.l&&Jh({},function(r,o){je(e,o,r)})}function wf(n,e,r){r=Math.min(n.i.length,r);var o=n.l?Ot(n.l.Ra,n.l,n):null;e:{var c=n.i;let h=-1;for(;;){const p=["count="+r];h==-1?0<r?(h=c[0].h,p.push("ofs="+h)):h=0:p.push("ofs="+h);let w=!0;for(let A=0;A<r;A++){let m=c[A].h;const C=c[A].g;if(m-=h,0>m)h=Math.max(0,c[A].h-100),w=!1;else try{Up(C,p,"req"+m+"_")}catch{o&&o(C)}}if(w){o=p.join("&");break e}}}return n=n.i.splice(0,r),e.D=n,o}function Ef(n){n.g||n.u||(n.Z=1,Fh(n.Ia,n),n.A=0)}function Hl(n){return n.g||n.u||3<=n.A?!1:(n.Z++,n.u=as(Ot(n.Ia,n),If(n,n.A)),n.A++,!0)}$.Ia=function(){if(this.u=null,yf(this),this.$&&!(this.K||this.g==null||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=as(Ot(this.eb,this),n)}};$.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Ut(10),Bo(this),yf(this))};function Gl(n){n.B!=null&&(ae.clearTimeout(n.B),n.B=null)}function yf(n){n.g=new cs(n,n.j,"rpc",n.Z),n.o===null&&(n.g.H=n.s),n.g.N=0;var e=Rn(n.sa);je(e,"RID","rpc"),je(e,"SID",n.I),je(e,"CI",n.L?"0":"1"),je(e,"AID",n.T),je(e,"TYPE","xmlhttp"),ds(n,e),n.o&&n.s&&Ul(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var r=n.g;n=n.ka,r.K=1,r.v=ko(Rn(e)),r.s=null,r.P=!0,qh(r,n)}$.cb=function(){this.v!=null&&(this.v=null,Bo(this),Hl(this),Ut(19))};function co(n){n.v!=null&&(ae.clearTimeout(n.v),n.v=null)}function Af(n,e){var r=null;if(n.g==e){co(n),Gl(n),n.g=null;var o=2}else if(ol(n.h,e))r=e.D,lf(n.h,e),o=1;else return;if(n.G!=0){if(n.pa=e.Y,e.i)if(o==1){r=e.s?e.s.length:0,e=Date.now()-e.F;var c=n.C;o=Ro(),It(o,new jh(o,r)),Fo(n)}else Ef(n);else if(c=e.o,c==3||c==0&&0<n.pa||!(o==1&&jp(n,e)||o==2&&Hl(n)))switch(r&&0<r.length&&(e=n.h,e.i=e.i.concat(r)),c){case 1:fr(n,5);break;case 4:fr(n,10);break;case 3:fr(n,6);break;default:fr(n,2)}}}function If(n,e){let r=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(r*=2),r*e}function fr(n,e){if(n.j.info("Error code "+e),e==2){var r=null;n.l&&(r=null);var o=Ot(n.kb,n);r||(r=new pr("//www.google.com/images/cleardot.gif"),ae.location&&ae.location.protocol=="http"||ao(r,"https"),ko(r)),Vp(r.toString(),o)}else Ut(2);n.G=0,n.l&&n.l.va(e),Cf(n),xf(n)}$.kb=function(n){n?(this.j.info("Successfully pinged google.com"),Ut(2)):(this.j.info("Failed to ping google.com"),Ut(1))};function Cf(n){if(n.G=0,n.la=[],n.l){const e=cf(n.h);(e.length!=0||n.i.length!=0)&&(tu(n.la,e),tu(n.la,n.i),n.h.i.length=0,Cl(n.i),n.i.length=0),n.l.ua()}}function bf(n,e,r){var o=r instanceof pr?Rn(r):new pr(r,void 0);if(o.g!="")e&&(o.g=e+"."+o.g),lo(o,o.m);else{var c=ae.location;o=c.protocol,e=e?e+"."+c.hostname:c.hostname,c=+c.port;var h=new pr(null,void 0);o&&ao(h,o),e&&(h.g=e),c&&lo(h,c),r&&(h.l=r),o=h}return r=n.D,e=n.za,r&&e&&je(o,r,e),je(o,"VER",n.ma),ds(n,o),o}function Tf(n,e,r){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=r&&n.Da&&!n.ra?new Qe(new hs({jb:!0})):new Qe(n.ra),e.Ka(n.H),e}function _f(){}$=_f.prototype;$.xa=function(){};$.wa=function(){};$.va=function(){};$.ua=function(){};$.Ra=function(){};function uo(){if(Yr&&!(10<=Number(lp)))throw Error("Environmental error: no available transport.")}uo.prototype.g=function(n,e){return new $t(n,e)};function $t(n,e){pt.call(this),this.g=new mf(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!io(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!io(e)&&(this.g.D=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new si(this)}Ct($t,pt);$t.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,r=this.h||void 0;Ut(0),n.V=e,n.ia=r||{},n.L=n.Y,n.F=bf(n,null,n.V),Fo(n)};$t.prototype.close=function(){Vl(this.g)};$t.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var r={};r.__data__=n,n=r}else this.v&&(r={},r.__data__=Rl(n),n=r);e.i.push(new Lp(e.ab++,n)),e.G==3&&Fo(e)};$t.prototype.M=function(){this.g.l=null,delete this.j,Vl(this.g),delete this.g,$t.X.M.call(this)};function vf(n){kl.call(this);var e=n.__sm__;if(e){e:{for(const r in e){n=r;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Ct(vf,kl);function Sf(){Pl.call(this),this.status=1}Ct(Sf,Pl);function si(n){this.g=n}Ct(si,_f);si.prototype.xa=function(){It(this.g,"a")};si.prototype.wa=function(n){It(this.g,new vf(n))};si.prototype.va=function(n){It(this.g,new Sf)};si.prototype.ua=function(){It(this.g,"b")};uo.prototype.createWebChannel=uo.prototype.g;$t.prototype.send=$t.prototype.u;$t.prototype.open=$t.prototype.m;$t.prototype.close=$t.prototype.close;Oo.NO_ERROR=0;Oo.TIMEOUT=8;Oo.HTTP_ERROR=6;zh.COMPLETE="complete";Kh.EventType=ls;ls.OPEN="a";ls.CLOSE="b";ls.ERROR="c";ls.MESSAGE="d";pt.prototype.listen=pt.prototype.N;Qe.prototype.listenOnce=Qe.prototype.O;Qe.prototype.getLastError=Qe.prototype.Oa;Qe.prototype.getLastErrorCode=Qe.prototype.Ea;Qe.prototype.getStatus=Qe.prototype.aa;Qe.prototype.getResponseJson=Qe.prototype.Sa;Qe.prototype.getResponseText=Qe.prototype.fa;Qe.prototype.send=Qe.prototype.da;Qe.prototype.setWithCredentials=Qe.prototype.Ka;var zp=function(){return new uo},Kp=function(){return Ro()},ka=Oo,Yp=zh,qp=Tr,du={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Zp=hs,Fs=Kh,$p=Qe;const gu="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}St.UNAUTHENTICATED=new St(null),St.GOOGLE_CREDENTIALS=new St("google-credentials-uid"),St.FIRST_PARTY=new St("first-party-uid"),St.MOCK_USER=new St("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oi="9.18.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yr=new El("@firebase/firestore");function pu(){return yr.logLevel}function re(n,...e){if(yr.logLevel<=Re.DEBUG){const r=e.map(Wl);yr.debug(`Firestore (${oi}): ${n}`,...r)}}function Ar(n,...e){if(yr.logLevel<=Re.ERROR){const r=e.map(Wl);yr.error(`Firestore (${oi}): ${n}`,...r)}}function al(n,...e){if(yr.logLevel<=Re.WARN){const r=e.map(Wl);yr.warn(`Firestore (${oi}): ${n}`,...r)}}function Wl(n){if(typeof n=="string")return n;try{return e=n,JSON.stringify(e)}catch{return n}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ae(n="Unexpected state"){const e=`FIRESTORE (${oi}) INTERNAL ASSERTION FAILED: `+n;throw Ar(e),new Error(e)}function at(n,e){n||Ae()}function Ge(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ue extends Mn{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Qp{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable(()=>r(St.UNAUTHENTICATED))}shutdown(){}}class Jp{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class em{constructor(e){this.t=e,this.currentUser=St.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,r){let o=this.i;const c=A=>this.i!==o?(o=this.i,r(A)):Promise.resolve();let h=new mr;this.o=()=>{this.i++,this.currentUser=this.u(),h.resolve(),h=new mr,e.enqueueRetryable(()=>c(this.currentUser))};const p=()=>{const A=h;e.enqueueRetryable(async()=>{await A.promise,await c(this.currentUser)})},w=A=>{re("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=A,this.auth.addAuthTokenListener(this.o),p()};this.t.onInit(A=>w(A)),setTimeout(()=>{if(!this.auth){const A=this.t.getImmediate({optional:!0});A?w(A):(re("FirebaseAuthCredentialsProvider","Auth not yet detected"),h.resolve(),h=new mr)}},0),p()}getToken(){const e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(o=>this.i!==e?(re("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(at(typeof o.accessToken=="string"),new Nf(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return at(e===null||typeof e=="string"),new St(e)}}class tm{constructor(e,r,o,c){this.h=e,this.l=r,this.m=o,this.g=c,this.type="FirstParty",this.user=St.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(at(!(typeof this.h!="object"||this.h===null||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class nm{constructor(e,r,o,c){this.h=e,this.l=r,this.m=o,this.g=c}getToken(){return Promise.resolve(new tm(this.h,this.l,this.m,this.g))}start(e,r){e.enqueueRetryable(()=>r(St.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rm{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class im{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,r){const o=h=>{h.error!=null&&re("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${h.error.message}`);const p=h.token!==this.A;return this.A=h.token,re("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?r(h.token):Promise.resolve()};this.o=h=>{e.enqueueRetryable(()=>o(h))};const c=h=>{re("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=h,this.appCheck.addTokenListener(this.o)};this.T.onInit(h=>c(h)),setTimeout(()=>{if(!this.appCheck){const h=this.T.getImmediate({optional:!0});h?c(h):re("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(r=>r?(at(typeof r.token=="string"),this.A=r.token,new rm(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sm(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let o=0;o<n;o++)r[o]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/e.length)*e.length;let o="";for(;o.length<20;){const c=sm(40);for(let h=0;h<c.length;++h)o.length<20&&c[h]<r&&(o+=e.charAt(c[h]%e.length))}return o}}function Ve(n,e){return n<e?-1:n>e?1:0}function qr(n,e,r){return n.length===e.length&&n.every((o,c)=>r(o,e[c]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new ue(W.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new ue(W.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new ue(W.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ue(W.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return gt.fromMillis(Date.now())}static fromDate(e){return gt.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),o=Math.floor(1e6*(e-1e3*r));return new gt(r,o)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ve(this.nanoseconds,e.nanoseconds):Ve(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ke{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ke(e)}static min(){return new Ke(new gt(0,0))}static max(){return new Ke(new gt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(e,r,o){r===void 0?r=0:r>e.length&&Ae(),o===void 0?o=e.length-r:o>e.length-r&&Ae(),this.segments=e,this.offset=r,this.len=o}get length(){return this.len}isEqual(e){return zi.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof zi?e.forEach(o=>{r.push(o)}):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,o=this.limit();r<o;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const o=Math.min(e.length,r.length);for(let c=0;c<o;c++){const h=e.get(c),p=r.get(c);if(h<p)return-1;if(h>p)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}class nt extends zi{construct(e,r,o){return new nt(e,r,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const r=[];for(const o of e){if(o.indexOf("//")>=0)throw new ue(W.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);r.push(...o.split("/").filter(c=>c.length>0))}return new nt(r)}static emptyPath(){return new nt([])}}const om=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Rt extends zi{construct(e,r,o){return new Rt(e,r,o)}static isValidIdentifier(e){return om.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Rt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Rt(["__name__"])}static fromServerFormat(e){const r=[];let o="",c=0;const h=()=>{if(o.length===0)throw new ue(W.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(o),o=""};let p=!1;for(;c<e.length;){const w=e[c];if(w==="\\"){if(c+1===e.length)throw new ue(W.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const A=e[c+1];if(A!=="\\"&&A!=="."&&A!=="`")throw new ue(W.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=A,c+=2}else w==="`"?(p=!p,c++):w!=="."||p?(o+=w,c++):(h(),c++)}if(h(),p)throw new ue(W.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Rt(r)}static emptyPath(){return new Rt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class me{constructor(e){this.path=e}static fromPath(e){return new me(nt.fromString(e))}static fromName(e){return new me(nt.fromString(e).popFirst(5))}static empty(){return new me(nt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&nt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return nt.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new me(new nt(e.slice()))}}function am(n,e){const r=n.toTimestamp().seconds,o=n.toTimestamp().nanoseconds+1,c=Ke.fromTimestamp(o===1e9?new gt(r+1,0):new gt(r,o));return new $n(c,me.empty(),e)}function lm(n){return new $n(n.readTime,n.key,-1)}class $n{constructor(e,r,o){this.readTime=e,this.documentKey=r,this.largestBatchId=o}static min(){return new $n(Ke.min(),me.empty(),-1)}static max(){return new $n(Ke.max(),me.empty(),-1)}}function cm(n,e){let r=n.readTime.compareTo(e.readTime);return r!==0?r:(r=me.comparator(n.documentKey,e.documentKey),r!==0?r:Ve(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const um="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class hm{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Of(n){if(n.code!==W.FAILED_PRECONDITION||n.message!==um)throw n;re("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(e){return this.next(void 0,e)}next(e,r){return this.callbackAttached&&Ae(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new G((o,c)=>{this.nextCallback=h=>{this.wrapSuccess(e,h).next(o,c)},this.catchCallback=h=>{this.wrapFailure(r,h).next(o,c)}})}toPromise(){return new Promise((e,r)=>{this.next(e,r)})}wrapUserFunction(e){try{const r=e();return r instanceof G?r:G.resolve(r)}catch(r){return G.reject(r)}}wrapSuccess(e,r){return e?this.wrapUserFunction(()=>e(r)):G.resolve(r)}wrapFailure(e,r){return e?this.wrapUserFunction(()=>e(r)):G.reject(r)}static resolve(e){return new G((r,o)=>{r(e)})}static reject(e){return new G((r,o)=>{o(e)})}static waitFor(e){return new G((r,o)=>{let c=0,h=0,p=!1;e.forEach(w=>{++c,w.next(()=>{++h,p&&h===c&&r()},A=>o(A))}),p=!0,h===c&&r()})}static or(e){let r=G.resolve(!1);for(const o of e)r=r.next(c=>c?G.resolve(c):o());return r}static forEach(e,r){const o=[];return e.forEach((c,h)=>{o.push(r.call(this,c,h))}),this.waitFor(o)}static mapArray(e,r){return new G((o,c)=>{const h=e.length,p=new Array(h);let w=0;for(let A=0;A<h;A++){const m=A;r(e[m]).next(C=>{p[m]=C,++w,w===h&&o(p)},C=>c(C))}})}static doWhile(e,r){return new G((o,c)=>{const h=()=>{e()===!0?r().next(()=>{h()},c):o()};h()})}}function Uo(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Df{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=o=>this.ut(o),this.ct=o=>r.writeSequenceNumber(o))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}Df.at=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm{constructor(e,r,o,c,h,p,w,A){this.databaseId=e,this.appId=r,this.persistenceKey=o,this.host=c,this.ssl=h,this.forceLongPolling=p,this.autoDetectLongPolling=w,this.useFetchStreams=A}}class ho{constructor(e,r){this.projectId=e,this.database=r||"(default)"}static empty(){return new ho("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ho&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mu(n){let e=0;for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&e++;return e}function gs(n,e){for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&e(r,n[r])}function Mf(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xl(n){return n==null}function fo(n){return n===0&&1/n==-1/0}function dm(n){return typeof n=="number"&&Number.isInteger(n)&&!fo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(e){this.binaryString=e}static fromBase64String(e){const r=function(o){try{return atob(o)}catch(c){throw c instanceof DOMException?new gm("Invalid base64 string: "+c):c}}(e);return new On(r)}static fromUint8Array(e){const r=function(o){let c="";for(let h=0;h<o.length;++h)c+=String.fromCharCode(o[h]);return c}(e);return new On(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ve(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}On.EMPTY_BYTE_STRING=new On("");const pm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ir(n){if(at(!!n),typeof n=="string"){let e=0;const r=pm.exec(n);if(at(!!r),r[1]){let c=r[1];c=(c+"000000000").substr(0,9),e=Number(c)}const o=new Date(n);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:yt(n.seconds),nanos:yt(n.nanos)}}function yt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ki(n){return typeof n=="string"?On.fromBase64String(n):On.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mm(n){var e,r;return((r=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function go(n){const e=Ir(n.mapValue.fields.__local_write_time__.timestampValue);return new gt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Us={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Zr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?mm(n)?4:xm(n)?9007199254740991:10:Ae()}function In(n,e){if(n===e)return!0;const r=Zr(n);if(r!==Zr(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return go(n).isEqual(go(e));case 3:return function(o,c){if(typeof o.timestampValue=="string"&&typeof c.timestampValue=="string"&&o.timestampValue.length===c.timestampValue.length)return o.timestampValue===c.timestampValue;const h=Ir(o.timestampValue),p=Ir(c.timestampValue);return h.seconds===p.seconds&&h.nanos===p.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(o,c){return Ki(o.bytesValue).isEqual(Ki(c.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(o,c){return yt(o.geoPointValue.latitude)===yt(c.geoPointValue.latitude)&&yt(o.geoPointValue.longitude)===yt(c.geoPointValue.longitude)}(n,e);case 2:return function(o,c){if("integerValue"in o&&"integerValue"in c)return yt(o.integerValue)===yt(c.integerValue);if("doubleValue"in o&&"doubleValue"in c){const h=yt(o.doubleValue),p=yt(c.doubleValue);return h===p?fo(h)===fo(p):isNaN(h)&&isNaN(p)}return!1}(n,e);case 9:return qr(n.arrayValue.values||[],e.arrayValue.values||[],In);case 10:return function(o,c){const h=o.mapValue.fields||{},p=c.mapValue.fields||{};if(mu(h)!==mu(p))return!1;for(const w in h)if(h.hasOwnProperty(w)&&(p[w]===void 0||!In(h[w],p[w])))return!1;return!0}(n,e);default:return Ae()}}function Yi(n,e){return(n.values||[]).find(r=>In(r,e))!==void 0}function $r(n,e){if(n===e)return 0;const r=Zr(n),o=Zr(e);if(r!==o)return Ve(r,o);switch(r){case 0:case 9007199254740991:return 0;case 1:return Ve(n.booleanValue,e.booleanValue);case 2:return function(c,h){const p=yt(c.integerValue||c.doubleValue),w=yt(h.integerValue||h.doubleValue);return p<w?-1:p>w?1:p===w?0:isNaN(p)?isNaN(w)?0:-1:1}(n,e);case 3:return xu(n.timestampValue,e.timestampValue);case 4:return xu(go(n),go(e));case 5:return Ve(n.stringValue,e.stringValue);case 6:return function(c,h){const p=Ki(c),w=Ki(h);return p.compareTo(w)}(n.bytesValue,e.bytesValue);case 7:return function(c,h){const p=c.split("/"),w=h.split("/");for(let A=0;A<p.length&&A<w.length;A++){const m=Ve(p[A],w[A]);if(m!==0)return m}return Ve(p.length,w.length)}(n.referenceValue,e.referenceValue);case 8:return function(c,h){const p=Ve(yt(c.latitude),yt(h.latitude));return p!==0?p:Ve(yt(c.longitude),yt(h.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(c,h){const p=c.values||[],w=h.values||[];for(let A=0;A<p.length&&A<w.length;++A){const m=$r(p[A],w[A]);if(m)return m}return Ve(p.length,w.length)}(n.arrayValue,e.arrayValue);case 10:return function(c,h){if(c===Us.mapValue&&h===Us.mapValue)return 0;if(c===Us.mapValue)return 1;if(h===Us.mapValue)return-1;const p=c.fields||{},w=Object.keys(p),A=h.fields||{},m=Object.keys(A);w.sort(),m.sort();for(let C=0;C<w.length&&C<m.length;++C){const _=Ve(w[C],m[C]);if(_!==0)return _;const k=$r(p[w[C]],A[m[C]]);if(k!==0)return k}return Ve(w.length,m.length)}(n.mapValue,e.mapValue);default:throw Ae()}}function xu(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ve(n,e);const r=Ir(n),o=Ir(e),c=Ve(r.seconds,o.seconds);return c!==0?c:Ve(r.nanos,o.nanos)}function Qr(n){return ll(n)}function ll(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(o){const c=Ir(o);return`time(${c.seconds},${c.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Ki(n.bytesValue).toBase64():"referenceValue"in n?(r=n.referenceValue,me.fromName(r).toString()):"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(o){let c="[",h=!0;for(const p of o.values||[])h?h=!1:c+=",",c+=ll(p);return c+"]"}(n.arrayValue):"mapValue"in n?function(o){const c=Object.keys(o.fields||{}).sort();let h="{",p=!0;for(const w of c)p?p=!1:h+=",",h+=`${w}:${ll(o.fields[w])}`;return h+"}"}(n.mapValue):Ae();var e,r}function cl(n){return!!n&&"integerValue"in n}function jl(n){return!!n&&"arrayValue"in n}function js(n){return!!n&&"mapValue"in n}function ki(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return gs(n.mapValue.fields,(r,o)=>e.mapValue.fields[r]=ki(o)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(n.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=ki(n.arrayValue.values[r]);return e}return Object.assign({},n)}function xm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po{constructor(e,r){this.position=e,this.inclusive=r}}function wu(n,e,r){let o=0;for(let c=0;c<n.position.length;c++){const h=e[c],p=n.position[c];if(h.field.isKeyField()?o=me.comparator(me.fromName(p.referenceValue),r.key):o=$r(p,r.data.field(h.field)),h.dir==="desc"&&(o*=-1),o!==0)break}return o}function Eu(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let r=0;r<n.position.length;r++)if(!In(n.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{}class dt extends kf{constructor(e,r,o){super(),this.field=e,this.op=r,this.value=o}static create(e,r,o){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,o):new Em(e,r,o):r==="array-contains"?new Im(e,o):r==="in"?new Cm(e,o):r==="not-in"?new bm(e,o):r==="array-contains-any"?new Tm(e,o):new dt(e,r,o)}static createKeyFieldInFilter(e,r,o){return r==="in"?new ym(e,o):new Am(e,o)}matches(e){const r=e.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison($r(r,this.value)):r!==null&&Zr(this.value)===Zr(r)&&this.matchesComparison($r(r,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ae()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Qn extends kf{constructor(e,r){super(),this.filters=e,this.op=r,this.ft=null}static create(e,r){return new Qn(e,r)}matches(e){return Pf(this)?this.filters.find(r=>!r.matches(e))===void 0:this.filters.find(r=>r.matches(e))!==void 0}getFlattenedFilters(){return this.ft!==null||(this.ft=this.filters.reduce((e,r)=>e.concat(r.getFlattenedFilters()),[])),this.ft}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.dt(r=>r.isInequality());return e!==null?e.field:null}dt(e){for(const r of this.getFlattenedFilters())if(e(r))return r;return null}}function Pf(n){return n.op==="and"}function Lf(n){return wm(n)&&Pf(n)}function wm(n){for(const e of n.filters)if(e instanceof Qn)return!1;return!0}function ul(n){if(n instanceof dt)return n.field.canonicalString()+n.op.toString()+Qr(n.value);if(Lf(n))return n.filters.map(e=>ul(e)).join(",");{const e=n.filters.map(r=>ul(r)).join(",");return`${n.op}(${e})`}}function Bf(n,e){return n instanceof dt?function(r,o){return o instanceof dt&&r.op===o.op&&r.field.isEqual(o.field)&&In(r.value,o.value)}(n,e):n instanceof Qn?function(r,o){return o instanceof Qn&&r.op===o.op&&r.filters.length===o.filters.length?r.filters.reduce((c,h,p)=>c&&Bf(h,o.filters[p]),!0):!1}(n,e):void Ae()}function Ff(n){return n instanceof dt?function(e){return`${e.field.canonicalString()} ${e.op} ${Qr(e.value)}`}(n):n instanceof Qn?function(e){return e.op.toString()+" {"+e.getFilters().map(Ff).join(" ,")+"}"}(n):"Filter"}class Em extends dt{constructor(e,r,o){super(e,r,o),this.key=me.fromName(o.referenceValue)}matches(e){const r=me.comparator(e.key,this.key);return this.matchesComparison(r)}}class ym extends dt{constructor(e,r){super(e,"in",r),this.keys=Uf("in",r)}matches(e){return this.keys.some(r=>r.isEqual(e.key))}}class Am extends dt{constructor(e,r){super(e,"not-in",r),this.keys=Uf("not-in",r)}matches(e){return!this.keys.some(r=>r.isEqual(e.key))}}function Uf(n,e){var r;return(((r=e.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(o=>me.fromName(o.referenceValue))}class Im extends dt{constructor(e,r){super(e,"array-contains",r)}matches(e){const r=e.data.field(this.field);return jl(r)&&Yi(r.arrayValue,this.value)}}class Cm extends dt{constructor(e,r){super(e,"in",r)}matches(e){const r=e.data.field(this.field);return r!==null&&Yi(this.value.arrayValue,r)}}class bm extends dt{constructor(e,r){super(e,"not-in",r)}matches(e){if(Yi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=e.data.field(this.field);return r!==null&&!Yi(this.value.arrayValue,r)}}class Tm extends dt{constructor(e,r){super(e,"array-contains-any",r)}matches(e){const r=e.data.field(this.field);return!(!jl(r)||!r.arrayValue.values)&&r.arrayValue.values.some(o=>Yi(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi{constructor(e,r="asc"){this.field=e,this.dir=r}}function _m(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e,r){this.comparator=e,this.root=r||At.EMPTY}insert(e,r){return new Yt(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,At.BLACK,null,null))}remove(e){return new Yt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,At.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const o=this.comparator(e,r.key);if(o===0)return r.value;o<0?r=r.left:o>0&&(r=r.right)}return null}indexOf(e){let r=0,o=this.root;for(;!o.isEmpty();){const c=this.comparator(e,o.key);if(c===0)return r+o.left.size;c<0?o=o.left:(r+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((r,o)=>(e(r,o),!1))}toString(){const e=[];return this.inorderTraversal((r,o)=>(e.push(`${r}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Vs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Vs(this.root,e,this.comparator,!1)}getReverseIterator(){return new Vs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Vs(this.root,e,this.comparator,!0)}}class Vs{constructor(e,r,o,c){this.isReverse=c,this.nodeStack=[];let h=1;for(;!e.isEmpty();)if(h=r?o(e.key,r):1,r&&c&&(h*=-1),h<0)e=this.isReverse?e.left:e.right;else{if(h===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class At{constructor(e,r,o,c,h){this.key=e,this.value=r,this.color=o!=null?o:At.RED,this.left=c!=null?c:At.EMPTY,this.right=h!=null?h:At.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,o,c,h){return new At(e!=null?e:this.key,r!=null?r:this.value,o!=null?o:this.color,c!=null?c:this.left,h!=null?h:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,o){let c=this;const h=o(e,c.key);return c=h<0?c.copy(null,null,null,c.left.insert(e,r,o),null):h===0?c.copy(null,r,null,null,null):c.copy(null,null,null,null,c.right.insert(e,r,o)),c.fixUp()}removeMin(){if(this.left.isEmpty())return At.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let o,c=this;if(r(e,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(e,r),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),r(e,c.key)===0){if(c.right.isEmpty())return At.EMPTY;o=c.right.min(),c=c.copy(o.key,o.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(e,r))}return c.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,At.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,At.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ae();const e=this.left.check();if(e!==this.right.check())throw Ae();return e+(this.isRed()?0:1)}}At.EMPTY=null,At.RED=!0,At.BLACK=!1;At.EMPTY=new class{constructor(){this.size=0}get key(){throw Ae()}get value(){throw Ae()}get color(){throw Ae()}get left(){throw Ae()}get right(){throw Ae()}copy(n,e,r,o,c){return this}insert(n,e,r){return new At(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e){this.comparator=e,this.data=new Yt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((r,o)=>(e(r),!1))}forEachInRange(e,r){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const c=o.getNext();if(this.comparator(c.key,e[1])>=0)return;r(c.key)}}forEachWhile(e,r){let o;for(o=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new yu(this.data.getIterator())}getIteratorFrom(e){return new yu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach(o=>{r=r.add(o)}),r}isEqual(e){if(!(e instanceof Vt)||this.size!==e.size)return!1;const r=this.data.getIterator(),o=e.data.getIterator();for(;r.hasNext();){const c=r.getNext().key,h=o.getNext().key;if(this.comparator(c,h)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(r=>{e.push(r)}),e}toString(){const e=[];return this.forEach(r=>e.push(r)),"SortedSet("+e.toString()+")"}copy(e){const r=new Vt(this.comparator);return r.data=e,r}}class yu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e){this.fields=e,e.sort(Rt.comparator)}static empty(){return new ln([])}unionWith(e){let r=new Vt(Rt.comparator);for(const o of this.fields)r=r.add(o);for(const o of e)r=r.add(o);return new ln(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return qr(this.fields,e.fields,(r,o)=>r.isEqual(o))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this.value=e}static empty(){return new an({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let o=0;o<e.length-1;++o)if(r=(r.mapValue.fields||{})[e.get(o)],!js(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=ki(r)}setAll(e){let r=Rt.emptyPath(),o={},c=[];e.forEach((p,w)=>{if(!r.isImmediateParentOf(w)){const A=this.getFieldsMap(r);this.applyChanges(A,o,c),o={},c=[],r=w.popLast()}p?o[w.lastSegment()]=ki(p):c.push(w.lastSegment())});const h=this.getFieldsMap(r);this.applyChanges(h,o,c)}delete(e){const r=this.field(e.popLast());js(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return In(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let o=0;o<e.length;++o){let c=r.mapValue.fields[e.get(o)];js(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},r.mapValue.fields[e.get(o)]=c),r=c}return r.mapValue.fields}applyChanges(e,r,o){gs(r,(c,h)=>e[c]=h);for(const c of o)delete e[c]}clone(){return new an(ki(this.value))}}function Vf(n){const e=[];return gs(n.fields,(r,o)=>{const c=new Rt([r]);if(js(o)){const h=Vf(o.mapValue).fields;if(h.length===0)e.push(c);else for(const p of h)e.push(c.child(p))}else e.push(c)}),new ln(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e,r,o,c,h,p,w){this.key=e,this.documentType=r,this.version=o,this.readTime=c,this.createTime=h,this.data=p,this.documentState=w}static newInvalidDocument(e){return new on(e,0,Ke.min(),Ke.min(),Ke.min(),an.empty(),0)}static newFoundDocument(e,r,o,c){return new on(e,1,r,Ke.min(),o,c,0)}static newNoDocument(e,r){return new on(e,2,r,Ke.min(),Ke.min(),an.empty(),0)}static newUnknownDocument(e,r){return new on(e,3,r,Ke.min(),Ke.min(),an.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(Ke.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=an.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=an.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ke.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof on&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new on(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vm{constructor(e,r=null,o=[],c=[],h=null,p=null,w=null){this.path=e,this.collectionGroup=r,this.orderBy=o,this.filters=c,this.limit=h,this.startAt=p,this.endAt=w,this._t=null}}function Au(n,e=null,r=[],o=[],c=null,h=null,p=null){return new vm(n,e,r,o,c,h,p)}function zl(n){const e=Ge(n);if(e._t===null){let r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map(o=>ul(o)).join(","),r+="|ob:",r+=e.orderBy.map(o=>function(c){return c.field.canonicalString()+c.dir}(o)).join(","),Xl(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(o=>Qr(o)).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(o=>Qr(o)).join(",")),e._t=r}return e._t}function Kl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<n.orderBy.length;r++)if(!_m(n.orderBy[r],e.orderBy[r]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let r=0;r<n.filters.length;r++)if(!Bf(n.filters[r],e.filters[r]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Eu(n.startAt,e.startAt)&&Eu(n.endAt,e.endAt)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{constructor(e,r=null,o=[],c=[],h=null,p="F",w=null,A=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=o,this.filters=c,this.limit=h,this.limitType=p,this.startAt=w,this.endAt=A,this.wt=null,this.gt=null,this.startAt,this.endAt}}function Sm(n,e,r,o,c,h,p,w){return new Vo(n,e,r,o,c,h,p,w)}function Nm(n){return new Vo(n)}function Iu(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Rm(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Om(n){for(const e of n.filters){const r=e.getFirstInequalityField();if(r!==null)return r}return null}function Dm(n){return n.collectionGroup!==null}function Wr(n){const e=Ge(n);if(e.wt===null){e.wt=[];const r=Om(e),o=Rm(e);if(r!==null&&o===null)r.isKeyField()||e.wt.push(new Pi(r)),e.wt.push(new Pi(Rt.keyField(),"asc"));else{let c=!1;for(const h of e.explicitOrderBy)e.wt.push(h),h.field.isKeyField()&&(c=!0);if(!c){const h=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new Pi(Rt.keyField(),h))}}}return e.wt}function Jr(n){const e=Ge(n);if(!e.gt)if(e.limitType==="F")e.gt=Au(e.path,e.collectionGroup,Wr(e),e.filters,e.limit,e.startAt,e.endAt);else{const r=[];for(const h of Wr(e)){const p=h.dir==="desc"?"asc":"desc";r.push(new Pi(h.field,p))}const o=e.endAt?new po(e.endAt.position,e.endAt.inclusive):null,c=e.startAt?new po(e.startAt.position,e.startAt.inclusive):null;e.gt=Au(e.path,e.collectionGroup,r,e.filters,e.limit,o,c)}return e.gt}function hl(n,e,r){return new Vo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,r,n.startAt,n.endAt)}function Hf(n,e){return Kl(Jr(n),Jr(e))&&n.limitType===e.limitType}function Gf(n){return`${zl(Jr(n))}|lt:${n.limitType}`}function Cu(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(o=>Ff(o)).join(", ")}]`),Xl(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(o=>function(c){return`${c.field.canonicalString()} (${c.dir})`}(o)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(o=>Qr(o)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(o=>Qr(o)).join(",")),`Target(${r})`}(Jr(n))}; limitType=${n.limitType})`}function Yl(n,e){return e.isFoundDocument()&&function(r,o){const c=o.key.path;return r.collectionGroup!==null?o.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(c):me.isDocumentKey(r.path)?r.path.isEqual(c):r.path.isImmediateParentOf(c)}(n,e)&&function(r,o){for(const c of Wr(r))if(!c.field.isKeyField()&&o.data.field(c.field)===null)return!1;return!0}(n,e)&&function(r,o){for(const c of r.filters)if(!c.matches(o))return!1;return!0}(n,e)&&function(r,o){return!(r.startAt&&!function(c,h,p){const w=wu(c,h,p);return c.inclusive?w<=0:w<0}(r.startAt,Wr(r),o)||r.endAt&&!function(c,h,p){const w=wu(c,h,p);return c.inclusive?w>=0:w>0}(r.endAt,Wr(r),o))}(n,e)}function Mm(n){return(e,r)=>{let o=!1;for(const c of Wr(n)){const h=km(c,e,r);if(h!==0)return h;o=o||c.field.isKeyField()}return 0}}function km(n,e,r){const o=n.field.isKeyField()?me.comparator(e.key,r.key):function(c,h,p){const w=h.data.field(c),A=p.data.field(c);return w!==null&&A!==null?$r(w,A):Ae()}(n.field,e,r);switch(n.dir){case"asc":return o;case"desc":return-1*o;default:return Ae()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wf(n,e){if(n.yt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fo(e)?"-0":e}}function Xf(n){return{integerValue:""+n}}function Pm(n,e){return dm(e)?Xf(e):Wf(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(){this._=void 0}}function Lm(n,e,r){return n instanceof mo?function(o,c){const h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return c&&(h.fields.__previous_value__=c),{mapValue:h}}(r,e):n instanceof qi?zf(n,e):n instanceof Zi?Kf(n,e):function(o,c){const h=jf(o,c),p=bu(h)+bu(o.It);return cl(h)&&cl(o.It)?Xf(p):Wf(o.Tt,p)}(n,e)}function Bm(n,e,r){return n instanceof qi?zf(n,e):n instanceof Zi?Kf(n,e):r}function jf(n,e){return n instanceof xo?cl(r=e)||function(o){return!!o&&"doubleValue"in o}(r)?e:{integerValue:0}:null;var r}class mo extends Ho{}class qi extends Ho{constructor(e){super(),this.elements=e}}function zf(n,e){const r=Yf(e);for(const o of n.elements)r.some(c=>In(c,o))||r.push(o);return{arrayValue:{values:r}}}class Zi extends Ho{constructor(e){super(),this.elements=e}}function Kf(n,e){let r=Yf(e);for(const o of n.elements)r=r.filter(c=>!In(c,o));return{arrayValue:{values:r}}}class xo extends Ho{constructor(e,r){super(),this.Tt=e,this.It=r}}function bu(n){return yt(n.integerValue||n.doubleValue)}function Yf(n){return jl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Fm(n,e){return n.field.isEqual(e.field)&&function(r,o){return r instanceof qi&&o instanceof qi||r instanceof Zi&&o instanceof Zi?qr(r.elements,o.elements,In):r instanceof xo&&o instanceof xo?In(r.It,o.It):r instanceof mo&&o instanceof mo}(n.transform,e.transform)}class Um{constructor(e,r){this.version=e,this.transformResults=r}}class Sn{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new Sn}static exists(e){return new Sn(void 0,e)}static updateTime(e){return new Sn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function zs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Go{}function qf(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new $f(n.key,Sn.none()):new ps(n.key,n.data,Sn.none());{const r=n.data,o=an.empty();let c=new Vt(Rt.comparator);for(let h of e.fields)if(!c.has(h)){let p=r.field(h);p===null&&h.length>1&&(h=h.popLast(),p=r.field(h)),p===null?o.delete(h):o.set(h,p),c=c.add(h)}return new _r(n.key,o,new ln(c.toArray()),Sn.none())}}function Vm(n,e,r){n instanceof ps?function(o,c,h){const p=o.value.clone(),w=_u(o.fieldTransforms,c,h.transformResults);p.setAll(w),c.convertToFoundDocument(h.version,p).setHasCommittedMutations()}(n,e,r):n instanceof _r?function(o,c,h){if(!zs(o.precondition,c))return void c.convertToUnknownDocument(h.version);const p=_u(o.fieldTransforms,c,h.transformResults),w=c.data;w.setAll(Zf(o)),w.setAll(p),c.convertToFoundDocument(h.version,w).setHasCommittedMutations()}(n,e,r):function(o,c,h){c.convertToNoDocument(h.version).setHasCommittedMutations()}(0,e,r)}function Li(n,e,r,o){return n instanceof ps?function(c,h,p,w){if(!zs(c.precondition,h))return p;const A=c.value.clone(),m=vu(c.fieldTransforms,w,h);return A.setAll(m),h.convertToFoundDocument(h.version,A).setHasLocalMutations(),null}(n,e,r,o):n instanceof _r?function(c,h,p,w){if(!zs(c.precondition,h))return p;const A=vu(c.fieldTransforms,w,h),m=h.data;return m.setAll(Zf(c)),m.setAll(A),h.convertToFoundDocument(h.version,m).setHasLocalMutations(),p===null?null:p.unionWith(c.fieldMask.fields).unionWith(c.fieldTransforms.map(C=>C.field))}(n,e,r,o):function(c,h,p){return zs(c.precondition,h)?(h.convertToNoDocument(h.version).setHasLocalMutations(),null):p}(n,e,r)}function Hm(n,e){let r=null;for(const o of n.fieldTransforms){const c=e.data.field(o.field),h=jf(o.transform,c||null);h!=null&&(r===null&&(r=an.empty()),r.set(o.field,h))}return r||null}function Tu(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,o){return r===void 0&&o===void 0||!(!r||!o)&&qr(r,o,(c,h)=>Fm(c,h))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ps extends Go{constructor(e,r,o,c=[]){super(),this.key=e,this.value=r,this.precondition=o,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class _r extends Go{constructor(e,r,o,c,h=[]){super(),this.key=e,this.data=r,this.fieldMask=o,this.precondition=c,this.fieldTransforms=h,this.type=1}getFieldMask(){return this.fieldMask}}function Zf(n){const e=new Map;return n.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const o=n.data.field(r);e.set(r,o)}}),e}function _u(n,e,r){const o=new Map;at(n.length===r.length);for(let c=0;c<r.length;c++){const h=n[c],p=h.transform,w=e.data.field(h.field);o.set(h.field,Bm(p,w,r[c]))}return o}function vu(n,e,r){const o=new Map;for(const c of n){const h=c.transform,p=r.data.field(c.field);o.set(c.field,Lm(h,p,e))}return o}class $f extends Go{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Gm extends Go{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tt,Ie;function Wm(n){switch(n){default:return Ae();case W.CANCELLED:case W.UNKNOWN:case W.DEADLINE_EXCEEDED:case W.RESOURCE_EXHAUSTED:case W.INTERNAL:case W.UNAVAILABLE:case W.UNAUTHENTICATED:return!1;case W.INVALID_ARGUMENT:case W.NOT_FOUND:case W.ALREADY_EXISTS:case W.PERMISSION_DENIED:case W.FAILED_PRECONDITION:case W.ABORTED:case W.OUT_OF_RANGE:case W.UNIMPLEMENTED:case W.DATA_LOSS:return!0}}function Xm(n){if(n===void 0)return Ar("GRPC error has no .code"),W.UNKNOWN;switch(n){case tt.OK:return W.OK;case tt.CANCELLED:return W.CANCELLED;case tt.UNKNOWN:return W.UNKNOWN;case tt.DEADLINE_EXCEEDED:return W.DEADLINE_EXCEEDED;case tt.RESOURCE_EXHAUSTED:return W.RESOURCE_EXHAUSTED;case tt.INTERNAL:return W.INTERNAL;case tt.UNAVAILABLE:return W.UNAVAILABLE;case tt.UNAUTHENTICATED:return W.UNAUTHENTICATED;case tt.INVALID_ARGUMENT:return W.INVALID_ARGUMENT;case tt.NOT_FOUND:return W.NOT_FOUND;case tt.ALREADY_EXISTS:return W.ALREADY_EXISTS;case tt.PERMISSION_DENIED:return W.PERMISSION_DENIED;case tt.FAILED_PRECONDITION:return W.FAILED_PRECONDITION;case tt.ABORTED:return W.ABORTED;case tt.OUT_OF_RANGE:return W.OUT_OF_RANGE;case tt.UNIMPLEMENTED:return W.UNIMPLEMENTED;case tt.DATA_LOSS:return W.DATA_LOSS;default:return Ae()}}(Ie=tt||(tt={}))[Ie.OK=0]="OK",Ie[Ie.CANCELLED=1]="CANCELLED",Ie[Ie.UNKNOWN=2]="UNKNOWN",Ie[Ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ie[Ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ie[Ie.NOT_FOUND=5]="NOT_FOUND",Ie[Ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ie[Ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ie[Ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ie[Ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ie[Ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ie[Ie.ABORTED=10]="ABORTED",Ie[Ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ie[Ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ie[Ie.INTERNAL=13]="INTERNAL",Ie[Ie.UNAVAILABLE=14]="UNAVAILABLE",Ie[Ie.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e,r){this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0}get(e){const r=this.mapKeyFn(e),o=this.inner[r];if(o!==void 0){for(const[c,h]of o)if(this.equalsFn(c,e))return h}}has(e){return this.get(e)!==void 0}set(e,r){const o=this.mapKeyFn(e),c=this.inner[o];if(c===void 0)return this.inner[o]=[[e,r]],void this.innerSize++;for(let h=0;h<c.length;h++)if(this.equalsFn(c[h][0],e))return void(c[h]=[e,r]);c.push([e,r]),this.innerSize++}delete(e){const r=this.mapKeyFn(e),o=this.inner[r];if(o===void 0)return!1;for(let c=0;c<o.length;c++)if(this.equalsFn(o[c][0],e))return o.length===1?delete this.inner[r]:o.splice(c,1),this.innerSize--,!0;return!1}forEach(e){gs(this.inner,(r,o)=>{for(const[c,h]of o)e(c,h)})}isEmpty(){return Mf(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jm=new Yt(me.comparator);function wo(){return jm}const Qf=new Yt(me.comparator);function Hs(...n){let e=Qf;for(const r of n)e=e.insert(r.key,r);return e}function Jf(n){let e=Qf;return n.forEach((r,o)=>e=e.insert(r,o.overlayedDocument)),e}function dr(){return Bi()}function e1(){return Bi()}function Bi(){return new ai(n=>n.toString(),(n,e)=>n.isEqual(e))}const zm=new Yt(me.comparator),Km=new Vt(me.comparator);function Nt(...n){let e=Km;for(const r of n)e=e.add(r);return e}const Ym=new Vt(Ve);function qm(){return Ym}class Zm{constructor(e,r){this.databaseId=e,this.yt=r}}function fl(n,e){return n.yt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function $m(n,e){return n.yt?e.toBase64():e.toUint8Array()}function Qm(n,e){return fl(n,e.toTimestamp())}function Xr(n){return at(!!n),Ke.fromTimestamp(function(e){const r=Ir(e);return new gt(r.seconds,r.nanos)}(n))}function t1(n,e){return function(r){return new nt(["projects",r.projectId,"databases",r.database])}(n).child("documents").child(e).canonicalString()}function Jm(n){const e=nt.fromString(n);return at(a2(e)),e}function dl(n,e){return t1(n.databaseId,e.path)}function e2(n){const e=Jm(n);return e.length===4?nt.emptyPath():n2(e)}function t2(n){return new nt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function n2(n){return at(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Su(n,e,r){return{name:dl(n,e),fields:r.value.mapValue.fields}}function r2(n,e){let r;if(e instanceof ps)r={update:Su(n,e.key,e.value)};else if(e instanceof $f)r={delete:dl(n,e.key)};else if(e instanceof _r)r={update:Su(n,e.key,e.data),updateMask:o2(e.fieldMask)};else{if(!(e instanceof Gm))return Ae();r={verify:dl(n,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map(o=>function(c,h){const p=h.transform;if(p instanceof mo)return{fieldPath:h.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(p instanceof qi)return{fieldPath:h.field.canonicalString(),appendMissingElements:{values:p.elements}};if(p instanceof Zi)return{fieldPath:h.field.canonicalString(),removeAllFromArray:{values:p.elements}};if(p instanceof xo)return{fieldPath:h.field.canonicalString(),increment:p.It};throw Ae()}(0,o))),e.precondition.isNone||(r.currentDocument=function(o,c){return c.updateTime!==void 0?{updateTime:Qm(o,c.updateTime)}:c.exists!==void 0?{exists:c.exists}:Ae()}(n,e.precondition)),r}function i2(n,e){return n&&n.length>0?(at(e!==void 0),n.map(r=>function(o,c){let h=o.updateTime?Xr(o.updateTime):Xr(c);return h.isEqual(Ke.min())&&(h=Xr(c)),new Um(h,o.transformResults||[])}(r,e))):[]}function s2(n){let e=e2(n.parent);const r=n.structuredQuery,o=r.from?r.from.length:0;let c=null;if(o>0){at(o===1);const C=r.from[0];C.allDescendants?c=C.collectionId:e=e.child(C.collectionId)}let h=[];r.where&&(h=function(C){const _=n1(C);return _ instanceof Qn&&Lf(_)?_.getFilters():[_]}(r.where));let p=[];r.orderBy&&(p=r.orderBy.map(C=>function(_){return new Pi(Ur(_.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction))}(C)));let w=null;r.limit&&(w=function(C){let _;return _=typeof C=="object"?C.value:C,Xl(_)?null:_}(r.limit));let A=null;r.startAt&&(A=function(C){const _=!!C.before,k=C.values||[];return new po(k,_)}(r.startAt));let m=null;return r.endAt&&(m=function(C){const _=!C.before,k=C.values||[];return new po(k,_)}(r.endAt)),Sm(e,c,p,h,w,"F",A,m)}function n1(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const r=Ur(e.unaryFilter.field);return dt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const o=Ur(e.unaryFilter.field);return dt.create(o,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const c=Ur(e.unaryFilter.field);return dt.create(c,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const h=Ur(e.unaryFilter.field);return dt.create(h,"!=",{nullValue:"NULL_VALUE"});default:return Ae()}}(n):n.fieldFilter!==void 0?function(e){return dt.create(Ur(e.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ae()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return Qn.create(e.compositeFilter.filters.map(r=>n1(r)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Ae()}}(e.compositeFilter.op))}(n):Ae()}function Ur(n){return Rt.fromServerFormat(n.fieldPath)}function o2(n){const e=[];return n.fields.forEach(r=>e.push(r.canonicalString())),{fieldPaths:e}}function a2(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l2{constructor(e,r,o,c){this.batchId=e,this.localWriteTime=r,this.baseMutations=o,this.mutations=c}applyToRemoteDocument(e,r){const o=r.mutationResults;for(let c=0;c<this.mutations.length;c++){const h=this.mutations[c];h.key.isEqual(e.key)&&Vm(h,e,o[c])}}applyToLocalView(e,r){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(r=Li(o,e,r,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(r=Li(o,e,r,this.localWriteTime));return r}applyToLocalDocumentSet(e,r){const o=e1();return this.mutations.forEach(c=>{const h=e.get(c.key),p=h.overlayedDocument;let w=this.applyToLocalView(p,h.mutatedFields);w=r.has(c.key)?null:w;const A=qf(p,w);A!==null&&o.set(c.key,A),p.isValidDocument()||p.convertToNoDocument(Ke.min())}),o}keys(){return this.mutations.reduce((e,r)=>e.add(r.key),Nt())}isEqual(e){return this.batchId===e.batchId&&qr(this.mutations,e.mutations,(r,o)=>Tu(r,o))&&qr(this.baseMutations,e.baseMutations,(r,o)=>Tu(r,o))}}class ql{constructor(e,r,o,c){this.batch=e,this.commitVersion=r,this.mutationResults=o,this.docVersions=c}static from(e,r,o){at(e.mutations.length===o.length);let c=zm;const h=e.mutations;for(let p=0;p<h.length;p++)c=c.insert(h[p].key,o[p].version);return new ql(e,r,o,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c2{constructor(e,r){this.largestBatchId=e,this.mutation=r}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u2{constructor(e){this.oe=e}}function h2(n){const e=s2({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?hl(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f2{constructor(){this.Ze=new d2}addToCollectionParentIndex(e,r){return this.Ze.add(r),G.resolve()}getCollectionParents(e,r){return G.resolve(this.Ze.getEntries(r))}addFieldIndex(e,r){return G.resolve()}deleteFieldIndex(e,r){return G.resolve()}getDocumentsMatchingTarget(e,r){return G.resolve(null)}getIndexType(e,r){return G.resolve(0)}getFieldIndexes(e,r){return G.resolve([])}getNextCollectionGroupToUpdate(e){return G.resolve(null)}getMinOffset(e,r){return G.resolve($n.min())}getMinOffsetFromCollectionGroup(e,r){return G.resolve($n.min())}updateCollectionGroup(e,r,o){return G.resolve()}updateIndexEntries(e,r){return G.resolve()}}class d2{constructor(){this.index={}}add(e){const r=e.lastSegment(),o=e.popLast(),c=this.index[r]||new Vt(nt.comparator),h=!c.has(o);return this.index[r]=c.add(o),h}has(e){const r=e.lastSegment(),o=e.popLast(),c=this.index[r];return c&&c.has(o)}getEntries(e){return(this.index[e]||new Vt(nt.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Vn(){return new ei(0)}static Sn(){return new ei(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g2{constructor(){this.changes=new ai(e=>e.toString(),(e,r)=>e.isEqual(r)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,r){this.assertNotApplied(),this.changes.set(e,on.newInvalidDocument(e).setReadTime(r))}getEntry(e,r){this.assertNotApplied();const o=this.changes.get(r);return o!==void 0?G.resolve(o):this.getFromCache(e,r)}getEntries(e,r){return this.getAllFromCache(e,r)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p2{constructor(e,r){this.overlayedDocument=e,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m2{constructor(e,r,o,c){this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=o,this.indexManager=c}getDocument(e,r){let o=null;return this.documentOverlayCache.getOverlay(e,r).next(c=>(o=c,this.remoteDocumentCache.getEntry(e,r))).next(c=>(o!==null&&Li(o.mutation,c,ln.empty(),gt.now()),c))}getDocuments(e,r){return this.remoteDocumentCache.getEntries(e,r).next(o=>this.getLocalViewOfDocuments(e,o,Nt()).next(()=>o))}getLocalViewOfDocuments(e,r,o=Nt()){const c=dr();return this.populateOverlays(e,c,r).next(()=>this.computeViews(e,r,c,o).next(h=>{let p=Hs();return h.forEach((w,A)=>{p=p.insert(w,A.overlayedDocument)}),p}))}getOverlayedDocuments(e,r){const o=dr();return this.populateOverlays(e,o,r).next(()=>this.computeViews(e,r,o,Nt()))}populateOverlays(e,r,o){const c=[];return o.forEach(h=>{r.has(h)||c.push(h)}),this.documentOverlayCache.getOverlays(e,c).next(h=>{h.forEach((p,w)=>{r.set(p,w)})})}computeViews(e,r,o,c){let h=wo();const p=Bi(),w=Bi();return r.forEach((A,m)=>{const C=o.get(m.key);c.has(m.key)&&(C===void 0||C.mutation instanceof _r)?h=h.insert(m.key,m):C!==void 0?(p.set(m.key,C.mutation.getFieldMask()),Li(C.mutation,m,C.mutation.getFieldMask(),gt.now())):p.set(m.key,ln.empty())}),this.recalculateAndSaveOverlays(e,h).next(A=>(A.forEach((m,C)=>p.set(m,C)),r.forEach((m,C)=>{var _;return w.set(m,new p2(C,(_=p.get(m))!==null&&_!==void 0?_:null))}),w))}recalculateAndSaveOverlays(e,r){const o=Bi();let c=new Yt((p,w)=>p-w),h=Nt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,r).next(p=>{for(const w of p)w.keys().forEach(A=>{const m=r.get(A);if(m===null)return;let C=o.get(A)||ln.empty();C=w.applyToLocalView(m,C),o.set(A,C);const _=(c.get(w.batchId)||Nt()).add(A);c=c.insert(w.batchId,_)})}).next(()=>{const p=[],w=c.getReverseIterator();for(;w.hasNext();){const A=w.getNext(),m=A.key,C=A.value,_=e1();C.forEach(k=>{if(!h.has(k)){const H=qf(r.get(k),o.get(k));H!==null&&_.set(k,H),h=h.add(k)}}),p.push(this.documentOverlayCache.saveOverlays(e,m,_))}return G.waitFor(p)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,r){return this.remoteDocumentCache.getEntries(e,r).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,r,o){return function(c){return me.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(e,r.path):Dm(r)?this.getDocumentsMatchingCollectionGroupQuery(e,r,o):this.getDocumentsMatchingCollectionQuery(e,r,o)}getNextDocuments(e,r,o,c){return this.remoteDocumentCache.getAllFromCollectionGroup(e,r,o,c).next(h=>{const p=c-h.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,r,o.largestBatchId,c-h.size):G.resolve(dr());let w=-1,A=h;return p.next(m=>G.forEach(m,(C,_)=>(w<_.largestBatchId&&(w=_.largestBatchId),h.get(C)?G.resolve():this.remoteDocumentCache.getEntry(e,C).next(k=>{A=A.insert(C,k)}))).next(()=>this.populateOverlays(e,m,h)).next(()=>this.computeViews(e,A,m,Nt())).next(C=>({batchId:w,changes:Jf(C)})))})}getDocumentsMatchingDocumentQuery(e,r){return this.getDocument(e,new me(r)).next(o=>{let c=Hs();return o.isFoundDocument()&&(c=c.insert(o.key,o)),c})}getDocumentsMatchingCollectionGroupQuery(e,r,o){const c=r.collectionGroup;let h=Hs();return this.indexManager.getCollectionParents(e,c).next(p=>G.forEach(p,w=>{const A=function(m,C){return new Vo(C,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(r,w.child(c));return this.getDocumentsMatchingCollectionQuery(e,A,o).next(m=>{m.forEach((C,_)=>{h=h.insert(C,_)})})}).next(()=>h))}getDocumentsMatchingCollectionQuery(e,r,o){let c;return this.documentOverlayCache.getOverlaysForCollection(e,r.path,o.largestBatchId).next(h=>(c=h,this.remoteDocumentCache.getDocumentsMatchingQuery(e,r,o,c))).next(h=>{c.forEach((w,A)=>{const m=A.getKey();h.get(m)===null&&(h=h.insert(m,on.newInvalidDocument(m)))});let p=Hs();return h.forEach((w,A)=>{const m=c.get(w);m!==void 0&&Li(m.mutation,A,ln.empty(),gt.now()),Yl(r,A)&&(p=p.insert(w,A))}),p})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x2{constructor(e){this.Tt=e,this.es=new Map,this.ns=new Map}getBundleMetadata(e,r){return G.resolve(this.es.get(r))}saveBundleMetadata(e,r){var o;return this.es.set(r.id,{id:(o=r).id,version:o.version,createTime:Xr(o.createTime)}),G.resolve()}getNamedQuery(e,r){return G.resolve(this.ns.get(r))}saveNamedQuery(e,r){return this.ns.set(r.name,function(o){return{name:o.name,query:h2(o.bundledQuery),readTime:Xr(o.readTime)}}(r)),G.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w2{constructor(){this.overlays=new Yt(me.comparator),this.ss=new Map}getOverlay(e,r){return G.resolve(this.overlays.get(r))}getOverlays(e,r){const o=dr();return G.forEach(r,c=>this.getOverlay(e,c).next(h=>{h!==null&&o.set(c,h)})).next(()=>o)}saveOverlays(e,r,o){return o.forEach((c,h)=>{this.ce(e,r,h)}),G.resolve()}removeOverlaysForBatchId(e,r,o){const c=this.ss.get(o);return c!==void 0&&(c.forEach(h=>this.overlays=this.overlays.remove(h)),this.ss.delete(o)),G.resolve()}getOverlaysForCollection(e,r,o){const c=dr(),h=r.length+1,p=new me(r.child("")),w=this.overlays.getIteratorFrom(p);for(;w.hasNext();){const A=w.getNext().value,m=A.getKey();if(!r.isPrefixOf(m.path))break;m.path.length===h&&A.largestBatchId>o&&c.set(A.getKey(),A)}return G.resolve(c)}getOverlaysForCollectionGroup(e,r,o,c){let h=new Yt((m,C)=>m-C);const p=this.overlays.getIterator();for(;p.hasNext();){const m=p.getNext().value;if(m.getKey().getCollectionGroup()===r&&m.largestBatchId>o){let C=h.get(m.largestBatchId);C===null&&(C=dr(),h=h.insert(m.largestBatchId,C)),C.set(m.getKey(),m)}}const w=dr(),A=h.getIterator();for(;A.hasNext()&&(A.getNext().value.forEach((m,C)=>w.set(m,C)),!(w.size()>=c)););return G.resolve(w)}ce(e,r,o){const c=this.overlays.get(o.key);if(c!==null){const p=this.ss.get(c.largestBatchId).delete(o.key);this.ss.set(c.largestBatchId,p)}this.overlays=this.overlays.insert(o.key,new c2(r,o));let h=this.ss.get(r);h===void 0&&(h=Nt(),this.ss.set(r,h)),this.ss.set(r,h.add(o.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl{constructor(){this.rs=new Vt(ft.os),this.us=new Vt(ft.cs)}isEmpty(){return this.rs.isEmpty()}addReference(e,r){const o=new ft(e,r);this.rs=this.rs.add(o),this.us=this.us.add(o)}hs(e,r){e.forEach(o=>this.addReference(o,r))}removeReference(e,r){this.ls(new ft(e,r))}fs(e,r){e.forEach(o=>this.removeReference(o,r))}ds(e){const r=new me(new nt([])),o=new ft(r,e),c=new ft(r,e+1),h=[];return this.us.forEachInRange([o,c],p=>{this.ls(p),h.push(p.key)}),h}_s(){this.rs.forEach(e=>this.ls(e))}ls(e){this.rs=this.rs.delete(e),this.us=this.us.delete(e)}ws(e){const r=new me(new nt([])),o=new ft(r,e),c=new ft(r,e+1);let h=Nt();return this.us.forEachInRange([o,c],p=>{h=h.add(p.key)}),h}containsKey(e){const r=new ft(e,0),o=this.rs.firstAfterOrEqual(r);return o!==null&&e.isEqual(o.key)}}class ft{constructor(e,r){this.key=e,this.gs=r}static os(e,r){return me.comparator(e.key,r.key)||Ve(e.gs,r.gs)}static cs(e,r){return Ve(e.gs,r.gs)||me.comparator(e.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E2{constructor(e,r){this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.ys=1,this.ps=new Vt(ft.os)}checkEmpty(e){return G.resolve(this.mutationQueue.length===0)}addMutationBatch(e,r,o,c){const h=this.ys;this.ys++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new l2(h,r,o,c);this.mutationQueue.push(p);for(const w of c)this.ps=this.ps.add(new ft(w.key,h)),this.indexManager.addToCollectionParentIndex(e,w.key.path.popLast());return G.resolve(p)}lookupMutationBatch(e,r){return G.resolve(this.Is(r))}getNextMutationBatchAfterBatchId(e,r){const o=r+1,c=this.Ts(o),h=c<0?0:c;return G.resolve(this.mutationQueue.length>h?this.mutationQueue[h]:null)}getHighestUnacknowledgedBatchId(){return G.resolve(this.mutationQueue.length===0?-1:this.ys-1)}getAllMutationBatches(e){return G.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,r){const o=new ft(r,0),c=new ft(r,Number.POSITIVE_INFINITY),h=[];return this.ps.forEachInRange([o,c],p=>{const w=this.Is(p.gs);h.push(w)}),G.resolve(h)}getAllMutationBatchesAffectingDocumentKeys(e,r){let o=new Vt(Ve);return r.forEach(c=>{const h=new ft(c,0),p=new ft(c,Number.POSITIVE_INFINITY);this.ps.forEachInRange([h,p],w=>{o=o.add(w.gs)})}),G.resolve(this.Es(o))}getAllMutationBatchesAffectingQuery(e,r){const o=r.path,c=o.length+1;let h=o;me.isDocumentKey(h)||(h=h.child(""));const p=new ft(new me(h),0);let w=new Vt(Ve);return this.ps.forEachWhile(A=>{const m=A.key.path;return!!o.isPrefixOf(m)&&(m.length===c&&(w=w.add(A.gs)),!0)},p),G.resolve(this.Es(w))}Es(e){const r=[];return e.forEach(o=>{const c=this.Is(o);c!==null&&r.push(c)}),r}removeMutationBatch(e,r){at(this.As(r.batchId,"removed")===0),this.mutationQueue.shift();let o=this.ps;return G.forEach(r.mutations,c=>{const h=new ft(c.key,r.batchId);return o=o.delete(h),this.referenceDelegate.markPotentiallyOrphaned(e,c.key)}).next(()=>{this.ps=o})}Pn(e){}containsKey(e,r){const o=new ft(r,0),c=this.ps.firstAfterOrEqual(o);return G.resolve(r.isEqual(c&&c.key))}performConsistencyCheck(e){return this.mutationQueue.length,G.resolve()}As(e,r){return this.Ts(e)}Ts(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Is(e){const r=this.Ts(e);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y2{constructor(e){this.Rs=e,this.docs=new Yt(me.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,r){const o=r.key,c=this.docs.get(o),h=c?c.size:0,p=this.Rs(r);return this.docs=this.docs.insert(o,{document:r.mutableCopy(),size:p}),this.size+=p-h,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const r=this.docs.get(e);r&&(this.docs=this.docs.remove(e),this.size-=r.size)}getEntry(e,r){const o=this.docs.get(r);return G.resolve(o?o.document.mutableCopy():on.newInvalidDocument(r))}getEntries(e,r){let o=wo();return r.forEach(c=>{const h=this.docs.get(c);o=o.insert(c,h?h.document.mutableCopy():on.newInvalidDocument(c))}),G.resolve(o)}getDocumentsMatchingQuery(e,r,o,c){let h=wo();const p=r.path,w=new me(p.child("")),A=this.docs.getIteratorFrom(w);for(;A.hasNext();){const{key:m,value:{document:C}}=A.getNext();if(!p.isPrefixOf(m.path))break;m.path.length>p.length+1||cm(lm(C),o)<=0||(c.has(C.key)||Yl(r,C))&&(h=h.insert(C.key,C.mutableCopy()))}return G.resolve(h)}getAllFromCollectionGroup(e,r,o,c){Ae()}Ps(e,r){return G.forEach(this.docs,o=>r(o))}newChangeBuffer(e){return new A2(this)}getSize(e){return G.resolve(this.size)}}class A2 extends g2{constructor(e){super(),this.Xn=e}applyChanges(e){const r=[];return this.changes.forEach((o,c)=>{c.isValidDocument()?r.push(this.Xn.addEntry(e,c)):this.Xn.removeEntry(o)}),G.waitFor(r)}getFromCache(e,r){return this.Xn.getEntry(e,r)}getAllFromCache(e,r){return this.Xn.getEntries(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I2{constructor(e){this.persistence=e,this.vs=new ai(r=>zl(r),Kl),this.lastRemoteSnapshotVersion=Ke.min(),this.highestTargetId=0,this.bs=0,this.Vs=new Zl,this.targetCount=0,this.Ss=ei.Vn()}forEachTarget(e,r){return this.vs.forEach((o,c)=>r(c)),G.resolve()}getLastRemoteSnapshotVersion(e){return G.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return G.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.Ss.next(),G.resolve(this.highestTargetId)}setTargetsMetadata(e,r,o){return o&&(this.lastRemoteSnapshotVersion=o),r>this.bs&&(this.bs=r),G.resolve()}xn(e){this.vs.set(e.target,e);const r=e.targetId;r>this.highestTargetId&&(this.Ss=new ei(r),this.highestTargetId=r),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,r){return this.xn(r),this.targetCount+=1,G.resolve()}updateTargetData(e,r){return this.xn(r),G.resolve()}removeTargetData(e,r){return this.vs.delete(r.target),this.Vs.ds(r.targetId),this.targetCount-=1,G.resolve()}removeTargets(e,r,o){let c=0;const h=[];return this.vs.forEach((p,w)=>{w.sequenceNumber<=r&&o.get(w.targetId)===null&&(this.vs.delete(p),h.push(this.removeMatchingKeysForTargetId(e,w.targetId)),c++)}),G.waitFor(h).next(()=>c)}getTargetCount(e){return G.resolve(this.targetCount)}getTargetData(e,r){const o=this.vs.get(r)||null;return G.resolve(o)}addMatchingKeys(e,r,o){return this.Vs.hs(r,o),G.resolve()}removeMatchingKeys(e,r,o){this.Vs.fs(r,o);const c=this.persistence.referenceDelegate,h=[];return c&&r.forEach(p=>{h.push(c.markPotentiallyOrphaned(e,p))}),G.waitFor(h)}removeMatchingKeysForTargetId(e,r){return this.Vs.ds(r),G.resolve()}getMatchingKeysForTargetId(e,r){const o=this.Vs.ws(r);return G.resolve(o)}containsKey(e,r){return G.resolve(this.Vs.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C2{constructor(e,r){this.Ds={},this.overlays={},this.Cs=new Df(0),this.xs=!1,this.xs=!0,this.referenceDelegate=e(this),this.Ns=new I2(this),this.indexManager=new f2,this.remoteDocumentCache=function(o){return new y2(o)}(o=>this.referenceDelegate.ks(o)),this.Tt=new u2(r),this.$s=new x2(this.Tt)}start(){return Promise.resolve()}shutdown(){return this.xs=!1,Promise.resolve()}get started(){return this.xs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let r=this.overlays[e.toKey()];return r||(r=new w2,this.overlays[e.toKey()]=r),r}getMutationQueue(e,r){let o=this.Ds[e.toKey()];return o||(o=new E2(r,this.referenceDelegate),this.Ds[e.toKey()]=o),o}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$s}runTransaction(e,r,o){re("MemoryPersistence","Starting transaction:",e);const c=new b2(this.Cs.next());return this.referenceDelegate.Ms(),o(c).next(h=>this.referenceDelegate.Os(c).next(()=>h)).toPromise().then(h=>(c.raiseOnCommittedEvent(),h))}Fs(e,r){return G.or(Object.values(this.Ds).map(o=>()=>o.containsKey(e,r)))}}class b2 extends hm{constructor(e){super(),this.currentSequenceNumber=e}}class $l{constructor(e){this.persistence=e,this.Bs=new Zl,this.Ls=null}static qs(e){return new $l(e)}get Us(){if(this.Ls)return this.Ls;throw Ae()}addReference(e,r,o){return this.Bs.addReference(o,r),this.Us.delete(o.toString()),G.resolve()}removeReference(e,r,o){return this.Bs.removeReference(o,r),this.Us.add(o.toString()),G.resolve()}markPotentiallyOrphaned(e,r){return this.Us.add(r.toString()),G.resolve()}removeTarget(e,r){this.Bs.ds(r.targetId).forEach(c=>this.Us.add(c.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,r.targetId).next(c=>{c.forEach(h=>this.Us.add(h.toString()))}).next(()=>o.removeTargetData(e,r))}Ms(){this.Ls=new Set}Os(e){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return G.forEach(this.Us,o=>{const c=me.fromPath(o);return this.Ks(e,c).next(h=>{h||r.removeEntry(c,Ke.min())})}).next(()=>(this.Ls=null,r.apply(e)))}updateLimboDocument(e,r){return this.Ks(e,r).next(o=>{o?this.Us.delete(r.toString()):this.Us.add(r.toString())})}ks(e){return 0}Ks(e,r){return G.or([()=>G.resolve(this.Bs.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(e,r),()=>this.persistence.Fs(e,r)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql{constructor(e,r,o,c){this.targetId=e,this.fromCache=r,this.Ci=o,this.xi=c}static Ni(e,r){let o=Nt(),c=Nt();for(const h of r.docChanges)switch(h.type){case 0:o=o.add(h.doc.key);break;case 1:c=c.add(h.doc.key)}return new Ql(e,r.fromCache,o,c)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T2{constructor(){this.ki=!1}initialize(e,r){this.$i=e,this.indexManager=r,this.ki=!0}getDocumentsMatchingQuery(e,r,o,c){return this.Mi(e,r).next(h=>h||this.Oi(e,r,c,o)).next(h=>h||this.Fi(e,r))}Mi(e,r){if(Iu(r))return G.resolve(null);let o=Jr(r);return this.indexManager.getIndexType(e,o).next(c=>c===0?null:(r.limit!==null&&c===1&&(r=hl(r,null,"F"),o=Jr(r)),this.indexManager.getDocumentsMatchingTarget(e,o).next(h=>{const p=Nt(...h);return this.$i.getDocuments(e,p).next(w=>this.indexManager.getMinOffset(e,o).next(A=>{const m=this.Bi(r,w);return this.Li(r,m,p,A.readTime)?this.Mi(e,hl(r,null,"F")):this.qi(e,m,r,A)}))})))}Oi(e,r,o,c){return Iu(r)||c.isEqual(Ke.min())?this.Fi(e,r):this.$i.getDocuments(e,o).next(h=>{const p=this.Bi(r,h);return this.Li(r,p,o,c)?this.Fi(e,r):(pu()<=Re.DEBUG&&re("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),Cu(r)),this.qi(e,p,r,am(c,-1)))})}Bi(e,r){let o=new Vt(Mm(e));return r.forEach((c,h)=>{Yl(e,h)&&(o=o.add(h))}),o}Li(e,r,o,c){if(e.limit===null)return!1;if(o.size!==r.size)return!0;const h=e.limitType==="F"?r.last():r.first();return!!h&&(h.hasPendingWrites||h.version.compareTo(c)>0)}Fi(e,r){return pu()<=Re.DEBUG&&re("QueryEngine","Using full collection scan to execute query:",Cu(r)),this.$i.getDocumentsMatchingQuery(e,r,$n.min())}qi(e,r,o,c){return this.$i.getDocumentsMatchingQuery(e,o,c).next(h=>(r.forEach(p=>{h=h.insert(p.key,p)}),h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _2{constructor(e,r,o,c){this.persistence=e,this.Ui=r,this.Tt=c,this.Ki=new Yt(Ve),this.Gi=new ai(h=>zl(h),Kl),this.Qi=new Map,this.ji=e.getRemoteDocumentCache(),this.Ns=e.getTargetCache(),this.$s=e.getBundleCache(),this.zi(o)}zi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new m2(this.ji,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ji.setIndexManager(this.indexManager),this.Ui.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>e.collect(r,this.Ki))}}function v2(n,e,r,o){return new _2(n,e,r,o)}async function r1(n,e){const r=Ge(n);return await r.persistence.runTransaction("Handle user change","readonly",o=>{let c;return r.mutationQueue.getAllMutationBatches(o).next(h=>(c=h,r.zi(e),r.mutationQueue.getAllMutationBatches(o))).next(h=>{const p=[],w=[];let A=Nt();for(const m of c){p.push(m.batchId);for(const C of m.mutations)A=A.add(C.key)}for(const m of h){w.push(m.batchId);for(const C of m.mutations)A=A.add(C.key)}return r.localDocuments.getDocuments(o,A).next(m=>({Wi:m,removedBatchIds:p,addedBatchIds:w}))})})}function S2(n,e){const r=Ge(n);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const c=e.batch.keys(),h=r.ji.newChangeBuffer({trackRemovals:!0});return function(p,w,A,m){const C=A.batch,_=C.keys();let k=G.resolve();return _.forEach(H=>{k=k.next(()=>m.getEntry(w,H)).next(q=>{const j=A.docVersions.get(H);at(j!==null),q.version.compareTo(j)<0&&(C.applyToRemoteDocument(q,A),q.isValidDocument()&&(q.setReadTime(A.commitVersion),m.addEntry(q)))})}),k.next(()=>p.mutationQueue.removeMutationBatch(w,C))}(r,o,e,h).next(()=>h.apply(o)).next(()=>r.mutationQueue.performConsistencyCheck(o)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(o,c,e.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(p){let w=Nt();for(let A=0;A<p.mutationResults.length;++A)p.mutationResults[A].transformResults.length>0&&(w=w.add(p.batch.mutations[A].key));return w}(e))).next(()=>r.localDocuments.getDocuments(o,c))})}function N2(n){const e=Ge(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",r=>e.Ns.getLastRemoteSnapshotVersion(r))}function R2(n,e){const r=Ge(n);return r.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}class Nu{constructor(){this.activeTargetIds=qm()}sr(e){this.activeTargetIds=this.activeTargetIds.add(e)}ir(e){this.activeTargetIds=this.activeTargetIds.delete(e)}nr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class O2{constructor(){this.Ur=new Nu,this.Kr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,r,o){}addLocalQueryTarget(e){return this.Ur.sr(e),this.Kr[e]||"not-current"}updateQueryState(e,r,o){this.Kr[e]=r}removeLocalQueryTarget(e){this.Ur.ir(e)}isLocalQueryTarget(e){return this.Ur.activeTargetIds.has(e)}clearQueryState(e){delete this.Kr[e]}getAllActiveQueryTargets(){return this.Ur.activeTargetIds}isActiveQueryTarget(e){return this.Ur.activeTargetIds.has(e)}start(){return this.Ur=new Nu,Promise.resolve()}handleUserChange(e,r,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D2{Gr(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru{constructor(){this.Qr=()=>this.jr(),this.zr=()=>this.Wr(),this.Hr=[],this.Jr()}Gr(e){this.Hr.push(e)}shutdown(){window.removeEventListener("online",this.Qr),window.removeEventListener("offline",this.zr)}Jr(){window.addEventListener("online",this.Qr),window.addEventListener("offline",this.zr)}jr(){re("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Hr)e(0)}Wr(){re("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Hr)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gs=null;function Pa(){return Gs===null?Gs=268435456+Math.round(2147483648*Math.random()):Gs++,"0x"+Gs.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M2={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k2{constructor(e){this.Yr=e.Yr,this.Zr=e.Zr}Xr(e){this.eo=e}no(e){this.so=e}onMessage(e){this.io=e}close(){this.Zr()}send(e){this.Yr(e)}ro(){this.eo()}oo(e){this.so(e)}uo(e){this.io(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _t="WebChannelConnection";class P2 extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const r=e.ssl?"https":"http";this.co=r+"://"+e.host,this.ao="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get ho(){return!1}lo(e,r,o,c,h){const p=Pa(),w=this.fo(e,r);re("RestConnection",`Sending RPC '${e}' ${p}:`,w,o);const A={};return this._o(A,c,h),this.wo(e,w,A,o).then(m=>(re("RestConnection",`Received RPC '${e}' ${p}: `,m),m),m=>{throw al("RestConnection",`RPC '${e}' ${p} failed with error: `,m,"url: ",w,"request:",o),m})}mo(e,r,o,c,h,p){return this.lo(e,r,o,c,h)}_o(e,r,o){e["X-Goog-Api-Client"]="gl-js/ fire/"+oi,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((c,h)=>e[h]=c),o&&o.headers.forEach((c,h)=>e[h]=c)}fo(e,r){const o=M2[e];return`${this.co}/v1/${r}:${o}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}wo(e,r,o,c){const h=Pa();return new Promise((p,w)=>{const A=new $p;A.setWithCredentials(!0),A.listenOnce(Yp.COMPLETE,()=>{try{switch(A.getLastErrorCode()){case ka.NO_ERROR:const C=A.getResponseJson();re(_t,`XHR for RPC '${e}' ${h} received:`,JSON.stringify(C)),p(C);break;case ka.TIMEOUT:re(_t,`RPC '${e}' ${h} timed out`),w(new ue(W.DEADLINE_EXCEEDED,"Request time out"));break;case ka.HTTP_ERROR:const _=A.getStatus();if(re(_t,`RPC '${e}' ${h} failed with status:`,_,"response text:",A.getResponseText()),_>0){let k=A.getResponseJson();Array.isArray(k)&&(k=k[0]);const H=k==null?void 0:k.error;if(H&&H.status&&H.message){const q=function(j){const Ce=j.toLowerCase().replace(/_/g,"-");return Object.values(W).indexOf(Ce)>=0?Ce:W.UNKNOWN}(H.status);w(new ue(q,H.message))}else w(new ue(W.UNKNOWN,"Server responded with status "+A.getStatus()))}else w(new ue(W.UNAVAILABLE,"Connection failed."));break;default:Ae()}}finally{re(_t,`RPC '${e}' ${h} completed.`)}});const m=JSON.stringify(c);re(_t,`RPC '${e}' ${h} sending request:`,c),A.send(r,"POST",m,o,15)})}yo(e,r,o){const c=Pa(),h=[this.co,"/","google.firestore.v1.Firestore","/",e,"/channel"],p=zp(),w=Kp(),A={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(A.xmlHttpFactory=new Zp({})),this._o(A.initMessageHeaders,r,o),A.encodeInitMessageHeaders=!0;const m=h.join("");re(_t,`Creating RPC '${e}' stream ${c}: ${m}`,A);const C=p.createWebChannel(m,A);let _=!1,k=!1;const H=new k2({Yr:j=>{k?re(_t,`Not sending because RPC '${e}' stream ${c} is closed:`,j):(_||(re(_t,`Opening RPC '${e}' stream ${c} transport.`),C.open(),_=!0),re(_t,`RPC '${e}' stream ${c} sending:`,j),C.send(j))},Zr:()=>C.close()}),q=(j,Ce,De)=>{j.listen(Ce,he=>{try{De(he)}catch(Y){setTimeout(()=>{throw Y},0)}})};return q(C,Fs.EventType.OPEN,()=>{k||re(_t,`RPC '${e}' stream ${c} transport opened.`)}),q(C,Fs.EventType.CLOSE,()=>{k||(k=!0,re(_t,`RPC '${e}' stream ${c} transport closed`),H.oo())}),q(C,Fs.EventType.ERROR,j=>{k||(k=!0,al(_t,`RPC '${e}' stream ${c} transport errored:`,j),H.oo(new ue(W.UNAVAILABLE,"The operation could not be completed")))}),q(C,Fs.EventType.MESSAGE,j=>{var Ce;if(!k){const De=j.data[0];at(!!De);const he=De,Y=he.error||((Ce=he[0])===null||Ce===void 0?void 0:Ce.error);if(Y){re(_t,`RPC '${e}' stream ${c} received error:`,Y);const fe=Y.status;let rt=function(V){const xe=tt[V];if(xe!==void 0)return Xm(xe)}(fe),de=Y.message;rt===void 0&&(rt=W.INTERNAL,de="Unknown error status: "+fe+" with message "+Y.message),k=!0,H.oo(new ue(rt,de)),C.close()}else re(_t,`RPC '${e}' stream ${c} received:`,De),H.uo(De)}}),q(w,qp.STAT_EVENT,j=>{j.stat===du.PROXY?re(_t,`RPC '${e}' stream ${c} detected buffering proxy`):j.stat===du.NOPROXY&&re(_t,`RPC '${e}' stream ${c} detected no buffering proxy`)}),setTimeout(()=>{H.ro()},0),H}}function La(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wo(n){return new Zm(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i1{constructor(e,r,o=1e3,c=1.5,h=6e4){this.Ys=e,this.timerId=r,this.po=o,this.Io=c,this.To=h,this.Eo=0,this.Ao=null,this.Ro=Date.now(),this.reset()}reset(){this.Eo=0}Po(){this.Eo=this.To}vo(e){this.cancel();const r=Math.floor(this.Eo+this.bo()),o=Math.max(0,Date.now()-this.Ro),c=Math.max(0,r-o);c>0&&re("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.Eo} ms, delay with jitter: ${r} ms, last attempt: ${o} ms ago)`),this.Ao=this.Ys.enqueueAfterDelay(this.timerId,c,()=>(this.Ro=Date.now(),e())),this.Eo*=this.Io,this.Eo<this.po&&(this.Eo=this.po),this.Eo>this.To&&(this.Eo=this.To)}Vo(){this.Ao!==null&&(this.Ao.skipDelay(),this.Ao=null)}cancel(){this.Ao!==null&&(this.Ao.cancel(),this.Ao=null)}bo(){return(Math.random()-.5)*this.Eo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L2{constructor(e,r,o,c,h,p,w,A){this.Ys=e,this.So=o,this.Do=c,this.connection=h,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=w,this.listener=A,this.state=0,this.Co=0,this.xo=null,this.No=null,this.stream=null,this.ko=new i1(e,r)}$o(){return this.state===1||this.state===5||this.Mo()}Mo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Oo()}async stop(){this.$o()&&await this.close(0)}Fo(){this.state=0,this.ko.reset()}Bo(){this.Mo()&&this.xo===null&&(this.xo=this.Ys.enqueueAfterDelay(this.So,6e4,()=>this.Lo()))}qo(e){this.Uo(),this.stream.send(e)}async Lo(){if(this.Mo())return this.close(0)}Uo(){this.xo&&(this.xo.cancel(),this.xo=null)}Ko(){this.No&&(this.No.cancel(),this.No=null)}async close(e,r){this.Uo(),this.Ko(),this.ko.cancel(),this.Co++,e!==4?this.ko.reset():r&&r.code===W.RESOURCE_EXHAUSTED?(Ar(r.toString()),Ar("Using maximum backoff delay to prevent overloading the backend."),this.ko.Po()):r&&r.code===W.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Go(),this.stream.close(),this.stream=null),this.state=e,await this.listener.no(r)}Go(){}auth(){this.state=1;const e=this.Qo(this.Co),r=this.Co;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,c])=>{this.Co===r&&this.jo(o,c)},o=>{e(()=>{const c=new ue(W.UNKNOWN,"Fetching auth token failed: "+o.message);return this.zo(c)})})}jo(e,r){const o=this.Qo(this.Co);this.stream=this.Wo(e,r),this.stream.Xr(()=>{o(()=>(this.state=2,this.No=this.Ys.enqueueAfterDelay(this.Do,1e4,()=>(this.Mo()&&(this.state=3),Promise.resolve())),this.listener.Xr()))}),this.stream.no(c=>{o(()=>this.zo(c))}),this.stream.onMessage(c=>{o(()=>this.onMessage(c))})}Oo(){this.state=5,this.ko.vo(async()=>{this.state=0,this.start()})}zo(e){return re("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Qo(e){return r=>{this.Ys.enqueueAndForget(()=>this.Co===e?r():(re("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class B2 extends L2{constructor(e,r,o,c,h,p){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,o,c,p),this.Tt=h,this.Zo=!1}get Xo(){return this.Zo}start(){this.Zo=!1,this.lastStreamToken=void 0,super.start()}Go(){this.Zo&&this.tu([])}Wo(e,r){return this.connection.yo("Write",e,r)}onMessage(e){if(at(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Zo){this.ko.reset();const r=i2(e.writeResults,e.commitTime),o=Xr(e.commitTime);return this.listener.eu(o,r)}return at(!e.writeResults||e.writeResults.length===0),this.Zo=!0,this.listener.nu()}su(){const e={};e.database=t2(this.Tt),this.qo(e)}tu(e){const r={streamToken:this.lastStreamToken,writes:e.map(o=>r2(this.Tt,o))};this.qo(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F2 extends class{}{constructor(e,r,o,c){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=o,this.Tt=c,this.iu=!1}ru(){if(this.iu)throw new ue(W.FAILED_PRECONDITION,"The client has already been terminated.")}lo(e,r,o){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,h])=>this.connection.lo(e,r,o,c,h)).catch(c=>{throw c.name==="FirebaseError"?(c.code===W.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new ue(W.UNKNOWN,c.toString())})}mo(e,r,o,c){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([h,p])=>this.connection.mo(e,r,o,h,p,c)).catch(h=>{throw h.name==="FirebaseError"?(h.code===W.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),h):new ue(W.UNKNOWN,h.toString())})}terminate(){this.iu=!0}}class U2{constructor(e,r){this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.ou=0,this.uu=null,this.cu=!0}au(){this.ou===0&&(this.hu("Unknown"),this.uu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.uu=null,this.lu("Backend didn't respond within 10 seconds."),this.hu("Offline"),Promise.resolve())))}fu(e){this.state==="Online"?this.hu("Unknown"):(this.ou++,this.ou>=1&&(this.du(),this.lu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.hu("Offline")))}set(e){this.du(),this.ou=0,e==="Online"&&(this.cu=!1),this.hu(e)}hu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}lu(e){const r=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.cu?(Ar(r),this.cu=!1):re("OnlineStateTracker",r)}du(){this.uu!==null&&(this.uu.cancel(),this.uu=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V2{constructor(e,r,o,c,h){this.localStore=e,this.datastore=r,this.asyncQueue=o,this.remoteSyncer={},this._u=[],this.wu=new Map,this.mu=new Set,this.gu=[],this.yu=h,this.yu.Gr(p=>{o.enqueueAndForget(async()=>{xs(this)&&(re("RemoteStore","Restarting streams for network reachability change."),await async function(w){const A=Ge(w);A.mu.add(4),await ms(A),A.pu.set("Unknown"),A.mu.delete(4),await Xo(A)}(this))})}),this.pu=new U2(o,c)}}async function Xo(n){if(xs(n))for(const e of n.gu)await e(!0)}async function ms(n){for(const e of n.gu)await e(!1)}function xs(n){return Ge(n).mu.size===0}async function s1(n,e,r){if(!Uo(e))throw e;n.mu.add(1),await ms(n),n.pu.set("Offline"),r||(r=()=>N2(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{re("RemoteStore","Retrying IndexedDB access"),await r(),n.mu.delete(1),await Xo(n)})}function o1(n,e){return e().catch(r=>s1(n,r,e))}async function jo(n){const e=Ge(n),r=Jn(e);let o=e._u.length>0?e._u[e._u.length-1].batchId:-1;for(;H2(e);)try{const c=await R2(e.localStore,o);if(c===null){e._u.length===0&&r.Bo();break}o=c.batchId,G2(e,c)}catch(c){await s1(e,c)}a1(e)&&l1(e)}function H2(n){return xs(n)&&n._u.length<10}function G2(n,e){n._u.push(e);const r=Jn(n);r.Mo()&&r.Xo&&r.tu(e.mutations)}function a1(n){return xs(n)&&!Jn(n).$o()&&n._u.length>0}function l1(n){Jn(n).start()}async function W2(n){Jn(n).su()}async function X2(n){const e=Jn(n);for(const r of n._u)e.tu(r.mutations)}async function j2(n,e,r){const o=n._u.shift(),c=ql.from(o,e,r);await o1(n,()=>n.remoteSyncer.applySuccessfulWrite(c)),await jo(n)}async function z2(n,e){e&&Jn(n).Xo&&await async function(r,o){if(c=o.code,Wm(c)&&c!==W.ABORTED){const h=r._u.shift();Jn(r).Fo(),await o1(r,()=>r.remoteSyncer.rejectFailedWrite(h.batchId,o)),await jo(r)}var c}(n,e),a1(n)&&l1(n)}async function Ou(n,e){const r=Ge(n);r.asyncQueue.verifyOperationInProgress(),re("RemoteStore","RemoteStore received new credentials");const o=xs(r);r.mu.add(3),await ms(r),o&&r.pu.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.mu.delete(3),await Xo(r)}async function K2(n,e){const r=Ge(n);e?(r.mu.delete(2),await Xo(r)):e||(r.mu.add(2),await ms(r),r.pu.set("Unknown"))}function Jn(n){return n.Eu||(n.Eu=function(e,r,o){const c=Ge(e);return c.ru(),new B2(r,c.connection,c.authCredentials,c.appCheckCredentials,c.Tt,o)}(n.datastore,n.asyncQueue,{Xr:W2.bind(null,n),no:z2.bind(null,n),nu:X2.bind(null,n),eu:j2.bind(null,n)}),n.gu.push(async e=>{e?(n.Eu.Fo(),await jo(n)):(await n.Eu.stop(),n._u.length>0&&(re("RemoteStore",`Stopping write stream with ${n._u.length} pending writes`),n._u=[]))})),n.Eu}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(e,r,o,c,h){this.asyncQueue=e,this.timerId=r,this.targetTimeMs=o,this.op=c,this.removalCallback=h,this.deferred=new mr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(p=>{})}static createAndSchedule(e,r,o,c,h){const p=Date.now()+o,w=new Jl(e,r,p,c,h);return w.start(o),w}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ue(W.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function c1(n,e){if(Ar("AsyncQueue",`${e}: ${n}`),Uo(n))return new ue(W.UNAVAILABLE,`${e}: ${n}`);throw n}class Y2{constructor(){this.queries=new ai(e=>Gf(e),Hf),this.onlineState="Unknown",this.vu=new Set}}function q2(n){n.vu.forEach(e=>{e.next()})}class Z2{constructor(e,r,o,c,h,p){this.localStore=e,this.remoteStore=r,this.eventManager=o,this.sharedClientState=c,this.currentUser=h,this.maxConcurrentLimboResolutions=p,this.rc={},this.oc=new ai(w=>Gf(w),Hf),this.uc=new Map,this.cc=new Set,this.ac=new Yt(me.comparator),this.hc=new Map,this.lc=new Zl,this.fc={},this.dc=new Map,this._c=ei.Sn(),this.onlineState="Unknown",this.wc=void 0}get isPrimaryClient(){return this.wc===!0}}async function $2(n,e,r){const o=tx(n);try{const c=await function(h,p){const w=Ge(h),A=gt.now(),m=p.reduce((k,H)=>k.add(H.key),Nt());let C,_;return w.persistence.runTransaction("Locally write mutations","readwrite",k=>{let H=wo(),q=Nt();return w.ji.getEntries(k,m).next(j=>{H=j,H.forEach((Ce,De)=>{De.isValidDocument()||(q=q.add(Ce))})}).next(()=>w.localDocuments.getOverlayedDocuments(k,H)).next(j=>{C=j;const Ce=[];for(const De of p){const he=Hm(De,C.get(De.key).overlayedDocument);he!=null&&Ce.push(new _r(De.key,he,Vf(he.value.mapValue),Sn.exists(!0)))}return w.mutationQueue.addMutationBatch(k,A,Ce,p)}).next(j=>{_=j;const Ce=j.applyToLocalDocumentSet(C,q);return w.documentOverlayCache.saveOverlays(k,j.batchId,Ce)})}).then(()=>({batchId:_.batchId,changes:Jf(C)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(c.batchId),function(h,p,w){let A=h.fc[h.currentUser.toKey()];A||(A=new Yt(Ve)),A=A.insert(p,w),h.fc[h.currentUser.toKey()]=A}(o,c.batchId,r),await zo(o,c.changes),await jo(o.remoteStore)}catch(c){const h=c1(c,"Failed to persist write");r.reject(h)}}function Du(n,e,r){const o=Ge(n);if(o.isPrimaryClient&&r===0||!o.isPrimaryClient&&r===1){const c=[];o.oc.forEach((h,p)=>{const w=p.view.bu(e);w.snapshot&&c.push(w.snapshot)}),function(h,p){const w=Ge(h);w.onlineState=p;let A=!1;w.queries.forEach((m,C)=>{for(const _ of C.listeners)_.bu(p)&&(A=!0)}),A&&q2(w)}(o.eventManager,e),c.length&&o.rc.Ho(c),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function Q2(n,e){const r=Ge(n),o=e.batch.batchId;try{const c=await S2(r.localStore,e);h1(r,o,null),u1(r,o),r.sharedClientState.updateMutationState(o,"acknowledged"),await zo(r,c)}catch(c){await Of(c)}}async function J2(n,e,r){const o=Ge(n);try{const c=await function(h,p){const w=Ge(h);return w.persistence.runTransaction("Reject batch","readwrite-primary",A=>{let m;return w.mutationQueue.lookupMutationBatch(A,p).next(C=>(at(C!==null),m=C.keys(),w.mutationQueue.removeMutationBatch(A,C))).next(()=>w.mutationQueue.performConsistencyCheck(A)).next(()=>w.documentOverlayCache.removeOverlaysForBatchId(A,m,p)).next(()=>w.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(A,m)).next(()=>w.localDocuments.getDocuments(A,m))})}(o.localStore,e);h1(o,e,r),u1(o,e),o.sharedClientState.updateMutationState(e,"rejected",r),await zo(o,c)}catch(c){await Of(c)}}function u1(n,e){(n.dc.get(e)||[]).forEach(r=>{r.resolve()}),n.dc.delete(e)}function h1(n,e,r){const o=Ge(n);let c=o.fc[o.currentUser.toKey()];if(c){const h=c.get(e);h&&(r?h.reject(r):h.resolve(),c=c.remove(e)),o.fc[o.currentUser.toKey()]=c}}async function zo(n,e,r){const o=Ge(n),c=[],h=[],p=[];o.oc.isEmpty()||(o.oc.forEach((w,A)=>{p.push(o.mc(A,e,r).then(m=>{if((m||r)&&o.isPrimaryClient&&o.sharedClientState.updateQueryState(A.targetId,m!=null&&m.fromCache?"not-current":"current"),m){c.push(m);const C=Ql.Ni(A.targetId,m);h.push(C)}}))}),await Promise.all(p),o.rc.Ho(c),await async function(w,A){const m=Ge(w);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",C=>G.forEach(A,_=>G.forEach(_.Ci,k=>m.persistence.referenceDelegate.addReference(C,_.targetId,k)).next(()=>G.forEach(_.xi,k=>m.persistence.referenceDelegate.removeReference(C,_.targetId,k)))))}catch(C){if(!Uo(C))throw C;re("LocalStore","Failed to update sequence numbers: "+C)}for(const C of A){const _=C.targetId;if(!C.fromCache){const k=m.Ki.get(_),H=k.snapshotVersion,q=k.withLastLimboFreeSnapshotVersion(H);m.Ki=m.Ki.insert(_,q)}}}(o.localStore,h))}async function ex(n,e){const r=Ge(n);if(!r.currentUser.isEqual(e)){re("SyncEngine","User change. New user:",e.toKey());const o=await r1(r.localStore,e);r.currentUser=e,function(c,h){c.dc.forEach(p=>{p.forEach(w=>{w.reject(new ue(W.CANCELLED,h))})}),c.dc.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await zo(r,o.Wi)}}function tx(n){const e=Ge(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Q2.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=J2.bind(null,e),e}class nx{constructor(){this.synchronizeTabs=!1}async initialize(e){this.Tt=Wo(e.databaseInfo.databaseId),this.sharedClientState=this.Ic(e),this.persistence=this.Tc(e),await this.persistence.start(),this.localStore=this.Ec(e),this.gcScheduler=this.Ac(e,this.localStore),this.indexBackfillerScheduler=this.Rc(e,this.localStore)}Ac(e,r){return null}Rc(e,r){return null}Ec(e){return v2(this.persistence,new T2,e.initialUser,this.Tt)}Tc(e){return new C2($l.qs,this.Tt)}Ic(e){return new O2}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class rx{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>Du(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=ex.bind(null,this.syncEngine),await K2(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Y2}createDatastore(e){const r=Wo(e.databaseInfo.databaseId),o=(c=e.databaseInfo,new P2(c));var c;return function(h,p,w,A){return new F2(h,p,w,A)}(e.authCredentials,e.appCheckCredentials,o,r)}createRemoteStore(e){return r=this.localStore,o=this.datastore,c=e.asyncQueue,h=w=>Du(this.syncEngine,w,0),p=Ru.C()?new Ru:new D2,new V2(r,o,c,h,p);var r,o,c,h,p}createSyncEngine(e,r){return function(o,c,h,p,w,A,m){const C=new Z2(o,c,h,p,w,A);return m&&(C.wc=!0),C}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}terminate(){return async function(e){const r=Ge(e);re("RemoteStore","RemoteStore shutting down."),r.mu.add(5),await ms(r),r.yu.shutdown(),r.pu.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ix{constructor(e,r,o,c){this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=o,this.databaseInfo=c,this.user=St.UNAUTHENTICATED,this.clientId=Rf.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(o,async h=>{re("FirestoreClient","Received user=",h.uid),await this.authCredentialListener(h),this.user=h}),this.appCheckCredentials.start(o,h=>(re("FirestoreClient","Received new app check token=",h),this.appCheckCredentialListener(h,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new ue(W.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new mr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const o=c1(r,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function sx(n,e){n.asyncQueue.verifyOperationInProgress(),re("FirestoreClient","Initializing OfflineComponentProvider");const r=await n.getConfiguration();await e.initialize(r);let o=r.initialUser;n.setCredentialChangeListener(async c=>{o.isEqual(c)||(await r1(e.localStore,c),o=c)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}async function ox(n,e){n.asyncQueue.verifyOperationInProgress();const r=await ax(n);re("FirestoreClient","Initializing OnlineComponentProvider");const o=await n.getConfiguration();await e.initialize(r,o),n.setCredentialChangeListener(c=>Ou(e.remoteStore,c)),n.setAppCheckTokenChangeListener((c,h)=>Ou(e.remoteStore,h)),n.onlineComponents=e}async function ax(n){return n.offlineComponents||(re("FirestoreClient","Using default OfflineComponentProvider"),await sx(n,new nx)),n.offlineComponents}async function lx(n){return n.onlineComponents||(re("FirestoreClient","Using default OnlineComponentProvider"),await ox(n,new rx)),n.onlineComponents}function cx(n){return lx(n).then(e=>e.syncEngine)}const Mu=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ux(n,e,r){if(!r)throw new ue(W.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function hx(n,e,r,o){if(e===!0&&o===!0)throw new ue(W.INVALID_ARGUMENT,`${n} and ${r} cannot be used together.`)}function ku(n){if(!me.isDocumentKey(n))throw new ue(W.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ec(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ae()}function gl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ue(W.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=ec(n);throw new ue(W.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${r}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pu{constructor(e){var r;if(e.host===void 0){if(e.ssl!==void 0)throw new ue(W.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ue(W.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,hx("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,r,o,c){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=o,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Pu({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new ue(W.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new ue(W.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Pu(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Qp;switch(r.type){case"gapi":const o=r.client;return new nm(o,r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ue(W.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const r=Mu.get(e);r&&(re("ComponentProvider","Removing Datastore"),Mu.delete(e),r.terminate())}(this),Promise.resolve()}}function fx(n,e,r,o={}){var c;const h=(n=gl(n,tc))._getSettings();if(h.host!=="firestore.googleapis.com"&&h.host!==e&&al("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},h),{host:`${e}:${r}`,ssl:!1})),o.mockUserToken){let p,w;if(typeof o.mockUserToken=="string")p=o.mockUserToken,w=St.MOCK_USER;else{p=Nd(o.mockUserToken,(c=n._app)===null||c===void 0?void 0:c.options.projectId);const A=o.mockUserToken.sub||o.mockUserToken.user_id;if(!A)throw new ue(W.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new St(A)}n._authCredentials=new Jp(new Nf(p,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nn{constructor(e,r,o){this.converter=r,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new $i(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Nn(this.firestore,e,this._key)}}class nc{constructor(e,r,o){this.converter=r,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new nc(this.firestore,e,this._query)}}class $i extends nc{constructor(e,r,o){super(e,r,Nm(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Nn(this.firestore,null,new me(e))}withConverter(e){return new $i(this.firestore,e,this._path)}}function dx(n,e,...r){if(n=cn(n),arguments.length===1&&(e=Rf.R()),ux("doc","path",e),n instanceof tc){const o=nt.fromString(e,...r);return ku(o),new Nn(n,null,new me(o))}{if(!(n instanceof Nn||n instanceof $i))throw new ue(W.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(nt.fromString(e,...r));return ku(o),new Nn(n.firestore,n instanceof $i?n.converter:null,new me(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(){this.qc=Promise.resolve(),this.Uc=[],this.Kc=!1,this.Gc=[],this.Qc=null,this.jc=!1,this.zc=!1,this.Wc=[],this.ko=new i1(this,"async_queue_retry"),this.Hc=()=>{const r=La();r&&re("AsyncQueue","Visibility state changed to "+r.visibilityState),this.ko.Vo()};const e=La();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Hc)}get isShuttingDown(){return this.Kc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Jc(),this.Yc(e)}enterRestrictedMode(e){if(!this.Kc){this.Kc=!0,this.zc=e||!1;const r=La();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.Hc)}}enqueue(e){if(this.Jc(),this.Kc)return new Promise(()=>{});const r=new mr;return this.Yc(()=>this.Kc&&this.zc?Promise.resolve():(e().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Uc.push(e),this.Zc()))}async Zc(){if(this.Uc.length!==0){try{await this.Uc[0](),this.Uc.shift(),this.ko.reset()}catch(e){if(!Uo(e))throw e;re("AsyncQueue","Operation failed with retryable error: "+e)}this.Uc.length>0&&this.ko.vo(()=>this.Zc())}}Yc(e){const r=this.qc.then(()=>(this.jc=!0,e().catch(o=>{this.Qc=o,this.jc=!1;const c=function(h){let p=h.message||"";return h.stack&&(p=h.stack.includes(h.message)?h.stack:h.message+`
`+h.stack),p}(o);throw Ar("INTERNAL UNHANDLED ERROR: ",c),o}).then(o=>(this.jc=!1,o))));return this.qc=r,r}enqueueAfterDelay(e,r,o){this.Jc(),this.Wc.indexOf(e)>-1&&(r=0);const c=Jl.createAndSchedule(this,e,r,o,h=>this.Xc(h));return this.Gc.push(c),c}Jc(){this.Qc&&Ae()}verifyOperationInProgress(){}async ta(){let e;do e=this.qc,await e;while(e!==this.qc)}ea(e){for(const r of this.Gc)if(r.timerId===e)return!0;return!1}na(e){return this.ta().then(()=>{this.Gc.sort((r,o)=>r.targetTimeMs-o.targetTimeMs);for(const r of this.Gc)if(r.skipDelay(),e!=="all"&&r.timerId===e)break;return this.ta()})}sa(e){this.Wc.push(e)}Xc(e){const r=this.Gc.indexOf(e);this.Gc.splice(r,1)}}class f1 extends tc{constructor(e,r,o,c){super(e,r,o,c),this.type="firestore",this._queue=new gx,this._persistenceKey=(c==null?void 0:c.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||d1(this),this._firestoreClient.terminate()}}function px(n,e){const r=typeof n=="object"?n:Ch(),o=typeof n=="string"?n:e||"(default)",c=Al(r,"firestore").getImmediate({identifier:o});if(!c._initialized){const h=_d("firestore");h&&fx(c,...h)}return c}function mx(n){return n._firestoreClient||d1(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function d1(n){var e;const r=n._freezeSettings(),o=function(c,h,p,w){return new fm(c,h,p,w.host,w.ssl,w.experimentalForceLongPolling,w.experimentalAutoDetectLongPolling,w.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._firestoreClient=new ix(n._authCredentials,n._appCheckCredentials,n._queue,o)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Qi(On.fromBase64String(e))}catch(r){throw new ue(W.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new Qi(On.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g1{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new ue(W.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Rt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p1{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m1{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new ue(W.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new ue(W.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ve(this._lat,e._lat)||Ve(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xx=/^__.*__$/;class wx{constructor(e,r,o){this.data=e,this.fieldMask=r,this.fieldTransforms=o}toMutation(e,r){return this.fieldMask!==null?new _r(e,this.data,this.fieldMask,r,this.fieldTransforms):new ps(e,this.data,r,this.fieldTransforms)}}function x1(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ae()}}class rc{constructor(e,r,o,c,h,p){this.settings=e,this.databaseId=r,this.Tt=o,this.ignoreUndefinedProperties=c,h===void 0&&this.ia(),this.fieldTransforms=h||[],this.fieldMask=p||[]}get path(){return this.settings.path}get ra(){return this.settings.ra}oa(e){return new rc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.Tt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ua(e){var r;const o=(r=this.path)===null||r===void 0?void 0:r.child(e),c=this.oa({path:o,ca:!1});return c.aa(e),c}ha(e){var r;const o=(r=this.path)===null||r===void 0?void 0:r.child(e),c=this.oa({path:o,ca:!1});return c.ia(),c}la(e){return this.oa({path:void 0,ca:!0})}fa(e){return Eo(e,this.settings.methodName,this.settings.da||!1,this.path,this.settings._a)}contains(e){return this.fieldMask.find(r=>e.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>e.isPrefixOf(r.field))!==void 0}ia(){if(this.path)for(let e=0;e<this.path.length;e++)this.aa(this.path.get(e))}aa(e){if(e.length===0)throw this.fa("Document fields must not be empty");if(x1(this.ra)&&xx.test(e))throw this.fa('Document fields cannot begin and end with "__"')}}class Ex{constructor(e,r,o){this.databaseId=e,this.ignoreUndefinedProperties=r,this.Tt=o||Wo(e)}wa(e,r,o,c=!1){return new rc({ra:e,methodName:r,_a:o,path:Rt.emptyPath(),ca:!1,da:c},this.databaseId,this.Tt,this.ignoreUndefinedProperties)}}function yx(n){const e=n._freezeSettings(),r=Wo(n._databaseId);return new Ex(n._databaseId,!!e.ignoreUndefinedProperties,r)}function Ax(n,e,r,o,c,h={}){const p=n.wa(h.merge||h.mergeFields?2:0,e,r,c);A1("Data must be an object, but it was:",p,o);const w=E1(o,p);let A,m;if(h.merge)A=new ln(p.fieldMask),m=p.fieldTransforms;else if(h.mergeFields){const C=[];for(const _ of h.mergeFields){const k=Ix(e,_,r);if(!p.contains(k))throw new ue(W.INVALID_ARGUMENT,`Field '${k}' is specified in your field mask but missing from your input data.`);Tx(C,k)||C.push(k)}A=new ln(C),m=p.fieldTransforms.filter(_=>A.covers(_.field))}else A=null,m=p.fieldTransforms;return new wx(new an(w),A,m)}function w1(n,e){if(y1(n=cn(n)))return A1("Unsupported field value:",e,n),E1(n,e);if(n instanceof p1)return function(r,o){if(!x1(o.ra))throw o.fa(`${r._methodName}() can only be used with update() and set()`);if(!o.path)throw o.fa(`${r._methodName}() is not currently supported inside arrays`);const c=r._toFieldTransform(o);c&&o.fieldTransforms.push(c)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.ca&&e.ra!==4)throw e.fa("Nested arrays are not supported");return function(r,o){const c=[];let h=0;for(const p of r){let w=w1(p,o.la(h));w==null&&(w={nullValue:"NULL_VALUE"}),c.push(w),h++}return{arrayValue:{values:c}}}(n,e)}return function(r,o){if((r=cn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Pm(o.Tt,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const c=gt.fromDate(r);return{timestampValue:fl(o.Tt,c)}}if(r instanceof gt){const c=new gt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:fl(o.Tt,c)}}if(r instanceof m1)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Qi)return{bytesValue:$m(o.Tt,r._byteString)};if(r instanceof Nn){const c=o.databaseId,h=r.firestore._databaseId;if(!h.isEqual(c))throw o.fa(`Document reference is for database ${h.projectId}/${h.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:t1(r.firestore._databaseId||o.databaseId,r._key.path)}}throw o.fa(`Unsupported field value: ${ec(r)}`)}(n,e)}function E1(n,e){const r={};return Mf(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):gs(n,(o,c)=>{const h=w1(c,e.ua(o));h!=null&&(r[o]=h)}),{mapValue:{fields:r}}}function y1(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof gt||n instanceof m1||n instanceof Qi||n instanceof Nn||n instanceof p1)}function A1(n,e,r){if(!y1(r)||!function(o){return typeof o=="object"&&o!==null&&(Object.getPrototypeOf(o)===Object.prototype||Object.getPrototypeOf(o)===null)}(r)){const o=ec(r);throw o==="an object"?e.fa(n+" a custom object"):e.fa(n+" "+o)}}function Ix(n,e,r){if((e=cn(e))instanceof g1)return e._internalPath;if(typeof e=="string")return bx(n,e);throw Eo("Field path arguments must be of type string or ",n,!1,void 0,r)}const Cx=new RegExp("[~\\*/\\[\\]]");function bx(n,e,r){if(e.search(Cx)>=0)throw Eo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,r);try{return new g1(...e.split("."))._internalPath}catch{throw Eo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,r)}}function Eo(n,e,r,o,c){const h=o&&!o.isEmpty(),p=c!==void 0;let w=`Function ${e}() called with invalid data`;r&&(w+=" (via `toFirestore()`)"),w+=". ";let A="";return(h||p)&&(A+=" (found",h&&(A+=` in field ${o}`),p&&(A+=` in document ${c}`),A+=")"),new ue(W.INVALID_ARGUMENT,w+n+A)}function Tx(n,e){return n.some(r=>r.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _x(n,e,r){let o;return o=n?r&&(r.merge||r.mergeFields)?n.toFirestore(e,r):n.toFirestore(e):e,o}function vx(n,e,r){n=gl(n,Nn);const o=gl(n.firestore,f1),c=_x(n.converter,e,r);return Sx(o,[Ax(yx(o),"setDoc",n._key,c,n.converter!==null,r).toMutation(n._key,Sn.none())])}function Sx(n,e){return function(r,o){const c=new mr;return r.asyncQueue.enqueueAndForget(async()=>$2(await cx(r),o,c)),c.promise}(mx(n),e)}(function(n,e=!0){(function(r){oi=r})(is),Kr(new wr("firestore",(r,{instanceIdentifier:o,options:c})=>{const h=r.getProvider("app").getImmediate(),p=new f1(new em(r.getProvider("auth-internal")),new im(r.getProvider("app-check-internal")),function(w,A){if(!Object.prototype.hasOwnProperty.apply(w.options,["projectId"]))throw new ue(W.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ho(w.options.projectId,A)}(h,o),h);return c=Object.assign({useFetchStreams:e},c),p._setSettings(c),p},"PUBLIC").setMultipleInstances(!0)),Zn(gu,"3.9.0",n),Zn(gu,"3.9.0","esm2017")})();function ic(n,e){var r={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(r[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,o=Object.getOwnPropertySymbols(n);c<o.length;c++)e.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(n,o[c])&&(r[o[c]]=n[o[c]]);return r}function I1(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Nx=I1,C1=new ns("auth","Firebase",I1());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lu=new El("@firebase/auth");function Ks(n,...e){Lu.logLevel<=Re.ERROR&&Lu.error(`Auth (${is}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function un(n,...e){throw sc(n,...e)}function yn(n,...e){return sc(n,...e)}function Rx(n,e,r){const o=Object.assign(Object.assign({},Nx()),{[e]:r});return new ns("auth","Firebase",o).create(e,{appName:n.name})}function sc(n,...e){if(typeof n!="string"){const r=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=n.name),n._errorFactory.create(r,...o)}return C1.create(n,...e)}function oe(n,e,...r){if(!n)throw sc(e,...r)}function _n(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ks(e),new Error(e)}function Dn(n,e){n||_n(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bu=new Map;function vn(n){Dn(n instanceof Function,"Expected a class definition");let e=Bu.get(n);return e?(Dn(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Bu.set(n,e),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ox(n,e){const r=Al(n,"auth");if(r.isInitialized()){const c=r.getImmediate(),h=r.getOptions();if(to(h,e!=null?e:{}))return c;un(c,"already-initialized")}return r.initialize({options:e})}function Dx(n,e){const r=(e==null?void 0:e.persistence)||[],o=(Array.isArray(r)?r:[r]).map(vn);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pl(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Mx(){return Fu()==="http:"||Fu()==="https:"}function Fu(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kx(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Mx()||Od()||"connection"in navigator)?navigator.onLine:!0}function Px(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e,r){this.shortDelay=e,this.longDelay=r,Dn(r>e,"Short delay should be less than long delay!"),this.isMobile=Rd()||Dd()}get(){return kx()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oc(n,e){Dn(n.emulator,"Emulator should always be set here");const{url:r}=n.emulator;return e?`${r}${e.startsWith("/")?e.slice(1):e}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b1{static initialize(e,r,o){this.fetchImpl=e,r&&(this.headersImpl=r),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;_n("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;_n("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;_n("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lx={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bx=new ws(3e4,6e4);function Ko(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Es(n,e,r,o,c={}){return T1(n,c,async()=>{let h={},p={};o&&(e==="GET"?p=o:h={body:JSON.stringify(o)});const w=rs(Object.assign({key:n.config.apiKey},p)).slice(1),A=await n._getAdditionalHeaders();return A["Content-Type"]="application/json",n.languageCode&&(A["X-Firebase-Locale"]=n.languageCode),b1.fetch()(_1(n,n.config.apiHost,r,w),Object.assign({method:e,headers:A,referrerPolicy:"no-referrer"},h))})}async function T1(n,e,r){n._canInitEmulator=!1;const o=Object.assign(Object.assign({},Lx),e);try{const c=new Fx(n),h=await Promise.race([r(),c.promise]);c.clearNetworkTimeout();const p=await h.json();if("needConfirmation"in p)throw Ws(n,"account-exists-with-different-credential",p);if(h.ok&&!("errorMessage"in p))return p;{const w=h.ok?p.errorMessage:p.error.message,[A,m]=w.split(" : ");if(A==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ws(n,"credential-already-in-use",p);if(A==="EMAIL_EXISTS")throw Ws(n,"email-already-in-use",p);if(A==="USER_DISABLED")throw Ws(n,"user-disabled",p);const C=o[A]||A.toLowerCase().replace(/[_\s]+/g,"-");if(m)throw Rx(n,C,m);un(n,C)}}catch(c){if(c instanceof Mn)throw c;un(n,"internal-error",{message:String(c)})}}async function Yo(n,e,r,o,c={}){const h=await Es(n,e,r,o,c);return"mfaPendingCredential"in h&&un(n,"multi-factor-auth-required",{_serverResponse:h}),h}function _1(n,e,r,o){const c=`${e}${r}?${o}`;return n.config.emulator?oc(n.config,c):`${n.config.apiScheme}://${c}`}class Fx{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((r,o)=>{this.timer=setTimeout(()=>o(yn(this.auth,"network-request-failed")),Bx.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ws(n,e,r){const o={appName:n.name};r.email&&(o.email=r.email),r.phoneNumber&&(o.phoneNumber=r.phoneNumber);const c=yn(n,e,o);return c.customData._tokenResponse=r,c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ux(n,e){return Es(n,"POST","/v1/accounts:delete",e)}async function Vx(n,e){return Es(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fi(n){if(!!n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Hx(n,e=!1){const r=cn(n),o=await r.getIdToken(e),c=ac(o);oe(c&&c.exp&&c.auth_time&&c.iat,r.auth,"internal-error");const h=typeof c.firebase=="object"?c.firebase:void 0,p=h==null?void 0:h.sign_in_provider;return{claims:c,token:o,authTime:Fi(Ba(c.auth_time)),issuedAtTime:Fi(Ba(c.iat)),expirationTime:Fi(Ba(c.exp)),signInProvider:p||null,signInSecondFactor:(h==null?void 0:h.sign_in_second_factor)||null}}function Ba(n){return Number(n)*1e3}function ac(n){const[e,r,o]=n.split(".");if(e===void 0||r===void 0||o===void 0)return Ks("JWT malformed, contained fewer than 3 sections"),null;try{const c=xh(r);return c?JSON.parse(c):(Ks("Failed to decode base64 JWT payload"),null)}catch(c){return Ks("Caught error parsing JWT payload as JSON",c==null?void 0:c.toString()),null}}function Gx(n){const e=ac(n);return oe(e,"internal-error"),oe(typeof e.exp<"u","internal-error"),oe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ji(n,e,r=!1){if(r)return e;try{return await e}catch(o){throw o instanceof Mn&&Wx(o)&&n.auth.currentUser===n&&await n.auth.signOut(),o}}function Wx({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xx{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var r;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const c=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{constructor(e,r){this.createdAt=e,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=Fi(this.lastLoginAt),this.creationTime=Fi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yo(n){var e;const r=n.auth,o=await n.getIdToken(),c=await Ji(n,Vx(r,{idToken:o}));oe(c==null?void 0:c.users.length,r,"internal-error");const h=c.users[0];n._notifyReloadListener(h);const p=!((e=h.providerUserInfo)===null||e===void 0)&&e.length?Kx(h.providerUserInfo):[],w=zx(n.providerData,p),A=n.isAnonymous,m=!(n.email&&h.passwordHash)&&!(w!=null&&w.length),C=A?m:!1,_={uid:h.localId,displayName:h.displayName||null,photoURL:h.photoUrl||null,email:h.email||null,emailVerified:h.emailVerified||!1,phoneNumber:h.phoneNumber||null,tenantId:h.tenantId||null,providerData:w,metadata:new v1(h.createdAt,h.lastLoginAt),isAnonymous:C};Object.assign(n,_)}async function jx(n){const e=cn(n);await yo(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function zx(n,e){return[...n.filter(o=>!e.some(c=>c.providerId===o.providerId)),...e]}function Kx(n){return n.map(e=>{var{providerId:r}=e,o=ic(e,["providerId"]);return{providerId:r,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yx(n,e){const r=await T1(n,{},async()=>{const o=rs({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:h}=n.config,p=_1(n,c,"/v1/token",`key=${h}`),w=await n._getAdditionalHeaders();return w["Content-Type"]="application/x-www-form-urlencoded",b1.fetch()(p,{method:"POST",headers:w,body:o})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){oe(e.idToken,"internal-error"),oe(typeof e.idToken<"u","internal-error"),oe(typeof e.refreshToken<"u","internal-error");const r="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Gx(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,r)}async getToken(e,r=!1){return oe(!this.accessToken||this.refreshToken,e,"user-token-expired"),!r&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,r){const{accessToken:o,refreshToken:c,expiresIn:h}=await Yx(e,r);this.updateTokensAndExpiration(o,c,Number(h))}updateTokensAndExpiration(e,r,o){this.refreshToken=r||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,r){const{refreshToken:o,accessToken:c,expirationTime:h}=r,p=new es;return o&&(oe(typeof o=="string","internal-error",{appName:e}),p.refreshToken=o),c&&(oe(typeof c=="string","internal-error",{appName:e}),p.accessToken=c),h&&(oe(typeof h=="number","internal-error",{appName:e}),p.expirationTime=h),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new es,this.toJSON())}_performRefresh(){return _n("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wn(n,e){oe(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class xr{constructor(e){var{uid:r,auth:o,stsTokenManager:c}=e,h=ic(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Xx(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=o,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=h.displayName||null,this.email=h.email||null,this.emailVerified=h.emailVerified||!1,this.phoneNumber=h.phoneNumber||null,this.photoURL=h.photoURL||null,this.isAnonymous=h.isAnonymous||!1,this.tenantId=h.tenantId||null,this.providerData=h.providerData?[...h.providerData]:[],this.metadata=new v1(h.createdAt||void 0,h.lastLoginAt||void 0)}async getIdToken(e){const r=await Ji(this,this.stsTokenManager.getToken(this.auth,e));return oe(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(e){return Hx(this,e)}reload(){return jx(this)}_assign(e){this!==e&&(oe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(r=>Object.assign({},r)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const r=new xr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(e){oe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,r=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),r&&await yo(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Ji(this,Ux(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,r){var o,c,h,p,w,A,m,C;const _=(o=r.displayName)!==null&&o!==void 0?o:void 0,k=(c=r.email)!==null&&c!==void 0?c:void 0,H=(h=r.phoneNumber)!==null&&h!==void 0?h:void 0,q=(p=r.photoURL)!==null&&p!==void 0?p:void 0,j=(w=r.tenantId)!==null&&w!==void 0?w:void 0,Ce=(A=r._redirectEventId)!==null&&A!==void 0?A:void 0,De=(m=r.createdAt)!==null&&m!==void 0?m:void 0,he=(C=r.lastLoginAt)!==null&&C!==void 0?C:void 0,{uid:Y,emailVerified:fe,isAnonymous:rt,providerData:de,stsTokenManager:V}=r;oe(Y&&V,e,"internal-error");const xe=es.fromJSON(this.name,V);oe(typeof Y=="string",e,"internal-error"),Wn(_,e.name),Wn(k,e.name),oe(typeof fe=="boolean",e,"internal-error"),oe(typeof rt=="boolean",e,"internal-error"),Wn(H,e.name),Wn(q,e.name),Wn(j,e.name),Wn(Ce,e.name),Wn(De,e.name),Wn(he,e.name);const B=new xr({uid:Y,auth:e,email:k,emailVerified:fe,displayName:_,isAnonymous:rt,photoURL:q,phoneNumber:H,tenantId:j,stsTokenManager:xe,createdAt:De,lastLoginAt:he});return de&&Array.isArray(de)&&(B.providerData=de.map(kt=>Object.assign({},kt))),Ce&&(B._redirectEventId=Ce),B}static async _fromIdTokenResponse(e,r,o=!1){const c=new es;c.updateFromServerResponse(r);const h=new xr({uid:r.localId,auth:e,stsTokenManager:c,isAnonymous:o});return await yo(h),h}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S1{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,r){this.storage[e]=r}async _get(e){const r=this.storage[e];return r===void 0?null:r}async _remove(e){delete this.storage[e]}_addListener(e,r){}_removeListener(e,r){}}S1.type="NONE";const Uu=S1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ys(n,e,r){return`firebase:${n}:${e}:${r}`}class jr{constructor(e,r,o){this.persistence=e,this.auth=r,this.userKey=o;const{config:c,name:h}=this.auth;this.fullUserKey=Ys(this.userKey,c.apiKey,h),this.fullPersistenceKey=Ys("persistence",c.apiKey,h),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?xr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,r,o="authUser"){if(!r.length)return new jr(vn(Uu),e,o);const c=(await Promise.all(r.map(async m=>{if(await m._isAvailable())return m}))).filter(m=>m);let h=c[0]||vn(Uu);const p=Ys(o,e.config.apiKey,e.name);let w=null;for(const m of r)try{const C=await m._get(p);if(C){const _=xr._fromJSON(e,C);m!==h&&(w=_),h=m;break}}catch{}const A=c.filter(m=>m._shouldAllowMigration);return!h._shouldAllowMigration||!A.length?new jr(h,e,o):(h=A[0],w&&await h._set(p,w.toJSON()),await Promise.all(r.map(async m=>{if(m!==h)try{await m._remove(p)}catch{}})),new jr(h,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vu(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(O1(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(N1(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(M1(e))return"Blackberry";if(k1(e))return"Webos";if(lc(e))return"Safari";if((e.includes("chrome/")||R1(e))&&!e.includes("edge/"))return"Chrome";if(D1(e))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=n.match(r);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function N1(n=Mt()){return/firefox\//i.test(n)}function lc(n=Mt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function R1(n=Mt()){return/crios\//i.test(n)}function O1(n=Mt()){return/iemobile/i.test(n)}function D1(n=Mt()){return/android/i.test(n)}function M1(n=Mt()){return/blackberry/i.test(n)}function k1(n=Mt()){return/webos/i.test(n)}function qo(n=Mt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function qx(n=Mt()){var e;return qo(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Zx(){return Md()&&document.documentMode===10}function P1(n=Mt()){return qo(n)||D1(n)||k1(n)||M1(n)||/windows phone/i.test(n)||O1(n)}function $x(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L1(n,e=[]){let r;switch(n){case"Browser":r=Vu(Mt());break;case"Worker":r=`${Vu(Mt())}-${n}`;break;default:r=n}const o=e.length?e.join(","):"FirebaseCore-web";return`${r}/JsCore/${is}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qx{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,r){const o=h=>new Promise((p,w)=>{try{const A=e(h);p(A)}catch(A){w(A)}});o.onAbort=r,this.queue.push(o);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const r=[];try{for(const o of this.queue)await o(e),o.onAbort&&r.push(o.onAbort)}catch(o){r.reverse();for(const c of r)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jx{constructor(e,r,o){this.app=e,this.heartbeatServiceProvider=r,this.config=o,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Hu(this),this.idTokenSubscription=new Hu(this),this.beforeStateQueue=new Qx(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=C1,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=o.sdkClientVersion}_initializeWithPersistence(e,r){return r&&(this._popupRedirectResolver=vn(r)),this._initializationPromise=this.queue(async()=>{var o,c;if(!this._deleted&&(this.persistenceManager=await jr.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var r;const o=await this.assertedPersistence.getCurrentUser();let c=o,h=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,w=c==null?void 0:c._redirectEventId,A=await this.tryRedirectSignIn(e);(!p||p===w)&&(A==null?void 0:A.user)&&(c=A.user,h=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(h)try{await this.beforeStateQueue.runMiddleware(c)}catch(p){c=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return oe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(e){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(e){try{await yo(e)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Px()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const r=e?cn(e):null;return r&&oe(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(e,r=!1){if(!this._deleted)return e&&oe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(vn(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ns("auth","Firebase",e())}onAuthStateChanged(e,r,o){return this.registerStateListener(this.authStateSubscription,e,r,o)}beforeAuthStateChanged(e,r){return this.beforeStateQueue.pushCallback(e,r)}onIdTokenChanged(e,r,o){return this.registerStateListener(this.idTokenSubscription,e,r,o)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,r){const o=await this.getOrInitRedirectPersistenceManager(r);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const r=e&&vn(e)||this._popupRedirectResolver;oe(r,this,"argument-error"),this.redirectPersistenceManager=await jr.create(this,[vn(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var r,o;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(r=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,r,o,c){if(this._deleted)return()=>{};const h=typeof r=="function"?r:r.next.bind(r),p=this._isInitialized?Promise.resolve():this._initializationPromise;return oe(p,this,"internal-error"),p.then(()=>h(this.currentUser)),typeof r=="function"?e.addObserver(r,o,c):e.addObserver(r)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return oe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=L1(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const r={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());return o&&(r["X-Firebase-Client"]=o),r}}function Zo(n){return cn(n)}class Hu{constructor(e){this.auth=e,this.observer=null,this.addObserver=Vd(r=>this.observer=r)}get next(){return oe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function ew(n,e,r){const o=Zo(n);oe(o._canInitEmulator,o,"emulator-config-failed"),oe(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const c=!!(r!=null&&r.disableWarnings),h=B1(e),{host:p,port:w}=tw(e),A=w===null?"":`:${w}`;o.config.emulator={url:`${h}//${p}${A}/`},o.settings.appVerificationDisabledForTesting=!0,o.emulatorConfig=Object.freeze({host:p,port:w,protocol:h.replace(":",""),options:Object.freeze({disableWarnings:c})}),c||nw()}function B1(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function tw(n){const e=B1(n),r=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!r)return{host:"",port:null};const o=r[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(o);if(c){const h=c[1];return{host:h,port:Gu(o.substr(h.length+1))}}else{const[h,p]=o.split(":");return{host:h,port:Gu(p)}}}function Gu(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function nw(){function n(){const e=document.createElement("p"),r=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(e,r){this.providerId=e,this.signInMethod=r}toJSON(){return _n("not implemented")}_getIdTokenResponse(e){return _n("not implemented")}_linkToIdToken(e,r){return _n("not implemented")}_getReauthenticationResolver(e){return _n("not implemented")}}async function rw(n,e){return Es(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iw(n,e){return Yo(n,"POST","/v1/accounts:signInWithPassword",Ko(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sw(n,e){return Yo(n,"POST","/v1/accounts:signInWithEmailLink",Ko(n,e))}async function ow(n,e){return Yo(n,"POST","/v1/accounts:signInWithEmailLink",Ko(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts extends cc{constructor(e,r,o,c=null){super("password",o),this._email=e,this._password=r,this._tenantId=c}static _fromEmailAndPassword(e,r){return new ts(e,r,"password")}static _fromEmailAndCode(e,r,o=null){return new ts(e,r,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e;if((r==null?void 0:r.email)&&(r==null?void 0:r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return iw(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return sw(e,{email:this._email,oobCode:this._password});default:un(e,"internal-error")}}async _linkToIdToken(e,r){switch(this.signInMethod){case"password":return rw(e,{idToken:r,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return ow(e,{idToken:r,email:this._email,oobCode:this._password});default:un(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zr(n,e){return Yo(n,"POST","/v1/accounts:signInWithIdp",Ko(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aw="http://localhost";class Cr extends cc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const r=new Cr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(r.idToken=e.idToken),e.accessToken&&(r.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(r.nonce=e.nonce),e.pendingToken&&(r.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(r.accessToken=e.oauthToken,r.secret=e.oauthTokenSecret):un("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:c}=r,h=ic(r,["providerId","signInMethod"]);if(!o||!c)return null;const p=new Cr(o,c);return p.idToken=h.idToken||void 0,p.accessToken=h.accessToken||void 0,p.secret=h.secret,p.nonce=h.nonce,p.pendingToken=h.pendingToken||null,p}_getIdTokenResponse(e){const r=this.buildRequest();return zr(e,r)}_linkToIdToken(e,r){const o=this.buildRequest();return o.idToken=r,zr(e,o)}_getReauthenticationResolver(e){const r=this.buildRequest();return r.autoCreate=!1,zr(e,r)}buildRequest(){const e={requestUri:aw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),e.postBody=rs(r)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lw(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function cw(n){const e=Ti(_i(n)).link,r=e?Ti(_i(e)).deep_link_id:null,o=Ti(_i(n)).deep_link_id;return(o?Ti(_i(o)).link:null)||o||r||e||n}class uc{constructor(e){var r,o,c,h,p,w;const A=Ti(_i(e)),m=(r=A.apiKey)!==null&&r!==void 0?r:null,C=(o=A.oobCode)!==null&&o!==void 0?o:null,_=lw((c=A.mode)!==null&&c!==void 0?c:null);oe(m&&C&&_,"argument-error"),this.apiKey=m,this.operation=_,this.code=C,this.continueUrl=(h=A.continueUrl)!==null&&h!==void 0?h:null,this.languageCode=(p=A.languageCode)!==null&&p!==void 0?p:null,this.tenantId=(w=A.tenantId)!==null&&w!==void 0?w:null}static parseLink(e){const r=cw(e);try{return new uc(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class li{constructor(){this.providerId=li.PROVIDER_ID}static credential(e,r){return ts._fromEmailAndPassword(e,r)}static credentialWithLink(e,r){const o=uc.parseLink(r);return oe(o,"argument-error"),ts._fromEmailAndCode(e,o.code,o.tenantId)}}li.PROVIDER_ID="password";li.EMAIL_PASSWORD_SIGN_IN_METHOD="password";li.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F1{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys extends F1{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xn extends ys{constructor(){super("facebook.com")}static credential(e){return Cr._fromParams({providerId:Xn.PROVIDER_ID,signInMethod:Xn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xn.credentialFromTaggedObject(e)}static credentialFromError(e){return Xn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xn.credential(e.oauthAccessToken)}catch{return null}}}Xn.FACEBOOK_SIGN_IN_METHOD="facebook.com";Xn.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn extends ys{constructor(){super("google.com"),this.addScope("profile")}static credential(e,r){return Cr._fromParams({providerId:jn.PROVIDER_ID,signInMethod:jn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}static credentialFromResult(e){return jn.credentialFromTaggedObject(e)}static credentialFromError(e){return jn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:r,oauthAccessToken:o}=e;if(!r&&!o)return null;try{return jn.credential(r,o)}catch{return null}}}jn.GOOGLE_SIGN_IN_METHOD="google.com";jn.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn extends ys{constructor(){super("github.com")}static credential(e){return Cr._fromParams({providerId:zn.PROVIDER_ID,signInMethod:zn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return zn.credentialFromTaggedObject(e)}static credentialFromError(e){return zn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return zn.credential(e.oauthAccessToken)}catch{return null}}}zn.GITHUB_SIGN_IN_METHOD="github.com";zn.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn extends ys{constructor(){super("twitter.com")}static credential(e,r){return Cr._fromParams({providerId:Kn.PROVIDER_ID,signInMethod:Kn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:r})}static credentialFromResult(e){return Kn.credentialFromTaggedObject(e)}static credentialFromError(e){return Kn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:r,oauthTokenSecret:o}=e;if(!r||!o)return null;try{return Kn.credential(r,o)}catch{return null}}}Kn.TWITTER_SIGN_IN_METHOD="twitter.com";Kn.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,r,o,c=!1){const h=await xr._fromIdTokenResponse(e,o,c),p=Wu(o);return new ti({user:h,providerId:p,_tokenResponse:o,operationType:r})}static async _forOperation(e,r,o){await e._updateTokensIfNecessary(o,!0);const c=Wu(o);return new ti({user:e,providerId:c,_tokenResponse:o,operationType:r})}}function Wu(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao extends Mn{constructor(e,r,o,c){var h;super(r.code,r.message),this.operationType=o,this.user=c,Object.setPrototypeOf(this,Ao.prototype),this.customData={appName:e.name,tenantId:(h=e.tenantId)!==null&&h!==void 0?h:void 0,_serverResponse:r.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,r,o,c){return new Ao(e,r,o,c)}}function U1(n,e,r,o){return(e==="reauthenticate"?r._getReauthenticationResolver(n):r._getIdTokenResponse(n)).catch(h=>{throw h.code==="auth/multi-factor-auth-required"?Ao._fromErrorAndOperation(n,h,e,o):h})}async function uw(n,e,r=!1){const o=await Ji(n,e._linkToIdToken(n.auth,await n.getIdToken()),r);return ti._forOperation(n,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hw(n,e,r=!1){const{auth:o}=n,c="reauthenticate";try{const h=await Ji(n,U1(o,c,e,n),r);oe(h.idToken,o,"internal-error");const p=ac(h.idToken);oe(p,o,"internal-error");const{sub:w}=p;return oe(n.uid===w,o,"user-mismatch"),ti._forOperation(n,c,h)}catch(h){throw(h==null?void 0:h.code)==="auth/user-not-found"&&un(o,"user-mismatch"),h}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V1(n,e,r=!1){const o="signIn",c=await U1(n,o,e),h=await ti._fromIdTokenResponse(n,o,c);return r||await n._updateCurrentUser(h.user),h}async function fw(n,e){return V1(Zo(n),e)}function dw(n,e,r){return fw(cn(n),li.credential(e,r))}function gw(n,e,r,o){return cn(n).onIdTokenChanged(e,r,o)}function pw(n,e,r){return cn(n).beforeAuthStateChanged(e,r)}const Io="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H1{constructor(e,r){this.storageRetriever=e,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(Io,"1"),this.storage.removeItem(Io),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,r){return this.storage.setItem(e,JSON.stringify(r)),Promise.resolve()}_get(e){const r=this.storage.getItem(e);return Promise.resolve(r?JSON.parse(r):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mw(){const n=Mt();return lc(n)||qo(n)}const xw=1e3,ww=10;class G1 extends H1{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,r)=>this.onStorageEvent(e,r),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=mw()&&$x(),this.fallbackToPolling=P1(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){const o=this.storage.getItem(r),c=this.localCache[r];o!==c&&e(r,c,o)}}onStorageEvent(e,r=!1){if(!e.key){this.forAllChangedKeys((p,w,A)=>{this.notifyListeners(p,A)});return}const o=e.key;if(r?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const p=this.storage.getItem(o);if(e.newValue!==p)e.newValue!==null?this.storage.setItem(o,e.newValue):this.storage.removeItem(o);else if(this.localCache[o]===e.newValue&&!r)return}const c=()=>{const p=this.storage.getItem(o);!r&&this.localCache[o]===p||this.notifyListeners(o,p)},h=this.storage.getItem(o);Zx()&&h!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,ww):c()}notifyListeners(e,r){this.localCache[e]=r;const o=this.listeners[e];if(o)for(const c of Array.from(o))c(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,r,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:r,newValue:o}),!0)})},xw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,r){await super._set(e,r),this.localCache[e]=JSON.stringify(r)}async _get(e){const r=await super._get(e);return this.localCache[e]=JSON.stringify(r),r}async _remove(e){await super._remove(e),delete this.localCache[e]}}G1.type="LOCAL";const Ew=G1;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W1 extends H1{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,r){}_removeListener(e,r){}}W1.type="SESSION";const X1=W1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yw(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const r=this.receivers.find(c=>c.isListeningto(e));if(r)return r;const o=new $o(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const r=e,{eventId:o,eventType:c,data:h}=r.data,p=this.handlersMap[c];if(!(p!=null&&p.size))return;r.ports[0].postMessage({status:"ack",eventId:o,eventType:c});const w=Array.from(p).map(async m=>m(r.origin,h)),A=await yw(w);r.ports[0].postMessage({status:"done",eventId:o,eventType:c,response:A})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$o.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hc(n="",e=10){let r="";for(let o=0;o<e;o++)r+=Math.floor(Math.random()*10);return n+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,r,o=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let h,p;return new Promise((w,A)=>{const m=hc("",20);c.port1.start();const C=setTimeout(()=>{A(new Error("unsupported_event"))},o);p={messageChannel:c,onMessage(_){const k=_;if(k.data.eventId===m)switch(k.data.status){case"ack":clearTimeout(C),h=setTimeout(()=>{A(new Error("timeout"))},3e3);break;case"done":clearTimeout(h),w(k.data.response);break;default:clearTimeout(C),clearTimeout(h),A(new Error("invalid_response"));break}}},this.handlers.add(p),c.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:e,eventId:m,data:r},[c.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function An(){return window}function Iw(n){An().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j1(){return typeof An().WorkerGlobalScope<"u"&&typeof An().importScripts=="function"}async function Cw(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function bw(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Tw(){return j1()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z1="firebaseLocalStorageDb",_w=1,Co="firebaseLocalStorage",K1="fbase_key";class As{constructor(e){this.request=e}toPromise(){return new Promise((e,r)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function Qo(n,e){return n.transaction([Co],e?"readwrite":"readonly").objectStore(Co)}function vw(){const n=indexedDB.deleteDatabase(z1);return new As(n).toPromise()}function ml(){const n=indexedDB.open(z1,_w);return new Promise((e,r)=>{n.addEventListener("error",()=>{r(n.error)}),n.addEventListener("upgradeneeded",()=>{const o=n.result;try{o.createObjectStore(Co,{keyPath:K1})}catch(c){r(c)}}),n.addEventListener("success",async()=>{const o=n.result;o.objectStoreNames.contains(Co)?e(o):(o.close(),await vw(),e(await ml()))})})}async function Xu(n,e,r){const o=Qo(n,!0).put({[K1]:e,value:r});return new As(o).toPromise()}async function Sw(n,e){const r=Qo(n,!1).get(e),o=await new As(r).toPromise();return o===void 0?null:o.value}function ju(n,e){const r=Qo(n,!0).delete(e);return new As(r).toPromise()}const Nw=800,Rw=3;class Y1{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ml(),this.db)}async _withRetries(e){let r=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(r++>Rw)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return j1()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$o._getInstance(Tw()),this.receiver._subscribe("keyChanged",async(e,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(e,r)=>["keyChanged"])}async initializeSender(){var e,r;if(this.activeServiceWorker=await Cw(),!this.activeServiceWorker)return;this.sender=new Aw(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);!o||((e=o[0])===null||e===void 0?void 0:e.fulfilled)&&((r=o[0])===null||r===void 0?void 0:r.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||bw()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ml();return await Xu(e,Io,"1"),await ju(e,Io),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,r){return this._withPendingWrite(async()=>(await this._withRetries(o=>Xu(o,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)))}async _get(e){const r=await this._withRetries(o=>Sw(o,e));return this.localCache[e]=r,r}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(r=>ju(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const h=Qo(c,!1).getAll();return new As(h).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const r=[],o=new Set;for(const{fbase_key:c,value:h}of e)o.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(h)&&(this.notifyListeners(c,h),r.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!o.has(c)&&(this.notifyListeners(c,null),r.push(c));return r}notifyListeners(e,r){this.localCache[e]=r;const o=this.listeners[e];if(o)for(const c of Array.from(o))c(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Nw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Y1.type="LOCAL";const Ow=Y1;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dw(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}function Mw(n){return new Promise((e,r)=>{const o=document.createElement("script");o.setAttribute("src",n),o.onload=e,o.onerror=c=>{const h=yn("internal-error");h.customData=c,r(h)},o.type="text/javascript",o.charset="UTF-8",Dw().appendChild(o)})}function kw(n){return`__${n}${Math.floor(Math.random()*1e6)}`}new ws(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pw(n,e){return e?vn(e):(oe(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fc extends cc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return zr(e,this._buildIdpRequest())}_linkToIdToken(e,r){return zr(e,this._buildIdpRequest(r))}_getReauthenticationResolver(e){return zr(e,this._buildIdpRequest())}_buildIdpRequest(e){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(r.idToken=e),r}}function Lw(n){return V1(n.auth,new fc(n),n.bypassAuthState)}function Bw(n){const{auth:e,user:r}=n;return oe(r,e,"internal-error"),hw(r,new fc(n),n.bypassAuthState)}async function Fw(n){const{auth:e,user:r}=n;return oe(r,e,"internal-error"),uw(r,new fc(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1{constructor(e,r,o,c,h=!1){this.auth=e,this.resolver=o,this.user=c,this.bypassAuthState=h,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(e,r)=>{this.pendingPromise={resolve:e,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:r,sessionId:o,postBody:c,tenantId:h,error:p,type:w}=e;if(p){this.reject(p);return}const A={auth:this.auth,requestUri:r,sessionId:o,tenantId:h||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(w)(A))}catch(m){this.reject(m)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Lw;case"linkViaPopup":case"linkViaRedirect":return Fw;case"reauthViaPopup":case"reauthViaRedirect":return Bw;default:un(this.auth,"internal-error")}}resolve(e){Dn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Dn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uw=new ws(2e3,1e4);class Hr extends q1{constructor(e,r,o,c,h){super(e,r,c,h),this.provider=o,this.authWindow=null,this.pollId=null,Hr.currentPopupAction&&Hr.currentPopupAction.cancel(),Hr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return oe(e,this.auth,"internal-error"),e}async onExecution(){Dn(this.filter.length===1,"Popup operations only handle one event");const e=hc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(yn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(yn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Hr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var r,o;if(!((o=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(yn(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,Uw.get())};e()}}Hr.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vw="pendingRedirect",qs=new Map;class Hw extends q1{constructor(e,r,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,o),this.eventId=null}async execute(){let e=qs.get(this.auth._key());if(!e){try{const o=await Gw(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(r){e=()=>Promise.reject(r)}qs.set(this.auth._key(),e)}return this.bypassAuthState||qs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const r=await this.auth._redirectUserForId(e.eventId);if(r)return this.user=r,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Gw(n,e){const r=jw(e),o=Xw(n);if(!await o._isAvailable())return!1;const c=await o._get(r)==="true";return await o._remove(r),c}function Ww(n,e){qs.set(n._key(),e)}function Xw(n){return vn(n._redirectPersistence)}function jw(n){return Ys(Vw,n.config.apiKey,n.name)}async function zw(n,e,r=!1){const o=Zo(n),c=Pw(o,e),p=await new Hw(o,c,r).execute();return p&&!r&&(delete p.user._redirectEventId,await o._persistUserIfCurrent(p.user),await o._setRedirectUser(null,e)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kw=10*60*1e3;class Yw{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let r=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(r=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!qw(e)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=e,r=!0)),r}sendToConsumer(e,r){var o;if(e.error&&!Z1(e)){const c=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";r.onError(yn(this.auth,c))}else r.onAuthEvent(e)}isEventForConsumer(e,r){const o=r.eventId===null||!!e.eventId&&e.eventId===r.eventId;return r.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Kw&&this.cachedEventUids.clear(),this.cachedEventUids.has(zu(e))}saveEventToCache(e){this.cachedEventUids.add(zu(e)),this.lastProcessedEventTime=Date.now()}}function zu(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Z1({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function qw(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Z1(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zw(n,e={}){return Es(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $w=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Qw=/^https?/;async function Jw(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Zw(n);for(const r of e)try{if(eE(r))return}catch{}un(n,"unauthorized-domain")}function eE(n){const e=pl(),{protocol:r,hostname:o}=new URL(e);if(n.startsWith("chrome-extension://")){const p=new URL(n);return p.hostname===""&&o===""?r==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):r==="chrome-extension:"&&p.hostname===o}if(!Qw.test(r))return!1;if($w.test(n))return o===n;const c=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tE=new ws(3e4,6e4);function Ku(){const n=An().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let r=0;r<n.CP.length;r++)n.CP[r]=null}}function nE(n){return new Promise((e,r)=>{var o,c,h;function p(){Ku(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ku(),r(yn(n,"network-request-failed"))},timeout:tE.get()})}if(!((c=(o=An().gapi)===null||o===void 0?void 0:o.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((h=An().gapi)===null||h===void 0)&&h.load)p();else{const w=kw("iframefcb");return An()[w]=()=>{gapi.load?p():r(yn(n,"network-request-failed"))},Mw(`https://apis.google.com/js/api.js?onload=${w}`).catch(A=>r(A))}}).catch(e=>{throw Zs=null,e})}let Zs=null;function rE(n){return Zs=Zs||nE(n),Zs}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE=new ws(5e3,15e3),sE="__/auth/iframe",oE="emulator/auth/iframe",aE={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},lE=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function cE(n){const e=n.config;oe(e.authDomain,n,"auth-domain-config-required");const r=e.emulator?oc(e,oE):`https://${n.config.authDomain}/${sE}`,o={apiKey:e.apiKey,appName:n.name,v:is},c=lE.get(n.config.apiHost);c&&(o.eid=c);const h=n._getFrameworks();return h.length&&(o.fw=h.join(",")),`${r}?${rs(o).slice(1)}`}async function uE(n){const e=await rE(n),r=An().gapi;return oe(r,n,"internal-error"),e.open({where:document.body,url:cE(n),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:aE,dontclear:!0},o=>new Promise(async(c,h)=>{await o.restyle({setHideOnLeave:!1});const p=yn(n,"network-request-failed"),w=An().setTimeout(()=>{h(p)},iE.get());function A(){An().clearTimeout(w),c(o)}o.ping(A).then(A,()=>{h(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hE={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},fE=500,dE=600,gE="_blank",pE="http://localhost";class Yu{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function mE(n,e,r,o=fE,c=dE){const h=Math.max((window.screen.availHeight-c)/2,0).toString(),p=Math.max((window.screen.availWidth-o)/2,0).toString();let w="";const A=Object.assign(Object.assign({},hE),{width:o.toString(),height:c.toString(),top:h,left:p}),m=Mt().toLowerCase();r&&(w=R1(m)?gE:r),N1(m)&&(e=e||pE,A.scrollbars="yes");const C=Object.entries(A).reduce((k,[H,q])=>`${k}${H}=${q},`,"");if(qx(m)&&w!=="_self")return xE(e||"",w),new Yu(null);const _=window.open(e||"",w,C);oe(_,n,"popup-blocked");try{_.focus()}catch{}return new Yu(_)}function xE(n,e){const r=document.createElement("a");r.href=n,r.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wE="__/auth/handler",EE="emulator/auth/handler";function qu(n,e,r,o,c,h){oe(n.config.authDomain,n,"auth-domain-config-required"),oe(n.config.apiKey,n,"invalid-api-key");const p={apiKey:n.config.apiKey,appName:n.name,authType:r,redirectUrl:o,v:is,eventId:c};if(e instanceof F1){e.setDefaultLanguage(n.languageCode),p.providerId=e.providerId||"",Ud(e.getCustomParameters())||(p.customParameters=JSON.stringify(e.getCustomParameters()));for(const[A,m]of Object.entries(h||{}))p[A]=m}if(e instanceof ys){const A=e.getScopes().filter(m=>m!=="");A.length>0&&(p.scopes=A.join(","))}n.tenantId&&(p.tid=n.tenantId);const w=p;for(const A of Object.keys(w))w[A]===void 0&&delete w[A];return`${yE(n)}?${rs(w).slice(1)}`}function yE({config:n}){return n.emulator?oc(n,EE):`https://${n.authDomain}/${wE}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fa="webStorageSupport";class AE{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=X1,this._completeRedirectFn=zw,this._overrideRedirectResult=Ww}async _openPopup(e,r,o,c){var h;Dn((h=this.eventManagers[e._key()])===null||h===void 0?void 0:h.manager,"_initialize() not called before _openPopup()");const p=qu(e,r,o,pl(),c);return mE(e,p,hc())}async _openRedirect(e,r,o,c){return await this._originValidation(e),Iw(qu(e,r,o,pl(),c)),new Promise(()=>{})}_initialize(e){const r=e._key();if(this.eventManagers[r]){const{manager:c,promise:h}=this.eventManagers[r];return c?Promise.resolve(c):(Dn(h,"If manager is not set, promise should be"),h)}const o=this.initAndGetManager(e);return this.eventManagers[r]={promise:o},o.catch(()=>{delete this.eventManagers[r]}),o}async initAndGetManager(e){const r=await uE(e),o=new Yw(e);return r.register("authEvent",c=>(oe(c==null?void 0:c.authEvent,e,"invalid-auth-event"),{status:o.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=r,o}_isIframeWebStorageSupported(e,r){this.iframes[e._key()].send(Fa,{type:Fa},c=>{var h;const p=(h=c==null?void 0:c[0])===null||h===void 0?void 0:h[Fa];p!==void 0&&r(!!p),un(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const r=e._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=Jw(e)),this.originValidationPromises[r]}get _shouldInitProactively(){return P1()||lc()||qo()}}const IE=AE;var Zu="@firebase/auth",$u="0.21.5";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const r=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const r=this.internalListeners.get(e);!r||(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}assertAuthConfigured(){oe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bE(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function TE(n){Kr(new wr("auth",(e,{options:r})=>{const o=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),{apiKey:h,authDomain:p}=o.options;return((w,A)=>{oe(h&&!h.includes(":"),"invalid-api-key",{appName:w.name}),oe(!(p!=null&&p.includes(":")),"argument-error",{appName:w.name});const m={apiKey:h,authDomain:p,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:L1(n)},C=new Jx(w,A,m);return Dx(C,r),C})(o,c)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,o)=>{e.getProvider("auth-internal").initialize()})),Kr(new wr("auth-internal",e=>{const r=Zo(e.getProvider("auth").getImmediate());return(o=>new CE(o))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),Zn(Zu,$u,bE(n)),Zn(Zu,$u,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _E=5*60,vE=Eh("authIdTokenMaxAge")||_E;let Qu=null;const SE=n=>async e=>{const r=e&&await e.getIdTokenResult(),o=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(o&&o>vE)return;const c=r==null?void 0:r.token;Qu!==c&&(Qu=c,await fetch(n,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))};function NE(n=Ch()){const e=Al(n,"auth");if(e.isInitialized())return e.getImmediate();const r=Ox(n,{popupRedirectResolver:IE,persistence:[Ow,Ew,X1]}),o=Eh("authTokenSyncURL");if(o){const h=SE(o);pw(r,h,()=>h(r.currentUser)),gw(r,p=>h(p))}const c=wh("auth");return c&&ew(r,`http://${c}`),r}TE("Browser");let $1;async function RE(n){const r=Ih({apiKey:"AIzaSyBR-UKnuOQ4eXJfhVLAT_MYDYDSiLDuh-s",authDomain:"scouting-6e3b0.firebaseapp.com",projectId:"scouting-6e3b0",storageBucket:"scouting-6e3b0.appspot.com",messagingSenderId:"1096923351613",appId:"1:1096923351613:web:4f2313a3d412a18f5c3854",measurementId:"G-4FEG1F5QK5"}),o=px(r),c=NE();return await dw(c,"scout@frc.com",n).then(h=>{console.log("Successfully signed in")}).catch(h=>(console.log("Could not sign in:",h),Promise.reject("Sign-in failed"))),$1=o,Promise.resolve(!0)}async function OE(n,e,r,o){const c=dx($1,`/teams/${n}/matches`,r),h={};h[e]={matchDetails:o},vx(c,h,{merge:!0}).then(()=>Promise.resolve(!0)).catch(p=>Promise.reject(`failed to save match ${n} #${e}: ${p}`))}function Ju(n){let e;return{c(){e=vt("div"),e.textContent="Successfully signed in",oh(e,"color","green")},m(r,o){ri(r,e,o)},d(r){r&&br(e)}}}function eh(n){let e;return{c(){e=vt("div"),e.textContent="Match data read!"},m(r,o){ri(r,e,o)},d(r){r&&br(e)}}}function th(n){let e,r,o;return{c(){e=vt("button"),e.textContent="Stop Scanning"},m(c,h){ri(c,e,h),r||(o=bi(e,"click",n[7]),r=!0)},p:gr,d(c){c&&br(e),r=!1,o()}}}function nh(n){let e,r,o,c;function h(w){n[10](w)}let p={close:n[7]};return n[1]!==void 0&&(p.result=n[1]),r=new wd({props:p}),Ua.push(()=>H0(r,"result",h)),{c(){e=vt("div"),G0(r.$$.fragment),Ni(e,"class","scanner-container svelte-asmgfm")},m(w,A){ri(w,e,A),lh(r,e,null),c=!0},p(w,A){const m={};!o&&A&2&&(o=!0,m.result=w[1],L0(()=>o=!1)),r.$set(m)},i(w){c||(Oi(r.$$.fragment,w),c=!0)},o(w){Wa(r.$$.fragment,w),c=!1},d(w){w&&br(e),ch(r)}}}function DE(n){let e,r,o,c,h,p,w,A,m,C,_,k,H,q,j,Ce,De,he,Y,fe,rt,de,V,xe,B,kt,lt,ie,le=n[2]===!0&&Ju(),_e=n[1]!==null&&eh(),M=n[4]&&th(n),we=n[4]&&nh(n);return{c(){e=vt("div"),r=vt("div"),o=vt("div"),o.textContent="Enter Password",c=wn(),h=vt("input"),p=wn(),w=vt("button"),w.textContent="Sign In",A=wn(),le&&le.c(),m=wn(),C=vt("div"),_e&&_e.c(),_=wn(),k=vt("button"),k.textContent="Scan match",H=wn(),M&&M.c(),q=wn(),j=vt("button"),j.textContent="Upload",Ce=wn(),De=vt("div"),he=Ci("Upload Status: "),Y=Ci(n[3]),fe=wn(),rt=vt("div"),de=vt("p"),V=Ci("Match Data: "),xe=Ci(n[1]),B=wn(),we&&we.c(),Ni(h,"type","text"),Ni(r,"class","mdown mtop svelte-asmgfm"),oh(de,"width","100px"),Ni(e,"class","main-container svelte-asmgfm")},m(Q,Ht){ri(Q,e,Ht),Xe(e,r),Xe(r,o),Xe(r,c),Xe(r,h),Lc(h,n[0]),Xe(r,p),Xe(r,w),Xe(r,A),le&&le.m(r,null),Xe(e,m),Xe(e,C),_e&&_e.m(C,null),Xe(C,_),Xe(C,k),Xe(C,H),M&&M.m(C,null),Xe(C,q),Xe(C,j),Xe(e,Ce),Xe(e,De),Xe(De,he),Xe(De,Y),Xe(e,fe),Xe(e,rt),Xe(rt,de),Xe(de,V),Xe(de,xe),Xe(e,B),we&&we.m(e,null),kt=!0,lt||(ie=[bi(h,"input",n[9]),bi(w,"click",n[5]),bi(k,"click",n[6]),bi(j,"click",n[8])],lt=!0)},p(Q,[Ht]){Ht&1&&h.value!==Q[0]&&Lc(h,Q[0]),Q[2]===!0?le||(le=Ju(),le.c(),le.m(r,null)):le&&(le.d(1),le=null),Q[1]!==null?_e||(_e=eh(),_e.c(),_e.m(C,_)):_e&&(_e.d(1),_e=null),Q[4]?M?M.p(Q,Ht):(M=th(Q),M.c(),M.m(C,q)):M&&(M.d(1),M=null),(!kt||Ht&8)&&Pc(Y,Q[3]),(!kt||Ht&2)&&Pc(xe,Q[1]),Q[4]?we?(we.p(Q,Ht),Ht&16&&Oi(we,1)):(we=nh(Q),we.c(),Oi(we,1),we.m(e,null)):we&&(U0(),Wa(we,1,1,()=>{we=null}),V0())},i(Q){kt||(Oi(we),kt=!0)},o(Q){Wa(we),kt=!1},d(Q){Q&&br(e),le&&le.d(),_e&&_e.d(),M&&M.d(),we&&we.d(),lt=!1,ni(ie)}}}function ME(n,e,r){let o="",c=null,h=!1,p="";function w(){RE(o).then(q=>{q===!0&&r(2,h=!0)})}let A=!1;function m(){r(1,c=null),r(4,A=!0)}function C(){r(4,A=!1)}function _(){OE(c.teamNumber.toString(),c.matchNumber.toString(),"PABEN",c.data).then(q=>{r(3,p="success")}).catch(q=>{r(3,p=q)})}function k(){o=this.value,r(0,o)}function H(q){c=q,r(1,c)}return[o,c,h,p,A,w,m,C,_,k,H]}class kE extends hh{constructor(e){super(),uh(this,e,ME,DE,sh,{})}}new kE({target:document.getElementById("app")});
